<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.3.0"/>
    <title>pyRdfa API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

            <h2>Contents</h2>
            <ul>
  <li><a href="#simple-usage">(Simple) Usage</a>
  <ul>
    <li><a href="#return-serialization-formats">Return (serialization) formats</a></li>
  </ul></li>
  <li><a href="#options">Options</a></li>
  <li><a href="#host-languages">Host Languages</a></li>
  <li><a href="#vocabularies">Vocabularies</a>
  <ul>
    <li><a href="#vocabulary-caching">Vocabulary caching</a></li>
  </ul></li>
  <li><a href="#rdfa-11-vs-rdfa-10">RDFa 1.1 vs. RDFa 1.0</a></li>
  <li><a href="#transformers">Transformers</a></li>
</ul>


            <h2>Submodules</h2>
            <ul>
                    <li><a href="pyRdfa/embeddedRDF.html">embeddedRDF</a></li>
                    <li><a href="pyRdfa/extras.html">extras</a></li>
                    <li><a href="pyRdfa/host.html">host</a></li>
                    <li><a href="pyRdfa/initialcontext.html">initialcontext</a></li>
                    <li><a href="pyRdfa/options.html">options</a></li>
                    <li><a href="pyRdfa/parse.html">parse</a></li>
                    <li><a href="pyRdfa/property.html">property</a></li>
                    <li><a href="pyRdfa/rdflibparsers.html">rdflibparsers</a></li>
                    <li><a href="pyRdfa/rdfs.html">rdfs</a></li>
                    <li><a href="pyRdfa/state.html">state</a></li>
                    <li><a href="pyRdfa/termorcurie.html">termorcurie</a></li>
                    <li><a href="pyRdfa/transform.html">transform</a></li>
                    <li><a href="pyRdfa/utils.html">utils</a></li>
            </ul>

            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#name">name</a>
            </li>
            <li>
                    <a class="variable" href="#ns_rdfa">ns_rdfa</a>
            </li>
            <li>
                    <a class="variable" href="#RDFA_VOCAB">RDFA_VOCAB</a>
            </li>
            <li>
                    <a class="variable" href="#ns_xsd">ns_xsd</a>
            </li>
            <li>
                    <a class="variable" href="#ns_distill">ns_distill</a>
            </li>
            <li>
                    <a class="variable" href="#debug">debug</a>
            </li>
            <li>
                    <a class="class" href="#RDFaError">RDFaError</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#RDFaError.__init__">RDFaError</a>
                        </li>
                        <li>
                                <a class="variable" href="#RDFaError.msg">msg</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#FailedSource">FailedSource</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#FailedSource.__init__">FailedSource</a>
                        </li>
                        <li>
                                <a class="variable" href="#FailedSource.msg">msg</a>
                        </li>
                        <li>
                                <a class="variable" href="#FailedSource.http_code">http_code</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#HTTPError">HTTPError</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#HTTPError.__init__">HTTPError</a>
                        </li>
                        <li>
                                <a class="variable" href="#HTTPError.msg">msg</a>
                        </li>
                        <li>
                                <a class="variable" href="#HTTPError.http_code">http_code</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ProcessingError">ProcessingError</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#pyRdfaError">pyRdfaError</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="variable" href="#RDFA_Error">RDFA_Error</a>
            </li>
            <li>
                    <a class="variable" href="#RDFA_Warning">RDFA_Warning</a>
            </li>
            <li>
                    <a class="variable" href="#RDFA_Info">RDFA_Info</a>
            </li>
            <li>
                    <a class="variable" href="#NonConformantMarkup">NonConformantMarkup</a>
            </li>
            <li>
                    <a class="variable" href="#UnresolvablePrefix">UnresolvablePrefix</a>
            </li>
            <li>
                    <a class="variable" href="#UnresolvableReference">UnresolvableReference</a>
            </li>
            <li>
                    <a class="variable" href="#UnresolvableTerm">UnresolvableTerm</a>
            </li>
            <li>
                    <a class="variable" href="#VocabReferenceError">VocabReferenceError</a>
            </li>
            <li>
                    <a class="variable" href="#PrefixRedefinitionWarning">PrefixRedefinitionWarning</a>
            </li>
            <li>
                    <a class="variable" href="#FileReferenceError">FileReferenceError</a>
            </li>
            <li>
                    <a class="variable" href="#HTError">HTError</a>
            </li>
            <li>
                    <a class="variable" href="#IncorrectPrefixDefinition">IncorrectPrefixDefinition</a>
            </li>
            <li>
                    <a class="variable" href="#IncorrectBlankNodeUsage">IncorrectBlankNodeUsage</a>
            </li>
            <li>
                    <a class="variable" href="#IncorrectLiteral">IncorrectLiteral</a>
            </li>
            <li>
                    <a class="variable" href="#err_no_blank_node">err_no_blank_node</a>
            </li>
            <li>
                    <a class="variable" href="#err_redefining_URI_as_prefix">err_redefining_URI_as_prefix</a>
            </li>
            <li>
                    <a class="variable" href="#err_xmlns_deprecated">err_xmlns_deprecated</a>
            </li>
            <li>
                    <a class="variable" href="#err_bnode_local_prefix">err_bnode_local_prefix</a>
            </li>
            <li>
                    <a class="variable" href="#err_col_local_prefix">err_col_local_prefix</a>
            </li>
            <li>
                    <a class="variable" href="#err_missing_URI_prefix">err_missing_URI_prefix</a>
            </li>
            <li>
                    <a class="variable" href="#err_invalid_prefix">err_invalid_prefix</a>
            </li>
            <li>
                    <a class="variable" href="#err_no_default_prefix">err_no_default_prefix</a>
            </li>
            <li>
                    <a class="variable" href="#err_prefix_and_xmlns">err_prefix_and_xmlns</a>
            </li>
            <li>
                    <a class="variable" href="#err_non_ncname_prefix">err_non_ncname_prefix</a>
            </li>
            <li>
                    <a class="variable" href="#err_absolute_reference">err_absolute_reference</a>
            </li>
            <li>
                    <a class="variable" href="#err_query_reference">err_query_reference</a>
            </li>
            <li>
                    <a class="variable" href="#err_fragment_reference">err_fragment_reference</a>
            </li>
            <li>
                    <a class="variable" href="#err_lang">err_lang</a>
            </li>
            <li>
                    <a class="variable" href="#err_URI_scheme">err_URI_scheme</a>
            </li>
            <li>
                    <a class="variable" href="#err_illegal_safe_CURIE">err_illegal_safe_CURIE</a>
            </li>
            <li>
                    <a class="variable" href="#err_no_CURIE_in_safe_CURIE">err_no_CURIE_in_safe_CURIE</a>
            </li>
            <li>
                    <a class="variable" href="#err_undefined_terms">err_undefined_terms</a>
            </li>
            <li>
                    <a class="variable" href="#err_non_legal_CURIE_ref">err_non_legal_CURIE_ref</a>
            </li>
            <li>
                    <a class="variable" href="#err_undefined_CURIE">err_undefined_CURIE</a>
            </li>
            <li>
                    <a class="variable" href="#err_prefix_redefinition">err_prefix_redefinition</a>
            </li>
            <li>
                    <a class="variable" href="#err_unusual_char_in_URI">err_unusual_char_in_URI</a>
            </li>
            <li>
                    <a class="variable" href="#CACHE_DIR_VAR">CACHE_DIR_VAR</a>
            </li>
            <li>
                    <a class="variable" href="#rdfa_current_version">rdfa_current_version</a>
            </li>
            <li>
                    <a class="variable" href="#registered_iana_schemes">registered_iana_schemes</a>
            </li>
            <li>
                    <a class="variable" href="#unofficial_common">unofficial_common</a>
            </li>
            <li>
                    <a class="variable" href="#historical_iana_schemes">historical_iana_schemes</a>
            </li>
            <li>
                    <a class="variable" href="#provisional_iana_schemes">provisional_iana_schemes</a>
            </li>
            <li>
                    <a class="variable" href="#other_used_schemes">other_used_schemes</a>
            </li>
            <li>
                    <a class="variable" href="#uri_schemes">uri_schemes</a>
            </li>
            <li>
                    <a class="variable" href="#builtInTransformers">builtInTransformers</a>
            </li>
            <li>
                    <a class="class" href="#pyRdfa">pyRdfa</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#pyRdfa.__init__">pyRdfa</a>
                        </li>
                        <li>
                                <a class="variable" href="#pyRdfa.http_status">http_status</a>
                        </li>
                        <li>
                                <a class="variable" href="#pyRdfa.base">base</a>
                        </li>
                        <li>
                                <a class="variable" href="#pyRdfa.charset">charset</a>
                        </li>
                        <li>
                                <a class="variable" href="#pyRdfa.media_type">media_type</a>
                        </li>
                        <li>
                                <a class="function" href="#pyRdfa.graph_from_DOM">graph_from_DOM</a>
                        </li>
                        <li>
                                <a class="function" href="#pyRdfa.graph_from_source">graph_from_source</a>
                        </li>
                        <li>
                                <a class="function" href="#pyRdfa.rdf_from_sources">rdf_from_sources</a>
                        </li>
                        <li>
                                <a class="function" href="#pyRdfa.rdf_from_source">rdf_from_source</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#processURI">processURI</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
pyRdfa    </h1>

                        <div class="docstring"><p>RDFa 1.1 parser, also referred to as a “RDFa Distiller”. It is
deployed, via a CGI front-end, on the U{W3C RDFa 1.1 Distiller page<a href="http://www.w3.org/2012/pyRdfa/">http://www.w3.org/2012/pyRdfa/</a>}.</p>

<p>For details on RDFa, the reader should consult the U{RDFa Core 1.1<a href="http://www.w3.org/TR/rdfa-core/">http://www.w3.org/TR/rdfa-core/</a>}, U{XHTML+RDFa1.1<a href="http://www.w3.org/TR/2010/xhtml-rdfa">http://www.w3.org/TR/2010/xhtml-rdfa</a>}, and the U{RDFa 1.1 Lite<a href="http://www.w3.org/TR/rdfa-lite/">http://www.w3.org/TR/rdfa-lite/</a>} documents.
The U{RDFa 1.1 Primer<a href="http://www.w3.org/TR/owl2-primer/">http://www.w3.org/TR/owl2-primer/</a>} may also prove helpful.</p>

<p>This package can also be downloaded U{from GitHub<a href="https://github.com/RDFLib/pyrdfa3">https://github.com/RDFLib/pyrdfa3</a>}. The
distribution also includes the CGI front-end and a separate utility script to be run locally.</p>

<p>Note that this package is an updated version of a U{previous RDFa distiller<a href="http://www.w3.org/2007/08/pyRdfa">http://www.w3.org/2007/08/pyRdfa</a>} that was developed
for RDFa 1.0. Although it reuses large portions of that code, it has been quite thoroughly rewritten, hence put in a completely
different project. (The version numbering has been continued, though, to avoid any kind of misunderstandings. This version has version numbers "3.0.0" or higher.)</p>

<h1 id="simple-usage">(Simple) Usage</h1>

<p>From a Python file, expecting a Turtle output::
 from pyRdfa import pyRdfa
 print pyRdfa().rdf_from_source('filename')
Other output formats are also possible. E.g., to produce RDF/XML output, one could use::
 from pyRdfa import pyRdfa
 print pyRdfa().rdf_from_source('filename', outputFormat='pretty-xml')
It is also possible to embed an RDFa processing. Eg, using::
 from pyRdfa import pyRdfa
 graph = pyRdfa().graph_from_source('filename')
returns an RDFLib.Graph object instead of a serialization thereof. See the the description of the
L{pyRdfa class<<a href="#pyRdfa">pyRdfa</a>>} for further possible entry points details.</p>

<p>There is also, as part of this module, a L{separate entry for CGI calls<processURI>}.</p>

<h2 id="return-serialization-formats">Return (serialization) formats</h2>

<p>The package relies on RDFLib. By default, it relies therefore on the serializers coming with the local RDFLib distribution. However, there has been some issues with serializers of older RDFLib releases; also, some output formats, like JSON-LD, are not (yet) part of the standard RDFLib distribution. A companion package, called pyRdfaExtras, is part of the download, and it includes some of those extra serializers. The extra format (not part of the RDFLib core) is U{JSON-LD<a href="http://json-ld.org/spec/latest/json-ld-syntax/">http://json-ld.org/spec/latest/json-ld-syntax/</a>}, whose 'key' is 'json', when used in the 'parse' method of an RDFLib graph.</p>

<p>(Note in 2018: the bugs that needed pyRdfaExtras are gone with the RDFLib versions, and the json-ld serializer and parser can be U{downloaded from github<a href="https://github.com/RDFLib/rdflib-jsonld">https://github.com/RDFLib/rdflib-jsonld</a>} (or installed via pip). This means that importing pyRdfaExtras is done only when running older (i.e., 2.X.X) RDFLib versions and can be safely ignored these days.)  </p>

<h1 id="options">Options</h1>

<p>The package also implements some optional features that are not part of the RDFa recommendations. At the moment these are:</p>

<ul>
<li>possibility for plain literals to be normalized in terms of white spaces. Default: false. (The RDFa specification requires keeping the white spaces and leave applications to normalize them, if needed)</li>
<li>inclusion of embedded RDF: Turtle content may be enclosed in a C{script} element and typed as C{text/turtle}, U{defined by the RDF Working Group<a href="http://www.w3.org/TR/turtle/">http://www.w3.org/TR/turtle/</a>}. Alternatively, some XML dialects (e.g., SVG) allows the usage of RDF/XML as part of their core content to define metadata in RDF. For both of these cases pyRdfa parses these serialized RDF content and adds the resulting triples to the output Graph. Default: true.</li>
<li>extra, built-in transformers are executed on the DOM tree prior to RDFa processing (see below). These transformers can be provided by the end user.</li>
</ul>

<p>Options are collected in an instance of the L{Options} class and may be passed to the processing functions as an extra argument. E.g., to allow the inclusion of embedded content::
 from <a href="pyRdfa/options.html">pyRdfa.options</a> import Options
 options = Options(embedded_rdf=True)
 print pyRdfa(options=options).rdf_from_source('filename')</p>

<p>See the description of the L{Options} class for the details.</p>

<h1 id="host-languages">Host Languages</h1>

<p>RDFa 1.1. Core is defined for generic XML; there are specific documents to describe how the generic specification is applied to
XHTML and HTML5.</p>

<p>pyRdfa makes an automatic switch among these based on the content type of the source as returned by an HTTP request. The following are the
possible host languages:</p>

<ul>
<li>if the content type is C{text/html}, the content is HTML5</li>
<li>if the content type is C{application/xhtml+xml} I{and} the right DTD is used, the content is XHTML1</li>
<li>if the content type is C{application/xhtml+xml} and no or an unknown DTD is used, the content is XHTML5</li>
<li>if the content type is C{application/svg+xml}, the content type is SVG</li>
<li>if the content type is C{application/atom+xml}, the content type is SVG</li>
<li>if the content type is C{application/xml} or C{application/xxx+xml} (but 'xxx' is not 'atom' or 'svg'), the content type is XML</li>
</ul>

<p>If local files are used, pyRdfa makes a guess on the content type based on the file name suffix: C{.html} is for HTML5, C{.xhtml} for XHTML1, C{.svg} for SVG, anything else is considered to be general XML. Finally, the content type may be set by the caller when initializing the L{pyRdfa class<<a href="#pyRdfa">pyRdfa</a>>}.</p>

<p>Beyond the differences described in the RDFa specification, the main difference is the parser used to parse the source. In the case of HTML5, pyRdfa uses an U{HTML5 parser<a href="http://code.google.com/p/html5lib/">http://code.google.com/p/html5lib/</a>}; for all other cases the simple XML parser, part of the core Python environment, is used. This may be significant in the case of erroneous sources: indeed, the HTML5 parser may do adjustments on
the DOM tree before handing it over to the distiller. Furthermore, SVG is also recognized as a type that allows embedded RDF in the form of RDF/XML.</p>

<p>See the variables in the L{host} module if a new host language is added to the system. The current host language information is available for transformers via the option argument, too, and can be used to control the effect of the transformer.</p>

<h1 id="vocabularies">Vocabularies</h1>

<p>RDFa 1.1 has the notion of vocabulary files (using the C{@vocab} attribute) that may be used to expand the generated RDF graph. Expansion is based on some very simply RDF Schema and OWL statements on sub-properties and sub-classes, and equivalences.</p>

<p>pyRdfa implements this feature, although it does not do this by default. The extra C{vocab_expansion} parameter should be used for this extra step, for example::
 from <a href="pyRdfa/options.html">pyRdfa.options</a> import Options
 options = Options(vocab_expansion=True)
 print pyRdfa(options=options).rdf_from_source('filename')</p>

<p>The triples in the vocabulary files themselves (i.e., the small ontology in RDF Schema and OWL) are removed from the result, leaving the inferred property and type relationships only (additionally to the “core” RDF content).</p>

<h2 id="vocabulary-caching">Vocabulary caching</h2>

<p>By default, pyRdfa uses a caching mechanism instead of fetching the vocabulary files each time their URI is met as a C{@vocab} attribute value. (This behavior can be switched off setting the C{vocab_cache} option to false.)</p>

<p>Caching happens in a file system directory. The directory itself is determined by the platform the tool is used on, namely:</p>

<ul>
<li>On Windows, it is the C{pyRdfa-cache} subdirectory of the C{%APPDATA%} environment variable</li>
<li>On MacOS, it is the C{~/Library/Application Support/pyRdfa-cache}</li>
<li>Otherwise, it is the C{~/.pyRdfa-cache}</li>
</ul>

<p>This automatic choice can be overridden by the C{PyRdfaCacheDir} environment variable.</p>

<p>Caching can be set to be read-only, i.e., the setup might generate the cache files off-line instead of letting the tool writing its own cache when operating, e.g., as a service on the Web. This can be achieved by making the cache directory read only.</p>

<p>If the directories are neither readable nor writable, the vocabulary files are retrieved via HTTP every time they are hit. This may slow down processing, it is advised to avoid such a setup for the package.</p>

<p>The cache includes a separate index file and a file for each vocabulary file. Cache control is based upon the C{EXPIRES} header of a vocabulary file’s HTTP return header: when first seen, this data is stored in the index file and controls whether the cache has to be renewed or not. If the HTTP return header does not have this entry, the date is artificially set ot the current date plus one day.</p>

<p>(The cache files themselves are dumped and loaded using U{Python’s built in cPickle package<a href="http://docs.python.org/release/2.7/library/pickle.html#module-cPickle">http://docs.python.org/release/2.7/library/pickle.html#module-cPickle</a>}. These are binary files. Care should be taken if they are managed by CVS: they must be declared as binary files when adding them to the repository.)</p>

<h1 id="rdfa-11-vs-rdfa-10">RDFa 1.1 vs. RDFa 1.0</h1>

<p>Unfortunately, RDFa 1.1 is I{not} fully backward compatible with RDFa 1.0, meaning that, in a few cases, the triples generated from an RDFa 1.1 source are not the same as for RDFa 1.0. (See the separate  U{section in the RDFa 1.1 specification<a href="http://www.w3.org/TR/rdfa-core/#major-differences-with-rdfa-syntax-1.0">http://www.w3.org/TR/rdfa-core/#major-differences-with-rdfa-syntax-1.0</a>} for some further details.)</p>

<p>This distiller’s default behavior is RDFa 1.1. However, if the source includes, in the top element of the file (e.g., the C{html} element) a C{@version} attribute whose value contains the C{RDFa 1.0} string, then the distiller switches to a RDFa 1.0 mode. (Although the C{@version} attribute is not required in RDFa 1.0, it is fairly commonly used.) Similarly, if the RDFa 1.0 DTD is used in the XHTML source, it will be taken into account (a very frequent setup is that an XHTML file is defined with that DTD and is served as text/html; pyRdfa will consider that file as XHTML5, i.e., parse it with the HTML5 parser, but interpret the RDFa attributes under the RDFa 1.0 rules).</p>

<h1 id="transformers">Transformers</h1>

<p>The package uses the concept of 'transformers': the parsed DOM tree is possibly
transformed I{before} performing the real RDFa processing. This transformer structure makes it possible to
add additional 'services' without distoring the core code of RDFa processing.</p>

<p>A transformer is a function with three arguments:</p>

<ul>
<li>C{node}: a DOM node for the top level element of the DOM tree</li>
<li>C{options}: the current L{Options} instance</li>
<li>C{state}: the current L{ExecutionContext} instance, corresponding to the top level DOM Tree element</li>
</ul>

<p>The function may perform any type of change on the DOM tree; the typical behavior is to add or remove attributes on specific elements. Some transformations are included in the package and can be used as examples; see the L{transform} module of the distribution. These are:</p>

<ul>
<li>The C{@name} attribute of the C{meta} element is copied into a C{@property} attribute of the same element</li>
<li>Interpreting the 'openid' references in the header. See L{transform.OpenID} for further details.</li>
<li>Implementing the Dublin Core dialect to include DC statements from the header.  See L{transform.DublinCore} for further details.</li>
</ul>

<p>The user of the package may refer add these transformers to L{Options} instance. Here is a possible usage with the “openid” transformer added to the call::
 from <a href="pyRdfa/options.html">pyRdfa.options</a> import Options
 from <a href="pyRdfa/transform/OpenID.html">pyRdfa.transform.OpenID</a> import OpenID_transform
 options = Options(transformers=[OpenID_transform])
 print pyRdfa(options=options).rdf_from_source('filename')</p>

<p>@summary: RDFa parser (distiller)
@requires: Python 3.7 or up
@requires: U{RDFLib<a href="http://rdflib.net">http://rdflib.net</a>}; version 3.X is preferred.
@requires: U{html5lib<a href="http://code.google.com/p/html5lib/">http://code.google.com/p/html5lib/</a>} for the HTML5 parsing (note that version 1.0b1 and 1.0b2 should be avoided, it may lead to unicode encoding problems)
@requires: U{httpheader<a href="http://deron.meranda.us/python/httpheader/">http://deron.meranda.us/python/httpheader/</a>}; however, a small modification had to make on the original file, so for this reason and to make distribution easier this module (single file) is added to the package.
@organization: U{World Wide Web Consortium<a href="http://www.w3.org">http://www.w3.org</a>}
@author: U{Ivan Herman<a href="http://www.w3.org/People/Ivan/">}
@license: This software is available for use under the
U{W3C® SOFTWARE NOTICE AND LICENSE<href="http://www.w3.org/Consortium/Legal/2002/copyright-software-20021231">}</p>

<p>@var builtInTransformers: List of built-in transformers that are to be run regardless, because they are part of the RDFa spec
@var CACHE_DIR_VAR: Environment variable used to define cache directories for RDFa vocabularies in case the default setting does not work or is not appropriate.
@var rdfa_current_version: Current "official" version of RDFa that this package implements by default. This can be changed at the invocation of the package
@var uri_schemes: List of registered (or widely used) URI schemes; used for warnings...</p>
</div>

                        <input id="mod-pyRdfa-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-pyRdfa-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">RDFa 1.1 parser, also referred to as a “RDFa Distiller”. It is</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">deployed, via a CGI front-end, on the U{W3C RDFa 1.1 Distiller page&lt;http://www.w3.org/2012/pyRdfa/&gt;}.</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="sd">For details on RDFa, the reader should consult the U{RDFa Core 1.1&lt;http://www.w3.org/TR/rdfa-core/&gt;}, U{XHTML+RDFa1.1&lt;http://www.w3.org/TR/2010/xhtml-rdfa&gt;}, and the U{RDFa 1.1 Lite&lt;http://www.w3.org/TR/rdfa-lite/&gt;} documents.</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">The U{RDFa 1.1 Primer&lt;http://www.w3.org/TR/owl2-primer/&gt;} may also prove helpful.</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">This package can also be downloaded U{from GitHub&lt;https://github.com/RDFLib/pyrdfa3&gt;}. The</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="sd">distribution also includes the CGI front-end and a separate utility script to be run locally.</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="sd">Note that this package is an updated version of a U{previous RDFa distiller&lt;http://www.w3.org/2007/08/pyRdfa&gt;} that was developed</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">for RDFa 1.0. Although it reuses large portions of that code, it has been quite thoroughly rewritten, hence put in a completely</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="sd">different project. (The version numbering has been continued, though, to avoid any kind of misunderstandings. This version has version numbers &quot;3.0.0&quot; or higher.)</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="sd">(Simple) Usage</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">==============</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">From a Python file, expecting a Turtle output::</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd"> from pyRdfa import pyRdfa</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd"> print pyRdfa().rdf_from_source(&#39;filename&#39;)</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">Other output formats are also possible. E.g., to produce RDF/XML output, one could use::</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd"> from pyRdfa import pyRdfa</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd"> print pyRdfa().rdf_from_source(&#39;filename&#39;, outputFormat=&#39;pretty-xml&#39;)</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">It is also possible to embed an RDFa processing. Eg, using::</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd"> from pyRdfa import pyRdfa</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd"> graph = pyRdfa().graph_from_source(&#39;filename&#39;)</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">returns an RDFLib.Graph object instead of a serialization thereof. See the the description of the</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">L{pyRdfa class&lt;pyRdfa.pyRdfa&gt;} for further possible entry points details.</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">There is also, as part of this module, a L{separate entry for CGI calls&lt;processURI&gt;}.</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">Return (serialization) formats</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">------------------------------</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">The package relies on RDFLib. By default, it relies therefore on the serializers coming with the local RDFLib distribution. However, there has been some issues with serializers of older RDFLib releases; also, some output formats, like JSON-LD, are not (yet) part of the standard RDFLib distribution. A companion package, called pyRdfaExtras, is part of the download, and it includes some of those extra serializers. The extra format (not part of the RDFLib core) is U{JSON-LD&lt;http://json-ld.org/spec/latest/json-ld-syntax/&gt;}, whose &#39;key&#39; is &#39;json&#39;, when used in the &#39;parse&#39; method of an RDFLib graph.</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">(Note in 2018: the bugs that needed pyRdfaExtras are gone with the RDFLib versions, and the json-ld serializer and parser can be U{downloaded from github&lt;https://github.com/RDFLib/rdflib-jsonld&gt;} (or installed via pip). This means that importing pyRdfaExtras is done only when running older (i.e., 2.X.X) RDFLib versions and can be safely ignored these days.)  </span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">Options</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">=======</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">The package also implements some optional features that are not part of the RDFa recommendations. At the moment these are:</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd"> - possibility for plain literals to be normalized in terms of white spaces. Default: false. (The RDFa specification requires keeping the white spaces and leave applications to normalize them, if needed)</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd"> - inclusion of embedded RDF: Turtle content may be enclosed in a C{script} element and typed as C{text/turtle}, U{defined by the RDF Working Group&lt;http://www.w3.org/TR/turtle/&gt;}. Alternatively, some XML dialects (e.g., SVG) allows the usage of RDF/XML as part of their core content to define metadata in RDF. For both of these cases pyRdfa parses these serialized RDF content and adds the resulting triples to the output Graph. Default: true.</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd"> - extra, built-in transformers are executed on the DOM tree prior to RDFa processing (see below). These transformers can be provided by the end user.</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">Options are collected in an instance of the L{Options} class and may be passed to the processing functions as an extra argument. E.g., to allow the inclusion of embedded content::</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd"> from pyRdfa.options import Options</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd"> options = Options(embedded_rdf=True)</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd"> print pyRdfa(options=options).rdf_from_source(&#39;filename&#39;)</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">See the description of the L{Options} class for the details.</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">Host Languages</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">==============</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">RDFa 1.1. Core is defined for generic XML; there are specific documents to describe how the generic specification is applied to</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">XHTML and HTML5.</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">pyRdfa makes an automatic switch among these based on the content type of the source as returned by an HTTP request. The following are the</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">possible host languages:</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd"> - if the content type is C{text/html}, the content is HTML5</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd"> - if the content type is C{application/xhtml+xml} I{and} the right DTD is used, the content is XHTML1</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd"> - if the content type is C{application/xhtml+xml} and no or an unknown DTD is used, the content is XHTML5</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd"> - if the content type is C{application/svg+xml}, the content type is SVG</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd"> - if the content type is C{application/atom+xml}, the content type is SVG</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd"> - if the content type is C{application/xml} or C{application/xxx+xml} (but &#39;xxx&#39; is not &#39;atom&#39; or &#39;svg&#39;), the content type is XML</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">If local files are used, pyRdfa makes a guess on the content type based on the file name suffix: C{.html} is for HTML5, C{.xhtml} for XHTML1, C{.svg} for SVG, anything else is considered to be general XML. Finally, the content type may be set by the caller when initializing the L{pyRdfa class&lt;pyRdfa.pyRdfa&gt;}.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">Beyond the differences described in the RDFa specification, the main difference is the parser used to parse the source. In the case of HTML5, pyRdfa uses an U{HTML5 parser&lt;http://code.google.com/p/html5lib/&gt;}; for all other cases the simple XML parser, part of the core Python environment, is used. This may be significant in the case of erroneous sources: indeed, the HTML5 parser may do adjustments on</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">the DOM tree before handing it over to the distiller. Furthermore, SVG is also recognized as a type that allows embedded RDF in the form of RDF/XML.</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">See the variables in the L{host} module if a new host language is added to the system. The current host language information is available for transformers via the option argument, too, and can be used to control the effect of the transformer.</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">Vocabularies</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">============</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">RDFa 1.1 has the notion of vocabulary files (using the C{@vocab} attribute) that may be used to expand the generated RDF graph. Expansion is based on some very simply RDF Schema and OWL statements on sub-properties and sub-classes, and equivalences.</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">pyRdfa implements this feature, although it does not do this by default. The extra C{vocab_expansion} parameter should be used for this extra step, for example::</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd"> from pyRdfa.options import Options</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd"> options = Options(vocab_expansion=True)</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd"> print pyRdfa(options=options).rdf_from_source(&#39;filename&#39;)</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">The triples in the vocabulary files themselves (i.e., the small ontology in RDF Schema and OWL) are removed from the result, leaving the inferred property and type relationships only (additionally to the “core” RDF content).</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">Vocabulary caching</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">------------------</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">By default, pyRdfa uses a caching mechanism instead of fetching the vocabulary files each time their URI is met as a C{@vocab} attribute value. (This behavior can be switched off setting the C{vocab_cache} option to false.)</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">Caching happens in a file system directory. The directory itself is determined by the platform the tool is used on, namely:</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd"> - On Windows, it is the C{pyRdfa-cache} subdirectory of the C{%APPDATA%} environment variable</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd"> - On MacOS, it is the C{~/Library/Application Support/pyRdfa-cache}</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd"> - Otherwise, it is the C{~/.pyRdfa-cache}</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">This automatic choice can be overridden by the C{PyRdfaCacheDir} environment variable.</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">Caching can be set to be read-only, i.e., the setup might generate the cache files off-line instead of letting the tool writing its own cache when operating, e.g., as a service on the Web. This can be achieved by making the cache directory read only.</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">If the directories are neither readable nor writable, the vocabulary files are retrieved via HTTP every time they are hit. This may slow down processing, it is advised to avoid such a setup for the package.</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">The cache includes a separate index file and a file for each vocabulary file. Cache control is based upon the C{EXPIRES} header of a vocabulary file’s HTTP return header: when first seen, this data is stored in the index file and controls whether the cache has to be renewed or not. If the HTTP return header does not have this entry, the date is artificially set ot the current date plus one day.</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">(The cache files themselves are dumped and loaded using U{Python’s built in cPickle package&lt;http://docs.python.org/release/2.7/library/pickle.html#module-cPickle&gt;}. These are binary files. Care should be taken if they are managed by CVS: they must be declared as binary files when adding them to the repository.)</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">RDFa 1.1 vs. RDFa 1.0</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">=====================</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">Unfortunately, RDFa 1.1 is I{not} fully backward compatible with RDFa 1.0, meaning that, in a few cases, the triples generated from an RDFa 1.1 source are not the same as for RDFa 1.0. (See the separate  U{section in the RDFa 1.1 specification&lt;http://www.w3.org/TR/rdfa-core/#major-differences-with-rdfa-syntax-1.0&gt;} for some further details.)</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">This distiller’s default behavior is RDFa 1.1. However, if the source includes, in the top element of the file (e.g., the C{html} element) a C{@version} attribute whose value contains the C{RDFa 1.0} string, then the distiller switches to a RDFa 1.0 mode. (Although the C{@version} attribute is not required in RDFa 1.0, it is fairly commonly used.) Similarly, if the RDFa 1.0 DTD is used in the XHTML source, it will be taken into account (a very frequent setup is that an XHTML file is defined with that DTD and is served as text/html; pyRdfa will consider that file as XHTML5, i.e., parse it with the HTML5 parser, but interpret the RDFa attributes under the RDFa 1.0 rules).</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">Transformers</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">============</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">The package uses the concept of &#39;transformers&#39;: the parsed DOM tree is possibly</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">transformed I{before} performing the real RDFa processing. This transformer structure makes it possible to</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">add additional &#39;services&#39; without distoring the core code of RDFa processing.</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">A transformer is a function with three arguments:</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd"> - C{node}: a DOM node for the top level element of the DOM tree</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd"> - C{options}: the current L{Options} instance</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd"> - C{state}: the current L{ExecutionContext} instance, corresponding to the top level DOM Tree element</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">The function may perform any type of change on the DOM tree; the typical behavior is to add or remove attributes on specific elements. Some transformations are included in the package and can be used as examples; see the L{transform} module of the distribution. These are:</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd"> - The C{@name} attribute of the C{meta} element is copied into a C{@property} attribute of the same element</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd"> - Interpreting the &#39;openid&#39; references in the header. See L{transform.OpenID} for further details.</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd"> - Implementing the Dublin Core dialect to include DC statements from the header.  See L{transform.DublinCore} for further details.</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">The user of the package may refer add these transformers to L{Options} instance. Here is a possible usage with the “openid” transformer added to the call::</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd"> from pyRdfa.options import Options</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd"> from pyRdfa.transform.OpenID import OpenID_transform</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd"> options = Options(transformers=[OpenID_transform])</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd"> print pyRdfa(options=options).rdf_from_source(&#39;filename&#39;)</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">@summary: RDFa parser (distiller)</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">@requires: Python 3.7 or up</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">@requires: U{RDFLib&lt;http://rdflib.net&gt;}; version 3.X is preferred.</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">@requires: U{html5lib&lt;http://code.google.com/p/html5lib/&gt;} for the HTML5 parsing (note that version 1.0b1 and 1.0b2 should be avoided, it may lead to unicode encoding problems)</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">@requires: U{httpheader&lt;http://deron.meranda.us/python/httpheader/&gt;}; however, a small modification had to make on the original file, so for this reason and to make distribution easier this module (single file) is added to the package.</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">@organization: U{World Wide Web Consortium&lt;http://www.w3.org&gt;}</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">@author: U{Ivan Herman&lt;a href=&quot;http://www.w3.org/People/Ivan/&quot;&gt;}</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">@license: This software is available for use under the</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">U{W3C® SOFTWARE NOTICE AND LICENSE&lt;href=&quot;http://www.w3.org/Consortium/Legal/2002/copyright-software-20021231&quot;&gt;}</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">@var builtInTransformers: List of built-in transformers that are to be run regardless, because they are part of the RDFa spec</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">@var CACHE_DIR_VAR: Environment variable used to define cache directories for RDFa vocabularies in case the default setting does not work or is not appropriate.</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">@var rdfa_current_version: Current &quot;official&quot; version of RDFa that this package implements by default. This can be changed at the invocation of the package</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">@var uri_schemes: List of registered (or widely used) URI schemes; used for warnings...</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;3.6.3&quot;</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="n">__author__</span> <span class="o">=</span>  <span class="s1">&#39;Ivan Herman and prrvchr&#39;</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="n">__contact__</span> <span class="o">=</span> <span class="s1">&#39;prrvchr@gmail.com&#39;</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="n">__license__</span> <span class="o">=</span> <span class="s1">&#39;W3C® SOFTWARE NOTICE AND LICENSE, http://www.w3.org/Consortium/Legal/2002/copyright-software-20021231&#39;</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;pyRdfa3&quot;</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="kn">import</span> <span class="nn">sys</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span><span class="p">,</span> <span class="n">IOBase</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="kn">import</span> <span class="nn">xml.dom.minidom</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="kn">import</span> <span class="nn">rdflib</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="kn">from</span> <span class="nn">rdflib</span> <span class="kn">import</span> <span class="n">URIRef</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="kn">from</span> <span class="nn">rdflib</span> <span class="kn">import</span> <span class="n">Literal</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="kn">from</span> <span class="nn">rdflib</span> <span class="kn">import</span> <span class="n">BNode</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="kn">from</span> <span class="nn">rdflib</span> <span class="kn">import</span> <span class="n">Namespace</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="kn">from</span> <span class="nn">rdflib</span> <span class="kn">import</span> <span class="n">RDF</span> <span class="k">as</span> <span class="n">ns_rdf</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="kn">from</span> <span class="nn">rdflib</span> <span class="kn">import</span> <span class="n">RDFS</span> <span class="k">as</span> <span class="n">ns_rdfs</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="kn">from</span> <span class="nn">rdflib</span> <span class="kn">import</span> <span class="n">Graph</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="c1"># Namespace, in the RDFLib sense, for the rdfa vocabulary</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="n">ns_rdfa</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="s2">&quot;http://www.w3.org/ns/rdfa#&quot;</span><span class="p">)</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a><span class="kn">from</span> <span class="nn">.extras.httpheader</span> <span class="kn">import</span> <span class="n">acceptable_content_type</span><span class="p">,</span> <span class="n">content_type</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a><span class="kn">from</span> <span class="nn">.transform.prototype</span> <span class="kn">import</span> <span class="n">handle_prototypes</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a><span class="c1"># Vocabulary terms for vocab reporting</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="n">RDFA_VOCAB</span> <span class="o">=</span> <span class="n">ns_rdfa</span><span class="p">[</span><span class="s2">&quot;usesVocabulary&quot;</span><span class="p">]</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="c1"># Namespace, in the RDFLib sense, for the XSD Datatypes</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="n">ns_xsd</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="s1">&#39;http://www.w3.org/2001/XMLSchema#&#39;</span><span class="p">)</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="c1"># Namespace, in the RDFLib sense, for the distiller vocabulary, used as part of the processor graph</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a><span class="n">ns_distill</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="s2">&quot;http://www.w3.org/2007/08/pyRdfa/vocab#&quot;</span><span class="p">)</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="c1">#########################################################################################################</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="c1"># Exception/error handling. Essentially, all the different exceptions are re-packaged into</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="c1"># separate exception class, to allow for an easier management on the user level</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="k">class</span> <span class="nc">RDFaError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Superclass exceptions representing error conditions defined by the RDFa 1.1 specification.</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">    It does not add any new functionality to the</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">    Exception class.&quot;&quot;&quot;</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>        <span class="ne">Exception</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="k">class</span> <span class="nc">FailedSource</span><span class="p">(</span><span class="n">RDFaError</span><span class="p">):</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when the original source cannot be accessed. It does not add any new functionality to the</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">    Exception class.&quot;&quot;&quot;</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">http_code</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">http_code</span> <span class="o">=</span> <span class="n">http_code</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>        <span class="n">RDFaError</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="k">class</span> <span class="nc">HTTPError</span><span class="p">(</span><span class="n">RDFaError</span><span class="p">):</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when HTTP problems are detected. It does not add any new functionality to the</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">    Exception class.&quot;&quot;&quot;</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">http_msg</span><span class="p">,</span> <span class="n">http_code</span><span class="p">):</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">http_msg</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">http_code</span> <span class="o">=</span> <span class="n">http_code</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="n">RDFaError</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">http_msg</span><span class="p">)</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="k">class</span> <span class="nc">ProcessingError</span><span class="p">(</span><span class="n">RDFaError</span><span class="p">):</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Error found during processing. It does not add any new functionality to the</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">    Exception class.&quot;&quot;&quot;</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>    <span class="k">pass</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="k">class</span> <span class="nc">pyRdfaError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Superclass exceptions representing error conditions outside the RDFa 1.1 specification.&quot;&quot;&quot;</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>    <span class="k">pass</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="c1"># Error and Warning RDFS classes</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="n">RDFA_Error</span> <span class="o">=</span>                <span class="n">ns_rdfa</span><span class="p">[</span><span class="s2">&quot;Error&quot;</span><span class="p">]</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="n">RDFA_Warning</span> <span class="o">=</span>              <span class="n">ns_rdfa</span><span class="p">[</span><span class="s2">&quot;Warning&quot;</span><span class="p">]</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="n">RDFA_Info</span> <span class="o">=</span>                 <span class="n">ns_rdfa</span><span class="p">[</span><span class="s2">&quot;Information&quot;</span><span class="p">]</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="n">NonConformantMarkup</span> <span class="o">=</span>       <span class="n">ns_rdfa</span><span class="p">[</span><span class="s2">&quot;DocumentError&quot;</span><span class="p">]</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="n">UnresolvablePrefix</span> <span class="o">=</span>        <span class="n">ns_rdfa</span><span class="p">[</span><span class="s2">&quot;UnresolvedCURIE&quot;</span><span class="p">]</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="n">UnresolvableReference</span> <span class="o">=</span>     <span class="n">ns_rdfa</span><span class="p">[</span><span class="s2">&quot;UnresolvedCURIE&quot;</span><span class="p">]</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="n">UnresolvableTerm</span> <span class="o">=</span>          <span class="n">ns_rdfa</span><span class="p">[</span><span class="s2">&quot;UnresolvedTerm&quot;</span><span class="p">]</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="n">VocabReferenceError</span> <span class="o">=</span>       <span class="n">ns_rdfa</span><span class="p">[</span><span class="s2">&quot;VocabReferenceError&quot;</span><span class="p">]</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="n">PrefixRedefinitionWarning</span> <span class="o">=</span> <span class="n">ns_rdfa</span><span class="p">[</span><span class="s2">&quot;PrefixRedefinition&quot;</span><span class="p">]</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="n">FileReferenceError</span> <span class="o">=</span>        <span class="n">ns_distill</span><span class="p">[</span><span class="s2">&quot;FileReferenceError&quot;</span><span class="p">]</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="n">HTError</span> <span class="o">=</span>                   <span class="n">ns_distill</span><span class="p">[</span><span class="s2">&quot;HTTPError&quot;</span><span class="p">]</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="n">IncorrectPrefixDefinition</span> <span class="o">=</span> <span class="n">ns_distill</span><span class="p">[</span><span class="s2">&quot;IncorrectPrefixDefinition&quot;</span><span class="p">]</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="n">IncorrectBlankNodeUsage</span> <span class="o">=</span>   <span class="n">ns_distill</span><span class="p">[</span><span class="s2">&quot;IncorrectBlankNodeUsage&quot;</span><span class="p">]</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="n">IncorrectLiteral</span> <span class="o">=</span>          <span class="n">ns_distill</span><span class="p">[</span><span class="s2">&quot;IncorrectLiteral&quot;</span><span class="p">]</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="c1"># Error message texts</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="n">err_no_blank_node</span> <span class="o">=</span> <span class="s2">&quot;Blank node in </span><span class="si">%s</span><span class="s2"> position is not allowed; ignored&quot;</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a><span class="n">err_redefining_URI_as_prefix</span> <span class="o">=</span> <span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; a registered or an otherwise used URI scheme, but is defined as a prefix here; is this a mistake? (see, eg, http://en.wikipedia.org/wiki/URI_scheme or http://www.iana.org/assignments/uri-schemes.html for further information for most of the URI schemes)&quot;</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a><span class="n">err_xmlns_deprecated</span> <span class="o">=</span>         <span class="s2">&quot;The usage of &#39;xmlns&#39; for prefix definition is deprecated; please use the &#39;prefix&#39; attribute instead (definition for &#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a><span class="n">err_bnode_local_prefix</span> <span class="o">=</span>       <span class="s2">&quot;The &#39;_&#39; local CURIE prefix is reserved for blank nodes, and cannot be defined as a prefix&quot;</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a><span class="n">err_col_local_prefix</span> <span class="o">=</span>         <span class="s2">&quot;The character &#39;:&#39; is not valid in a CURIE Prefix, and cannot be used in a prefix definition (definition for &#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a><span class="n">err_missing_URI_prefix</span> <span class="o">=</span>       <span class="s2">&quot;Missing URI in prefix declaration for &#39;</span><span class="si">%s</span><span class="s2">&#39; (in &#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="n">err_invalid_prefix</span> <span class="o">=</span>           <span class="s2">&quot;Invalid prefix declaration &#39;</span><span class="si">%s</span><span class="s2">&#39; (in &#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="n">err_no_default_prefix</span> <span class="o">=</span>        <span class="s2">&quot;Default prefix cannot be changed (in &#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="n">err_prefix_and_xmlns</span> <span class="o">=</span>         <span class="s2">&quot;@prefix setting for &#39;</span><span class="si">%s</span><span class="s2">&#39; overrides the &#39;xmlns:</span><span class="si">%s</span><span class="s2">&#39; setting; may be a source of problem if same file is run through RDFa 1.0&quot;</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="n">err_non_ncname_prefix</span> <span class="o">=</span>        <span class="s2">&quot;Non NCNAME &#39;</span><span class="si">%s</span><span class="s2">&#39; in prefix definition (in &#39;</span><span class="si">%s</span><span class="s2">&#39;); ignored&quot;</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="n">err_absolute_reference</span> <span class="o">=</span>       <span class="s2">&quot;CURIE Reference part contains an authority part: </span><span class="si">%s</span><span class="s2"> (in &#39;</span><span class="si">%s</span><span class="s2">&#39;); ignored&quot;</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="n">err_query_reference</span> <span class="o">=</span>          <span class="s2">&quot;CURIE Reference query part contains an unauthorized character: </span><span class="si">%s</span><span class="s2"> (in &#39;</span><span class="si">%s</span><span class="s2">&#39;); ignored&quot;</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="n">err_fragment_reference</span> <span class="o">=</span>       <span class="s2">&quot;CURIE Reference fragment part contains an unauthorized character: </span><span class="si">%s</span><span class="s2"> (in &#39;</span><span class="si">%s</span><span class="s2">&#39;); ignored&quot;</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="n">err_lang</span> <span class="o">=</span>                     <span class="s2">&quot;There is a problem with language setting; either both xml:lang and lang used on an element with different values, or, for (X)HTML5, only xml:lang is used.&quot;</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="n">err_URI_scheme</span> <span class="o">=</span>               <span class="s2">&quot;Unusual URI scheme used in &lt;</span><span class="si">%s</span><span class="s2">&gt;; may that be a mistake, e.g., resulting from using an undefined CURIE prefix or an incorrect CURIE?&quot;</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="n">err_illegal_safe_CURIE</span> <span class="o">=</span>       <span class="s2">&quot;Illegal safe CURIE: </span><span class="si">%s</span><span class="s2">; ignored&quot;</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="n">err_no_CURIE_in_safe_CURIE</span> <span class="o">=</span>   <span class="s2">&quot;Safe CURIE is used, but the value does not correspond to a defined CURIE: [</span><span class="si">%s</span><span class="s2">]; ignored&quot;</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="n">err_undefined_terms</span> <span class="o">=</span>          <span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; is used as a term, but has not been defined as such; ignored&quot;</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a><span class="n">err_non_legal_CURIE_ref</span> <span class="o">=</span>      <span class="s2">&quot;Relative URI is not allowed in this position (or not a legal CURIE reference) &#39;</span><span class="si">%s</span><span class="s2">&#39;; ignored&quot;</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="n">err_undefined_CURIE</span> <span class="o">=</span>          <span class="s2">&quot;Undefined CURIE: &#39;</span><span class="si">%s</span><span class="s2">&#39;; ignored&quot;</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="n">err_prefix_redefinition</span> <span class="o">=</span>      <span class="s2">&quot;Prefix &#39;</span><span class="si">%s</span><span class="s2">&#39; (defined in the initial RDFa context or in an ancestor) is redefined&quot;</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="n">err_unusual_char_in_URI</span> <span class="o">=</span>      <span class="s2">&quot;Unusual character in uri: </span><span class="si">%s</span><span class="s2">; possible error?&quot;</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="c1">#############################################################################################</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="kn">from</span> <span class="nn">.state</span> <span class="kn">import</span> <span class="n">ExecutionContext</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="kn">from</span> <span class="nn">.parse</span> <span class="kn">import</span> <span class="n">parse_one_node</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a><span class="kn">from</span> <span class="nn">.options</span> <span class="kn">import</span> <span class="n">Options</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="kn">from</span> <span class="nn">.transform</span> <span class="kn">import</span> <span class="n">top_about</span><span class="p">,</span> <span class="n">empty_safe_curie</span><span class="p">,</span> <span class="n">vocab_for_role</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">URIOpener</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="kn">from</span> <span class="nn">.host</span> <span class="kn">import</span> <span class="n">HostLanguage</span><span class="p">,</span> <span class="n">MediaTypes</span><span class="p">,</span> <span class="n">preferred_suffixes</span><span class="p">,</span> <span class="n">content_to_host_language</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="c1"># Environment variable used to characterize cache directories for RDFa vocabulary files.</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="n">CACHE_DIR_VAR</span> <span class="o">=</span> <span class="s2">&quot;PyRdfaCacheDir&quot;</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="c1"># current &quot;official&quot; version of RDFa that this package implements. This can be changed at the invocation of the package</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="n">rdfa_current_version</span> <span class="o">=</span> <span class="s2">&quot;1.1&quot;</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a><span class="c1"># I removed schemes that would not appear as a prefix anyway, like iris.beep</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="c1"># http://en.wikipedia.org/wiki/URI_scheme seems to be a good source of information</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="c1"># as well as http://www.iana.org/assignments/uri-schemes.html</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="c1"># There are some overlaps here, but better more than not enough...</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="c1"># This comes from wikipedia</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a><span class="n">registered_iana_schemes</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>    <span class="s2">&quot;aaa&quot;</span><span class="p">,</span><span class="s2">&quot;aaas&quot;</span><span class="p">,</span><span class="s2">&quot;acap&quot;</span><span class="p">,</span><span class="s2">&quot;cap&quot;</span><span class="p">,</span><span class="s2">&quot;cid&quot;</span><span class="p">,</span><span class="s2">&quot;crid&quot;</span><span class="p">,</span><span class="s2">&quot;data&quot;</span><span class="p">,</span><span class="s2">&quot;dav&quot;</span><span class="p">,</span><span class="s2">&quot;dict&quot;</span><span class="p">,</span><span class="s2">&quot;did&quot;</span><span class="p">,</span><span class="s2">&quot;dns&quot;</span><span class="p">,</span><span class="s2">&quot;fax&quot;</span><span class="p">,</span><span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="s2">&quot;ftp&quot;</span><span class="p">,</span><span class="s2">&quot;geo&quot;</span><span class="p">,</span><span class="s2">&quot;go&quot;</span><span class="p">,</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>    <span class="s2">&quot;gopher&quot;</span><span class="p">,</span><span class="s2">&quot;h323&quot;</span><span class="p">,</span><span class="s2">&quot;http&quot;</span><span class="p">,</span><span class="s2">&quot;https&quot;</span><span class="p">,</span><span class="s2">&quot;iax&quot;</span><span class="p">,</span><span class="s2">&quot;icap&quot;</span><span class="p">,</span><span class="s2">&quot;im&quot;</span><span class="p">,</span><span class="s2">&quot;imap&quot;</span><span class="p">,</span><span class="s2">&quot;info&quot;</span><span class="p">,</span><span class="s2">&quot;ipp&quot;</span><span class="p">,</span><span class="s2">&quot;iris&quot;</span><span class="p">,</span><span class="s2">&quot;ldap&quot;</span><span class="p">,</span> <span class="s2">&quot;lsid&quot;</span><span class="p">,</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>    <span class="s2">&quot;mailto&quot;</span><span class="p">,</span><span class="s2">&quot;mid&quot;</span><span class="p">,</span><span class="s2">&quot;modem&quot;</span><span class="p">,</span><span class="s2">&quot;msrp&quot;</span><span class="p">,</span><span class="s2">&quot;msrps&quot;</span><span class="p">,</span> <span class="s2">&quot;mtqp&quot;</span><span class="p">,</span> <span class="s2">&quot;mupdate&quot;</span><span class="p">,</span><span class="s2">&quot;news&quot;</span><span class="p">,</span><span class="s2">&quot;nfs&quot;</span><span class="p">,</span><span class="s2">&quot;nntp&quot;</span><span class="p">,</span><span class="s2">&quot;opaquelocktoken&quot;</span><span class="p">,</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>    <span class="s2">&quot;pop&quot;</span><span class="p">,</span><span class="s2">&quot;pres&quot;</span><span class="p">,</span> <span class="s2">&quot;prospero&quot;</span><span class="p">,</span><span class="s2">&quot;rstp&quot;</span><span class="p">,</span><span class="s2">&quot;rsync&quot;</span><span class="p">,</span> <span class="s2">&quot;service&quot;</span><span class="p">,</span><span class="s2">&quot;shttp&quot;</span><span class="p">,</span><span class="s2">&quot;sieve&quot;</span><span class="p">,</span><span class="s2">&quot;sip&quot;</span><span class="p">,</span><span class="s2">&quot;sips&quot;</span><span class="p">,</span> <span class="s2">&quot;sms&quot;</span><span class="p">,</span> <span class="s2">&quot;snmp&quot;</span><span class="p">,</span> <span class="s2">&quot;soap&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">,</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>    <span class="s2">&quot;tel&quot;</span><span class="p">,</span><span class="s2">&quot;telnet&quot;</span><span class="p">,</span> <span class="s2">&quot;tftp&quot;</span><span class="p">,</span> <span class="s2">&quot;thismessage&quot;</span><span class="p">,</span><span class="s2">&quot;tn3270&quot;</span><span class="p">,</span><span class="s2">&quot;tip&quot;</span><span class="p">,</span><span class="s2">&quot;tv&quot;</span><span class="p">,</span><span class="s2">&quot;urn&quot;</span><span class="p">,</span><span class="s2">&quot;vemmi&quot;</span><span class="p">,</span><span class="s2">&quot;wais&quot;</span><span class="p">,</span><span class="s2">&quot;ws&quot;</span><span class="p">,</span> <span class="s2">&quot;wss&quot;</span><span class="p">,</span> <span class="s2">&quot;xmpp&quot;</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="p">]</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="c1"># This comes from wikipedia, too</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="n">unofficial_common</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>    <span class="s2">&quot;about&quot;</span><span class="p">,</span> <span class="s2">&quot;adiumxtra&quot;</span><span class="p">,</span> <span class="s2">&quot;aim&quot;</span><span class="p">,</span> <span class="s2">&quot;apt&quot;</span><span class="p">,</span> <span class="s2">&quot;afp&quot;</span><span class="p">,</span> <span class="s2">&quot;aw&quot;</span><span class="p">,</span> <span class="s2">&quot;bitcoin&quot;</span><span class="p">,</span> <span class="s2">&quot;bolo&quot;</span><span class="p">,</span> <span class="s2">&quot;callto&quot;</span><span class="p">,</span> <span class="s2">&quot;chrome&quot;</span><span class="p">,</span> <span class="s2">&quot;coap&quot;</span><span class="p">,</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>    <span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;cvs&quot;</span><span class="p">,</span> <span class="s2">&quot;doi&quot;</span><span class="p">,</span> <span class="s2">&quot;ed2k&quot;</span><span class="p">,</span> <span class="s2">&quot;facetime&quot;</span><span class="p">,</span> <span class="s2">&quot;feed&quot;</span><span class="p">,</span> <span class="s2">&quot;finger&quot;</span><span class="p">,</span> <span class="s2">&quot;fish&quot;</span><span class="p">,</span> <span class="s2">&quot;git&quot;</span><span class="p">,</span> <span class="s2">&quot;gg&quot;</span><span class="p">,</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>    <span class="s2">&quot;gizmoproject&quot;</span><span class="p">,</span> <span class="s2">&quot;gtalk&quot;</span><span class="p">,</span> <span class="s2">&quot;irc&quot;</span><span class="p">,</span> <span class="s2">&quot;ircs&quot;</span><span class="p">,</span> <span class="s2">&quot;irc6&quot;</span><span class="p">,</span> <span class="s2">&quot;itms&quot;</span><span class="p">,</span> <span class="s2">&quot;jar&quot;</span><span class="p">,</span> <span class="s2">&quot;javascript&quot;</span><span class="p">,</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>    <span class="s2">&quot;keyparc&quot;</span><span class="p">,</span> <span class="s2">&quot;lastfm&quot;</span><span class="p">,</span> <span class="s2">&quot;ldaps&quot;</span><span class="p">,</span> <span class="s2">&quot;magnet&quot;</span><span class="p">,</span> <span class="s2">&quot;maps&quot;</span><span class="p">,</span> <span class="s2">&quot;market&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;mms&quot;</span><span class="p">,</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>    <span class="s2">&quot;msnim&quot;</span><span class="p">,</span> <span class="s2">&quot;mumble&quot;</span><span class="p">,</span> <span class="s2">&quot;mvn&quot;</span><span class="p">,</span> <span class="s2">&quot;notes&quot;</span><span class="p">,</span> <span class="s2">&quot;palm&quot;</span><span class="p">,</span> <span class="s2">&quot;paparazzi&quot;</span><span class="p">,</span> <span class="s2">&quot;psync&quot;</span><span class="p">,</span> <span class="s2">&quot;rmi&quot;</span><span class="p">,</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>    <span class="s2">&quot;secondlife&quot;</span><span class="p">,</span> <span class="s2">&quot;sgn&quot;</span><span class="p">,</span> <span class="s2">&quot;skype&quot;</span><span class="p">,</span> <span class="s2">&quot;spotify&quot;</span><span class="p">,</span> <span class="s2">&quot;ssh&quot;</span><span class="p">,</span> <span class="s2">&quot;sftp&quot;</span><span class="p">,</span> <span class="s2">&quot;smb&quot;</span><span class="p">,</span> <span class="s2">&quot;soldat&quot;</span><span class="p">,</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>    <span class="s2">&quot;steam&quot;</span><span class="p">,</span> <span class="s2">&quot;svn&quot;</span><span class="p">,</span> <span class="s2">&quot;teamspeak&quot;</span><span class="p">,</span> <span class="s2">&quot;things&quot;</span><span class="p">,</span> <span class="s2">&quot;udb&quot;</span><span class="p">,</span> <span class="s2">&quot;unreal&quot;</span><span class="p">,</span> <span class="s2">&quot;ut2004&quot;</span><span class="p">,</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>    <span class="s2">&quot;ventrillo&quot;</span><span class="p">,</span> <span class="s2">&quot;view-source&quot;</span><span class="p">,</span> <span class="s2">&quot;webcal&quot;</span><span class="p">,</span> <span class="s2">&quot;wtai&quot;</span><span class="p">,</span> <span class="s2">&quot;wyciwyg&quot;</span><span class="p">,</span> <span class="s2">&quot;xfire&quot;</span><span class="p">,</span> <span class="s2">&quot;xri&quot;</span><span class="p">,</span> <span class="s2">&quot;ymsgr&quot;</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="p">]</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="c1"># These come from the IANA page</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="n">historical_iana_schemes</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>    <span class="s2">&quot;fax&quot;</span><span class="p">,</span> <span class="s2">&quot;mailserver&quot;</span><span class="p">,</span> <span class="s2">&quot;modem&quot;</span><span class="p">,</span> <span class="s2">&quot;pack&quot;</span><span class="p">,</span> <span class="s2">&quot;prospero&quot;</span><span class="p">,</span> <span class="s2">&quot;snews&quot;</span><span class="p">,</span> <span class="s2">&quot;videotex&quot;</span><span class="p">,</span> <span class="s2">&quot;wais&quot;</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="p">]</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="n">provisional_iana_schemes</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>    <span class="s2">&quot;afs&quot;</span><span class="p">,</span> <span class="s2">&quot;dtn&quot;</span><span class="p">,</span> <span class="s2">&quot;dvb&quot;</span><span class="p">,</span> <span class="s2">&quot;icon&quot;</span><span class="p">,</span> <span class="s2">&quot;ipn&quot;</span><span class="p">,</span> <span class="s2">&quot;jms&quot;</span><span class="p">,</span> <span class="s2">&quot;oid&quot;</span><span class="p">,</span> <span class="s2">&quot;rsync&quot;</span><span class="p">,</span> <span class="s2">&quot;ni&quot;</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="p">]</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="n">other_used_schemes</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>    <span class="s2">&quot;hdl&quot;</span><span class="p">,</span> <span class="s2">&quot;isbn&quot;</span><span class="p">,</span> <span class="s2">&quot;issn&quot;</span><span class="p">,</span> <span class="s2">&quot;mstp&quot;</span><span class="p">,</span> <span class="s2">&quot;rtmp&quot;</span><span class="p">,</span> <span class="s2">&quot;rtspu&quot;</span><span class="p">,</span> <span class="s2">&quot;stp&quot;</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="p">]</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="n">uri_schemes</span> <span class="o">=</span> <span class="n">registered_iana_schemes</span> <span class="o">+</span> <span class="n">unofficial_common</span> <span class="o">+</span> <span class="n">historical_iana_schemes</span> <span class="o">+</span> <span class="n">provisional_iana_schemes</span> <span class="o">+</span> <span class="n">other_used_schemes</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="c1"># List of built-in transformers that are to be run regardless, because they are part of the RDFa spec</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="n">builtInTransformers</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>    <span class="n">empty_safe_curie</span><span class="p">,</span> <span class="n">top_about</span><span class="p">,</span> <span class="n">vocab_for_role</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="p">]</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a><span class="c1">#########################################################################################################</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a><span class="k">class</span> <span class="nc">pyRdfa</span><span class="p">:</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Main processing class for the distiller</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">    @ivar options: an instance of the L{Options} class</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a><span class="sd">    @ivar media_type: the preferred default media type, possibly set at initialization</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a><span class="sd">    @ivar base: the base value, possibly set at initialization</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="sd">    @ivar http_status: HTTP Status, to be returned when the package is used via a CGI entry. Initially set to 200, may be modified by exception handlers</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">media_type</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">rdfa_version</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="sd">        @keyword options: Options for the distiller</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="sd">        @type options: L{Options}</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a><span class="sd">        @keyword base: URI for the default &quot;base&quot; value (usually the URI of the file to be processed)</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="sd">        @keyword media_type: explicit setting of the preferred media type (a.k.a. content type) of the the RDFa source</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a><span class="sd">        @keyword rdfa_version: the RDFa version that should be used. If not set, the value of the global L{rdfa_current_version} variable is used</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="mi">200</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="n">base</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>        <span class="k">if</span> <span class="n">base</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">required_base</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">required_base</span>    <span class="o">=</span> <span class="n">base</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">charset</span>         <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>        <span class="c1"># predefined content type</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">media_type</span> <span class="o">=</span> <span class="n">media_type</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>        <span class="k">if</span> <span class="n">options</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>        <span class="k">if</span> <span class="n">media_type</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">set_host_language</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">media_type</span><span class="p">)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>        <span class="k">if</span> <span class="n">rdfa_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span> <span class="o">=</span> <span class="n">rdfa_version</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>    <span class="k">def</span> <span class="nf">_get_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a><span class="sd">        Trying to guess whether &quot;name&quot; is a URI or a string (for a file); it then tries to open this source accordingly,</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="sd">        returning a file-like object. If name is none of these, it returns the input argument (that should</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">        be, supposedly, a file-like object already).</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="sd">        If the media type has not been set explicitly at initialization of this instance,</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">        the method also sets the media_type based on the HTTP GET response or the suffix of the file. See</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">        L{host.preferred_suffixes} for the suffix to media type mapping.</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">        @param name: identifier of the input source</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">        @type name: string or a file-like object</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">        @return: a file like object if opening &quot;name&quot; is possible and successful, &quot;name&quot; otherwise</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>        <span class="n">isstring</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>            <span class="k">if</span> <span class="n">isstring</span><span class="p">:</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>                <span class="c1"># check if this is a URI, ie, if there is a valid &#39;scheme&#39; part</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>                <span class="c1"># otherwise it is considered to be a simple file</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>                <span class="k">if</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>                    <span class="n">url_request</span>       <span class="o">=</span> <span class="n">URIOpener</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{},</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">certifi_verify</span><span class="p">)</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">base</span>           <span class="o">=</span> <span class="n">url_request</span><span class="o">.</span><span class="n">location</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">media_type</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>                        <span class="k">if</span> <span class="n">url_request</span><span class="o">.</span><span class="n">content_type</span> <span class="ow">in</span> <span class="n">content_to_host_language</span><span class="p">:</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">media_type</span> <span class="o">=</span> <span class="n">url_request</span><span class="o">.</span><span class="n">content_type</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">media_type</span> <span class="o">=</span> <span class="n">MediaTypes</span><span class="o">.</span><span class="n">xml</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">set_host_language</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">media_type</span><span class="p">)</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">charset</span> <span class="o">=</span> <span class="n">url_request</span><span class="o">.</span><span class="n">charset</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_base</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">required_base</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>                    <span class="k">return</span> <span class="n">url_request</span><span class="o">.</span><span class="n">data</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>                    <span class="c1"># Creating a File URI for this thing</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_base</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">required_base</span> <span class="o">=</span> <span class="s2">&quot;file://&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">media_type</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">media_type</span> <span class="o">=</span> <span class="n">MediaTypes</span><span class="o">.</span><span class="n">xml</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>                        <span class="c1"># see if the default should be overwritten</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>                        <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">preferred_suffixes</span><span class="p">:</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>                            <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">):</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">media_type</span> <span class="o">=</span> <span class="n">preferred_suffixes</span><span class="p">[</span><span class="n">suffix</span><span class="p">]</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">charset</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>                                <span class="k">break</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">set_host_language</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">media_type</span><span class="p">)</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>                    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>                <span class="k">return</span> <span class="n">name</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>        <span class="k">except</span> <span class="n">HTTPError</span><span class="p">:</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>            <span class="k">raise</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>        <span class="k">except</span> <span class="n">RDFaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>            <span class="k">raise</span> <span class="n">e</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>            <span class="n">_type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">_traceback</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>            <span class="k">raise</span> <span class="n">FailedSource</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>    <span class="k">def</span> <span class="nf">_validate_output_format</span><span class="p">(</span><span class="n">outputFormat</span><span class="p">):</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="sd">        Malicious actors may create XSS style issues by using an illegal output format... better be careful</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>        <span class="c1"># protection against possible malicious URL call</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>        <span class="k">if</span> <span class="n">outputFormat</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;turtle&quot;</span><span class="p">,</span> <span class="s2">&quot;n3&quot;</span><span class="p">,</span> <span class="s2">&quot;xml&quot;</span><span class="p">,</span> <span class="s2">&quot;pretty-xml&quot;</span><span class="p">,</span> <span class="s2">&quot;nt&quot;</span><span class="p">,</span> <span class="s2">&quot;json-ld&quot;</span><span class="p">]:</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>            <span class="n">outputFormat</span> <span class="o">=</span> <span class="s2">&quot;turtle&quot;</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>        <span class="k">return</span> <span class="n">outputFormat</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>        
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>    <span class="c1">####################################################################################################################</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>    <span class="c1"># Externally used methods</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>    <span class="c1">#</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>    <span class="k">def</span> <span class="nf">graph_from_DOM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dom</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pgraph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">        Extract the RDF Graph from a DOM tree. This is where the real processing happens. All other methods get down to this</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a><span class="sd">        one, eventually (e.g., after opening a URI and parsing it into a DOM).</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a><span class="sd">        @param dom: a DOM Node element, the top level entry node for the whole tree (i.e., the C{dom.documentElement} is used to initiate processing down the node hierarchy)</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="sd">        @keyword graph: an RDF Graph (if None, than a new one is created)</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a><span class="sd">        @type graph: rdflib Graph instance.</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a><span class="sd">        @keyword pgraph: an RDF Graph to hold (possibly) the processor graph content. If None, and the error/warning triples are to be generated, they will be added to the returned graph. Otherwise they are stored in this graph.</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a><span class="sd">        @type pgraph: rdflib Graph instance</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a><span class="sd">        @return: an RDF Graph</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a><span class="sd">        @rtype: rdflib Graph instance</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>        <span class="k">def</span> <span class="nf">copyGraph</span><span class="p">(</span><span class="n">tog</span><span class="p">,</span> <span class="n">fromg</span><span class="p">):</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">fromg</span><span class="p">:</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>                <span class="n">tog</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">ns</span> <span class="ow">in</span> <span class="n">fromg</span><span class="o">.</span><span class="n">namespaces</span><span class="p">():</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>                <span class="n">tog</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">ns</span><span class="p">)</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>            <span class="c1"># Create the RDF Graph, that will contain the return triples...</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>            <span class="n">graph</span>   <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>        <span class="c1"># this will collect the content, the &#39;default graph&#39;, as called in the RDFa spec</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>        <span class="n">default_graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>        <span class="c1"># get the DOM tree</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>        <span class="n">topElement</span> <span class="o">=</span> <span class="n">dom</span><span class="o">.</span><span class="n">documentElement</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>        <span class="c1"># Create the initial state. This takes care of things</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>        <span class="c1"># like base, top level namespace settings, etc.</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>        <span class="n">state</span> <span class="o">=</span> <span class="n">ExecutionContext</span><span class="p">(</span><span class="n">topElement</span><span class="p">,</span> <span class="n">default_graph</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">required_base</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_base</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">,</span> <span class="n">rdfa_version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span><span class="p">)</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>        <span class="c1"># Perform the built-in and external transformations on the HTML tree.</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>        <span class="k">for</span> <span class="n">trans</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">transformers</span> <span class="o">+</span> <span class="n">builtInTransformers</span><span class="p">:</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>            <span class="n">trans</span><span class="p">(</span><span class="n">topElement</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>        <span class="c1"># This may have changed if the state setting detected an explicit version information:</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">rdfa_version</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>        <span class="c1"># The top level subject starts with the current document; this</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>        <span class="c1"># is used by the recursion</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>        <span class="c1"># this function is the real workhorse</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>        <span class="n">parse_one_node</span><span class="p">(</span><span class="n">topElement</span><span class="p">,</span> <span class="n">default_graph</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>        <span class="c1"># Massage the output graph in term of rdfa:Pattern and rdfa:copy</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>        <span class="n">handle_prototypes</span><span class="p">(</span><span class="n">default_graph</span><span class="p">)</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>        <span class="c1"># If the RDFS expansion has to be made, here is the place...</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">vocab_expansion</span><span class="p">:</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>            <span class="kn">from</span> <span class="nn">.rdfs.process</span> <span class="kn">import</span> <span class="n">process_rdfa_sem</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>            <span class="n">process_rdfa_sem</span><span class="p">(</span><span class="n">default_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>        <span class="c1"># Experimental feature: nothing for now, this is kept as a placeholder</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">experimental_features</span><span class="p">:</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>            <span class="k">pass</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>        <span class="c1"># What should be returned depends on the way the options have been set up</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">output_default_graph</span><span class="p">:</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>            <span class="n">copyGraph</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">default_graph</span><span class="p">)</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">output_processor_graph</span><span class="p">:</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>                <span class="k">if</span> <span class="n">pgraph</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>                    <span class="n">copyGraph</span><span class="p">(</span><span class="n">pgraph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>                    <span class="n">copyGraph</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">output_processor_graph</span><span class="p">:</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>            <span class="k">if</span> <span class="n">pgraph</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>                <span class="n">copyGraph</span><span class="p">(</span><span class="n">pgraph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>                <span class="n">copyGraph</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>        <span class="c1"># this is necessary if several DOM trees are handled in a row...</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">reset_processor_graph</span><span class="p">()</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>        <span class="k">return</span> <span class="n">graph</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>    <span class="k">def</span> <span class="nf">graph_from_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rdfOutput</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">pgraph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a><span class="sd">        Extract an RDF graph from an RDFa source. The source is parsed, the RDF extracted, and the RDFa Graph is</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a><span class="sd">        returned. This is a front-end to the L{pyRdfa.graph_from_DOM} method.</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a><span class="sd">        @param name: a URI, a file name, or a file-like object</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a><span class="sd">        @param graph: rdflib Graph instance. If None, a new one is created.</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a><span class="sd">        @param pgraph: rdflib Graph instance for the processor graph. If None, and the error/warning triples are to be generated, they will be added to the returned graph. Otherwise they are stored in this graph.</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a><span class="sd">        @param rdfOutput: whether runtime exceptions should be turned into RDF and returned as part of the processor graph</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a><span class="sd">        @return: an RDF Graph</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a><span class="sd">        @rtype: rdflib Graph instance</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>        <span class="k">def</span> <span class="nf">copyErrors</span><span class="p">(</span><span class="n">tog</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>            <span class="k">if</span> <span class="n">tog</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>                <span class="n">tog</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">output_processor_graph</span><span class="p">:</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">graph</span><span class="p">:</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>                    <span class="n">tog</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>                    <span class="k">if</span> <span class="n">pgraph</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">pgraph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">ns</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">namespaces</span><span class="p">():</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>                    <span class="n">tog</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">ns</span><span class="p">)</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>                    <span class="k">if</span> <span class="n">pgraph</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">pgraph</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">ns</span><span class="p">)</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>            <span class="n">options</span><span class="o">.</span><span class="n">reset_processor_graph</span><span class="p">()</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>            <span class="k">return</span> <span class="n">tog</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>        <span class="n">isstring</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>            <span class="c1"># First, open the source... Possible HTTP errors are returned as error triples</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>            <span class="n">stream</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>                <span class="n">stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_input</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>            <span class="k">except</span> <span class="n">FailedSource</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>                <span class="n">_f</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="mi">400</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">rdfOutput</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>                <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">msg</span><span class="p">,</span> <span class="n">FileReferenceError</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">add_http_context</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>                <span class="k">return</span> <span class="n">copyErrors</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>            <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>                <span class="n">h</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">http_code</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">rdfOutput</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>                <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="s2">&quot;HTTP Error: </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">http_code</span><span class="p">,</span><span class="n">h</span><span class="o">.</span><span class="n">msg</span><span class="p">),</span> <span class="n">HTError</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">add_http_context</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">http_code</span><span class="p">)</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>                <span class="k">return</span> <span class="n">copyErrors</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>            <span class="k">except</span> <span class="n">RDFaError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>                <span class="n">e</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="mi">500</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>                <span class="c1"># Something nasty happened:-(</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">rdfOutput</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>                <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">msg</span><span class="p">),</span> <span class="n">context</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">add_http_context</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>                <span class="k">return</span> <span class="n">copyErrors</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>                <span class="n">e</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="mi">500</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>                <span class="c1"># Something nasty happened:-(</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">rdfOutput</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">ex</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>                <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">context</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">add_http_context</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>                <span class="k">return</span> <span class="n">copyErrors</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>            <span class="n">dom</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>                <span class="n">parser</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">host_language</span> <span class="o">==</span> <span class="n">HostLanguage</span><span class="o">.</span><span class="n">html5</span><span class="p">:</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a>                    <span class="kn">import</span> <span class="nn">warnings</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>                    <span class="kn">from</span> <span class="nn">html5lib</span> <span class="kn">import</span> <span class="n">HTMLParser</span><span class="p">,</span> <span class="n">treebuilders</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>                    <span class="n">parser</span> <span class="o">=</span> <span class="n">HTMLParser</span><span class="p">(</span><span class="n">tree</span><span class="o">=</span><span class="n">treebuilders</span><span class="o">.</span><span class="n">getTreeBuilder</span><span class="p">(</span><span class="s2">&quot;dom&quot;</span><span class="p">))</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charset</span><span class="p">:</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>                        <span class="c1"># This means the HTTP header has provided a charset, or the</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>                        <span class="c1"># file is a local file when we suppose it to be a utf-8</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a>                        <span class="c1">#</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>                        <span class="c1"># 2020-01-20, Ivan Herman</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>                        <span class="c1">#   for some reasons the python3 version ran into a problem with this html5lib call</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>                        <span class="c1">#   the override_encoding argument was not accepted.</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>                        <span class="c1"># dom = parser.parse(stream, override_encoding=self.charset)</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>                        <span class="n">dom</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>                        <span class="c1"># No charset set. The HTMLLib parser tries to sniff into the</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>                        <span class="c1"># the file to find a meta header for the charset; if that</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>                        <span class="c1"># works, fine, otherwise it falls back on window-...</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>                        <span class="n">dom</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>                        <span class="k">if</span> <span class="n">isstring</span><span class="p">:</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>                            <span class="n">stream</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a>                            <span class="n">stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_input</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>                            <span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>                        <span class="kn">from</span> <span class="nn">.host</span> <span class="kn">import</span> <span class="n">adjust_html_version</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span> <span class="o">=</span> <span class="n">adjust_html_version</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span><span class="p">)</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>                        <span class="c1"># if anything goes wrong, it is not really important; rdfa version stays what it was...</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>                        <span class="k">pass</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>                    <span class="kn">from</span> <span class="nn">.host</span> <span class="kn">import</span> <span class="n">adjust_xhtml_and_version</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">IOBase</span><span class="p">):</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>                        <span class="n">parse</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">dom</span><span class="o">.</span><span class="n">minidom</span><span class="o">.</span><span class="n">parse</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>                        <span class="n">parse</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">dom</span><span class="o">.</span><span class="n">minidom</span><span class="o">.</span><span class="n">parseString</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>                    <span class="n">dom</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>                    <span class="n">adjusted_host_language</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="n">adjust_xhtml_and_version</span><span class="p">(</span><span class="n">dom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">host_language</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span><span class="p">)</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">host_language</span> <span class="o">=</span> <span class="n">adjusted_host_language</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span> <span class="o">=</span> <span class="n">version</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;HTML5 parser not available. Try installing html5lib &lt;http://code.google.com/p/html5lib&gt;&quot;</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>                <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>                <span class="n">e</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>                <span class="c1"># These are various parsing exception. Per spec, this is a case when</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>                <span class="c1"># error triples MUST be returned, ie, the usage of rdfOutput (which switches between an HTML formatted</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>                <span class="c1"># return page or a graph with error triples) does not apply</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>                <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">context</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="mi">400</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">add_http_context</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>                <span class="k">return</span> <span class="n">copyErrors</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>            <span class="c1"># If we got here, we have a DOM tree to operate on...</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_from_DOM</span><span class="p">(</span><span class="n">dom</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">pgraph</span><span class="p">)</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>            <span class="c1"># Something nasty happened during the generation of the graph...</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>            <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="ne">ImportError</span><span class="p">):</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="mi">500</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">rdfOutput</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">b</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a>            <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">context</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">add_http_context</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a>            <span class="k">return</span> <span class="n">copyErrors</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a>    <span class="k">def</span> <span class="nf">rdf_from_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">outputFormat</span> <span class="o">=</span> <span class="s2">&quot;turtle&quot;</span><span class="p">,</span> <span class="n">rdfOutput</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a><span class="sd">        Extract and RDF graph from a list of RDFa sources and serialize them in one graph. The sources are parsed, the RDF</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a><span class="sd">        extracted, and serialization is done in the specified format.</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a><span class="sd">        @param names: list of sources, each can be a URI, a file name, or a file-like object</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a><span class="sd">        @keyword outputFormat: serialization format. Can be one of &quot;turtle&quot;, &quot;n3&quot;, &quot;xml&quot;, &quot;pretty-xml&quot;, &quot;nt&quot;. &quot;xml&quot;, &quot;pretty-xml&quot;, &quot;json&quot; or &quot;json-ld&quot;. &quot;turtle&quot; and &quot;n3&quot;, &quot;xml&quot; and &quot;pretty-xml&quot;, and &quot;json&quot; and &quot;json-ld&quot; are synonyms, respectively. Note that the JSON-LD serialization works with RDFLib 3.* only.</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a><span class="sd">        @keyword rdfOutput: controls what happens in case an exception is raised. If the value is False, the caller is responsible handling it; otherwise a graph is returned with an error message included in the processor graph</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a><span class="sd">        @type rdfOutput: boolean</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a><span class="sd">        @return: a serialized RDF Graph</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a><span class="sd">        @rtype: string</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a>        <span class="c1"># protection against possible malicious URL call</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a>        <span class="n">outputFormat</span> <span class="o">=</span> <span class="n">pyRdfa</span><span class="o">.</span><span class="n">_validate_output_format</span><span class="p">(</span><span class="n">outputFormat</span><span class="p">);</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a>        <span class="c1"># This is better because it gives access to the various, non-standard serializations</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a>        <span class="c1"># If it does not work because the extra are not installed, fall back to the standard</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a>        <span class="c1"># rdlib distribution...</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a>        <span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a>        <span class="c1"># graph.bind(&quot;xsd&quot;, Namespace(&#39;http://www.w3.org/2001/XMLSchema#&#39;))</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a>        <span class="c1"># the value of rdfOutput determines the reaction on exceptions...</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_from_source</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">rdfOutput</span><span class="p">)</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a>        <span class="c1"># Stupid difference between python2 and python3...</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="n">outputFormat</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a>    <span class="k">def</span> <span class="nf">rdf_from_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">outputFormat</span> <span class="o">=</span> <span class="s2">&quot;turtle&quot;</span><span class="p">,</span> <span class="n">rdfOutput</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a><span class="sd">        Extract and RDF graph from an RDFa source and serialize it in one graph. The source is parsed, the RDF</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a><span class="sd">        extracted, and serialization is done in the specified format.</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a><span class="sd">        @param name: a URI, a file name, or a file-like object</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a><span class="sd">        @keyword outputFormat: serialization format. Can be one of &quot;turtle&quot;, &quot;n3&quot;, &quot;xml&quot;, &quot;pretty-xml&quot;, &quot;nt&quot;. &quot;xml&quot;, &quot;pretty-xml&quot;, or &quot;json-ld&quot;. &quot;turtle&quot; and &quot;n3&quot;, or &quot;xml&quot; and &quot;pretty-xml&quot; are synonyms, respectively. Note that the JSON-LD serialization works with RDFLib 3.* only.</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a><span class="sd">        @keyword rdfOutput: controls what happens in case an exception is raised. If the value is False, the caller is responsible handling it; otherwise a graph is returned with an error message included in the processor graph</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a><span class="sd">        @type rdfOutput: boolean</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a><span class="sd">        @return: a serialized RDF Graph</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a><span class="sd">        @rtype: string</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdf_from_sources</span><span class="p">([</span><span class="n">name</span><span class="p">],</span> <span class="n">outputFormat</span><span class="p">,</span> <span class="n">rdfOutput</span><span class="p">)</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a><span class="c1">################################################# CGI Entry point</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a><span class="k">def</span> <span class="nf">processURI</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">outputFormat</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="p">{}):</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The standard processing of an RDFa uri options in a form; used as an entry point from a CGI call.</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a>
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a><span class="sd">    The call accepts extra form options (i.e., HTTP GET options) as follows:</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a>
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a><span class="sd">     - C{graph=[output|processor|output,processor|processor,output]} specifying which graphs are returned. Default: C{output}</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a><span class="sd">     - C{space_preserve=[true|false]} means that plain literals are normalized in terms of white spaces. Default: C{false}</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a><span class="sd">     - C{rfa_version} provides the RDFa version that should be used for distilling. The string should be of the form &quot;1.0&quot; or &quot;1.1&quot;. Default is the highest version the current package implements, currently &quot;1.1&quot;</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a><span class="sd">     - C{host_language=[xhtml,html,xml]} : the host language. Used when files are uploaded or text is added verbatim, otherwise the HTTP return header should be used. Default C{xml}</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a><span class="sd">     - C{embedded_rdf=[true|false]} : whether embedded turtle or RDF/XML content should be added to the output graph. Default: C{false}</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a><span class="sd">     - C{vocab_expansion=[true|false]} : whether the vocabularies should be expanded through the restricted RDFS entailment. Default: C{false}</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a><span class="sd">     - C{vocab_cache=[true|false]} : whether vocab caching should be performed or whether it should be ignored and vocabulary files should be picked up every time. Default: C{false}</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a><span class="sd">     - C{vocab_cache_report=[true|false]} : whether vocab caching details should be reported. Default: C{false}</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos">722</span></a><span class="sd">     - C{vocab_cache_bypass=[true|false]} : whether vocab caches have to be regenerated every time. Default: C{false}</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos">723</span></a><span class="sd">     - C{rdfa_lite=[true|false]} : whether warnings should be generated for non RDFa Lite attribute usage. Default: C{false}</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos">724</span></a><span class="sd">     - C{certifi_verify=[true|false]} : whether the SSL certificate needs to be verified. Default: C{true}</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos">725</span></a>
</span><span id="L-726"><a href="#L-726"><span class="linenos">726</span></a><span class="sd">    @param uri: URI to access. Note that the C{text:} and C{uploaded:} fake URI values are treated separately; the former is for textual intput (in which case a StringIO is used to get the data) and the latter is for uploaded file, where the form gives access to the file directly.</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos">727</span></a><span class="sd">    @param outputFormat: serialization format, as defined by the package. Currently &quot;xml&quot;, &quot;turtle&quot;, &quot;nt&quot;, or &quot;json&quot;. Default is &quot;turtle&quot;, also used if any other string is given.</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos">728</span></a><span class="sd">    @param form: extra call options (from the CGI call) to set up the local options</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos">729</span></a><span class="sd">    @type form: cgi FieldStorage instance</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos">730</span></a><span class="sd">    @return: serialized graph</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos">731</span></a><span class="sd">    @rtype: string</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos">732</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos">733</span></a>    <span class="k">def</span> <span class="nf">_get_option</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">compare_value</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos">734</span></a>        <span class="n">param_old</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos">735</span></a>        <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos">736</span></a>            <span class="n">val</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos">737</span></a>            <span class="k">return</span> <span class="n">val</span> <span class="o">==</span> <span class="n">compare_value</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos">738</span></a>        <span class="k">elif</span> <span class="n">param_old</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos">739</span></a>            <span class="c1"># this is to ensure the old style parameters are still valid...</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos">740</span></a>            <span class="c1"># in the old days I used &#39;-&#39; in the parameters, the standard favours &#39;_&#39;</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos">741</span></a>            <span class="n">val</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="n">param_old</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos">742</span></a>            <span class="k">return</span> <span class="n">val</span> <span class="o">==</span> <span class="n">compare_value</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos">743</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos">744</span></a>            <span class="k">return</span> <span class="n">default</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos">745</span></a>
</span><span id="L-746"><a href="#L-746"><span class="linenos">746</span></a>    <span class="k">if</span> <span class="n">uri</span> <span class="o">==</span> <span class="s2">&quot;uploaded:&quot;</span><span class="p">:</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos">747</span></a>        <span class="n">stream</span> <span class="o">=</span> <span class="n">form</span><span class="p">[</span><span class="s2">&quot;uploaded&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">file</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos">748</span></a>        <span class="n">base</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos">749</span></a>    <span class="k">elif</span> <span class="n">uri</span> <span class="o">==</span> <span class="s2">&quot;text:&quot;</span><span class="p">:</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos">750</span></a>        <span class="n">stream</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">))</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos">751</span></a>        <span class="n">base</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos">752</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos">753</span></a>        <span class="n">stream</span> <span class="o">=</span> <span class="n">uri</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos">754</span></a>        <span class="n">base</span> <span class="o">=</span> <span class="n">uri</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos">755</span></a>
</span><span id="L-756"><a href="#L-756"><span class="linenos">756</span></a>    <span class="k">if</span> <span class="s2">&quot;rdfa_version&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos">757</span></a>        <span class="n">rdfa_version</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;rdfa_version&quot;</span><span class="p">)</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos">758</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos">759</span></a>        <span class="n">rdfa_version</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos">760</span></a>
</span><span id="L-761"><a href="#L-761"><span class="linenos">761</span></a>    <span class="c1"># working through the possible options</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos">762</span></a>    <span class="c1"># Host language: HTML, XHTML, or XML</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos">763</span></a>    <span class="c1"># Note that these options should be used for the upload and inline version only in case of a form</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos">764</span></a>    <span class="c1"># for real uris the returned content type should be used</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos">765</span></a>    <span class="k">if</span> <span class="s2">&quot;host_language&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos">766</span></a>        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;host_language&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;xhtml&quot;</span><span class="p">:</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos">767</span></a>            <span class="n">media_type</span> <span class="o">=</span> <span class="n">MediaTypes</span><span class="o">.</span><span class="n">xhtml</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos">768</span></a>        <span class="k">elif</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;host_language&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;html&quot;</span><span class="p">:</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos">769</span></a>            <span class="n">media_type</span> <span class="o">=</span> <span class="n">MediaTypes</span><span class="o">.</span><span class="n">html</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos">770</span></a>        <span class="k">elif</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;host_language&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;svg&quot;</span><span class="p">:</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos">771</span></a>            <span class="n">media_type</span> <span class="o">=</span> <span class="n">MediaTypes</span><span class="o">.</span><span class="n">svg</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos">772</span></a>        <span class="k">elif</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;host_language&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos">773</span></a>            <span class="n">media_type</span> <span class="o">=</span> <span class="n">MediaTypes</span><span class="o">.</span><span class="n">atom</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos">774</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos">775</span></a>            <span class="n">media_type</span> <span class="o">=</span> <span class="n">MediaTypes</span><span class="o">.</span><span class="n">xml</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos">776</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos">777</span></a>        <span class="n">media_type</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos">778</span></a>
</span><span id="L-779"><a href="#L-779"><span class="linenos">779</span></a>    <span class="n">transformers</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos">780</span></a>
</span><span id="L-781"><a href="#L-781"><span class="linenos">781</span></a>    <span class="n">check_lite</span> <span class="o">=</span> <span class="s2">&quot;rdfa_lite&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;rdfa_lite&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos">782</span></a>
</span><span id="L-783"><a href="#L-783"><span class="linenos">783</span></a>    <span class="c1"># The code below is left for backward compatibility only. In fact, these options are not exposed any more,</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos">784</span></a>    <span class="c1"># they are not really in use</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos">785</span></a>    <span class="kn">from</span> <span class="nn">.transform.metaname</span> <span class="kn">import</span> <span class="n">meta_transform</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos">786</span></a>    <span class="kn">from</span> <span class="nn">.transform.OpenID</span> <span class="kn">import</span> <span class="n">OpenID_transform</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos">787</span></a>    <span class="kn">from</span> <span class="nn">.transform.DublinCore</span> <span class="kn">import</span> <span class="n">DC_transform</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos">788</span></a>
</span><span id="L-789"><a href="#L-789"><span class="linenos">789</span></a>    <span class="k">if</span> <span class="s2">&quot;extras&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;extras&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos">790</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="n">OpenID_transform</span><span class="p">,</span> <span class="n">DC_transform</span><span class="p">,</span> <span class="n">meta_transform</span><span class="p">]:</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos">791</span></a>            <span class="n">transformers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos">792</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos">793</span></a>        <span class="k">if</span> <span class="s2">&quot;extra-meta&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;extra-meta&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos">794</span></a>            <span class="n">transformers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meta_transform</span><span class="p">)</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos">795</span></a>        <span class="k">if</span> <span class="s2">&quot;extra-openid&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;extra-openid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos">796</span></a>            <span class="n">transformers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OpenID_transform</span><span class="p">)</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos">797</span></a>        <span class="k">if</span> <span class="s2">&quot;extra-dc&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;extra-dc&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos">798</span></a>            <span class="n">transformers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DC_transform</span><span class="p">)</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos">799</span></a>
</span><span id="L-800"><a href="#L-800"><span class="linenos">800</span></a>    <span class="n">output_default_graph</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos">801</span></a>    <span class="n">output_processor_graph</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos">802</span></a>    <span class="c1"># Note that I use the &#39;graph&#39; and the &#39;rdfagraph&#39; form keys here. Reason is that</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos">803</span></a>    <span class="c1"># I used &#39;graph&#39; in the previous versions, including the RDFa 1.0 processor,</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos">804</span></a>    <span class="c1"># so if I removed that altogether that would create backward incompatibilities</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos">805</span></a>    <span class="c1"># On the other hand, the RDFa 1.1 doc clearly refers to &#39;rdfagraph&#39; as the standard</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos">806</span></a>    <span class="c1"># key.</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos">807</span></a>    <span class="n">a</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos">808</span></a>    <span class="k">if</span> <span class="s2">&quot;graph&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos">809</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;graph&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos">810</span></a>    <span class="k">elif</span> <span class="s2">&quot;rdfagraph&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos">811</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;rdfagraph&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos">812</span></a>    <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos">813</span></a>        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;processor&quot;</span><span class="p">:</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos">814</span></a>            <span class="n">output_default_graph</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos">815</span></a>            <span class="n">output_processor_graph</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos">816</span></a>        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;processor,output&quot;</span> <span class="ow">or</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;output,processor&quot;</span><span class="p">:</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos">817</span></a>            <span class="n">output_processor_graph</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos">818</span></a>
</span><span id="L-819"><a href="#L-819"><span class="linenos">819</span></a>    <span class="n">embedded_rdf</span> <span class="o">=</span>        <span class="n">_get_option</span><span class="p">(</span> <span class="s2">&quot;embedded_rdf&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos">820</span></a>    <span class="n">space_preserve</span> <span class="o">=</span>      <span class="n">_get_option</span><span class="p">(</span> <span class="s2">&quot;space_preserve&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos">821</span></a>    <span class="n">vocab_cache</span> <span class="o">=</span>         <span class="n">_get_option</span><span class="p">(</span> <span class="s2">&quot;vocab_cache&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos">822</span></a>    <span class="n">vocab_cache_report</span> <span class="o">=</span>  <span class="n">_get_option</span><span class="p">(</span> <span class="s2">&quot;vocab_cache_report&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos">823</span></a>    <span class="n">refresh_vocab_cache</span> <span class="o">=</span> <span class="n">_get_option</span><span class="p">(</span> <span class="s2">&quot;vocab_cache_refresh&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos">824</span></a>    <span class="n">vocab_expansion</span> <span class="o">=</span>     <span class="n">_get_option</span><span class="p">(</span> <span class="s2">&quot;vocab_expansion&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos">825</span></a>    <span class="n">certifi_verify</span> <span class="o">=</span>      <span class="n">_get_option</span><span class="p">(</span> <span class="s2">&quot;certifi_verify&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos">826</span></a>    <span class="k">if</span> <span class="n">vocab_cache_report</span><span class="p">:</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos">827</span></a>        <span class="n">output_processor_graph</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos">828</span></a>
</span><span id="L-829"><a href="#L-829"><span class="linenos">829</span></a>    <span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">(</span><span class="n">output_default_graph</span>   <span class="o">=</span> <span class="n">output_default_graph</span><span class="p">,</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos">830</span></a>                      <span class="n">output_processor_graph</span> <span class="o">=</span> <span class="n">output_processor_graph</span><span class="p">,</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos">831</span></a>                      <span class="n">space_preserve</span>         <span class="o">=</span> <span class="n">space_preserve</span><span class="p">,</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos">832</span></a>                      <span class="n">transformers</span>           <span class="o">=</span> <span class="n">transformers</span><span class="p">,</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos">833</span></a>                      <span class="n">vocab_cache</span>            <span class="o">=</span> <span class="n">vocab_cache</span><span class="p">,</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos">834</span></a>                      <span class="n">vocab_cache_report</span>     <span class="o">=</span> <span class="n">vocab_cache_report</span><span class="p">,</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos">835</span></a>                      <span class="n">refresh_vocab_cache</span>    <span class="o">=</span> <span class="n">refresh_vocab_cache</span><span class="p">,</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos">836</span></a>                      <span class="n">vocab_expansion</span>        <span class="o">=</span> <span class="n">vocab_expansion</span><span class="p">,</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos">837</span></a>                      <span class="n">embedded_rdf</span>           <span class="o">=</span> <span class="n">embedded_rdf</span><span class="p">,</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos">838</span></a>                      <span class="n">check_lite</span>             <span class="o">=</span> <span class="n">check_lite</span><span class="p">,</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos">839</span></a>                      <span class="n">certifi_verify</span>         <span class="o">=</span> <span class="n">certifi_verify</span><span class="p">)</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos">840</span></a>
</span><span id="L-841"><a href="#L-841"><span class="linenos">841</span></a>    <span class="n">processor</span> <span class="o">=</span> <span class="n">pyRdfa</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="n">base</span><span class="p">,</span> <span class="n">media_type</span> <span class="o">=</span> <span class="n">media_type</span><span class="p">,</span> <span class="n">rdfa_version</span> <span class="o">=</span> <span class="n">rdfa_version</span><span class="p">)</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos">842</span></a>
</span><span id="L-843"><a href="#L-843"><span class="linenos">843</span></a>    <span class="c1"># Decide the output format; the issue is what should happen in case of a top level error like an inaccessibility of</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos">844</span></a>    <span class="c1"># the html source: should a graph be returned or an HTML page with an error message?</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos">845</span></a>
</span><span id="L-846"><a href="#L-846"><span class="linenos">846</span></a>    <span class="c1"># decide whether HTML or RDF should be sent.</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos">847</span></a>    <span class="n">htmlOutput</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos">848</span></a>    <span class="c1">#if &#39;HTTP_ACCEPT&#39; in os.environ:</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos">849</span></a>    <span class="c1">#    acc = os.environ[&#39;HTTP_ACCEPT&#39;]</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos">850</span></a>    <span class="c1">#    possibilities = [&#39;text/html&#39;,</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos">851</span></a>    <span class="c1">#                     &#39;application/rdf+xml&#39;,</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos">852</span></a>    <span class="c1">#                     &#39;text/turtle; charset=utf-8&#39;,</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos">853</span></a>    <span class="c1">#                     &#39;application/json&#39;,</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos">854</span></a>    <span class="c1">#                     &#39;application/ld+json&#39;,</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos">855</span></a>    <span class="c1">#                     &#39;text/rdf+n3&#39;]</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos">856</span></a>    <span class="c1">#</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos">857</span></a>    <span class="c1">#    # this nice module does content negotiation and returns the preferred format</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos">858</span></a>    <span class="c1">#    sg = acceptable_content_type(acc, possibilities)</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos">859</span></a>    <span class="c1">#    htmlOutput = (sg != None and sg[0] == content_type(&#39;text/html&#39;))</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos">860</span></a>    <span class="c1">#    os.environ[&#39;rdfaerror&#39;] = &#39;true&#39;</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos">861</span></a>
</span><span id="L-862"><a href="#L-862"><span class="linenos">862</span></a>    <span class="c1"># This is really for testing purposes only, it is an unpublished flag to force RDF output no</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos">863</span></a>    <span class="c1"># matter what</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos">864</span></a>    <span class="kn">import</span> <span class="nn">html</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos">865</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos">866</span></a>        <span class="n">outputFormat</span> <span class="o">=</span> <span class="n">pyRdfa</span><span class="o">.</span><span class="n">_validate_output_format</span><span class="p">(</span><span class="n">outputFormat</span><span class="p">);</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos">867</span></a>        <span class="k">if</span> <span class="n">outputFormat</span> <span class="o">==</span> <span class="s2">&quot;n3&quot;</span><span class="p">:</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos">868</span></a>            <span class="n">retval</span> <span class="o">=</span> <span class="s1">&#39;Content-Type: text/rdf+n3; charset=utf-8</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos">869</span></a>        <span class="k">elif</span> <span class="n">outputFormat</span> <span class="o">==</span> <span class="s2">&quot;nt&quot;</span> <span class="ow">or</span> <span class="n">outputFormat</span> <span class="o">==</span> <span class="s2">&quot;turtle&quot;</span><span class="p">:</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos">870</span></a>            <span class="n">retval</span> <span class="o">=</span> <span class="s1">&#39;Content-Type: text/turtle; charset=utf-8</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos">871</span></a>        <span class="k">elif</span> <span class="n">outputFormat</span> <span class="o">==</span> <span class="s2">&quot;json-ld&quot;</span> <span class="ow">or</span> <span class="n">outputFormat</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos">872</span></a>            <span class="n">retval</span> <span class="o">=</span> <span class="s1">&#39;Content-Type: application/ld+json; charset=utf-8</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos">873</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos">874</span></a>            <span class="n">retval</span> <span class="o">=</span> <span class="s1">&#39;Content-Type: application/rdf+xml; charset=utf-8</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos">875</span></a>        <span class="n">graph</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">rdf_from_source</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">outputFormat</span><span class="p">,</span> <span class="n">rdfOutput</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;forceRDFOutput&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">htmlOutput</span><span class="p">)</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos">876</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos">877</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="n">graph</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos">878</span></a>        <span class="k">return</span> <span class="n">retval</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos">879</span></a>    <span class="k">except</span> <span class="n">HTTPError</span><span class="p">:</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos">880</span></a>        <span class="n">_type</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">_traceback</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos">881</span></a>
</span><span id="L-882"><a href="#L-882"><span class="linenos">882</span></a>        <span class="n">retval</span> <span class="o">=</span> <span class="s1">&#39;Content-type: text/html; charset=utf-8</span><span class="se">\n</span><span class="s1">Status: </span><span class="si">%s</span><span class="s1"> </span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">h</span><span class="o">.</span><span class="n">http_code</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos">883</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;html&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos">884</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;head&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos">885</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;title&gt;HTTP Error in distilling RDFa content&lt;/title&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos">886</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/head&gt;&lt;body&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos">887</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h1&gt;HTTP Error in distilling RDFa content&lt;/h1&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos">888</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;p&gt;HTTP Error: </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&lt;/p&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">http_code</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos">889</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;p&gt;On URI: &lt;code&gt;&#39;</span><span class="si">%s</span><span class="s2">&#39;&lt;/code&gt;&lt;/p&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos">890</span></a>        <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;/body&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos">891</span></a>        <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;/html&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos">892</span></a>        <span class="k">return</span> <span class="n">retval</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos">893</span></a>    <span class="k">except</span><span class="p">:</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos">894</span></a>        <span class="c1"># This branch should occur only if an exception is really raised, ie, if it is not turned</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos">895</span></a>        <span class="c1"># into a graph value.</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos">896</span></a>        <span class="n">_type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">_traceback</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos">897</span></a>
</span><span id="L-898"><a href="#L-898"><span class="linenos">898</span></a>        <span class="kn">import</span> <span class="nn">traceback</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos">899</span></a>
</span><span id="L-900"><a href="#L-900"><span class="linenos">900</span></a>        <span class="n">retval</span> <span class="o">=</span> <span class="s1">&#39;Content-type: text/html; charset=utf-8</span><span class="se">\n</span><span class="s1">Status: </span><span class="si">%s</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">processor</span><span class="o">.</span><span class="n">http_status</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos">901</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;html&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos">902</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;head&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos">903</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;title&gt;Exception in RDFa processing&lt;/title&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos">904</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/head&gt;&lt;body&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos">905</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h1&gt;Exception in distilling RDFa&lt;/h1&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos">906</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;pre&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos">907</span></a>        <span class="n">strio</span>  <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos">908</span></a>        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">strio</span><span class="p">)</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos">909</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="n">strio</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos">910</span></a>        <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;/pre&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos">911</span></a>        <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;pre&gt;</span><span class="si">%s</span><span class="s2">&lt;/pre&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos">912</span></a>        <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;h1&gt;Distiller request details&lt;/h1&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos">913</span></a>        <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;dl&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos">914</span></a>        <span class="k">if</span> <span class="n">uri</span> <span class="o">==</span> <span class="s2">&quot;text:&quot;</span> <span class="ow">and</span> <span class="s2">&quot;text&quot;</span> <span class="ow">in</span> <span class="n">form</span> <span class="ow">and</span> <span class="n">form</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos">915</span></a>            <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;dt&gt;Text input:&lt;/dt&gt;&lt;dd&gt;</span><span class="si">%s</span><span class="s2">&lt;/dd&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;br/&gt;&#39;</span><span class="p">)</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos">916</span></a>        <span class="k">elif</span> <span class="n">uri</span> <span class="o">==</span> <span class="s2">&quot;uploaded:&quot;</span><span class="p">:</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos">917</span></a>            <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;dt&gt;Uploaded file&lt;/dt&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos">918</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos">919</span></a>            <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;dt&gt;URI received:&lt;/dt&gt;&lt;dd&gt;&lt;code&gt;&#39;</span><span class="si">%s</span><span class="s2">&#39;&lt;/code&gt;&lt;/dd&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos">920</span></a>        <span class="k">if</span> <span class="s2">&quot;host_language&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos">921</span></a>            <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;dt&gt;Media Type:&lt;/dt&gt;&lt;dd&gt;</span><span class="si">%s</span><span class="s2">&lt;/dd&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">media_type</span><span class="p">)</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos">922</span></a>        <span class="k">if</span> <span class="s2">&quot;graph&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos">923</span></a>            <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;dt&gt;Requested graphs:&lt;/dt&gt;&lt;dd&gt;</span><span class="si">%s</span><span class="s2">&lt;/dd&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;graph&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos">924</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos">925</span></a>            <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;dt&gt;Requested graphs:&lt;/dt&gt;&lt;dd&gt;default&lt;/dd&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos">926</span></a>        <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;dt&gt;Output serialization format:&lt;/dt&gt;&lt;dd&gt; </span><span class="si">%s</span><span class="s2">&lt;/dd&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">outputFormat</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos">927</span></a>        <span class="k">if</span> <span class="s2">&quot;space_preserve&quot;</span> <span class="ow">in</span> <span class="n">form</span> <span class="p">:</span> <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;dt&gt;Space preserve:&lt;/dt&gt;&lt;dd&gt; </span><span class="si">%s</span><span class="s2">&lt;/dd&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;space_preserve&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos">928</span></a>        <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;/dl&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos">929</span></a>        <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;/body&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos">930</span></a>        <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;/html&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos">931</span></a>        <span class="k">return</span> <span class="n">retval</span>
</span></pre></div>


            </section>
                <section id="name">
                    <div class="attr variable">
            <span class="name">name</span>        =
<span class="default_value">&#39;pyRdfa3&#39;</span>

        
    </div>
    <a class="headerlink" href="#name"></a>
    
    

                </section>
                <section id="ns_rdfa">
                    <div class="attr variable">
            <span class="name">ns_rdfa</span>        =
<span class="default_value">Namespace(&#39;http://www.w3.org/ns/rdfa#&#39;)</span>

        
    </div>
    <a class="headerlink" href="#ns_rdfa"></a>
    
    

                </section>
                <section id="RDFA_VOCAB">
                    <div class="attr variable">
            <span class="name">RDFA_VOCAB</span>        =
<span class="default_value">rdflib.term.URIRef(&#39;http://www.w3.org/ns/rdfa#usesVocabulary&#39;)</span>

        
    </div>
    <a class="headerlink" href="#RDFA_VOCAB"></a>
    
    

                </section>
                <section id="ns_xsd">
                    <div class="attr variable">
            <span class="name">ns_xsd</span>        =
<span class="default_value">Namespace(&#39;http://www.w3.org/2001/XMLSchema#&#39;)</span>

        
    </div>
    <a class="headerlink" href="#ns_xsd"></a>
    
    

                </section>
                <section id="ns_distill">
                    <div class="attr variable">
            <span class="name">ns_distill</span>        =
<span class="default_value">Namespace(&#39;http://www.w3.org/2007/08/pyRdfa/vocab#&#39;)</span>

        
    </div>
    <a class="headerlink" href="#ns_distill"></a>
    
    

                </section>
                <section id="debug">
                    <div class="attr variable">
            <span class="name">debug</span>        =
<span class="default_value">False</span>

        
    </div>
    <a class="headerlink" href="#debug"></a>
    
    

                </section>
                <section id="RDFaError">
                            <input id="RDFaError-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">RDFaError</span><wbr>(<span class="base">builtins.Exception</span>):

                <label class="view-source-button" for="RDFaError-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RDFaError"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RDFaError-206"><a href="#RDFaError-206"><span class="linenos">206</span></a><span class="k">class</span> <span class="nc">RDFaError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="RDFaError-207"><a href="#RDFaError-207"><span class="linenos">207</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Superclass exceptions representing error conditions defined by the RDFa 1.1 specification.</span>
</span><span id="RDFaError-208"><a href="#RDFaError-208"><span class="linenos">208</span></a><span class="sd">    It does not add any new functionality to the</span>
</span><span id="RDFaError-209"><a href="#RDFaError-209"><span class="linenos">209</span></a><span class="sd">    Exception class.&quot;&quot;&quot;</span>
</span><span id="RDFaError-210"><a href="#RDFaError-210"><span class="linenos">210</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
</span><span id="RDFaError-211"><a href="#RDFaError-211"><span class="linenos">211</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>
</span><span id="RDFaError-212"><a href="#RDFaError-212"><span class="linenos">212</span></a>        <span class="ne">Exception</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Superclass exceptions representing error conditions defined by the RDFa 1.1 specification.
It does not add any new functionality to the
Exception class.</p>
</div>


                            <div id="RDFaError.__init__" class="classattr">
                                        <input id="RDFaError.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">RDFaError</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">msg</span></span>)</span>

                <label class="view-source-button" for="RDFaError.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RDFaError.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RDFaError.__init__-210"><a href="#RDFaError.__init__-210"><span class="linenos">210</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
</span><span id="RDFaError.__init__-211"><a href="#RDFaError.__init__-211"><span class="linenos">211</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>
</span><span id="RDFaError.__init__-212"><a href="#RDFaError.__init__-212"><span class="linenos">212</span></a>        <span class="ne">Exception</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="RDFaError.msg" class="classattr">
                                <div class="attr variable">
            <span class="name">msg</span>

        
    </div>
    <a class="headerlink" href="#RDFaError.msg"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.BaseException</dt>
                                <dd id="RDFaError.with_traceback" class="function">with_traceback</dd>
                <dd id="RDFaError.args" class="variable">args</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="FailedSource">
                            <input id="FailedSource-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">FailedSource</span><wbr>(<span class="base"><a href="#RDFaError">RDFaError</a></span>):

                <label class="view-source-button" for="FailedSource-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FailedSource"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FailedSource-214"><a href="#FailedSource-214"><span class="linenos">214</span></a><span class="k">class</span> <span class="nc">FailedSource</span><span class="p">(</span><span class="n">RDFaError</span><span class="p">):</span>
</span><span id="FailedSource-215"><a href="#FailedSource-215"><span class="linenos">215</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when the original source cannot be accessed. It does not add any new functionality to the</span>
</span><span id="FailedSource-216"><a href="#FailedSource-216"><span class="linenos">216</span></a><span class="sd">    Exception class.&quot;&quot;&quot;</span>
</span><span id="FailedSource-217"><a href="#FailedSource-217"><span class="linenos">217</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">http_code</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="FailedSource-218"><a href="#FailedSource-218"><span class="linenos">218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>
</span><span id="FailedSource-219"><a href="#FailedSource-219"><span class="linenos">219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">http_code</span> <span class="o">=</span> <span class="n">http_code</span>
</span><span id="FailedSource-220"><a href="#FailedSource-220"><span class="linenos">220</span></a>        <span class="n">RDFaError</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Raised when the original source cannot be accessed. It does not add any new functionality to the
Exception class.</p>
</div>


                            <div id="FailedSource.__init__" class="classattr">
                                        <input id="FailedSource.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">FailedSource</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">msg</span>, </span><span class="param"><span class="n">http_code</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="FailedSource.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FailedSource.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FailedSource.__init__-217"><a href="#FailedSource.__init__-217"><span class="linenos">217</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">http_code</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="FailedSource.__init__-218"><a href="#FailedSource.__init__-218"><span class="linenos">218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>
</span><span id="FailedSource.__init__-219"><a href="#FailedSource.__init__-219"><span class="linenos">219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">http_code</span> <span class="o">=</span> <span class="n">http_code</span>
</span><span id="FailedSource.__init__-220"><a href="#FailedSource.__init__-220"><span class="linenos">220</span></a>        <span class="n">RDFaError</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="FailedSource.msg" class="classattr">
                                <div class="attr variable">
            <span class="name">msg</span>

        
    </div>
    <a class="headerlink" href="#FailedSource.msg"></a>
    
    

                            </div>
                            <div id="FailedSource.http_code" class="classattr">
                                <div class="attr variable">
            <span class="name">http_code</span>

        
    </div>
    <a class="headerlink" href="#FailedSource.http_code"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.BaseException</dt>
                                <dd id="FailedSource.with_traceback" class="function">with_traceback</dd>
                <dd id="FailedSource.args" class="variable">args</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="HTTPError">
                            <input id="HTTPError-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">HTTPError</span><wbr>(<span class="base"><a href="#RDFaError">RDFaError</a></span>):

                <label class="view-source-button" for="HTTPError-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HTTPError"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HTTPError-222"><a href="#HTTPError-222"><span class="linenos">222</span></a><span class="k">class</span> <span class="nc">HTTPError</span><span class="p">(</span><span class="n">RDFaError</span><span class="p">):</span>
</span><span id="HTTPError-223"><a href="#HTTPError-223"><span class="linenos">223</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when HTTP problems are detected. It does not add any new functionality to the</span>
</span><span id="HTTPError-224"><a href="#HTTPError-224"><span class="linenos">224</span></a><span class="sd">    Exception class.&quot;&quot;&quot;</span>
</span><span id="HTTPError-225"><a href="#HTTPError-225"><span class="linenos">225</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">http_msg</span><span class="p">,</span> <span class="n">http_code</span><span class="p">):</span>
</span><span id="HTTPError-226"><a href="#HTTPError-226"><span class="linenos">226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">http_msg</span>
</span><span id="HTTPError-227"><a href="#HTTPError-227"><span class="linenos">227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">http_code</span> <span class="o">=</span> <span class="n">http_code</span>
</span><span id="HTTPError-228"><a href="#HTTPError-228"><span class="linenos">228</span></a>        <span class="n">RDFaError</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">http_msg</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Raised when HTTP problems are detected. It does not add any new functionality to the
Exception class.</p>
</div>


                            <div id="HTTPError.__init__" class="classattr">
                                        <input id="HTTPError.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">HTTPError</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">http_msg</span>, </span><span class="param"><span class="n">http_code</span></span>)</span>

                <label class="view-source-button" for="HTTPError.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HTTPError.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HTTPError.__init__-225"><a href="#HTTPError.__init__-225"><span class="linenos">225</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">http_msg</span><span class="p">,</span> <span class="n">http_code</span><span class="p">):</span>
</span><span id="HTTPError.__init__-226"><a href="#HTTPError.__init__-226"><span class="linenos">226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">http_msg</span>
</span><span id="HTTPError.__init__-227"><a href="#HTTPError.__init__-227"><span class="linenos">227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">http_code</span> <span class="o">=</span> <span class="n">http_code</span>
</span><span id="HTTPError.__init__-228"><a href="#HTTPError.__init__-228"><span class="linenos">228</span></a>        <span class="n">RDFaError</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">http_msg</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="HTTPError.msg" class="classattr">
                                <div class="attr variable">
            <span class="name">msg</span>

        
    </div>
    <a class="headerlink" href="#HTTPError.msg"></a>
    
    

                            </div>
                            <div id="HTTPError.http_code" class="classattr">
                                <div class="attr variable">
            <span class="name">http_code</span>

        
    </div>
    <a class="headerlink" href="#HTTPError.http_code"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.BaseException</dt>
                                <dd id="HTTPError.with_traceback" class="function">with_traceback</dd>
                <dd id="HTTPError.args" class="variable">args</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ProcessingError">
                            <input id="ProcessingError-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ProcessingError</span><wbr>(<span class="base"><a href="#RDFaError">RDFaError</a></span>):

                <label class="view-source-button" for="ProcessingError-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ProcessingError"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ProcessingError-230"><a href="#ProcessingError-230"><span class="linenos">230</span></a><span class="k">class</span> <span class="nc">ProcessingError</span><span class="p">(</span><span class="n">RDFaError</span><span class="p">):</span>
</span><span id="ProcessingError-231"><a href="#ProcessingError-231"><span class="linenos">231</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Error found during processing. It does not add any new functionality to the</span>
</span><span id="ProcessingError-232"><a href="#ProcessingError-232"><span class="linenos">232</span></a><span class="sd">    Exception class.&quot;&quot;&quot;</span>
</span><span id="ProcessingError-233"><a href="#ProcessingError-233"><span class="linenos">233</span></a>    <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Error found during processing. It does not add any new functionality to the
Exception class.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#RDFaError">RDFaError</a></dt>
                                <dd id="ProcessingError.__init__" class="function"><a href="#RDFaError.__init__">RDFaError</a></dd>
                <dd id="ProcessingError.msg" class="variable"><a href="#RDFaError.msg">msg</a></dd>

            </div>
            <div><dt>builtins.BaseException</dt>
                                <dd id="ProcessingError.with_traceback" class="function">with_traceback</dd>
                <dd id="ProcessingError.args" class="variable">args</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="pyRdfaError">
                            <input id="pyRdfaError-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">pyRdfaError</span><wbr>(<span class="base">builtins.Exception</span>):

                <label class="view-source-button" for="pyRdfaError-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#pyRdfaError"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="pyRdfaError-235"><a href="#pyRdfaError-235"><span class="linenos">235</span></a><span class="k">class</span> <span class="nc">pyRdfaError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="pyRdfaError-236"><a href="#pyRdfaError-236"><span class="linenos">236</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Superclass exceptions representing error conditions outside the RDFa 1.1 specification.&quot;&quot;&quot;</span>
</span><span id="pyRdfaError-237"><a href="#pyRdfaError-237"><span class="linenos">237</span></a>    <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Superclass exceptions representing error conditions outside the RDFa 1.1 specification.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.Exception</dt>
                                <dd id="pyRdfaError.__init__" class="function">Exception</dd>

            </div>
            <div><dt>builtins.BaseException</dt>
                                <dd id="pyRdfaError.with_traceback" class="function">with_traceback</dd>
                <dd id="pyRdfaError.args" class="variable">args</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="RDFA_Error">
                    <div class="attr variable">
            <span class="name">RDFA_Error</span>        =
<span class="default_value">rdflib.term.URIRef(&#39;http://www.w3.org/ns/rdfa#Error&#39;)</span>

        
    </div>
    <a class="headerlink" href="#RDFA_Error"></a>
    
    

                </section>
                <section id="RDFA_Warning">
                    <div class="attr variable">
            <span class="name">RDFA_Warning</span>        =
<span class="default_value">rdflib.term.URIRef(&#39;http://www.w3.org/ns/rdfa#Warning&#39;)</span>

        
    </div>
    <a class="headerlink" href="#RDFA_Warning"></a>
    
    

                </section>
                <section id="RDFA_Info">
                    <div class="attr variable">
            <span class="name">RDFA_Info</span>        =
<span class="default_value">rdflib.term.URIRef(&#39;http://www.w3.org/ns/rdfa#Information&#39;)</span>

        
    </div>
    <a class="headerlink" href="#RDFA_Info"></a>
    
    

                </section>
                <section id="NonConformantMarkup">
                    <div class="attr variable">
            <span class="name">NonConformantMarkup</span>        =
<span class="default_value">rdflib.term.URIRef(&#39;http://www.w3.org/ns/rdfa#DocumentError&#39;)</span>

        
    </div>
    <a class="headerlink" href="#NonConformantMarkup"></a>
    
    

                </section>
                <section id="UnresolvablePrefix">
                    <div class="attr variable">
            <span class="name">UnresolvablePrefix</span>        =
<span class="default_value">rdflib.term.URIRef(&#39;http://www.w3.org/ns/rdfa#UnresolvedCURIE&#39;)</span>

        
    </div>
    <a class="headerlink" href="#UnresolvablePrefix"></a>
    
    

                </section>
                <section id="UnresolvableReference">
                    <div class="attr variable">
            <span class="name">UnresolvableReference</span>        =
<span class="default_value">rdflib.term.URIRef(&#39;http://www.w3.org/ns/rdfa#UnresolvedCURIE&#39;)</span>

        
    </div>
    <a class="headerlink" href="#UnresolvableReference"></a>
    
    

                </section>
                <section id="UnresolvableTerm">
                    <div class="attr variable">
            <span class="name">UnresolvableTerm</span>        =
<span class="default_value">rdflib.term.URIRef(&#39;http://www.w3.org/ns/rdfa#UnresolvedTerm&#39;)</span>

        
    </div>
    <a class="headerlink" href="#UnresolvableTerm"></a>
    
    

                </section>
                <section id="VocabReferenceError">
                    <div class="attr variable">
            <span class="name">VocabReferenceError</span>        =
<span class="default_value">rdflib.term.URIRef(&#39;http://www.w3.org/ns/rdfa#VocabReferenceError&#39;)</span>

        
    </div>
    <a class="headerlink" href="#VocabReferenceError"></a>
    
    

                </section>
                <section id="PrefixRedefinitionWarning">
                    <div class="attr variable">
            <span class="name">PrefixRedefinitionWarning</span>        =
<span class="default_value">rdflib.term.URIRef(&#39;http://www.w3.org/ns/rdfa#PrefixRedefinition&#39;)</span>

        
    </div>
    <a class="headerlink" href="#PrefixRedefinitionWarning"></a>
    
    

                </section>
                <section id="FileReferenceError">
                    <div class="attr variable">
            <span class="name">FileReferenceError</span>        =
<span class="default_value">rdflib.term.URIRef(&#39;http://www.w3.org/2007/08/pyRdfa/vocab#FileReferenceError&#39;)</span>

        
    </div>
    <a class="headerlink" href="#FileReferenceError"></a>
    
    

                </section>
                <section id="HTError">
                    <div class="attr variable">
            <span class="name">HTError</span>        =
<span class="default_value">rdflib.term.URIRef(&#39;http://www.w3.org/2007/08/pyRdfa/vocab#HTTPError&#39;)</span>

        
    </div>
    <a class="headerlink" href="#HTError"></a>
    
    

                </section>
                <section id="IncorrectPrefixDefinition">
                    <div class="attr variable">
            <span class="name">IncorrectPrefixDefinition</span>        =
<span class="default_value">rdflib.term.URIRef(&#39;http://www.w3.org/2007/08/pyRdfa/vocab#IncorrectPrefixDefinition&#39;)</span>

        
    </div>
    <a class="headerlink" href="#IncorrectPrefixDefinition"></a>
    
    

                </section>
                <section id="IncorrectBlankNodeUsage">
                    <div class="attr variable">
            <span class="name">IncorrectBlankNodeUsage</span>        =
<span class="default_value">rdflib.term.URIRef(&#39;http://www.w3.org/2007/08/pyRdfa/vocab#IncorrectBlankNodeUsage&#39;)</span>

        
    </div>
    <a class="headerlink" href="#IncorrectBlankNodeUsage"></a>
    
    

                </section>
                <section id="IncorrectLiteral">
                    <div class="attr variable">
            <span class="name">IncorrectLiteral</span>        =
<span class="default_value">rdflib.term.URIRef(&#39;http://www.w3.org/2007/08/pyRdfa/vocab#IncorrectLiteral&#39;)</span>

        
    </div>
    <a class="headerlink" href="#IncorrectLiteral"></a>
    
    

                </section>
                <section id="err_no_blank_node">
                    <div class="attr variable">
            <span class="name">err_no_blank_node</span>        =
<span class="default_value">&#39;Blank node in %s position is not allowed; ignored&#39;</span>

        
    </div>
    <a class="headerlink" href="#err_no_blank_node"></a>
    
    

                </section>
                <section id="err_redefining_URI_as_prefix">
                    <div class="attr variable">
            <span class="name">err_redefining_URI_as_prefix</span>        =
<input id="err_redefining_URI_as_prefix-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="err_redefining_URI_as_prefix-view-value"></label><span class="default_value">&#34;&#39;%s&#39; a registered or an otherwise used URI scheme, but is defined as a prefix here; is this a mistake? (see, eg, http://en.wikipedia.org/wiki/URI_scheme or http://www.iana.org/assignments/uri-schemes.html for further information for most of the URI schemes)&#34;</span>

        
    </div>
    <a class="headerlink" href="#err_redefining_URI_as_prefix"></a>
    
    

                </section>
                <section id="err_xmlns_deprecated">
                    <div class="attr variable">
            <span class="name">err_xmlns_deprecated</span>        =
<input id="err_xmlns_deprecated-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="err_xmlns_deprecated-view-value"></label><span class="default_value">&#34;The usage of &#39;xmlns&#39; for prefix definition is deprecated; please use the &#39;prefix&#39; attribute instead (definition for &#39;%s&#39;)&#34;</span>

        
    </div>
    <a class="headerlink" href="#err_xmlns_deprecated"></a>
    
    

                </section>
                <section id="err_bnode_local_prefix">
                    <div class="attr variable">
            <span class="name">err_bnode_local_prefix</span>        =
<span class="default_value">&#34;The &#39;_&#39; local CURIE prefix is reserved for blank nodes, and cannot be defined as a prefix&#34;</span>

        
    </div>
    <a class="headerlink" href="#err_bnode_local_prefix"></a>
    
    

                </section>
                <section id="err_col_local_prefix">
                    <div class="attr variable">
            <span class="name">err_col_local_prefix</span>        =
<input id="err_col_local_prefix-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="err_col_local_prefix-view-value"></label><span class="default_value">&#34;The character &#39;:&#39; is not valid in a CURIE Prefix, and cannot be used in a prefix definition (definition for &#39;%s&#39;)&#34;</span>

        
    </div>
    <a class="headerlink" href="#err_col_local_prefix"></a>
    
    

                </section>
                <section id="err_missing_URI_prefix">
                    <div class="attr variable">
            <span class="name">err_missing_URI_prefix</span>        =
<span class="default_value">&#34;Missing URI in prefix declaration for &#39;%s&#39; (in &#39;%s&#39;)&#34;</span>

        
    </div>
    <a class="headerlink" href="#err_missing_URI_prefix"></a>
    
    

                </section>
                <section id="err_invalid_prefix">
                    <div class="attr variable">
            <span class="name">err_invalid_prefix</span>        =
<span class="default_value">&#34;Invalid prefix declaration &#39;%s&#39; (in &#39;%s&#39;)&#34;</span>

        
    </div>
    <a class="headerlink" href="#err_invalid_prefix"></a>
    
    

                </section>
                <section id="err_no_default_prefix">
                    <div class="attr variable">
            <span class="name">err_no_default_prefix</span>        =
<span class="default_value">&#34;Default prefix cannot be changed (in &#39;%s&#39;)&#34;</span>

        
    </div>
    <a class="headerlink" href="#err_no_default_prefix"></a>
    
    

                </section>
                <section id="err_prefix_and_xmlns">
                    <div class="attr variable">
            <span class="name">err_prefix_and_xmlns</span>        =
<input id="err_prefix_and_xmlns-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="err_prefix_and_xmlns-view-value"></label><span class="default_value">&#34;@prefix setting for &#39;%s&#39; overrides the &#39;xmlns:%s&#39; setting; may be a source of problem if same file is run through RDFa 1.0&#34;</span>

        
    </div>
    <a class="headerlink" href="#err_prefix_and_xmlns"></a>
    
    

                </section>
                <section id="err_non_ncname_prefix">
                    <div class="attr variable">
            <span class="name">err_non_ncname_prefix</span>        =
<span class="default_value">&#34;Non NCNAME &#39;%s&#39; in prefix definition (in &#39;%s&#39;); ignored&#34;</span>

        
    </div>
    <a class="headerlink" href="#err_non_ncname_prefix"></a>
    
    

                </section>
                <section id="err_absolute_reference">
                    <div class="attr variable">
            <span class="name">err_absolute_reference</span>        =
<span class="default_value">&#34;CURIE Reference part contains an authority part: %s (in &#39;%s&#39;); ignored&#34;</span>

        
    </div>
    <a class="headerlink" href="#err_absolute_reference"></a>
    
    

                </section>
                <section id="err_query_reference">
                    <div class="attr variable">
            <span class="name">err_query_reference</span>        =
<span class="default_value">&#34;CURIE Reference query part contains an unauthorized character: %s (in &#39;%s&#39;); ignored&#34;</span>

        
    </div>
    <a class="headerlink" href="#err_query_reference"></a>
    
    

                </section>
                <section id="err_fragment_reference">
                    <div class="attr variable">
            <span class="name">err_fragment_reference</span>        =
<span class="default_value">&#34;CURIE Reference fragment part contains an unauthorized character: %s (in &#39;%s&#39;); ignored&#34;</span>

        
    </div>
    <a class="headerlink" href="#err_fragment_reference"></a>
    
    

                </section>
                <section id="err_lang">
                    <div class="attr variable">
            <span class="name">err_lang</span>        =
<input id="err_lang-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="err_lang-view-value"></label><span class="default_value">&#39;There is a problem with language setting; either both xml:lang and lang used on an element with different values, or, for (X)HTML5, only xml:lang is used.&#39;</span>

        
    </div>
    <a class="headerlink" href="#err_lang"></a>
    
    

                </section>
                <section id="err_URI_scheme">
                    <div class="attr variable">
            <span class="name">err_URI_scheme</span>        =
<input id="err_URI_scheme-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="err_URI_scheme-view-value"></label><span class="default_value">&#39;Unusual URI scheme used in &lt;%s&gt;; may that be a mistake, e.g., resulting from using an undefined CURIE prefix or an incorrect CURIE?&#39;</span>

        
    </div>
    <a class="headerlink" href="#err_URI_scheme"></a>
    
    

                </section>
                <section id="err_illegal_safe_CURIE">
                    <div class="attr variable">
            <span class="name">err_illegal_safe_CURIE</span>        =
<span class="default_value">&#39;Illegal safe CURIE: %s; ignored&#39;</span>

        
    </div>
    <a class="headerlink" href="#err_illegal_safe_CURIE"></a>
    
    

                </section>
                <section id="err_no_CURIE_in_safe_CURIE">
                    <div class="attr variable">
            <span class="name">err_no_CURIE_in_safe_CURIE</span>        =
<span class="default_value">&#39;Safe CURIE is used, but the value does not correspond to a defined CURIE: [%s]; ignored&#39;</span>

        
    </div>
    <a class="headerlink" href="#err_no_CURIE_in_safe_CURIE"></a>
    
    

                </section>
                <section id="err_undefined_terms">
                    <div class="attr variable">
            <span class="name">err_undefined_terms</span>        =
<span class="default_value">&#34;&#39;%s&#39; is used as a term, but has not been defined as such; ignored&#34;</span>

        
    </div>
    <a class="headerlink" href="#err_undefined_terms"></a>
    
    

                </section>
                <section id="err_non_legal_CURIE_ref">
                    <div class="attr variable">
            <span class="name">err_non_legal_CURIE_ref</span>        =
<span class="default_value">&#34;Relative URI is not allowed in this position (or not a legal CURIE reference) &#39;%s&#39;; ignored&#34;</span>

        
    </div>
    <a class="headerlink" href="#err_non_legal_CURIE_ref"></a>
    
    

                </section>
                <section id="err_undefined_CURIE">
                    <div class="attr variable">
            <span class="name">err_undefined_CURIE</span>        =
<span class="default_value">&#34;Undefined CURIE: &#39;%s&#39;; ignored&#34;</span>

        
    </div>
    <a class="headerlink" href="#err_undefined_CURIE"></a>
    
    

                </section>
                <section id="err_prefix_redefinition">
                    <div class="attr variable">
            <span class="name">err_prefix_redefinition</span>        =
<span class="default_value">&#34;Prefix &#39;%s&#39; (defined in the initial RDFa context or in an ancestor) is redefined&#34;</span>

        
    </div>
    <a class="headerlink" href="#err_prefix_redefinition"></a>
    
    

                </section>
                <section id="err_unusual_char_in_URI">
                    <div class="attr variable">
            <span class="name">err_unusual_char_in_URI</span>        =
<span class="default_value">&#39;Unusual character in uri: %s; possible error?&#39;</span>

        
    </div>
    <a class="headerlink" href="#err_unusual_char_in_URI"></a>
    
    

                </section>
                <section id="CACHE_DIR_VAR">
                    <div class="attr variable">
            <span class="name">CACHE_DIR_VAR</span>        =
<span class="default_value">&#39;PyRdfaCacheDir&#39;</span>

        
    </div>
    <a class="headerlink" href="#CACHE_DIR_VAR"></a>
    
    

                </section>
                <section id="rdfa_current_version">
                    <div class="attr variable">
            <span class="name">rdfa_current_version</span>        =
<span class="default_value">&#39;1.1&#39;</span>

        
    </div>
    <a class="headerlink" href="#rdfa_current_version"></a>
    
    

                </section>
                <section id="registered_iana_schemes">
                    <div class="attr variable">
            <span class="name">registered_iana_schemes</span>        =
<input id="registered_iana_schemes-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="registered_iana_schemes-view-value"></label><span class="default_value">[&#39;aaa&#39;, &#39;aaas&#39;, &#39;acap&#39;, &#39;cap&#39;, &#39;cid&#39;, &#39;crid&#39;, &#39;data&#39;, &#39;dav&#39;, &#39;dict&#39;, &#39;did&#39;, &#39;dns&#39;, &#39;fax&#39;, &#39;file&#39;, &#39;ftp&#39;, &#39;geo&#39;, &#39;go&#39;, &#39;gopher&#39;, &#39;h323&#39;, &#39;http&#39;, &#39;https&#39;, &#39;iax&#39;, &#39;icap&#39;, &#39;im&#39;, &#39;imap&#39;, &#39;info&#39;, &#39;ipp&#39;, &#39;iris&#39;, &#39;ldap&#39;, &#39;lsid&#39;, &#39;mailto&#39;, &#39;mid&#39;, &#39;modem&#39;, &#39;msrp&#39;, &#39;msrps&#39;, &#39;mtqp&#39;, &#39;mupdate&#39;, &#39;news&#39;, &#39;nfs&#39;, &#39;nntp&#39;, &#39;opaquelocktoken&#39;, &#39;pop&#39;, &#39;pres&#39;, &#39;prospero&#39;, &#39;rstp&#39;, &#39;rsync&#39;, &#39;service&#39;, &#39;shttp&#39;, &#39;sieve&#39;, &#39;sip&#39;, &#39;sips&#39;, &#39;sms&#39;, &#39;snmp&#39;, &#39;soap&#39;, &#39;tag&#39;, &#39;tel&#39;, &#39;telnet&#39;, &#39;tftp&#39;, &#39;thismessage&#39;, &#39;tn3270&#39;, &#39;tip&#39;, &#39;tv&#39;, &#39;urn&#39;, &#39;vemmi&#39;, &#39;wais&#39;, &#39;ws&#39;, &#39;wss&#39;, &#39;xmpp&#39;]</span>

        
    </div>
    <a class="headerlink" href="#registered_iana_schemes"></a>
    
    

                </section>
                <section id="unofficial_common">
                    <div class="attr variable">
            <span class="name">unofficial_common</span>        =
<input id="unofficial_common-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="unofficial_common-view-value"></label><span class="default_value">[&#39;about&#39;, &#39;adiumxtra&#39;, &#39;aim&#39;, &#39;apt&#39;, &#39;afp&#39;, &#39;aw&#39;, &#39;bitcoin&#39;, &#39;bolo&#39;, &#39;callto&#39;, &#39;chrome&#39;, &#39;coap&#39;, &#39;content&#39;, &#39;cvs&#39;, &#39;doi&#39;, &#39;ed2k&#39;, &#39;facetime&#39;, &#39;feed&#39;, &#39;finger&#39;, &#39;fish&#39;, &#39;git&#39;, &#39;gg&#39;, &#39;gizmoproject&#39;, &#39;gtalk&#39;, &#39;irc&#39;, &#39;ircs&#39;, &#39;irc6&#39;, &#39;itms&#39;, &#39;jar&#39;, &#39;javascript&#39;, &#39;keyparc&#39;, &#39;lastfm&#39;, &#39;ldaps&#39;, &#39;magnet&#39;, &#39;maps&#39;, &#39;market&#39;, &#39;message&#39;, &#39;mms&#39;, &#39;msnim&#39;, &#39;mumble&#39;, &#39;mvn&#39;, &#39;notes&#39;, &#39;palm&#39;, &#39;paparazzi&#39;, &#39;psync&#39;, &#39;rmi&#39;, &#39;secondlife&#39;, &#39;sgn&#39;, &#39;skype&#39;, &#39;spotify&#39;, &#39;ssh&#39;, &#39;sftp&#39;, &#39;smb&#39;, &#39;soldat&#39;, &#39;steam&#39;, &#39;svn&#39;, &#39;teamspeak&#39;, &#39;things&#39;, &#39;udb&#39;, &#39;unreal&#39;, &#39;ut2004&#39;, &#39;ventrillo&#39;, &#39;view-source&#39;, &#39;webcal&#39;, &#39;wtai&#39;, &#39;wyciwyg&#39;, &#39;xfire&#39;, &#39;xri&#39;, &#39;ymsgr&#39;]</span>

        
    </div>
    <a class="headerlink" href="#unofficial_common"></a>
    
    

                </section>
                <section id="historical_iana_schemes">
                    <div class="attr variable">
            <span class="name">historical_iana_schemes</span>        =
<span class="default_value">[&#39;fax&#39;, &#39;mailserver&#39;, &#39;modem&#39;, &#39;pack&#39;, &#39;prospero&#39;, &#39;snews&#39;, &#39;videotex&#39;, &#39;wais&#39;]</span>

        
    </div>
    <a class="headerlink" href="#historical_iana_schemes"></a>
    
    

                </section>
                <section id="provisional_iana_schemes">
                    <div class="attr variable">
            <span class="name">provisional_iana_schemes</span>        =
<span class="default_value">[&#39;afs&#39;, &#39;dtn&#39;, &#39;dvb&#39;, &#39;icon&#39;, &#39;ipn&#39;, &#39;jms&#39;, &#39;oid&#39;, &#39;rsync&#39;, &#39;ni&#39;]</span>

        
    </div>
    <a class="headerlink" href="#provisional_iana_schemes"></a>
    
    

                </section>
                <section id="other_used_schemes">
                    <div class="attr variable">
            <span class="name">other_used_schemes</span>        =
<span class="default_value">[&#39;hdl&#39;, &#39;isbn&#39;, &#39;issn&#39;, &#39;mstp&#39;, &#39;rtmp&#39;, &#39;rtspu&#39;, &#39;stp&#39;]</span>

        
    </div>
    <a class="headerlink" href="#other_used_schemes"></a>
    
    

                </section>
                <section id="uri_schemes">
                    <div class="attr variable">
            <span class="name">uri_schemes</span>        =
<input id="uri_schemes-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="uri_schemes-view-value"></label><span class="default_value">[&#39;aaa&#39;, &#39;aaas&#39;, &#39;acap&#39;, &#39;cap&#39;, &#39;cid&#39;, &#39;crid&#39;, &#39;data&#39;, &#39;dav&#39;, &#39;dict&#39;, &#39;did&#39;, &#39;dns&#39;, &#39;fax&#39;, &#39;file&#39;, &#39;ftp&#39;, &#39;geo&#39;, &#39;go&#39;, &#39;gopher&#39;, &#39;h323&#39;, &#39;http&#39;, &#39;https&#39;, &#39;iax&#39;, &#39;icap&#39;, &#39;im&#39;, &#39;imap&#39;, &#39;info&#39;, &#39;ipp&#39;, &#39;iris&#39;, &#39;ldap&#39;, &#39;lsid&#39;, &#39;mailto&#39;, &#39;mid&#39;, &#39;modem&#39;, &#39;msrp&#39;, &#39;msrps&#39;, &#39;mtqp&#39;, &#39;mupdate&#39;, &#39;news&#39;, &#39;nfs&#39;, &#39;nntp&#39;, &#39;opaquelocktoken&#39;, &#39;pop&#39;, &#39;pres&#39;, &#39;prospero&#39;, &#39;rstp&#39;, &#39;rsync&#39;, &#39;service&#39;, &#39;shttp&#39;, &#39;sieve&#39;, &#39;sip&#39;, &#39;sips&#39;, &#39;sms&#39;, &#39;snmp&#39;, &#39;soap&#39;, &#39;tag&#39;, &#39;tel&#39;, &#39;telnet&#39;, &#39;tftp&#39;, &#39;thismessage&#39;, &#39;tn3270&#39;, &#39;tip&#39;, &#39;tv&#39;, &#39;urn&#39;, &#39;vemmi&#39;, &#39;wais&#39;, &#39;ws&#39;, &#39;wss&#39;, &#39;xmpp&#39;, &#39;about&#39;, &#39;adiumxtra&#39;, &#39;aim&#39;, &#39;apt&#39;, &#39;afp&#39;, &#39;aw&#39;, &#39;bitcoin&#39;, &#39;bolo&#39;, &#39;callto&#39;, &#39;chrome&#39;, &#39;coap&#39;, &#39;content&#39;, &#39;cvs&#39;, &#39;doi&#39;, &#39;ed2k&#39;, &#39;facetime&#39;, &#39;feed&#39;, &#39;finger&#39;, &#39;fish&#39;, &#39;git&#39;, &#39;gg&#39;, &#39;gizmoproject&#39;, &#39;gtalk&#39;, &#39;irc&#39;, &#39;ircs&#39;, &#39;irc6&#39;, &#39;itms&#39;, &#39;jar&#39;, &#39;javascript&#39;, &#39;keyparc&#39;, &#39;lastfm&#39;, &#39;ldaps&#39;, &#39;magnet&#39;, &#39;maps&#39;, &#39;market&#39;, &#39;message&#39;, &#39;mms&#39;, &#39;msnim&#39;, &#39;mumble&#39;, &#39;mvn&#39;, &#39;notes&#39;, &#39;palm&#39;, &#39;paparazzi&#39;, &#39;psync&#39;, &#39;rmi&#39;, &#39;secondlife&#39;, &#39;sgn&#39;, &#39;skype&#39;, &#39;spotify&#39;, &#39;ssh&#39;, &#39;sftp&#39;, &#39;smb&#39;, &#39;soldat&#39;, &#39;steam&#39;, &#39;svn&#39;, &#39;teamspeak&#39;, &#39;things&#39;, &#39;udb&#39;, &#39;unreal&#39;, &#39;ut2004&#39;, &#39;ventrillo&#39;, &#39;view-source&#39;, &#39;webcal&#39;, &#39;wtai&#39;, &#39;wyciwyg&#39;, &#39;xfire&#39;, &#39;xri&#39;, &#39;ymsgr&#39;, &#39;fax&#39;, &#39;mailserver&#39;, &#39;modem&#39;, &#39;pack&#39;, &#39;prospero&#39;, &#39;snews&#39;, &#39;videotex&#39;, &#39;wais&#39;, &#39;afs&#39;, &#39;dtn&#39;, &#39;dvb&#39;, &#39;icon&#39;, &#39;ipn&#39;, &#39;jms&#39;, &#39;oid&#39;, &#39;rsync&#39;, &#39;ni&#39;, &#39;hdl&#39;, &#39;isbn&#39;, &#39;issn&#39;, &#39;mstp&#39;, &#39;rtmp&#39;, &#39;rtspu&#39;, &#39;stp&#39;]</span>

        
    </div>
    <a class="headerlink" href="#uri_schemes"></a>
    
    

                </section>
                <section id="builtInTransformers">
                    <div class="attr variable">
            <span class="name">builtInTransformers</span>        =
<span class="default_value">[&lt;function empty_safe_curie&gt;, &lt;function top_about&gt;, &lt;function vocab_for_role&gt;]</span>

        
    </div>
    <a class="headerlink" href="#builtInTransformers"></a>
    
    

                </section>
                <section id="pyRdfa">
                            <input id="pyRdfa-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">pyRdfa</span>:

                <label class="view-source-button" for="pyRdfa-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#pyRdfa"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="pyRdfa-344"><a href="#pyRdfa-344"><span class="linenos">344</span></a><span class="k">class</span> <span class="nc">pyRdfa</span><span class="p">:</span>
</span><span id="pyRdfa-345"><a href="#pyRdfa-345"><span class="linenos">345</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Main processing class for the distiller</span>
</span><span id="pyRdfa-346"><a href="#pyRdfa-346"><span class="linenos">346</span></a>
</span><span id="pyRdfa-347"><a href="#pyRdfa-347"><span class="linenos">347</span></a><span class="sd">    @ivar options: an instance of the L{Options} class</span>
</span><span id="pyRdfa-348"><a href="#pyRdfa-348"><span class="linenos">348</span></a><span class="sd">    @ivar media_type: the preferred default media type, possibly set at initialization</span>
</span><span id="pyRdfa-349"><a href="#pyRdfa-349"><span class="linenos">349</span></a><span class="sd">    @ivar base: the base value, possibly set at initialization</span>
</span><span id="pyRdfa-350"><a href="#pyRdfa-350"><span class="linenos">350</span></a><span class="sd">    @ivar http_status: HTTP Status, to be returned when the package is used via a CGI entry. Initially set to 200, may be modified by exception handlers</span>
</span><span id="pyRdfa-351"><a href="#pyRdfa-351"><span class="linenos">351</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="pyRdfa-352"><a href="#pyRdfa-352"><span class="linenos">352</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">media_type</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">rdfa_version</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="pyRdfa-353"><a href="#pyRdfa-353"><span class="linenos">353</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="pyRdfa-354"><a href="#pyRdfa-354"><span class="linenos">354</span></a><span class="sd">        @keyword options: Options for the distiller</span>
</span><span id="pyRdfa-355"><a href="#pyRdfa-355"><span class="linenos">355</span></a><span class="sd">        @type options: L{Options}</span>
</span><span id="pyRdfa-356"><a href="#pyRdfa-356"><span class="linenos">356</span></a><span class="sd">        @keyword base: URI for the default &quot;base&quot; value (usually the URI of the file to be processed)</span>
</span><span id="pyRdfa-357"><a href="#pyRdfa-357"><span class="linenos">357</span></a><span class="sd">        @keyword media_type: explicit setting of the preferred media type (a.k.a. content type) of the the RDFa source</span>
</span><span id="pyRdfa-358"><a href="#pyRdfa-358"><span class="linenos">358</span></a><span class="sd">        @keyword rdfa_version: the RDFa version that should be used. If not set, the value of the global L{rdfa_current_version} variable is used</span>
</span><span id="pyRdfa-359"><a href="#pyRdfa-359"><span class="linenos">359</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="pyRdfa-360"><a href="#pyRdfa-360"><span class="linenos">360</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="mi">200</span>
</span><span id="pyRdfa-361"><a href="#pyRdfa-361"><span class="linenos">361</span></a>
</span><span id="pyRdfa-362"><a href="#pyRdfa-362"><span class="linenos">362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="n">base</span>
</span><span id="pyRdfa-363"><a href="#pyRdfa-363"><span class="linenos">363</span></a>        <span class="k">if</span> <span class="n">base</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="pyRdfa-364"><a href="#pyRdfa-364"><span class="linenos">364</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">required_base</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="pyRdfa-365"><a href="#pyRdfa-365"><span class="linenos">365</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa-366"><a href="#pyRdfa-366"><span class="linenos">366</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">required_base</span>    <span class="o">=</span> <span class="n">base</span>
</span><span id="pyRdfa-367"><a href="#pyRdfa-367"><span class="linenos">367</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">charset</span>         <span class="o">=</span> <span class="kc">None</span>
</span><span id="pyRdfa-368"><a href="#pyRdfa-368"><span class="linenos">368</span></a>
</span><span id="pyRdfa-369"><a href="#pyRdfa-369"><span class="linenos">369</span></a>        <span class="c1"># predefined content type</span>
</span><span id="pyRdfa-370"><a href="#pyRdfa-370"><span class="linenos">370</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">media_type</span> <span class="o">=</span> <span class="n">media_type</span>
</span><span id="pyRdfa-371"><a href="#pyRdfa-371"><span class="linenos">371</span></a>
</span><span id="pyRdfa-372"><a href="#pyRdfa-372"><span class="linenos">372</span></a>        <span class="k">if</span> <span class="n">options</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="pyRdfa-373"><a href="#pyRdfa-373"><span class="linenos">373</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
</span><span id="pyRdfa-374"><a href="#pyRdfa-374"><span class="linenos">374</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa-375"><a href="#pyRdfa-375"><span class="linenos">375</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
</span><span id="pyRdfa-376"><a href="#pyRdfa-376"><span class="linenos">376</span></a>
</span><span id="pyRdfa-377"><a href="#pyRdfa-377"><span class="linenos">377</span></a>        <span class="k">if</span> <span class="n">media_type</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="pyRdfa-378"><a href="#pyRdfa-378"><span class="linenos">378</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">set_host_language</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">media_type</span><span class="p">)</span>
</span><span id="pyRdfa-379"><a href="#pyRdfa-379"><span class="linenos">379</span></a>
</span><span id="pyRdfa-380"><a href="#pyRdfa-380"><span class="linenos">380</span></a>        <span class="k">if</span> <span class="n">rdfa_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="pyRdfa-381"><a href="#pyRdfa-381"><span class="linenos">381</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span> <span class="o">=</span> <span class="n">rdfa_version</span>
</span><span id="pyRdfa-382"><a href="#pyRdfa-382"><span class="linenos">382</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa-383"><a href="#pyRdfa-383"><span class="linenos">383</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="pyRdfa-384"><a href="#pyRdfa-384"><span class="linenos">384</span></a>
</span><span id="pyRdfa-385"><a href="#pyRdfa-385"><span class="linenos">385</span></a>    <span class="k">def</span> <span class="nf">_get_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="pyRdfa-386"><a href="#pyRdfa-386"><span class="linenos">386</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="pyRdfa-387"><a href="#pyRdfa-387"><span class="linenos">387</span></a><span class="sd">        Trying to guess whether &quot;name&quot; is a URI or a string (for a file); it then tries to open this source accordingly,</span>
</span><span id="pyRdfa-388"><a href="#pyRdfa-388"><span class="linenos">388</span></a><span class="sd">        returning a file-like object. If name is none of these, it returns the input argument (that should</span>
</span><span id="pyRdfa-389"><a href="#pyRdfa-389"><span class="linenos">389</span></a><span class="sd">        be, supposedly, a file-like object already).</span>
</span><span id="pyRdfa-390"><a href="#pyRdfa-390"><span class="linenos">390</span></a>
</span><span id="pyRdfa-391"><a href="#pyRdfa-391"><span class="linenos">391</span></a><span class="sd">        If the media type has not been set explicitly at initialization of this instance,</span>
</span><span id="pyRdfa-392"><a href="#pyRdfa-392"><span class="linenos">392</span></a><span class="sd">        the method also sets the media_type based on the HTTP GET response or the suffix of the file. See</span>
</span><span id="pyRdfa-393"><a href="#pyRdfa-393"><span class="linenos">393</span></a><span class="sd">        L{host.preferred_suffixes} for the suffix to media type mapping.</span>
</span><span id="pyRdfa-394"><a href="#pyRdfa-394"><span class="linenos">394</span></a>
</span><span id="pyRdfa-395"><a href="#pyRdfa-395"><span class="linenos">395</span></a><span class="sd">        @param name: identifier of the input source</span>
</span><span id="pyRdfa-396"><a href="#pyRdfa-396"><span class="linenos">396</span></a><span class="sd">        @type name: string or a file-like object</span>
</span><span id="pyRdfa-397"><a href="#pyRdfa-397"><span class="linenos">397</span></a><span class="sd">        @return: a file like object if opening &quot;name&quot; is possible and successful, &quot;name&quot; otherwise</span>
</span><span id="pyRdfa-398"><a href="#pyRdfa-398"><span class="linenos">398</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="pyRdfa-399"><a href="#pyRdfa-399"><span class="linenos">399</span></a>
</span><span id="pyRdfa-400"><a href="#pyRdfa-400"><span class="linenos">400</span></a>        <span class="n">isstring</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="pyRdfa-401"><a href="#pyRdfa-401"><span class="linenos">401</span></a>
</span><span id="pyRdfa-402"><a href="#pyRdfa-402"><span class="linenos">402</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="pyRdfa-403"><a href="#pyRdfa-403"><span class="linenos">403</span></a>            <span class="k">if</span> <span class="n">isstring</span><span class="p">:</span>
</span><span id="pyRdfa-404"><a href="#pyRdfa-404"><span class="linenos">404</span></a>                <span class="c1"># check if this is a URI, ie, if there is a valid &#39;scheme&#39; part</span>
</span><span id="pyRdfa-405"><a href="#pyRdfa-405"><span class="linenos">405</span></a>                <span class="c1"># otherwise it is considered to be a simple file</span>
</span><span id="pyRdfa-406"><a href="#pyRdfa-406"><span class="linenos">406</span></a>                <span class="k">if</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="pyRdfa-407"><a href="#pyRdfa-407"><span class="linenos">407</span></a>                    <span class="n">url_request</span>       <span class="o">=</span> <span class="n">URIOpener</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{},</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">certifi_verify</span><span class="p">)</span>
</span><span id="pyRdfa-408"><a href="#pyRdfa-408"><span class="linenos">408</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">base</span>           <span class="o">=</span> <span class="n">url_request</span><span class="o">.</span><span class="n">location</span>
</span><span id="pyRdfa-409"><a href="#pyRdfa-409"><span class="linenos">409</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">media_type</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="pyRdfa-410"><a href="#pyRdfa-410"><span class="linenos">410</span></a>                        <span class="k">if</span> <span class="n">url_request</span><span class="o">.</span><span class="n">content_type</span> <span class="ow">in</span> <span class="n">content_to_host_language</span><span class="p">:</span>
</span><span id="pyRdfa-411"><a href="#pyRdfa-411"><span class="linenos">411</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">media_type</span> <span class="o">=</span> <span class="n">url_request</span><span class="o">.</span><span class="n">content_type</span>
</span><span id="pyRdfa-412"><a href="#pyRdfa-412"><span class="linenos">412</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa-413"><a href="#pyRdfa-413"><span class="linenos">413</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">media_type</span> <span class="o">=</span> <span class="n">MediaTypes</span><span class="o">.</span><span class="n">xml</span>
</span><span id="pyRdfa-414"><a href="#pyRdfa-414"><span class="linenos">414</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">set_host_language</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">media_type</span><span class="p">)</span>
</span><span id="pyRdfa-415"><a href="#pyRdfa-415"><span class="linenos">415</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">charset</span> <span class="o">=</span> <span class="n">url_request</span><span class="o">.</span><span class="n">charset</span>
</span><span id="pyRdfa-416"><a href="#pyRdfa-416"><span class="linenos">416</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_base</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="pyRdfa-417"><a href="#pyRdfa-417"><span class="linenos">417</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">required_base</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="pyRdfa-418"><a href="#pyRdfa-418"><span class="linenos">418</span></a>                    <span class="k">return</span> <span class="n">url_request</span><span class="o">.</span><span class="n">data</span>
</span><span id="pyRdfa-419"><a href="#pyRdfa-419"><span class="linenos">419</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa-420"><a href="#pyRdfa-420"><span class="linenos">420</span></a>                    <span class="c1"># Creating a File URI for this thing</span>
</span><span id="pyRdfa-421"><a href="#pyRdfa-421"><span class="linenos">421</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_base</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="pyRdfa-422"><a href="#pyRdfa-422"><span class="linenos">422</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">required_base</span> <span class="o">=</span> <span class="s2">&quot;file://&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="n">name</span><span class="p">)</span>
</span><span id="pyRdfa-423"><a href="#pyRdfa-423"><span class="linenos">423</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">media_type</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="pyRdfa-424"><a href="#pyRdfa-424"><span class="linenos">424</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">media_type</span> <span class="o">=</span> <span class="n">MediaTypes</span><span class="o">.</span><span class="n">xml</span>
</span><span id="pyRdfa-425"><a href="#pyRdfa-425"><span class="linenos">425</span></a>                        <span class="c1"># see if the default should be overwritten</span>
</span><span id="pyRdfa-426"><a href="#pyRdfa-426"><span class="linenos">426</span></a>                        <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">preferred_suffixes</span><span class="p">:</span>
</span><span id="pyRdfa-427"><a href="#pyRdfa-427"><span class="linenos">427</span></a>                            <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">):</span>
</span><span id="pyRdfa-428"><a href="#pyRdfa-428"><span class="linenos">428</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">media_type</span> <span class="o">=</span> <span class="n">preferred_suffixes</span><span class="p">[</span><span class="n">suffix</span><span class="p">]</span>
</span><span id="pyRdfa-429"><a href="#pyRdfa-429"><span class="linenos">429</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">charset</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span>
</span><span id="pyRdfa-430"><a href="#pyRdfa-430"><span class="linenos">430</span></a>                                <span class="k">break</span>
</span><span id="pyRdfa-431"><a href="#pyRdfa-431"><span class="linenos">431</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">set_host_language</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">media_type</span><span class="p">)</span>
</span><span id="pyRdfa-432"><a href="#pyRdfa-432"><span class="linenos">432</span></a>                    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="pyRdfa-433"><a href="#pyRdfa-433"><span class="linenos">433</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa-434"><a href="#pyRdfa-434"><span class="linenos">434</span></a>                <span class="k">return</span> <span class="n">name</span>
</span><span id="pyRdfa-435"><a href="#pyRdfa-435"><span class="linenos">435</span></a>        <span class="k">except</span> <span class="n">HTTPError</span><span class="p">:</span>
</span><span id="pyRdfa-436"><a href="#pyRdfa-436"><span class="linenos">436</span></a>            <span class="k">raise</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="pyRdfa-437"><a href="#pyRdfa-437"><span class="linenos">437</span></a>        <span class="k">except</span> <span class="n">RDFaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="pyRdfa-438"><a href="#pyRdfa-438"><span class="linenos">438</span></a>            <span class="k">raise</span> <span class="n">e</span>
</span><span id="pyRdfa-439"><a href="#pyRdfa-439"><span class="linenos">439</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="pyRdfa-440"><a href="#pyRdfa-440"><span class="linenos">440</span></a>            <span class="n">_type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">_traceback</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
</span><span id="pyRdfa-441"><a href="#pyRdfa-441"><span class="linenos">441</span></a>            <span class="k">raise</span> <span class="n">FailedSource</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="pyRdfa-442"><a href="#pyRdfa-442"><span class="linenos">442</span></a>
</span><span id="pyRdfa-443"><a href="#pyRdfa-443"><span class="linenos">443</span></a>    <span class="nd">@staticmethod</span>
</span><span id="pyRdfa-444"><a href="#pyRdfa-444"><span class="linenos">444</span></a>    <span class="k">def</span> <span class="nf">_validate_output_format</span><span class="p">(</span><span class="n">outputFormat</span><span class="p">):</span>
</span><span id="pyRdfa-445"><a href="#pyRdfa-445"><span class="linenos">445</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="pyRdfa-446"><a href="#pyRdfa-446"><span class="linenos">446</span></a><span class="sd">        Malicious actors may create XSS style issues by using an illegal output format... better be careful</span>
</span><span id="pyRdfa-447"><a href="#pyRdfa-447"><span class="linenos">447</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="pyRdfa-448"><a href="#pyRdfa-448"><span class="linenos">448</span></a>        <span class="c1"># protection against possible malicious URL call</span>
</span><span id="pyRdfa-449"><a href="#pyRdfa-449"><span class="linenos">449</span></a>        <span class="k">if</span> <span class="n">outputFormat</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;turtle&quot;</span><span class="p">,</span> <span class="s2">&quot;n3&quot;</span><span class="p">,</span> <span class="s2">&quot;xml&quot;</span><span class="p">,</span> <span class="s2">&quot;pretty-xml&quot;</span><span class="p">,</span> <span class="s2">&quot;nt&quot;</span><span class="p">,</span> <span class="s2">&quot;json-ld&quot;</span><span class="p">]:</span>
</span><span id="pyRdfa-450"><a href="#pyRdfa-450"><span class="linenos">450</span></a>            <span class="n">outputFormat</span> <span class="o">=</span> <span class="s2">&quot;turtle&quot;</span>
</span><span id="pyRdfa-451"><a href="#pyRdfa-451"><span class="linenos">451</span></a>        <span class="k">return</span> <span class="n">outputFormat</span>
</span><span id="pyRdfa-452"><a href="#pyRdfa-452"><span class="linenos">452</span></a>        
</span><span id="pyRdfa-453"><a href="#pyRdfa-453"><span class="linenos">453</span></a>    <span class="c1">####################################################################################################################</span>
</span><span id="pyRdfa-454"><a href="#pyRdfa-454"><span class="linenos">454</span></a>    <span class="c1"># Externally used methods</span>
</span><span id="pyRdfa-455"><a href="#pyRdfa-455"><span class="linenos">455</span></a>    <span class="c1">#</span>
</span><span id="pyRdfa-456"><a href="#pyRdfa-456"><span class="linenos">456</span></a>    <span class="k">def</span> <span class="nf">graph_from_DOM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dom</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pgraph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="pyRdfa-457"><a href="#pyRdfa-457"><span class="linenos">457</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="pyRdfa-458"><a href="#pyRdfa-458"><span class="linenos">458</span></a><span class="sd">        Extract the RDF Graph from a DOM tree. This is where the real processing happens. All other methods get down to this</span>
</span><span id="pyRdfa-459"><a href="#pyRdfa-459"><span class="linenos">459</span></a><span class="sd">        one, eventually (e.g., after opening a URI and parsing it into a DOM).</span>
</span><span id="pyRdfa-460"><a href="#pyRdfa-460"><span class="linenos">460</span></a><span class="sd">        @param dom: a DOM Node element, the top level entry node for the whole tree (i.e., the C{dom.documentElement} is used to initiate processing down the node hierarchy)</span>
</span><span id="pyRdfa-461"><a href="#pyRdfa-461"><span class="linenos">461</span></a><span class="sd">        @keyword graph: an RDF Graph (if None, than a new one is created)</span>
</span><span id="pyRdfa-462"><a href="#pyRdfa-462"><span class="linenos">462</span></a><span class="sd">        @type graph: rdflib Graph instance.</span>
</span><span id="pyRdfa-463"><a href="#pyRdfa-463"><span class="linenos">463</span></a><span class="sd">        @keyword pgraph: an RDF Graph to hold (possibly) the processor graph content. If None, and the error/warning triples are to be generated, they will be added to the returned graph. Otherwise they are stored in this graph.</span>
</span><span id="pyRdfa-464"><a href="#pyRdfa-464"><span class="linenos">464</span></a><span class="sd">        @type pgraph: rdflib Graph instance</span>
</span><span id="pyRdfa-465"><a href="#pyRdfa-465"><span class="linenos">465</span></a><span class="sd">        @return: an RDF Graph</span>
</span><span id="pyRdfa-466"><a href="#pyRdfa-466"><span class="linenos">466</span></a><span class="sd">        @rtype: rdflib Graph instance</span>
</span><span id="pyRdfa-467"><a href="#pyRdfa-467"><span class="linenos">467</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="pyRdfa-468"><a href="#pyRdfa-468"><span class="linenos">468</span></a>        <span class="k">def</span> <span class="nf">copyGraph</span><span class="p">(</span><span class="n">tog</span><span class="p">,</span> <span class="n">fromg</span><span class="p">):</span>
</span><span id="pyRdfa-469"><a href="#pyRdfa-469"><span class="linenos">469</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">fromg</span><span class="p">:</span>
</span><span id="pyRdfa-470"><a href="#pyRdfa-470"><span class="linenos">470</span></a>                <span class="n">tog</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="pyRdfa-471"><a href="#pyRdfa-471"><span class="linenos">471</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">ns</span> <span class="ow">in</span> <span class="n">fromg</span><span class="o">.</span><span class="n">namespaces</span><span class="p">():</span>
</span><span id="pyRdfa-472"><a href="#pyRdfa-472"><span class="linenos">472</span></a>                <span class="n">tog</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">ns</span><span class="p">)</span>
</span><span id="pyRdfa-473"><a href="#pyRdfa-473"><span class="linenos">473</span></a>
</span><span id="pyRdfa-474"><a href="#pyRdfa-474"><span class="linenos">474</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="pyRdfa-475"><a href="#pyRdfa-475"><span class="linenos">475</span></a>            <span class="c1"># Create the RDF Graph, that will contain the return triples...</span>
</span><span id="pyRdfa-476"><a href="#pyRdfa-476"><span class="linenos">476</span></a>            <span class="n">graph</span>   <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
</span><span id="pyRdfa-477"><a href="#pyRdfa-477"><span class="linenos">477</span></a>
</span><span id="pyRdfa-478"><a href="#pyRdfa-478"><span class="linenos">478</span></a>        <span class="c1"># this will collect the content, the &#39;default graph&#39;, as called in the RDFa spec</span>
</span><span id="pyRdfa-479"><a href="#pyRdfa-479"><span class="linenos">479</span></a>        <span class="n">default_graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
</span><span id="pyRdfa-480"><a href="#pyRdfa-480"><span class="linenos">480</span></a>
</span><span id="pyRdfa-481"><a href="#pyRdfa-481"><span class="linenos">481</span></a>        <span class="c1"># get the DOM tree</span>
</span><span id="pyRdfa-482"><a href="#pyRdfa-482"><span class="linenos">482</span></a>        <span class="n">topElement</span> <span class="o">=</span> <span class="n">dom</span><span class="o">.</span><span class="n">documentElement</span>
</span><span id="pyRdfa-483"><a href="#pyRdfa-483"><span class="linenos">483</span></a>
</span><span id="pyRdfa-484"><a href="#pyRdfa-484"><span class="linenos">484</span></a>        <span class="c1"># Create the initial state. This takes care of things</span>
</span><span id="pyRdfa-485"><a href="#pyRdfa-485"><span class="linenos">485</span></a>        <span class="c1"># like base, top level namespace settings, etc.</span>
</span><span id="pyRdfa-486"><a href="#pyRdfa-486"><span class="linenos">486</span></a>        <span class="n">state</span> <span class="o">=</span> <span class="n">ExecutionContext</span><span class="p">(</span><span class="n">topElement</span><span class="p">,</span> <span class="n">default_graph</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">required_base</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_base</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">,</span> <span class="n">rdfa_version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span><span class="p">)</span>
</span><span id="pyRdfa-487"><a href="#pyRdfa-487"><span class="linenos">487</span></a>
</span><span id="pyRdfa-488"><a href="#pyRdfa-488"><span class="linenos">488</span></a>        <span class="c1"># Perform the built-in and external transformations on the HTML tree.</span>
</span><span id="pyRdfa-489"><a href="#pyRdfa-489"><span class="linenos">489</span></a>        <span class="k">for</span> <span class="n">trans</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">transformers</span> <span class="o">+</span> <span class="n">builtInTransformers</span><span class="p">:</span>
</span><span id="pyRdfa-490"><a href="#pyRdfa-490"><span class="linenos">490</span></a>            <span class="n">trans</span><span class="p">(</span><span class="n">topElement</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span><span id="pyRdfa-491"><a href="#pyRdfa-491"><span class="linenos">491</span></a>
</span><span id="pyRdfa-492"><a href="#pyRdfa-492"><span class="linenos">492</span></a>        <span class="c1"># This may have changed if the state setting detected an explicit version information:</span>
</span><span id="pyRdfa-493"><a href="#pyRdfa-493"><span class="linenos">493</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">rdfa_version</span>
</span><span id="pyRdfa-494"><a href="#pyRdfa-494"><span class="linenos">494</span></a>
</span><span id="pyRdfa-495"><a href="#pyRdfa-495"><span class="linenos">495</span></a>        <span class="c1"># The top level subject starts with the current document; this</span>
</span><span id="pyRdfa-496"><a href="#pyRdfa-496"><span class="linenos">496</span></a>        <span class="c1"># is used by the recursion</span>
</span><span id="pyRdfa-497"><a href="#pyRdfa-497"><span class="linenos">497</span></a>        <span class="c1"># this function is the real workhorse</span>
</span><span id="pyRdfa-498"><a href="#pyRdfa-498"><span class="linenos">498</span></a>        <span class="n">parse_one_node</span><span class="p">(</span><span class="n">topElement</span><span class="p">,</span> <span class="n">default_graph</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="pyRdfa-499"><a href="#pyRdfa-499"><span class="linenos">499</span></a>
</span><span id="pyRdfa-500"><a href="#pyRdfa-500"><span class="linenos">500</span></a>        <span class="c1"># Massage the output graph in term of rdfa:Pattern and rdfa:copy</span>
</span><span id="pyRdfa-501"><a href="#pyRdfa-501"><span class="linenos">501</span></a>        <span class="n">handle_prototypes</span><span class="p">(</span><span class="n">default_graph</span><span class="p">)</span>
</span><span id="pyRdfa-502"><a href="#pyRdfa-502"><span class="linenos">502</span></a>
</span><span id="pyRdfa-503"><a href="#pyRdfa-503"><span class="linenos">503</span></a>        <span class="c1"># If the RDFS expansion has to be made, here is the place...</span>
</span><span id="pyRdfa-504"><a href="#pyRdfa-504"><span class="linenos">504</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">vocab_expansion</span><span class="p">:</span>
</span><span id="pyRdfa-505"><a href="#pyRdfa-505"><span class="linenos">505</span></a>            <span class="kn">from</span> <span class="nn">.rdfs.process</span> <span class="kn">import</span> <span class="n">process_rdfa_sem</span>
</span><span id="pyRdfa-506"><a href="#pyRdfa-506"><span class="linenos">506</span></a>            <span class="n">process_rdfa_sem</span><span class="p">(</span><span class="n">default_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="pyRdfa-507"><a href="#pyRdfa-507"><span class="linenos">507</span></a>
</span><span id="pyRdfa-508"><a href="#pyRdfa-508"><span class="linenos">508</span></a>        <span class="c1"># Experimental feature: nothing for now, this is kept as a placeholder</span>
</span><span id="pyRdfa-509"><a href="#pyRdfa-509"><span class="linenos">509</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">experimental_features</span><span class="p">:</span>
</span><span id="pyRdfa-510"><a href="#pyRdfa-510"><span class="linenos">510</span></a>            <span class="k">pass</span>
</span><span id="pyRdfa-511"><a href="#pyRdfa-511"><span class="linenos">511</span></a>
</span><span id="pyRdfa-512"><a href="#pyRdfa-512"><span class="linenos">512</span></a>        <span class="c1"># What should be returned depends on the way the options have been set up</span>
</span><span id="pyRdfa-513"><a href="#pyRdfa-513"><span class="linenos">513</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">output_default_graph</span><span class="p">:</span>
</span><span id="pyRdfa-514"><a href="#pyRdfa-514"><span class="linenos">514</span></a>            <span class="n">copyGraph</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">default_graph</span><span class="p">)</span>
</span><span id="pyRdfa-515"><a href="#pyRdfa-515"><span class="linenos">515</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">output_processor_graph</span><span class="p">:</span>
</span><span id="pyRdfa-516"><a href="#pyRdfa-516"><span class="linenos">516</span></a>                <span class="k">if</span> <span class="n">pgraph</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="pyRdfa-517"><a href="#pyRdfa-517"><span class="linenos">517</span></a>                    <span class="n">copyGraph</span><span class="p">(</span><span class="n">pgraph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="pyRdfa-518"><a href="#pyRdfa-518"><span class="linenos">518</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa-519"><a href="#pyRdfa-519"><span class="linenos">519</span></a>                    <span class="n">copyGraph</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="pyRdfa-520"><a href="#pyRdfa-520"><span class="linenos">520</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">output_processor_graph</span><span class="p">:</span>
</span><span id="pyRdfa-521"><a href="#pyRdfa-521"><span class="linenos">521</span></a>            <span class="k">if</span> <span class="n">pgraph</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="pyRdfa-522"><a href="#pyRdfa-522"><span class="linenos">522</span></a>                <span class="n">copyGraph</span><span class="p">(</span><span class="n">pgraph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="pyRdfa-523"><a href="#pyRdfa-523"><span class="linenos">523</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa-524"><a href="#pyRdfa-524"><span class="linenos">524</span></a>                <span class="n">copyGraph</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="pyRdfa-525"><a href="#pyRdfa-525"><span class="linenos">525</span></a>
</span><span id="pyRdfa-526"><a href="#pyRdfa-526"><span class="linenos">526</span></a>        <span class="c1"># this is necessary if several DOM trees are handled in a row...</span>
</span><span id="pyRdfa-527"><a href="#pyRdfa-527"><span class="linenos">527</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">reset_processor_graph</span><span class="p">()</span>
</span><span id="pyRdfa-528"><a href="#pyRdfa-528"><span class="linenos">528</span></a>
</span><span id="pyRdfa-529"><a href="#pyRdfa-529"><span class="linenos">529</span></a>        <span class="k">return</span> <span class="n">graph</span>
</span><span id="pyRdfa-530"><a href="#pyRdfa-530"><span class="linenos">530</span></a>
</span><span id="pyRdfa-531"><a href="#pyRdfa-531"><span class="linenos">531</span></a>    <span class="k">def</span> <span class="nf">graph_from_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rdfOutput</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">pgraph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="pyRdfa-532"><a href="#pyRdfa-532"><span class="linenos">532</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="pyRdfa-533"><a href="#pyRdfa-533"><span class="linenos">533</span></a><span class="sd">        Extract an RDF graph from an RDFa source. The source is parsed, the RDF extracted, and the RDFa Graph is</span>
</span><span id="pyRdfa-534"><a href="#pyRdfa-534"><span class="linenos">534</span></a><span class="sd">        returned. This is a front-end to the L{pyRdfa.graph_from_DOM} method.</span>
</span><span id="pyRdfa-535"><a href="#pyRdfa-535"><span class="linenos">535</span></a>
</span><span id="pyRdfa-536"><a href="#pyRdfa-536"><span class="linenos">536</span></a><span class="sd">        @param name: a URI, a file name, or a file-like object</span>
</span><span id="pyRdfa-537"><a href="#pyRdfa-537"><span class="linenos">537</span></a><span class="sd">        @param graph: rdflib Graph instance. If None, a new one is created.</span>
</span><span id="pyRdfa-538"><a href="#pyRdfa-538"><span class="linenos">538</span></a><span class="sd">        @param pgraph: rdflib Graph instance for the processor graph. If None, and the error/warning triples are to be generated, they will be added to the returned graph. Otherwise they are stored in this graph.</span>
</span><span id="pyRdfa-539"><a href="#pyRdfa-539"><span class="linenos">539</span></a><span class="sd">        @param rdfOutput: whether runtime exceptions should be turned into RDF and returned as part of the processor graph</span>
</span><span id="pyRdfa-540"><a href="#pyRdfa-540"><span class="linenos">540</span></a><span class="sd">        @return: an RDF Graph</span>
</span><span id="pyRdfa-541"><a href="#pyRdfa-541"><span class="linenos">541</span></a><span class="sd">        @rtype: rdflib Graph instance</span>
</span><span id="pyRdfa-542"><a href="#pyRdfa-542"><span class="linenos">542</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="pyRdfa-543"><a href="#pyRdfa-543"><span class="linenos">543</span></a>        <span class="k">def</span> <span class="nf">copyErrors</span><span class="p">(</span><span class="n">tog</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="pyRdfa-544"><a href="#pyRdfa-544"><span class="linenos">544</span></a>            <span class="k">if</span> <span class="n">tog</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="pyRdfa-545"><a href="#pyRdfa-545"><span class="linenos">545</span></a>                <span class="n">tog</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
</span><span id="pyRdfa-546"><a href="#pyRdfa-546"><span class="linenos">546</span></a>            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">output_processor_graph</span><span class="p">:</span>
</span><span id="pyRdfa-547"><a href="#pyRdfa-547"><span class="linenos">547</span></a>                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">graph</span><span class="p">:</span>
</span><span id="pyRdfa-548"><a href="#pyRdfa-548"><span class="linenos">548</span></a>                    <span class="n">tog</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="pyRdfa-549"><a href="#pyRdfa-549"><span class="linenos">549</span></a>                    <span class="k">if</span> <span class="n">pgraph</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">pgraph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="pyRdfa-550"><a href="#pyRdfa-550"><span class="linenos">550</span></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">ns</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">namespaces</span><span class="p">():</span>
</span><span id="pyRdfa-551"><a href="#pyRdfa-551"><span class="linenos">551</span></a>                    <span class="n">tog</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">ns</span><span class="p">)</span>
</span><span id="pyRdfa-552"><a href="#pyRdfa-552"><span class="linenos">552</span></a>                    <span class="k">if</span> <span class="n">pgraph</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">pgraph</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">ns</span><span class="p">)</span>
</span><span id="pyRdfa-553"><a href="#pyRdfa-553"><span class="linenos">553</span></a>            <span class="n">options</span><span class="o">.</span><span class="n">reset_processor_graph</span><span class="p">()</span>
</span><span id="pyRdfa-554"><a href="#pyRdfa-554"><span class="linenos">554</span></a>            <span class="k">return</span> <span class="n">tog</span>
</span><span id="pyRdfa-555"><a href="#pyRdfa-555"><span class="linenos">555</span></a>
</span><span id="pyRdfa-556"><a href="#pyRdfa-556"><span class="linenos">556</span></a>        <span class="n">isstring</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="pyRdfa-557"><a href="#pyRdfa-557"><span class="linenos">557</span></a>
</span><span id="pyRdfa-558"><a href="#pyRdfa-558"><span class="linenos">558</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="pyRdfa-559"><a href="#pyRdfa-559"><span class="linenos">559</span></a>            <span class="c1"># First, open the source... Possible HTTP errors are returned as error triples</span>
</span><span id="pyRdfa-560"><a href="#pyRdfa-560"><span class="linenos">560</span></a>            <span class="n">stream</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="pyRdfa-561"><a href="#pyRdfa-561"><span class="linenos">561</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="pyRdfa-562"><a href="#pyRdfa-562"><span class="linenos">562</span></a>                <span class="n">stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_input</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="pyRdfa-563"><a href="#pyRdfa-563"><span class="linenos">563</span></a>            <span class="k">except</span> <span class="n">FailedSource</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
</span><span id="pyRdfa-564"><a href="#pyRdfa-564"><span class="linenos">564</span></a>                <span class="n">_f</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="pyRdfa-565"><a href="#pyRdfa-565"><span class="linenos">565</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="mi">400</span>
</span><span id="pyRdfa-566"><a href="#pyRdfa-566"><span class="linenos">566</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">rdfOutput</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
</span><span id="pyRdfa-567"><a href="#pyRdfa-567"><span class="linenos">567</span></a>                <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">msg</span><span class="p">,</span> <span class="n">FileReferenceError</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="pyRdfa-568"><a href="#pyRdfa-568"><span class="linenos">568</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">add_http_context</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
</span><span id="pyRdfa-569"><a href="#pyRdfa-569"><span class="linenos">569</span></a>                <span class="k">return</span> <span class="n">copyErrors</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="pyRdfa-570"><a href="#pyRdfa-570"><span class="linenos">570</span></a>            <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
</span><span id="pyRdfa-571"><a href="#pyRdfa-571"><span class="linenos">571</span></a>                <span class="n">h</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="pyRdfa-572"><a href="#pyRdfa-572"><span class="linenos">572</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">http_code</span>
</span><span id="pyRdfa-573"><a href="#pyRdfa-573"><span class="linenos">573</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">rdfOutput</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
</span><span id="pyRdfa-574"><a href="#pyRdfa-574"><span class="linenos">574</span></a>                <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="s2">&quot;HTTP Error: </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">http_code</span><span class="p">,</span><span class="n">h</span><span class="o">.</span><span class="n">msg</span><span class="p">),</span> <span class="n">HTError</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="pyRdfa-575"><a href="#pyRdfa-575"><span class="linenos">575</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">add_http_context</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">http_code</span><span class="p">)</span>
</span><span id="pyRdfa-576"><a href="#pyRdfa-576"><span class="linenos">576</span></a>                <span class="k">return</span> <span class="n">copyErrors</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="pyRdfa-577"><a href="#pyRdfa-577"><span class="linenos">577</span></a>            <span class="k">except</span> <span class="n">RDFaError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
</span><span id="pyRdfa-578"><a href="#pyRdfa-578"><span class="linenos">578</span></a>                <span class="n">e</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="pyRdfa-579"><a href="#pyRdfa-579"><span class="linenos">579</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="mi">500</span>
</span><span id="pyRdfa-580"><a href="#pyRdfa-580"><span class="linenos">580</span></a>                <span class="c1"># Something nasty happened:-(</span>
</span><span id="pyRdfa-581"><a href="#pyRdfa-581"><span class="linenos">581</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">rdfOutput</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
</span><span id="pyRdfa-582"><a href="#pyRdfa-582"><span class="linenos">582</span></a>                <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">msg</span><span class="p">),</span> <span class="n">context</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
</span><span id="pyRdfa-583"><a href="#pyRdfa-583"><span class="linenos">583</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">add_http_context</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
</span><span id="pyRdfa-584"><a href="#pyRdfa-584"><span class="linenos">584</span></a>                <span class="k">return</span> <span class="n">copyErrors</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="pyRdfa-585"><a href="#pyRdfa-585"><span class="linenos">585</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
</span><span id="pyRdfa-586"><a href="#pyRdfa-586"><span class="linenos">586</span></a>                <span class="n">e</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="pyRdfa-587"><a href="#pyRdfa-587"><span class="linenos">587</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="mi">500</span>
</span><span id="pyRdfa-588"><a href="#pyRdfa-588"><span class="linenos">588</span></a>                <span class="c1"># Something nasty happened:-(</span>
</span><span id="pyRdfa-589"><a href="#pyRdfa-589"><span class="linenos">589</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">rdfOutput</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">ex</span>
</span><span id="pyRdfa-590"><a href="#pyRdfa-590"><span class="linenos">590</span></a>                <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">context</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
</span><span id="pyRdfa-591"><a href="#pyRdfa-591"><span class="linenos">591</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">add_http_context</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
</span><span id="pyRdfa-592"><a href="#pyRdfa-592"><span class="linenos">592</span></a>                <span class="k">return</span> <span class="n">copyErrors</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="pyRdfa-593"><a href="#pyRdfa-593"><span class="linenos">593</span></a>
</span><span id="pyRdfa-594"><a href="#pyRdfa-594"><span class="linenos">594</span></a>            <span class="n">dom</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="pyRdfa-595"><a href="#pyRdfa-595"><span class="linenos">595</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="pyRdfa-596"><a href="#pyRdfa-596"><span class="linenos">596</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="pyRdfa-597"><a href="#pyRdfa-597"><span class="linenos">597</span></a>                <span class="n">parser</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="pyRdfa-598"><a href="#pyRdfa-598"><span class="linenos">598</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">host_language</span> <span class="o">==</span> <span class="n">HostLanguage</span><span class="o">.</span><span class="n">html5</span><span class="p">:</span>
</span><span id="pyRdfa-599"><a href="#pyRdfa-599"><span class="linenos">599</span></a>                    <span class="kn">import</span> <span class="nn">warnings</span>
</span><span id="pyRdfa-600"><a href="#pyRdfa-600"><span class="linenos">600</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
</span><span id="pyRdfa-601"><a href="#pyRdfa-601"><span class="linenos">601</span></a>                    <span class="kn">from</span> <span class="nn">html5lib</span> <span class="kn">import</span> <span class="n">HTMLParser</span><span class="p">,</span> <span class="n">treebuilders</span>
</span><span id="pyRdfa-602"><a href="#pyRdfa-602"><span class="linenos">602</span></a>                    <span class="n">parser</span> <span class="o">=</span> <span class="n">HTMLParser</span><span class="p">(</span><span class="n">tree</span><span class="o">=</span><span class="n">treebuilders</span><span class="o">.</span><span class="n">getTreeBuilder</span><span class="p">(</span><span class="s2">&quot;dom&quot;</span><span class="p">))</span>
</span><span id="pyRdfa-603"><a href="#pyRdfa-603"><span class="linenos">603</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charset</span><span class="p">:</span>
</span><span id="pyRdfa-604"><a href="#pyRdfa-604"><span class="linenos">604</span></a>                        <span class="c1"># This means the HTTP header has provided a charset, or the</span>
</span><span id="pyRdfa-605"><a href="#pyRdfa-605"><span class="linenos">605</span></a>                        <span class="c1"># file is a local file when we suppose it to be a utf-8</span>
</span><span id="pyRdfa-606"><a href="#pyRdfa-606"><span class="linenos">606</span></a>                        <span class="c1">#</span>
</span><span id="pyRdfa-607"><a href="#pyRdfa-607"><span class="linenos">607</span></a>                        <span class="c1"># 2020-01-20, Ivan Herman</span>
</span><span id="pyRdfa-608"><a href="#pyRdfa-608"><span class="linenos">608</span></a>                        <span class="c1">#   for some reasons the python3 version ran into a problem with this html5lib call</span>
</span><span id="pyRdfa-609"><a href="#pyRdfa-609"><span class="linenos">609</span></a>                        <span class="c1">#   the override_encoding argument was not accepted.</span>
</span><span id="pyRdfa-610"><a href="#pyRdfa-610"><span class="linenos">610</span></a>                        <span class="c1"># dom = parser.parse(stream, override_encoding=self.charset)</span>
</span><span id="pyRdfa-611"><a href="#pyRdfa-611"><span class="linenos">611</span></a>                        <span class="n">dom</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</span><span id="pyRdfa-612"><a href="#pyRdfa-612"><span class="linenos">612</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa-613"><a href="#pyRdfa-613"><span class="linenos">613</span></a>                        <span class="c1"># No charset set. The HTMLLib parser tries to sniff into the</span>
</span><span id="pyRdfa-614"><a href="#pyRdfa-614"><span class="linenos">614</span></a>                        <span class="c1"># the file to find a meta header for the charset; if that</span>
</span><span id="pyRdfa-615"><a href="#pyRdfa-615"><span class="linenos">615</span></a>                        <span class="c1"># works, fine, otherwise it falls back on window-...</span>
</span><span id="pyRdfa-616"><a href="#pyRdfa-616"><span class="linenos">616</span></a>                        <span class="n">dom</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</span><span id="pyRdfa-617"><a href="#pyRdfa-617"><span class="linenos">617</span></a>
</span><span id="pyRdfa-618"><a href="#pyRdfa-618"><span class="linenos">618</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="pyRdfa-619"><a href="#pyRdfa-619"><span class="linenos">619</span></a>                        <span class="k">if</span> <span class="n">isstring</span><span class="p">:</span>
</span><span id="pyRdfa-620"><a href="#pyRdfa-620"><span class="linenos">620</span></a>                            <span class="n">stream</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="pyRdfa-621"><a href="#pyRdfa-621"><span class="linenos">621</span></a>                            <span class="n">stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_input</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="pyRdfa-622"><a href="#pyRdfa-622"><span class="linenos">622</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa-623"><a href="#pyRdfa-623"><span class="linenos">623</span></a>                            <span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="pyRdfa-624"><a href="#pyRdfa-624"><span class="linenos">624</span></a>                        <span class="kn">from</span> <span class="nn">.host</span> <span class="kn">import</span> <span class="n">adjust_html_version</span>
</span><span id="pyRdfa-625"><a href="#pyRdfa-625"><span class="linenos">625</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span> <span class="o">=</span> <span class="n">adjust_html_version</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span><span class="p">)</span>
</span><span id="pyRdfa-626"><a href="#pyRdfa-626"><span class="linenos">626</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="pyRdfa-627"><a href="#pyRdfa-627"><span class="linenos">627</span></a>                        <span class="c1"># if anything goes wrong, it is not really important; rdfa version stays what it was...</span>
</span><span id="pyRdfa-628"><a href="#pyRdfa-628"><span class="linenos">628</span></a>                        <span class="k">pass</span>
</span><span id="pyRdfa-629"><a href="#pyRdfa-629"><span class="linenos">629</span></a>
</span><span id="pyRdfa-630"><a href="#pyRdfa-630"><span class="linenos">630</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa-631"><a href="#pyRdfa-631"><span class="linenos">631</span></a>                    <span class="kn">from</span> <span class="nn">.host</span> <span class="kn">import</span> <span class="n">adjust_xhtml_and_version</span>
</span><span id="pyRdfa-632"><a href="#pyRdfa-632"><span class="linenos">632</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">IOBase</span><span class="p">):</span>
</span><span id="pyRdfa-633"><a href="#pyRdfa-633"><span class="linenos">633</span></a>                        <span class="n">parse</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">dom</span><span class="o">.</span><span class="n">minidom</span><span class="o">.</span><span class="n">parse</span>
</span><span id="pyRdfa-634"><a href="#pyRdfa-634"><span class="linenos">634</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa-635"><a href="#pyRdfa-635"><span class="linenos">635</span></a>                        <span class="n">parse</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">dom</span><span class="o">.</span><span class="n">minidom</span><span class="o">.</span><span class="n">parseString</span>
</span><span id="pyRdfa-636"><a href="#pyRdfa-636"><span class="linenos">636</span></a>                    <span class="n">dom</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</span><span id="pyRdfa-637"><a href="#pyRdfa-637"><span class="linenos">637</span></a>                    <span class="n">adjusted_host_language</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="n">adjust_xhtml_and_version</span><span class="p">(</span><span class="n">dom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">host_language</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span><span class="p">)</span>
</span><span id="pyRdfa-638"><a href="#pyRdfa-638"><span class="linenos">638</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">host_language</span> <span class="o">=</span> <span class="n">adjusted_host_language</span>
</span><span id="pyRdfa-639"><a href="#pyRdfa-639"><span class="linenos">639</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span> <span class="o">=</span> <span class="n">version</span>
</span><span id="pyRdfa-640"><a href="#pyRdfa-640"><span class="linenos">640</span></a>            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="pyRdfa-641"><a href="#pyRdfa-641"><span class="linenos">641</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;HTML5 parser not available. Try installing html5lib &lt;http://code.google.com/p/html5lib&gt;&quot;</span>
</span><span id="pyRdfa-642"><a href="#pyRdfa-642"><span class="linenos">642</span></a>                <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="pyRdfa-643"><a href="#pyRdfa-643"><span class="linenos">643</span></a>            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="pyRdfa-644"><a href="#pyRdfa-644"><span class="linenos">644</span></a>                <span class="n">e</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="pyRdfa-645"><a href="#pyRdfa-645"><span class="linenos">645</span></a>                <span class="c1"># These are various parsing exception. Per spec, this is a case when</span>
</span><span id="pyRdfa-646"><a href="#pyRdfa-646"><span class="linenos">646</span></a>                <span class="c1"># error triples MUST be returned, ie, the usage of rdfOutput (which switches between an HTML formatted</span>
</span><span id="pyRdfa-647"><a href="#pyRdfa-647"><span class="linenos">647</span></a>                <span class="c1"># return page or a graph with error triples) does not apply</span>
</span><span id="pyRdfa-648"><a href="#pyRdfa-648"><span class="linenos">648</span></a>                <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">context</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
</span><span id="pyRdfa-649"><a href="#pyRdfa-649"><span class="linenos">649</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="mi">400</span>
</span><span id="pyRdfa-650"><a href="#pyRdfa-650"><span class="linenos">650</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">add_http_context</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
</span><span id="pyRdfa-651"><a href="#pyRdfa-651"><span class="linenos">651</span></a>                <span class="k">return</span> <span class="n">copyErrors</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="pyRdfa-652"><a href="#pyRdfa-652"><span class="linenos">652</span></a>
</span><span id="pyRdfa-653"><a href="#pyRdfa-653"><span class="linenos">653</span></a>            <span class="c1"># If we got here, we have a DOM tree to operate on...</span>
</span><span id="pyRdfa-654"><a href="#pyRdfa-654"><span class="linenos">654</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_from_DOM</span><span class="p">(</span><span class="n">dom</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">pgraph</span><span class="p">)</span>
</span><span id="pyRdfa-655"><a href="#pyRdfa-655"><span class="linenos">655</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="pyRdfa-656"><a href="#pyRdfa-656"><span class="linenos">656</span></a>            <span class="c1"># Something nasty happened during the generation of the graph...</span>
</span><span id="pyRdfa-657"><a href="#pyRdfa-657"><span class="linenos">657</span></a>            <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
</span><span id="pyRdfa-658"><a href="#pyRdfa-658"><span class="linenos">658</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
</span><span id="pyRdfa-659"><a href="#pyRdfa-659"><span class="linenos">659</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="ne">ImportError</span><span class="p">):</span>
</span><span id="pyRdfa-660"><a href="#pyRdfa-660"><span class="linenos">660</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="pyRdfa-661"><a href="#pyRdfa-661"><span class="linenos">661</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa-662"><a href="#pyRdfa-662"><span class="linenos">662</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="mi">500</span>
</span><span id="pyRdfa-663"><a href="#pyRdfa-663"><span class="linenos">663</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">rdfOutput</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">b</span>
</span><span id="pyRdfa-664"><a href="#pyRdfa-664"><span class="linenos">664</span></a>            <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">context</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
</span><span id="pyRdfa-665"><a href="#pyRdfa-665"><span class="linenos">665</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">add_http_context</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
</span><span id="pyRdfa-666"><a href="#pyRdfa-666"><span class="linenos">666</span></a>            <span class="k">return</span> <span class="n">copyErrors</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="pyRdfa-667"><a href="#pyRdfa-667"><span class="linenos">667</span></a>
</span><span id="pyRdfa-668"><a href="#pyRdfa-668"><span class="linenos">668</span></a>    <span class="k">def</span> <span class="nf">rdf_from_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">outputFormat</span> <span class="o">=</span> <span class="s2">&quot;turtle&quot;</span><span class="p">,</span> <span class="n">rdfOutput</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="pyRdfa-669"><a href="#pyRdfa-669"><span class="linenos">669</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="pyRdfa-670"><a href="#pyRdfa-670"><span class="linenos">670</span></a><span class="sd">        Extract and RDF graph from a list of RDFa sources and serialize them in one graph. The sources are parsed, the RDF</span>
</span><span id="pyRdfa-671"><a href="#pyRdfa-671"><span class="linenos">671</span></a><span class="sd">        extracted, and serialization is done in the specified format.</span>
</span><span id="pyRdfa-672"><a href="#pyRdfa-672"><span class="linenos">672</span></a><span class="sd">        @param names: list of sources, each can be a URI, a file name, or a file-like object</span>
</span><span id="pyRdfa-673"><a href="#pyRdfa-673"><span class="linenos">673</span></a><span class="sd">        @keyword outputFormat: serialization format. Can be one of &quot;turtle&quot;, &quot;n3&quot;, &quot;xml&quot;, &quot;pretty-xml&quot;, &quot;nt&quot;. &quot;xml&quot;, &quot;pretty-xml&quot;, &quot;json&quot; or &quot;json-ld&quot;. &quot;turtle&quot; and &quot;n3&quot;, &quot;xml&quot; and &quot;pretty-xml&quot;, and &quot;json&quot; and &quot;json-ld&quot; are synonyms, respectively. Note that the JSON-LD serialization works with RDFLib 3.* only.</span>
</span><span id="pyRdfa-674"><a href="#pyRdfa-674"><span class="linenos">674</span></a><span class="sd">        @keyword rdfOutput: controls what happens in case an exception is raised. If the value is False, the caller is responsible handling it; otherwise a graph is returned with an error message included in the processor graph</span>
</span><span id="pyRdfa-675"><a href="#pyRdfa-675"><span class="linenos">675</span></a><span class="sd">        @type rdfOutput: boolean</span>
</span><span id="pyRdfa-676"><a href="#pyRdfa-676"><span class="linenos">676</span></a><span class="sd">        @return: a serialized RDF Graph</span>
</span><span id="pyRdfa-677"><a href="#pyRdfa-677"><span class="linenos">677</span></a><span class="sd">        @rtype: string</span>
</span><span id="pyRdfa-678"><a href="#pyRdfa-678"><span class="linenos">678</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="pyRdfa-679"><a href="#pyRdfa-679"><span class="linenos">679</span></a>        <span class="c1"># protection against possible malicious URL call</span>
</span><span id="pyRdfa-680"><a href="#pyRdfa-680"><span class="linenos">680</span></a>        <span class="n">outputFormat</span> <span class="o">=</span> <span class="n">pyRdfa</span><span class="o">.</span><span class="n">_validate_output_format</span><span class="p">(</span><span class="n">outputFormat</span><span class="p">);</span>
</span><span id="pyRdfa-681"><a href="#pyRdfa-681"><span class="linenos">681</span></a>
</span><span id="pyRdfa-682"><a href="#pyRdfa-682"><span class="linenos">682</span></a>        <span class="c1"># This is better because it gives access to the various, non-standard serializations</span>
</span><span id="pyRdfa-683"><a href="#pyRdfa-683"><span class="linenos">683</span></a>        <span class="c1"># If it does not work because the extra are not installed, fall back to the standard</span>
</span><span id="pyRdfa-684"><a href="#pyRdfa-684"><span class="linenos">684</span></a>        <span class="c1"># rdlib distribution...</span>
</span><span id="pyRdfa-685"><a href="#pyRdfa-685"><span class="linenos">685</span></a>        <span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
</span><span id="pyRdfa-686"><a href="#pyRdfa-686"><span class="linenos">686</span></a>
</span><span id="pyRdfa-687"><a href="#pyRdfa-687"><span class="linenos">687</span></a>        <span class="c1"># graph.bind(&quot;xsd&quot;, Namespace(&#39;http://www.w3.org/2001/XMLSchema#&#39;))</span>
</span><span id="pyRdfa-688"><a href="#pyRdfa-688"><span class="linenos">688</span></a>        <span class="c1"># the value of rdfOutput determines the reaction on exceptions...</span>
</span><span id="pyRdfa-689"><a href="#pyRdfa-689"><span class="linenos">689</span></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
</span><span id="pyRdfa-690"><a href="#pyRdfa-690"><span class="linenos">690</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_from_source</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">rdfOutput</span><span class="p">)</span>
</span><span id="pyRdfa-691"><a href="#pyRdfa-691"><span class="linenos">691</span></a>
</span><span id="pyRdfa-692"><a href="#pyRdfa-692"><span class="linenos">692</span></a>        <span class="c1"># Stupid difference between python2 and python3...</span>
</span><span id="pyRdfa-693"><a href="#pyRdfa-693"><span class="linenos">693</span></a>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="n">outputFormat</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="pyRdfa-694"><a href="#pyRdfa-694"><span class="linenos">694</span></a>
</span><span id="pyRdfa-695"><a href="#pyRdfa-695"><span class="linenos">695</span></a>
</span><span id="pyRdfa-696"><a href="#pyRdfa-696"><span class="linenos">696</span></a>    <span class="k">def</span> <span class="nf">rdf_from_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">outputFormat</span> <span class="o">=</span> <span class="s2">&quot;turtle&quot;</span><span class="p">,</span> <span class="n">rdfOutput</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="pyRdfa-697"><a href="#pyRdfa-697"><span class="linenos">697</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="pyRdfa-698"><a href="#pyRdfa-698"><span class="linenos">698</span></a><span class="sd">        Extract and RDF graph from an RDFa source and serialize it in one graph. The source is parsed, the RDF</span>
</span><span id="pyRdfa-699"><a href="#pyRdfa-699"><span class="linenos">699</span></a><span class="sd">        extracted, and serialization is done in the specified format.</span>
</span><span id="pyRdfa-700"><a href="#pyRdfa-700"><span class="linenos">700</span></a><span class="sd">        @param name: a URI, a file name, or a file-like object</span>
</span><span id="pyRdfa-701"><a href="#pyRdfa-701"><span class="linenos">701</span></a><span class="sd">        @keyword outputFormat: serialization format. Can be one of &quot;turtle&quot;, &quot;n3&quot;, &quot;xml&quot;, &quot;pretty-xml&quot;, &quot;nt&quot;. &quot;xml&quot;, &quot;pretty-xml&quot;, or &quot;json-ld&quot;. &quot;turtle&quot; and &quot;n3&quot;, or &quot;xml&quot; and &quot;pretty-xml&quot; are synonyms, respectively. Note that the JSON-LD serialization works with RDFLib 3.* only.</span>
</span><span id="pyRdfa-702"><a href="#pyRdfa-702"><span class="linenos">702</span></a><span class="sd">        @keyword rdfOutput: controls what happens in case an exception is raised. If the value is False, the caller is responsible handling it; otherwise a graph is returned with an error message included in the processor graph</span>
</span><span id="pyRdfa-703"><a href="#pyRdfa-703"><span class="linenos">703</span></a><span class="sd">        @type rdfOutput: boolean</span>
</span><span id="pyRdfa-704"><a href="#pyRdfa-704"><span class="linenos">704</span></a><span class="sd">        @return: a serialized RDF Graph</span>
</span><span id="pyRdfa-705"><a href="#pyRdfa-705"><span class="linenos">705</span></a><span class="sd">        @rtype: string</span>
</span><span id="pyRdfa-706"><a href="#pyRdfa-706"><span class="linenos">706</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="pyRdfa-707"><a href="#pyRdfa-707"><span class="linenos">707</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdf_from_sources</span><span class="p">([</span><span class="n">name</span><span class="p">],</span> <span class="n">outputFormat</span><span class="p">,</span> <span class="n">rdfOutput</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Main processing class for the distiller</p>

<p>@ivar options: an instance of the L{Options} class
@ivar media_type: the preferred default media type, possibly set at initialization
@ivar base: the base value, possibly set at initialization
@ivar http_status: HTTP Status, to be returned when the package is used via a CGI entry. Initially set to 200, may be modified by exception handlers</p>
</div>


                            <div id="pyRdfa.__init__" class="classattr">
                                        <input id="pyRdfa.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">pyRdfa</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">options</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">base</span><span class="o">=</span><span class="s1">&#39;&#39;</span>, </span><span class="param"><span class="n">media_type</span><span class="o">=</span><span class="s1">&#39;&#39;</span>, </span><span class="param"><span class="n">rdfa_version</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="pyRdfa.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#pyRdfa.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="pyRdfa.__init__-352"><a href="#pyRdfa.__init__-352"><span class="linenos">352</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">media_type</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">rdfa_version</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="pyRdfa.__init__-353"><a href="#pyRdfa.__init__-353"><span class="linenos">353</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="pyRdfa.__init__-354"><a href="#pyRdfa.__init__-354"><span class="linenos">354</span></a><span class="sd">        @keyword options: Options for the distiller</span>
</span><span id="pyRdfa.__init__-355"><a href="#pyRdfa.__init__-355"><span class="linenos">355</span></a><span class="sd">        @type options: L{Options}</span>
</span><span id="pyRdfa.__init__-356"><a href="#pyRdfa.__init__-356"><span class="linenos">356</span></a><span class="sd">        @keyword base: URI for the default &quot;base&quot; value (usually the URI of the file to be processed)</span>
</span><span id="pyRdfa.__init__-357"><a href="#pyRdfa.__init__-357"><span class="linenos">357</span></a><span class="sd">        @keyword media_type: explicit setting of the preferred media type (a.k.a. content type) of the the RDFa source</span>
</span><span id="pyRdfa.__init__-358"><a href="#pyRdfa.__init__-358"><span class="linenos">358</span></a><span class="sd">        @keyword rdfa_version: the RDFa version that should be used. If not set, the value of the global L{rdfa_current_version} variable is used</span>
</span><span id="pyRdfa.__init__-359"><a href="#pyRdfa.__init__-359"><span class="linenos">359</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="pyRdfa.__init__-360"><a href="#pyRdfa.__init__-360"><span class="linenos">360</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="mi">200</span>
</span><span id="pyRdfa.__init__-361"><a href="#pyRdfa.__init__-361"><span class="linenos">361</span></a>
</span><span id="pyRdfa.__init__-362"><a href="#pyRdfa.__init__-362"><span class="linenos">362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="n">base</span>
</span><span id="pyRdfa.__init__-363"><a href="#pyRdfa.__init__-363"><span class="linenos">363</span></a>        <span class="k">if</span> <span class="n">base</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="pyRdfa.__init__-364"><a href="#pyRdfa.__init__-364"><span class="linenos">364</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">required_base</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="pyRdfa.__init__-365"><a href="#pyRdfa.__init__-365"><span class="linenos">365</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa.__init__-366"><a href="#pyRdfa.__init__-366"><span class="linenos">366</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">required_base</span>    <span class="o">=</span> <span class="n">base</span>
</span><span id="pyRdfa.__init__-367"><a href="#pyRdfa.__init__-367"><span class="linenos">367</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">charset</span>         <span class="o">=</span> <span class="kc">None</span>
</span><span id="pyRdfa.__init__-368"><a href="#pyRdfa.__init__-368"><span class="linenos">368</span></a>
</span><span id="pyRdfa.__init__-369"><a href="#pyRdfa.__init__-369"><span class="linenos">369</span></a>        <span class="c1"># predefined content type</span>
</span><span id="pyRdfa.__init__-370"><a href="#pyRdfa.__init__-370"><span class="linenos">370</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">media_type</span> <span class="o">=</span> <span class="n">media_type</span>
</span><span id="pyRdfa.__init__-371"><a href="#pyRdfa.__init__-371"><span class="linenos">371</span></a>
</span><span id="pyRdfa.__init__-372"><a href="#pyRdfa.__init__-372"><span class="linenos">372</span></a>        <span class="k">if</span> <span class="n">options</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="pyRdfa.__init__-373"><a href="#pyRdfa.__init__-373"><span class="linenos">373</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
</span><span id="pyRdfa.__init__-374"><a href="#pyRdfa.__init__-374"><span class="linenos">374</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa.__init__-375"><a href="#pyRdfa.__init__-375"><span class="linenos">375</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
</span><span id="pyRdfa.__init__-376"><a href="#pyRdfa.__init__-376"><span class="linenos">376</span></a>
</span><span id="pyRdfa.__init__-377"><a href="#pyRdfa.__init__-377"><span class="linenos">377</span></a>        <span class="k">if</span> <span class="n">media_type</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="pyRdfa.__init__-378"><a href="#pyRdfa.__init__-378"><span class="linenos">378</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">set_host_language</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">media_type</span><span class="p">)</span>
</span><span id="pyRdfa.__init__-379"><a href="#pyRdfa.__init__-379"><span class="linenos">379</span></a>
</span><span id="pyRdfa.__init__-380"><a href="#pyRdfa.__init__-380"><span class="linenos">380</span></a>        <span class="k">if</span> <span class="n">rdfa_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="pyRdfa.__init__-381"><a href="#pyRdfa.__init__-381"><span class="linenos">381</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span> <span class="o">=</span> <span class="n">rdfa_version</span>
</span><span id="pyRdfa.__init__-382"><a href="#pyRdfa.__init__-382"><span class="linenos">382</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa.__init__-383"><a href="#pyRdfa.__init__-383"><span class="linenos">383</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>@keyword options: Options for the distiller
@type options: L{Options}
@keyword base: URI for the default "base" value (usually the URI of the file to be processed)
@keyword media_type: explicit setting of the preferred media type (a.k.a. content type) of the the RDFa source
@keyword rdfa_version: the RDFa version that should be used. If not set, the value of the global L{rdfa_current_version} variable is used</p>
</div>


                            </div>
                            <div id="pyRdfa.http_status" class="classattr">
                                <div class="attr variable">
            <span class="name">http_status</span>

        
    </div>
    <a class="headerlink" href="#pyRdfa.http_status"></a>
    
    

                            </div>
                            <div id="pyRdfa.base" class="classattr">
                                <div class="attr variable">
            <span class="name">base</span>

        
    </div>
    <a class="headerlink" href="#pyRdfa.base"></a>
    
    

                            </div>
                            <div id="pyRdfa.charset" class="classattr">
                                <div class="attr variable">
            <span class="name">charset</span>

        
    </div>
    <a class="headerlink" href="#pyRdfa.charset"></a>
    
    

                            </div>
                            <div id="pyRdfa.media_type" class="classattr">
                                <div class="attr variable">
            <span class="name">media_type</span>

        
    </div>
    <a class="headerlink" href="#pyRdfa.media_type"></a>
    
    

                            </div>
                            <div id="pyRdfa.graph_from_DOM" class="classattr">
                                        <input id="pyRdfa.graph_from_DOM-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">graph_from_DOM</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">dom</span>, </span><span class="param"><span class="n">graph</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">pgraph</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="pyRdfa.graph_from_DOM-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#pyRdfa.graph_from_DOM"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="pyRdfa.graph_from_DOM-456"><a href="#pyRdfa.graph_from_DOM-456"><span class="linenos">456</span></a>    <span class="k">def</span> <span class="nf">graph_from_DOM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dom</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pgraph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="pyRdfa.graph_from_DOM-457"><a href="#pyRdfa.graph_from_DOM-457"><span class="linenos">457</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="pyRdfa.graph_from_DOM-458"><a href="#pyRdfa.graph_from_DOM-458"><span class="linenos">458</span></a><span class="sd">        Extract the RDF Graph from a DOM tree. This is where the real processing happens. All other methods get down to this</span>
</span><span id="pyRdfa.graph_from_DOM-459"><a href="#pyRdfa.graph_from_DOM-459"><span class="linenos">459</span></a><span class="sd">        one, eventually (e.g., after opening a URI and parsing it into a DOM).</span>
</span><span id="pyRdfa.graph_from_DOM-460"><a href="#pyRdfa.graph_from_DOM-460"><span class="linenos">460</span></a><span class="sd">        @param dom: a DOM Node element, the top level entry node for the whole tree (i.e., the C{dom.documentElement} is used to initiate processing down the node hierarchy)</span>
</span><span id="pyRdfa.graph_from_DOM-461"><a href="#pyRdfa.graph_from_DOM-461"><span class="linenos">461</span></a><span class="sd">        @keyword graph: an RDF Graph (if None, than a new one is created)</span>
</span><span id="pyRdfa.graph_from_DOM-462"><a href="#pyRdfa.graph_from_DOM-462"><span class="linenos">462</span></a><span class="sd">        @type graph: rdflib Graph instance.</span>
</span><span id="pyRdfa.graph_from_DOM-463"><a href="#pyRdfa.graph_from_DOM-463"><span class="linenos">463</span></a><span class="sd">        @keyword pgraph: an RDF Graph to hold (possibly) the processor graph content. If None, and the error/warning triples are to be generated, they will be added to the returned graph. Otherwise they are stored in this graph.</span>
</span><span id="pyRdfa.graph_from_DOM-464"><a href="#pyRdfa.graph_from_DOM-464"><span class="linenos">464</span></a><span class="sd">        @type pgraph: rdflib Graph instance</span>
</span><span id="pyRdfa.graph_from_DOM-465"><a href="#pyRdfa.graph_from_DOM-465"><span class="linenos">465</span></a><span class="sd">        @return: an RDF Graph</span>
</span><span id="pyRdfa.graph_from_DOM-466"><a href="#pyRdfa.graph_from_DOM-466"><span class="linenos">466</span></a><span class="sd">        @rtype: rdflib Graph instance</span>
</span><span id="pyRdfa.graph_from_DOM-467"><a href="#pyRdfa.graph_from_DOM-467"><span class="linenos">467</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="pyRdfa.graph_from_DOM-468"><a href="#pyRdfa.graph_from_DOM-468"><span class="linenos">468</span></a>        <span class="k">def</span> <span class="nf">copyGraph</span><span class="p">(</span><span class="n">tog</span><span class="p">,</span> <span class="n">fromg</span><span class="p">):</span>
</span><span id="pyRdfa.graph_from_DOM-469"><a href="#pyRdfa.graph_from_DOM-469"><span class="linenos">469</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">fromg</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_DOM-470"><a href="#pyRdfa.graph_from_DOM-470"><span class="linenos">470</span></a>                <span class="n">tog</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_DOM-471"><a href="#pyRdfa.graph_from_DOM-471"><span class="linenos">471</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">ns</span> <span class="ow">in</span> <span class="n">fromg</span><span class="o">.</span><span class="n">namespaces</span><span class="p">():</span>
</span><span id="pyRdfa.graph_from_DOM-472"><a href="#pyRdfa.graph_from_DOM-472"><span class="linenos">472</span></a>                <span class="n">tog</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">ns</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_DOM-473"><a href="#pyRdfa.graph_from_DOM-473"><span class="linenos">473</span></a>
</span><span id="pyRdfa.graph_from_DOM-474"><a href="#pyRdfa.graph_from_DOM-474"><span class="linenos">474</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_DOM-475"><a href="#pyRdfa.graph_from_DOM-475"><span class="linenos">475</span></a>            <span class="c1"># Create the RDF Graph, that will contain the return triples...</span>
</span><span id="pyRdfa.graph_from_DOM-476"><a href="#pyRdfa.graph_from_DOM-476"><span class="linenos">476</span></a>            <span class="n">graph</span>   <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
</span><span id="pyRdfa.graph_from_DOM-477"><a href="#pyRdfa.graph_from_DOM-477"><span class="linenos">477</span></a>
</span><span id="pyRdfa.graph_from_DOM-478"><a href="#pyRdfa.graph_from_DOM-478"><span class="linenos">478</span></a>        <span class="c1"># this will collect the content, the &#39;default graph&#39;, as called in the RDFa spec</span>
</span><span id="pyRdfa.graph_from_DOM-479"><a href="#pyRdfa.graph_from_DOM-479"><span class="linenos">479</span></a>        <span class="n">default_graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
</span><span id="pyRdfa.graph_from_DOM-480"><a href="#pyRdfa.graph_from_DOM-480"><span class="linenos">480</span></a>
</span><span id="pyRdfa.graph_from_DOM-481"><a href="#pyRdfa.graph_from_DOM-481"><span class="linenos">481</span></a>        <span class="c1"># get the DOM tree</span>
</span><span id="pyRdfa.graph_from_DOM-482"><a href="#pyRdfa.graph_from_DOM-482"><span class="linenos">482</span></a>        <span class="n">topElement</span> <span class="o">=</span> <span class="n">dom</span><span class="o">.</span><span class="n">documentElement</span>
</span><span id="pyRdfa.graph_from_DOM-483"><a href="#pyRdfa.graph_from_DOM-483"><span class="linenos">483</span></a>
</span><span id="pyRdfa.graph_from_DOM-484"><a href="#pyRdfa.graph_from_DOM-484"><span class="linenos">484</span></a>        <span class="c1"># Create the initial state. This takes care of things</span>
</span><span id="pyRdfa.graph_from_DOM-485"><a href="#pyRdfa.graph_from_DOM-485"><span class="linenos">485</span></a>        <span class="c1"># like base, top level namespace settings, etc.</span>
</span><span id="pyRdfa.graph_from_DOM-486"><a href="#pyRdfa.graph_from_DOM-486"><span class="linenos">486</span></a>        <span class="n">state</span> <span class="o">=</span> <span class="n">ExecutionContext</span><span class="p">(</span><span class="n">topElement</span><span class="p">,</span> <span class="n">default_graph</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">required_base</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_base</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">,</span> <span class="n">rdfa_version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_DOM-487"><a href="#pyRdfa.graph_from_DOM-487"><span class="linenos">487</span></a>
</span><span id="pyRdfa.graph_from_DOM-488"><a href="#pyRdfa.graph_from_DOM-488"><span class="linenos">488</span></a>        <span class="c1"># Perform the built-in and external transformations on the HTML tree.</span>
</span><span id="pyRdfa.graph_from_DOM-489"><a href="#pyRdfa.graph_from_DOM-489"><span class="linenos">489</span></a>        <span class="k">for</span> <span class="n">trans</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">transformers</span> <span class="o">+</span> <span class="n">builtInTransformers</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_DOM-490"><a href="#pyRdfa.graph_from_DOM-490"><span class="linenos">490</span></a>            <span class="n">trans</span><span class="p">(</span><span class="n">topElement</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_DOM-491"><a href="#pyRdfa.graph_from_DOM-491"><span class="linenos">491</span></a>
</span><span id="pyRdfa.graph_from_DOM-492"><a href="#pyRdfa.graph_from_DOM-492"><span class="linenos">492</span></a>        <span class="c1"># This may have changed if the state setting detected an explicit version information:</span>
</span><span id="pyRdfa.graph_from_DOM-493"><a href="#pyRdfa.graph_from_DOM-493"><span class="linenos">493</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">rdfa_version</span>
</span><span id="pyRdfa.graph_from_DOM-494"><a href="#pyRdfa.graph_from_DOM-494"><span class="linenos">494</span></a>
</span><span id="pyRdfa.graph_from_DOM-495"><a href="#pyRdfa.graph_from_DOM-495"><span class="linenos">495</span></a>        <span class="c1"># The top level subject starts with the current document; this</span>
</span><span id="pyRdfa.graph_from_DOM-496"><a href="#pyRdfa.graph_from_DOM-496"><span class="linenos">496</span></a>        <span class="c1"># is used by the recursion</span>
</span><span id="pyRdfa.graph_from_DOM-497"><a href="#pyRdfa.graph_from_DOM-497"><span class="linenos">497</span></a>        <span class="c1"># this function is the real workhorse</span>
</span><span id="pyRdfa.graph_from_DOM-498"><a href="#pyRdfa.graph_from_DOM-498"><span class="linenos">498</span></a>        <span class="n">parse_one_node</span><span class="p">(</span><span class="n">topElement</span><span class="p">,</span> <span class="n">default_graph</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="pyRdfa.graph_from_DOM-499"><a href="#pyRdfa.graph_from_DOM-499"><span class="linenos">499</span></a>
</span><span id="pyRdfa.graph_from_DOM-500"><a href="#pyRdfa.graph_from_DOM-500"><span class="linenos">500</span></a>        <span class="c1"># Massage the output graph in term of rdfa:Pattern and rdfa:copy</span>
</span><span id="pyRdfa.graph_from_DOM-501"><a href="#pyRdfa.graph_from_DOM-501"><span class="linenos">501</span></a>        <span class="n">handle_prototypes</span><span class="p">(</span><span class="n">default_graph</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_DOM-502"><a href="#pyRdfa.graph_from_DOM-502"><span class="linenos">502</span></a>
</span><span id="pyRdfa.graph_from_DOM-503"><a href="#pyRdfa.graph_from_DOM-503"><span class="linenos">503</span></a>        <span class="c1"># If the RDFS expansion has to be made, here is the place...</span>
</span><span id="pyRdfa.graph_from_DOM-504"><a href="#pyRdfa.graph_from_DOM-504"><span class="linenos">504</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">vocab_expansion</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_DOM-505"><a href="#pyRdfa.graph_from_DOM-505"><span class="linenos">505</span></a>            <span class="kn">from</span> <span class="nn">.rdfs.process</span> <span class="kn">import</span> <span class="n">process_rdfa_sem</span>
</span><span id="pyRdfa.graph_from_DOM-506"><a href="#pyRdfa.graph_from_DOM-506"><span class="linenos">506</span></a>            <span class="n">process_rdfa_sem</span><span class="p">(</span><span class="n">default_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_DOM-507"><a href="#pyRdfa.graph_from_DOM-507"><span class="linenos">507</span></a>
</span><span id="pyRdfa.graph_from_DOM-508"><a href="#pyRdfa.graph_from_DOM-508"><span class="linenos">508</span></a>        <span class="c1"># Experimental feature: nothing for now, this is kept as a placeholder</span>
</span><span id="pyRdfa.graph_from_DOM-509"><a href="#pyRdfa.graph_from_DOM-509"><span class="linenos">509</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">experimental_features</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_DOM-510"><a href="#pyRdfa.graph_from_DOM-510"><span class="linenos">510</span></a>            <span class="k">pass</span>
</span><span id="pyRdfa.graph_from_DOM-511"><a href="#pyRdfa.graph_from_DOM-511"><span class="linenos">511</span></a>
</span><span id="pyRdfa.graph_from_DOM-512"><a href="#pyRdfa.graph_from_DOM-512"><span class="linenos">512</span></a>        <span class="c1"># What should be returned depends on the way the options have been set up</span>
</span><span id="pyRdfa.graph_from_DOM-513"><a href="#pyRdfa.graph_from_DOM-513"><span class="linenos">513</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">output_default_graph</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_DOM-514"><a href="#pyRdfa.graph_from_DOM-514"><span class="linenos">514</span></a>            <span class="n">copyGraph</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">default_graph</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_DOM-515"><a href="#pyRdfa.graph_from_DOM-515"><span class="linenos">515</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">output_processor_graph</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_DOM-516"><a href="#pyRdfa.graph_from_DOM-516"><span class="linenos">516</span></a>                <span class="k">if</span> <span class="n">pgraph</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_DOM-517"><a href="#pyRdfa.graph_from_DOM-517"><span class="linenos">517</span></a>                    <span class="n">copyGraph</span><span class="p">(</span><span class="n">pgraph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_DOM-518"><a href="#pyRdfa.graph_from_DOM-518"><span class="linenos">518</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_DOM-519"><a href="#pyRdfa.graph_from_DOM-519"><span class="linenos">519</span></a>                    <span class="n">copyGraph</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_DOM-520"><a href="#pyRdfa.graph_from_DOM-520"><span class="linenos">520</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">output_processor_graph</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_DOM-521"><a href="#pyRdfa.graph_from_DOM-521"><span class="linenos">521</span></a>            <span class="k">if</span> <span class="n">pgraph</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_DOM-522"><a href="#pyRdfa.graph_from_DOM-522"><span class="linenos">522</span></a>                <span class="n">copyGraph</span><span class="p">(</span><span class="n">pgraph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_DOM-523"><a href="#pyRdfa.graph_from_DOM-523"><span class="linenos">523</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_DOM-524"><a href="#pyRdfa.graph_from_DOM-524"><span class="linenos">524</span></a>                <span class="n">copyGraph</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_DOM-525"><a href="#pyRdfa.graph_from_DOM-525"><span class="linenos">525</span></a>
</span><span id="pyRdfa.graph_from_DOM-526"><a href="#pyRdfa.graph_from_DOM-526"><span class="linenos">526</span></a>        <span class="c1"># this is necessary if several DOM trees are handled in a row...</span>
</span><span id="pyRdfa.graph_from_DOM-527"><a href="#pyRdfa.graph_from_DOM-527"><span class="linenos">527</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">reset_processor_graph</span><span class="p">()</span>
</span><span id="pyRdfa.graph_from_DOM-528"><a href="#pyRdfa.graph_from_DOM-528"><span class="linenos">528</span></a>
</span><span id="pyRdfa.graph_from_DOM-529"><a href="#pyRdfa.graph_from_DOM-529"><span class="linenos">529</span></a>        <span class="k">return</span> <span class="n">graph</span>
</span></pre></div>


            <div class="docstring"><p>Extract the RDF Graph from a DOM tree. This is where the real processing happens. All other methods get down to this
one, eventually (e.g., after opening a URI and parsing it into a DOM).
@param dom: a DOM Node element, the top level entry node for the whole tree (i.e., the C{dom.documentElement} is used to initiate processing down the node hierarchy)
@keyword graph: an RDF Graph (if None, than a new one is created)
@type graph: rdflib Graph instance.
@keyword pgraph: an RDF Graph to hold (possibly) the processor graph content. If None, and the error/warning triples are to be generated, they will be added to the returned graph. Otherwise they are stored in this graph.
@type pgraph: rdflib Graph instance
@return: an RDF Graph
@rtype: rdflib Graph instance</p>
</div>


                            </div>
                            <div id="pyRdfa.graph_from_source" class="classattr">
                                        <input id="pyRdfa.graph_from_source-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">graph_from_source</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">name</span>, </span><span class="param"><span class="n">graph</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">rdfOutput</span><span class="o">=</span><span class="kc">False</span>, </span><span class="param"><span class="n">pgraph</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="pyRdfa.graph_from_source-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#pyRdfa.graph_from_source"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="pyRdfa.graph_from_source-531"><a href="#pyRdfa.graph_from_source-531"><span class="linenos">531</span></a>    <span class="k">def</span> <span class="nf">graph_from_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rdfOutput</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">pgraph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="pyRdfa.graph_from_source-532"><a href="#pyRdfa.graph_from_source-532"><span class="linenos">532</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="pyRdfa.graph_from_source-533"><a href="#pyRdfa.graph_from_source-533"><span class="linenos">533</span></a><span class="sd">        Extract an RDF graph from an RDFa source. The source is parsed, the RDF extracted, and the RDFa Graph is</span>
</span><span id="pyRdfa.graph_from_source-534"><a href="#pyRdfa.graph_from_source-534"><span class="linenos">534</span></a><span class="sd">        returned. This is a front-end to the L{pyRdfa.graph_from_DOM} method.</span>
</span><span id="pyRdfa.graph_from_source-535"><a href="#pyRdfa.graph_from_source-535"><span class="linenos">535</span></a>
</span><span id="pyRdfa.graph_from_source-536"><a href="#pyRdfa.graph_from_source-536"><span class="linenos">536</span></a><span class="sd">        @param name: a URI, a file name, or a file-like object</span>
</span><span id="pyRdfa.graph_from_source-537"><a href="#pyRdfa.graph_from_source-537"><span class="linenos">537</span></a><span class="sd">        @param graph: rdflib Graph instance. If None, a new one is created.</span>
</span><span id="pyRdfa.graph_from_source-538"><a href="#pyRdfa.graph_from_source-538"><span class="linenos">538</span></a><span class="sd">        @param pgraph: rdflib Graph instance for the processor graph. If None, and the error/warning triples are to be generated, they will be added to the returned graph. Otherwise they are stored in this graph.</span>
</span><span id="pyRdfa.graph_from_source-539"><a href="#pyRdfa.graph_from_source-539"><span class="linenos">539</span></a><span class="sd">        @param rdfOutput: whether runtime exceptions should be turned into RDF and returned as part of the processor graph</span>
</span><span id="pyRdfa.graph_from_source-540"><a href="#pyRdfa.graph_from_source-540"><span class="linenos">540</span></a><span class="sd">        @return: an RDF Graph</span>
</span><span id="pyRdfa.graph_from_source-541"><a href="#pyRdfa.graph_from_source-541"><span class="linenos">541</span></a><span class="sd">        @rtype: rdflib Graph instance</span>
</span><span id="pyRdfa.graph_from_source-542"><a href="#pyRdfa.graph_from_source-542"><span class="linenos">542</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="pyRdfa.graph_from_source-543"><a href="#pyRdfa.graph_from_source-543"><span class="linenos">543</span></a>        <span class="k">def</span> <span class="nf">copyErrors</span><span class="p">(</span><span class="n">tog</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="pyRdfa.graph_from_source-544"><a href="#pyRdfa.graph_from_source-544"><span class="linenos">544</span></a>            <span class="k">if</span> <span class="n">tog</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-545"><a href="#pyRdfa.graph_from_source-545"><span class="linenos">545</span></a>                <span class="n">tog</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
</span><span id="pyRdfa.graph_from_source-546"><a href="#pyRdfa.graph_from_source-546"><span class="linenos">546</span></a>            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">output_processor_graph</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-547"><a href="#pyRdfa.graph_from_source-547"><span class="linenos">547</span></a>                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">graph</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-548"><a href="#pyRdfa.graph_from_source-548"><span class="linenos">548</span></a>                    <span class="n">tog</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-549"><a href="#pyRdfa.graph_from_source-549"><span class="linenos">549</span></a>                    <span class="k">if</span> <span class="n">pgraph</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">pgraph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-550"><a href="#pyRdfa.graph_from_source-550"><span class="linenos">550</span></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">ns</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">namespaces</span><span class="p">():</span>
</span><span id="pyRdfa.graph_from_source-551"><a href="#pyRdfa.graph_from_source-551"><span class="linenos">551</span></a>                    <span class="n">tog</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">ns</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-552"><a href="#pyRdfa.graph_from_source-552"><span class="linenos">552</span></a>                    <span class="k">if</span> <span class="n">pgraph</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">pgraph</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">ns</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-553"><a href="#pyRdfa.graph_from_source-553"><span class="linenos">553</span></a>            <span class="n">options</span><span class="o">.</span><span class="n">reset_processor_graph</span><span class="p">()</span>
</span><span id="pyRdfa.graph_from_source-554"><a href="#pyRdfa.graph_from_source-554"><span class="linenos">554</span></a>            <span class="k">return</span> <span class="n">tog</span>
</span><span id="pyRdfa.graph_from_source-555"><a href="#pyRdfa.graph_from_source-555"><span class="linenos">555</span></a>
</span><span id="pyRdfa.graph_from_source-556"><a href="#pyRdfa.graph_from_source-556"><span class="linenos">556</span></a>        <span class="n">isstring</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-557"><a href="#pyRdfa.graph_from_source-557"><span class="linenos">557</span></a>
</span><span id="pyRdfa.graph_from_source-558"><a href="#pyRdfa.graph_from_source-558"><span class="linenos">558</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-559"><a href="#pyRdfa.graph_from_source-559"><span class="linenos">559</span></a>            <span class="c1"># First, open the source... Possible HTTP errors are returned as error triples</span>
</span><span id="pyRdfa.graph_from_source-560"><a href="#pyRdfa.graph_from_source-560"><span class="linenos">560</span></a>            <span class="n">stream</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="pyRdfa.graph_from_source-561"><a href="#pyRdfa.graph_from_source-561"><span class="linenos">561</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-562"><a href="#pyRdfa.graph_from_source-562"><span class="linenos">562</span></a>                <span class="n">stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_input</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-563"><a href="#pyRdfa.graph_from_source-563"><span class="linenos">563</span></a>            <span class="k">except</span> <span class="n">FailedSource</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-564"><a href="#pyRdfa.graph_from_source-564"><span class="linenos">564</span></a>                <span class="n">_f</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="pyRdfa.graph_from_source-565"><a href="#pyRdfa.graph_from_source-565"><span class="linenos">565</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="mi">400</span>
</span><span id="pyRdfa.graph_from_source-566"><a href="#pyRdfa.graph_from_source-566"><span class="linenos">566</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">rdfOutput</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-567"><a href="#pyRdfa.graph_from_source-567"><span class="linenos">567</span></a>                <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">msg</span><span class="p">,</span> <span class="n">FileReferenceError</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-568"><a href="#pyRdfa.graph_from_source-568"><span class="linenos">568</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">add_http_context</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-569"><a href="#pyRdfa.graph_from_source-569"><span class="linenos">569</span></a>                <span class="k">return</span> <span class="n">copyErrors</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-570"><a href="#pyRdfa.graph_from_source-570"><span class="linenos">570</span></a>            <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-571"><a href="#pyRdfa.graph_from_source-571"><span class="linenos">571</span></a>                <span class="n">h</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="pyRdfa.graph_from_source-572"><a href="#pyRdfa.graph_from_source-572"><span class="linenos">572</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">http_code</span>
</span><span id="pyRdfa.graph_from_source-573"><a href="#pyRdfa.graph_from_source-573"><span class="linenos">573</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">rdfOutput</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-574"><a href="#pyRdfa.graph_from_source-574"><span class="linenos">574</span></a>                <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="s2">&quot;HTTP Error: </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">http_code</span><span class="p">,</span><span class="n">h</span><span class="o">.</span><span class="n">msg</span><span class="p">),</span> <span class="n">HTError</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-575"><a href="#pyRdfa.graph_from_source-575"><span class="linenos">575</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">add_http_context</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">http_code</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-576"><a href="#pyRdfa.graph_from_source-576"><span class="linenos">576</span></a>                <span class="k">return</span> <span class="n">copyErrors</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-577"><a href="#pyRdfa.graph_from_source-577"><span class="linenos">577</span></a>            <span class="k">except</span> <span class="n">RDFaError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-578"><a href="#pyRdfa.graph_from_source-578"><span class="linenos">578</span></a>                <span class="n">e</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="pyRdfa.graph_from_source-579"><a href="#pyRdfa.graph_from_source-579"><span class="linenos">579</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="mi">500</span>
</span><span id="pyRdfa.graph_from_source-580"><a href="#pyRdfa.graph_from_source-580"><span class="linenos">580</span></a>                <span class="c1"># Something nasty happened:-(</span>
</span><span id="pyRdfa.graph_from_source-581"><a href="#pyRdfa.graph_from_source-581"><span class="linenos">581</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">rdfOutput</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-582"><a href="#pyRdfa.graph_from_source-582"><span class="linenos">582</span></a>                <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">msg</span><span class="p">),</span> <span class="n">context</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-583"><a href="#pyRdfa.graph_from_source-583"><span class="linenos">583</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">add_http_context</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-584"><a href="#pyRdfa.graph_from_source-584"><span class="linenos">584</span></a>                <span class="k">return</span> <span class="n">copyErrors</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-585"><a href="#pyRdfa.graph_from_source-585"><span class="linenos">585</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-586"><a href="#pyRdfa.graph_from_source-586"><span class="linenos">586</span></a>                <span class="n">e</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="pyRdfa.graph_from_source-587"><a href="#pyRdfa.graph_from_source-587"><span class="linenos">587</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="mi">500</span>
</span><span id="pyRdfa.graph_from_source-588"><a href="#pyRdfa.graph_from_source-588"><span class="linenos">588</span></a>                <span class="c1"># Something nasty happened:-(</span>
</span><span id="pyRdfa.graph_from_source-589"><a href="#pyRdfa.graph_from_source-589"><span class="linenos">589</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">rdfOutput</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">ex</span>
</span><span id="pyRdfa.graph_from_source-590"><a href="#pyRdfa.graph_from_source-590"><span class="linenos">590</span></a>                <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">context</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-591"><a href="#pyRdfa.graph_from_source-591"><span class="linenos">591</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">add_http_context</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-592"><a href="#pyRdfa.graph_from_source-592"><span class="linenos">592</span></a>                <span class="k">return</span> <span class="n">copyErrors</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-593"><a href="#pyRdfa.graph_from_source-593"><span class="linenos">593</span></a>
</span><span id="pyRdfa.graph_from_source-594"><a href="#pyRdfa.graph_from_source-594"><span class="linenos">594</span></a>            <span class="n">dom</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="pyRdfa.graph_from_source-595"><a href="#pyRdfa.graph_from_source-595"><span class="linenos">595</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-596"><a href="#pyRdfa.graph_from_source-596"><span class="linenos">596</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="pyRdfa.graph_from_source-597"><a href="#pyRdfa.graph_from_source-597"><span class="linenos">597</span></a>                <span class="n">parser</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="pyRdfa.graph_from_source-598"><a href="#pyRdfa.graph_from_source-598"><span class="linenos">598</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">host_language</span> <span class="o">==</span> <span class="n">HostLanguage</span><span class="o">.</span><span class="n">html5</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-599"><a href="#pyRdfa.graph_from_source-599"><span class="linenos">599</span></a>                    <span class="kn">import</span> <span class="nn">warnings</span>
</span><span id="pyRdfa.graph_from_source-600"><a href="#pyRdfa.graph_from_source-600"><span class="linenos">600</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-601"><a href="#pyRdfa.graph_from_source-601"><span class="linenos">601</span></a>                    <span class="kn">from</span> <span class="nn">html5lib</span> <span class="kn">import</span> <span class="n">HTMLParser</span><span class="p">,</span> <span class="n">treebuilders</span>
</span><span id="pyRdfa.graph_from_source-602"><a href="#pyRdfa.graph_from_source-602"><span class="linenos">602</span></a>                    <span class="n">parser</span> <span class="o">=</span> <span class="n">HTMLParser</span><span class="p">(</span><span class="n">tree</span><span class="o">=</span><span class="n">treebuilders</span><span class="o">.</span><span class="n">getTreeBuilder</span><span class="p">(</span><span class="s2">&quot;dom&quot;</span><span class="p">))</span>
</span><span id="pyRdfa.graph_from_source-603"><a href="#pyRdfa.graph_from_source-603"><span class="linenos">603</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charset</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-604"><a href="#pyRdfa.graph_from_source-604"><span class="linenos">604</span></a>                        <span class="c1"># This means the HTTP header has provided a charset, or the</span>
</span><span id="pyRdfa.graph_from_source-605"><a href="#pyRdfa.graph_from_source-605"><span class="linenos">605</span></a>                        <span class="c1"># file is a local file when we suppose it to be a utf-8</span>
</span><span id="pyRdfa.graph_from_source-606"><a href="#pyRdfa.graph_from_source-606"><span class="linenos">606</span></a>                        <span class="c1">#</span>
</span><span id="pyRdfa.graph_from_source-607"><a href="#pyRdfa.graph_from_source-607"><span class="linenos">607</span></a>                        <span class="c1"># 2020-01-20, Ivan Herman</span>
</span><span id="pyRdfa.graph_from_source-608"><a href="#pyRdfa.graph_from_source-608"><span class="linenos">608</span></a>                        <span class="c1">#   for some reasons the python3 version ran into a problem with this html5lib call</span>
</span><span id="pyRdfa.graph_from_source-609"><a href="#pyRdfa.graph_from_source-609"><span class="linenos">609</span></a>                        <span class="c1">#   the override_encoding argument was not accepted.</span>
</span><span id="pyRdfa.graph_from_source-610"><a href="#pyRdfa.graph_from_source-610"><span class="linenos">610</span></a>                        <span class="c1"># dom = parser.parse(stream, override_encoding=self.charset)</span>
</span><span id="pyRdfa.graph_from_source-611"><a href="#pyRdfa.graph_from_source-611"><span class="linenos">611</span></a>                        <span class="n">dom</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-612"><a href="#pyRdfa.graph_from_source-612"><span class="linenos">612</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-613"><a href="#pyRdfa.graph_from_source-613"><span class="linenos">613</span></a>                        <span class="c1"># No charset set. The HTMLLib parser tries to sniff into the</span>
</span><span id="pyRdfa.graph_from_source-614"><a href="#pyRdfa.graph_from_source-614"><span class="linenos">614</span></a>                        <span class="c1"># the file to find a meta header for the charset; if that</span>
</span><span id="pyRdfa.graph_from_source-615"><a href="#pyRdfa.graph_from_source-615"><span class="linenos">615</span></a>                        <span class="c1"># works, fine, otherwise it falls back on window-...</span>
</span><span id="pyRdfa.graph_from_source-616"><a href="#pyRdfa.graph_from_source-616"><span class="linenos">616</span></a>                        <span class="n">dom</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-617"><a href="#pyRdfa.graph_from_source-617"><span class="linenos">617</span></a>
</span><span id="pyRdfa.graph_from_source-618"><a href="#pyRdfa.graph_from_source-618"><span class="linenos">618</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-619"><a href="#pyRdfa.graph_from_source-619"><span class="linenos">619</span></a>                        <span class="k">if</span> <span class="n">isstring</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-620"><a href="#pyRdfa.graph_from_source-620"><span class="linenos">620</span></a>                            <span class="n">stream</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="pyRdfa.graph_from_source-621"><a href="#pyRdfa.graph_from_source-621"><span class="linenos">621</span></a>                            <span class="n">stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_input</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-622"><a href="#pyRdfa.graph_from_source-622"><span class="linenos">622</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-623"><a href="#pyRdfa.graph_from_source-623"><span class="linenos">623</span></a>                            <span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-624"><a href="#pyRdfa.graph_from_source-624"><span class="linenos">624</span></a>                        <span class="kn">from</span> <span class="nn">.host</span> <span class="kn">import</span> <span class="n">adjust_html_version</span>
</span><span id="pyRdfa.graph_from_source-625"><a href="#pyRdfa.graph_from_source-625"><span class="linenos">625</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span> <span class="o">=</span> <span class="n">adjust_html_version</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-626"><a href="#pyRdfa.graph_from_source-626"><span class="linenos">626</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-627"><a href="#pyRdfa.graph_from_source-627"><span class="linenos">627</span></a>                        <span class="c1"># if anything goes wrong, it is not really important; rdfa version stays what it was...</span>
</span><span id="pyRdfa.graph_from_source-628"><a href="#pyRdfa.graph_from_source-628"><span class="linenos">628</span></a>                        <span class="k">pass</span>
</span><span id="pyRdfa.graph_from_source-629"><a href="#pyRdfa.graph_from_source-629"><span class="linenos">629</span></a>
</span><span id="pyRdfa.graph_from_source-630"><a href="#pyRdfa.graph_from_source-630"><span class="linenos">630</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-631"><a href="#pyRdfa.graph_from_source-631"><span class="linenos">631</span></a>                    <span class="kn">from</span> <span class="nn">.host</span> <span class="kn">import</span> <span class="n">adjust_xhtml_and_version</span>
</span><span id="pyRdfa.graph_from_source-632"><a href="#pyRdfa.graph_from_source-632"><span class="linenos">632</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">IOBase</span><span class="p">):</span>
</span><span id="pyRdfa.graph_from_source-633"><a href="#pyRdfa.graph_from_source-633"><span class="linenos">633</span></a>                        <span class="n">parse</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">dom</span><span class="o">.</span><span class="n">minidom</span><span class="o">.</span><span class="n">parse</span>
</span><span id="pyRdfa.graph_from_source-634"><a href="#pyRdfa.graph_from_source-634"><span class="linenos">634</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-635"><a href="#pyRdfa.graph_from_source-635"><span class="linenos">635</span></a>                        <span class="n">parse</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">dom</span><span class="o">.</span><span class="n">minidom</span><span class="o">.</span><span class="n">parseString</span>
</span><span id="pyRdfa.graph_from_source-636"><a href="#pyRdfa.graph_from_source-636"><span class="linenos">636</span></a>                    <span class="n">dom</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-637"><a href="#pyRdfa.graph_from_source-637"><span class="linenos">637</span></a>                    <span class="n">adjusted_host_language</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="n">adjust_xhtml_and_version</span><span class="p">(</span><span class="n">dom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">host_language</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-638"><a href="#pyRdfa.graph_from_source-638"><span class="linenos">638</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">host_language</span> <span class="o">=</span> <span class="n">adjusted_host_language</span>
</span><span id="pyRdfa.graph_from_source-639"><a href="#pyRdfa.graph_from_source-639"><span class="linenos">639</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">rdfa_version</span> <span class="o">=</span> <span class="n">version</span>
</span><span id="pyRdfa.graph_from_source-640"><a href="#pyRdfa.graph_from_source-640"><span class="linenos">640</span></a>            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-641"><a href="#pyRdfa.graph_from_source-641"><span class="linenos">641</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;HTML5 parser not available. Try installing html5lib &lt;http://code.google.com/p/html5lib&gt;&quot;</span>
</span><span id="pyRdfa.graph_from_source-642"><a href="#pyRdfa.graph_from_source-642"><span class="linenos">642</span></a>                <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-643"><a href="#pyRdfa.graph_from_source-643"><span class="linenos">643</span></a>            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-644"><a href="#pyRdfa.graph_from_source-644"><span class="linenos">644</span></a>                <span class="n">e</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="pyRdfa.graph_from_source-645"><a href="#pyRdfa.graph_from_source-645"><span class="linenos">645</span></a>                <span class="c1"># These are various parsing exception. Per spec, this is a case when</span>
</span><span id="pyRdfa.graph_from_source-646"><a href="#pyRdfa.graph_from_source-646"><span class="linenos">646</span></a>                <span class="c1"># error triples MUST be returned, ie, the usage of rdfOutput (which switches between an HTML formatted</span>
</span><span id="pyRdfa.graph_from_source-647"><a href="#pyRdfa.graph_from_source-647"><span class="linenos">647</span></a>                <span class="c1"># return page or a graph with error triples) does not apply</span>
</span><span id="pyRdfa.graph_from_source-648"><a href="#pyRdfa.graph_from_source-648"><span class="linenos">648</span></a>                <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">context</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-649"><a href="#pyRdfa.graph_from_source-649"><span class="linenos">649</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="mi">400</span>
</span><span id="pyRdfa.graph_from_source-650"><a href="#pyRdfa.graph_from_source-650"><span class="linenos">650</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">add_http_context</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-651"><a href="#pyRdfa.graph_from_source-651"><span class="linenos">651</span></a>                <span class="k">return</span> <span class="n">copyErrors</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-652"><a href="#pyRdfa.graph_from_source-652"><span class="linenos">652</span></a>
</span><span id="pyRdfa.graph_from_source-653"><a href="#pyRdfa.graph_from_source-653"><span class="linenos">653</span></a>            <span class="c1"># If we got here, we have a DOM tree to operate on...</span>
</span><span id="pyRdfa.graph_from_source-654"><a href="#pyRdfa.graph_from_source-654"><span class="linenos">654</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_from_DOM</span><span class="p">(</span><span class="n">dom</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">pgraph</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-655"><a href="#pyRdfa.graph_from_source-655"><span class="linenos">655</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-656"><a href="#pyRdfa.graph_from_source-656"><span class="linenos">656</span></a>            <span class="c1"># Something nasty happened during the generation of the graph...</span>
</span><span id="pyRdfa.graph_from_source-657"><a href="#pyRdfa.graph_from_source-657"><span class="linenos">657</span></a>            <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
</span><span id="pyRdfa.graph_from_source-658"><a href="#pyRdfa.graph_from_source-658"><span class="linenos">658</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-659"><a href="#pyRdfa.graph_from_source-659"><span class="linenos">659</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="ne">ImportError</span><span class="p">):</span>
</span><span id="pyRdfa.graph_from_source-660"><a href="#pyRdfa.graph_from_source-660"><span class="linenos">660</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="pyRdfa.graph_from_source-661"><a href="#pyRdfa.graph_from_source-661"><span class="linenos">661</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="pyRdfa.graph_from_source-662"><a href="#pyRdfa.graph_from_source-662"><span class="linenos">662</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="mi">500</span>
</span><span id="pyRdfa.graph_from_source-663"><a href="#pyRdfa.graph_from_source-663"><span class="linenos">663</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">rdfOutput</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">b</span>
</span><span id="pyRdfa.graph_from_source-664"><a href="#pyRdfa.graph_from_source-664"><span class="linenos">664</span></a>            <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">context</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-665"><a href="#pyRdfa.graph_from_source-665"><span class="linenos">665</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">processor_graph</span><span class="o">.</span><span class="n">add_http_context</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
</span><span id="pyRdfa.graph_from_source-666"><a href="#pyRdfa.graph_from_source-666"><span class="linenos">666</span></a>            <span class="k">return</span> <span class="n">copyErrors</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Extract an RDF graph from an RDFa source. The source is parsed, the RDF extracted, and the RDFa Graph is
returned. This is a front-end to the L{<a href="#pyRdfa.graph_from_DOM">pyRdfa.graph_from_DOM</a>} method.</p>

<p>@param name: a URI, a file name, or a file-like object
@param graph: rdflib Graph instance. If None, a new one is created.
@param pgraph: rdflib Graph instance for the processor graph. If None, and the error/warning triples are to be generated, they will be added to the returned graph. Otherwise they are stored in this graph.
@param rdfOutput: whether runtime exceptions should be turned into RDF and returned as part of the processor graph
@return: an RDF Graph
@rtype: rdflib Graph instance</p>
</div>


                            </div>
                            <div id="pyRdfa.rdf_from_sources" class="classattr">
                                        <input id="pyRdfa.rdf_from_sources-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rdf_from_sources</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">names</span>, </span><span class="param"><span class="n">outputFormat</span><span class="o">=</span><span class="s1">&#39;turtle&#39;</span>, </span><span class="param"><span class="n">rdfOutput</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="pyRdfa.rdf_from_sources-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#pyRdfa.rdf_from_sources"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="pyRdfa.rdf_from_sources-668"><a href="#pyRdfa.rdf_from_sources-668"><span class="linenos">668</span></a>    <span class="k">def</span> <span class="nf">rdf_from_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">outputFormat</span> <span class="o">=</span> <span class="s2">&quot;turtle&quot;</span><span class="p">,</span> <span class="n">rdfOutput</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="pyRdfa.rdf_from_sources-669"><a href="#pyRdfa.rdf_from_sources-669"><span class="linenos">669</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="pyRdfa.rdf_from_sources-670"><a href="#pyRdfa.rdf_from_sources-670"><span class="linenos">670</span></a><span class="sd">        Extract and RDF graph from a list of RDFa sources and serialize them in one graph. The sources are parsed, the RDF</span>
</span><span id="pyRdfa.rdf_from_sources-671"><a href="#pyRdfa.rdf_from_sources-671"><span class="linenos">671</span></a><span class="sd">        extracted, and serialization is done in the specified format.</span>
</span><span id="pyRdfa.rdf_from_sources-672"><a href="#pyRdfa.rdf_from_sources-672"><span class="linenos">672</span></a><span class="sd">        @param names: list of sources, each can be a URI, a file name, or a file-like object</span>
</span><span id="pyRdfa.rdf_from_sources-673"><a href="#pyRdfa.rdf_from_sources-673"><span class="linenos">673</span></a><span class="sd">        @keyword outputFormat: serialization format. Can be one of &quot;turtle&quot;, &quot;n3&quot;, &quot;xml&quot;, &quot;pretty-xml&quot;, &quot;nt&quot;. &quot;xml&quot;, &quot;pretty-xml&quot;, &quot;json&quot; or &quot;json-ld&quot;. &quot;turtle&quot; and &quot;n3&quot;, &quot;xml&quot; and &quot;pretty-xml&quot;, and &quot;json&quot; and &quot;json-ld&quot; are synonyms, respectively. Note that the JSON-LD serialization works with RDFLib 3.* only.</span>
</span><span id="pyRdfa.rdf_from_sources-674"><a href="#pyRdfa.rdf_from_sources-674"><span class="linenos">674</span></a><span class="sd">        @keyword rdfOutput: controls what happens in case an exception is raised. If the value is False, the caller is responsible handling it; otherwise a graph is returned with an error message included in the processor graph</span>
</span><span id="pyRdfa.rdf_from_sources-675"><a href="#pyRdfa.rdf_from_sources-675"><span class="linenos">675</span></a><span class="sd">        @type rdfOutput: boolean</span>
</span><span id="pyRdfa.rdf_from_sources-676"><a href="#pyRdfa.rdf_from_sources-676"><span class="linenos">676</span></a><span class="sd">        @return: a serialized RDF Graph</span>
</span><span id="pyRdfa.rdf_from_sources-677"><a href="#pyRdfa.rdf_from_sources-677"><span class="linenos">677</span></a><span class="sd">        @rtype: string</span>
</span><span id="pyRdfa.rdf_from_sources-678"><a href="#pyRdfa.rdf_from_sources-678"><span class="linenos">678</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="pyRdfa.rdf_from_sources-679"><a href="#pyRdfa.rdf_from_sources-679"><span class="linenos">679</span></a>        <span class="c1"># protection against possible malicious URL call</span>
</span><span id="pyRdfa.rdf_from_sources-680"><a href="#pyRdfa.rdf_from_sources-680"><span class="linenos">680</span></a>        <span class="n">outputFormat</span> <span class="o">=</span> <span class="n">pyRdfa</span><span class="o">.</span><span class="n">_validate_output_format</span><span class="p">(</span><span class="n">outputFormat</span><span class="p">);</span>
</span><span id="pyRdfa.rdf_from_sources-681"><a href="#pyRdfa.rdf_from_sources-681"><span class="linenos">681</span></a>
</span><span id="pyRdfa.rdf_from_sources-682"><a href="#pyRdfa.rdf_from_sources-682"><span class="linenos">682</span></a>        <span class="c1"># This is better because it gives access to the various, non-standard serializations</span>
</span><span id="pyRdfa.rdf_from_sources-683"><a href="#pyRdfa.rdf_from_sources-683"><span class="linenos">683</span></a>        <span class="c1"># If it does not work because the extra are not installed, fall back to the standard</span>
</span><span id="pyRdfa.rdf_from_sources-684"><a href="#pyRdfa.rdf_from_sources-684"><span class="linenos">684</span></a>        <span class="c1"># rdlib distribution...</span>
</span><span id="pyRdfa.rdf_from_sources-685"><a href="#pyRdfa.rdf_from_sources-685"><span class="linenos">685</span></a>        <span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
</span><span id="pyRdfa.rdf_from_sources-686"><a href="#pyRdfa.rdf_from_sources-686"><span class="linenos">686</span></a>
</span><span id="pyRdfa.rdf_from_sources-687"><a href="#pyRdfa.rdf_from_sources-687"><span class="linenos">687</span></a>        <span class="c1"># graph.bind(&quot;xsd&quot;, Namespace(&#39;http://www.w3.org/2001/XMLSchema#&#39;))</span>
</span><span id="pyRdfa.rdf_from_sources-688"><a href="#pyRdfa.rdf_from_sources-688"><span class="linenos">688</span></a>        <span class="c1"># the value of rdfOutput determines the reaction on exceptions...</span>
</span><span id="pyRdfa.rdf_from_sources-689"><a href="#pyRdfa.rdf_from_sources-689"><span class="linenos">689</span></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
</span><span id="pyRdfa.rdf_from_sources-690"><a href="#pyRdfa.rdf_from_sources-690"><span class="linenos">690</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_from_source</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">rdfOutput</span><span class="p">)</span>
</span><span id="pyRdfa.rdf_from_sources-691"><a href="#pyRdfa.rdf_from_sources-691"><span class="linenos">691</span></a>
</span><span id="pyRdfa.rdf_from_sources-692"><a href="#pyRdfa.rdf_from_sources-692"><span class="linenos">692</span></a>        <span class="c1"># Stupid difference between python2 and python3...</span>
</span><span id="pyRdfa.rdf_from_sources-693"><a href="#pyRdfa.rdf_from_sources-693"><span class="linenos">693</span></a>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="n">outputFormat</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Extract and RDF graph from a list of RDFa sources and serialize them in one graph. The sources are parsed, the RDF
extracted, and serialization is done in the specified format.
@param names: list of sources, each can be a URI, a file name, or a file-like object
@keyword outputFormat: serialization format. Can be one of "turtle", "n3", "xml", "pretty-xml", "nt". "xml", "pretty-xml", "json" or "json-ld". "turtle" and "n3", "xml" and "pretty-xml", and "json" and "json-ld" are synonyms, respectively. Note that the JSON-LD serialization works with RDFLib 3.* only.
@keyword rdfOutput: controls what happens in case an exception is raised. If the value is False, the caller is responsible handling it; otherwise a graph is returned with an error message included in the processor graph
@type rdfOutput: boolean
@return: a serialized RDF Graph
@rtype: string</p>
</div>


                            </div>
                            <div id="pyRdfa.rdf_from_source" class="classattr">
                                        <input id="pyRdfa.rdf_from_source-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rdf_from_source</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">name</span>, </span><span class="param"><span class="n">outputFormat</span><span class="o">=</span><span class="s1">&#39;turtle&#39;</span>, </span><span class="param"><span class="n">rdfOutput</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="pyRdfa.rdf_from_source-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#pyRdfa.rdf_from_source"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="pyRdfa.rdf_from_source-696"><a href="#pyRdfa.rdf_from_source-696"><span class="linenos">696</span></a>    <span class="k">def</span> <span class="nf">rdf_from_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">outputFormat</span> <span class="o">=</span> <span class="s2">&quot;turtle&quot;</span><span class="p">,</span> <span class="n">rdfOutput</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="pyRdfa.rdf_from_source-697"><a href="#pyRdfa.rdf_from_source-697"><span class="linenos">697</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="pyRdfa.rdf_from_source-698"><a href="#pyRdfa.rdf_from_source-698"><span class="linenos">698</span></a><span class="sd">        Extract and RDF graph from an RDFa source and serialize it in one graph. The source is parsed, the RDF</span>
</span><span id="pyRdfa.rdf_from_source-699"><a href="#pyRdfa.rdf_from_source-699"><span class="linenos">699</span></a><span class="sd">        extracted, and serialization is done in the specified format.</span>
</span><span id="pyRdfa.rdf_from_source-700"><a href="#pyRdfa.rdf_from_source-700"><span class="linenos">700</span></a><span class="sd">        @param name: a URI, a file name, or a file-like object</span>
</span><span id="pyRdfa.rdf_from_source-701"><a href="#pyRdfa.rdf_from_source-701"><span class="linenos">701</span></a><span class="sd">        @keyword outputFormat: serialization format. Can be one of &quot;turtle&quot;, &quot;n3&quot;, &quot;xml&quot;, &quot;pretty-xml&quot;, &quot;nt&quot;. &quot;xml&quot;, &quot;pretty-xml&quot;, or &quot;json-ld&quot;. &quot;turtle&quot; and &quot;n3&quot;, or &quot;xml&quot; and &quot;pretty-xml&quot; are synonyms, respectively. Note that the JSON-LD serialization works with RDFLib 3.* only.</span>
</span><span id="pyRdfa.rdf_from_source-702"><a href="#pyRdfa.rdf_from_source-702"><span class="linenos">702</span></a><span class="sd">        @keyword rdfOutput: controls what happens in case an exception is raised. If the value is False, the caller is responsible handling it; otherwise a graph is returned with an error message included in the processor graph</span>
</span><span id="pyRdfa.rdf_from_source-703"><a href="#pyRdfa.rdf_from_source-703"><span class="linenos">703</span></a><span class="sd">        @type rdfOutput: boolean</span>
</span><span id="pyRdfa.rdf_from_source-704"><a href="#pyRdfa.rdf_from_source-704"><span class="linenos">704</span></a><span class="sd">        @return: a serialized RDF Graph</span>
</span><span id="pyRdfa.rdf_from_source-705"><a href="#pyRdfa.rdf_from_source-705"><span class="linenos">705</span></a><span class="sd">        @rtype: string</span>
</span><span id="pyRdfa.rdf_from_source-706"><a href="#pyRdfa.rdf_from_source-706"><span class="linenos">706</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="pyRdfa.rdf_from_source-707"><a href="#pyRdfa.rdf_from_source-707"><span class="linenos">707</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdf_from_sources</span><span class="p">([</span><span class="n">name</span><span class="p">],</span> <span class="n">outputFormat</span><span class="p">,</span> <span class="n">rdfOutput</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Extract and RDF graph from an RDFa source and serialize it in one graph. The source is parsed, the RDF
extracted, and serialization is done in the specified format.
@param name: a URI, a file name, or a file-like object
@keyword outputFormat: serialization format. Can be one of "turtle", "n3", "xml", "pretty-xml", "nt". "xml", "pretty-xml", or "json-ld". "turtle" and "n3", or "xml" and "pretty-xml" are synonyms, respectively. Note that the JSON-LD serialization works with RDFLib 3.* only.
@keyword rdfOutput: controls what happens in case an exception is raised. If the value is False, the caller is responsible handling it; otherwise a graph is returned with an error message included in the processor graph
@type rdfOutput: boolean
@return: a serialized RDF Graph
@rtype: string</p>
</div>


                            </div>
                </section>
                <section id="processURI">
                            <input id="processURI-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">processURI</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">uri</span>, </span><span class="param"><span class="n">outputFormat</span>, </span><span class="param"><span class="n">form</span><span class="o">=</span><span class="p">{}</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="processURI-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#processURI"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="processURI-710"><a href="#processURI-710"><span class="linenos">710</span></a><span class="k">def</span> <span class="nf">processURI</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">outputFormat</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="p">{}):</span>
</span><span id="processURI-711"><a href="#processURI-711"><span class="linenos">711</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The standard processing of an RDFa uri options in a form; used as an entry point from a CGI call.</span>
</span><span id="processURI-712"><a href="#processURI-712"><span class="linenos">712</span></a>
</span><span id="processURI-713"><a href="#processURI-713"><span class="linenos">713</span></a><span class="sd">    The call accepts extra form options (i.e., HTTP GET options) as follows:</span>
</span><span id="processURI-714"><a href="#processURI-714"><span class="linenos">714</span></a>
</span><span id="processURI-715"><a href="#processURI-715"><span class="linenos">715</span></a><span class="sd">     - C{graph=[output|processor|output,processor|processor,output]} specifying which graphs are returned. Default: C{output}</span>
</span><span id="processURI-716"><a href="#processURI-716"><span class="linenos">716</span></a><span class="sd">     - C{space_preserve=[true|false]} means that plain literals are normalized in terms of white spaces. Default: C{false}</span>
</span><span id="processURI-717"><a href="#processURI-717"><span class="linenos">717</span></a><span class="sd">     - C{rfa_version} provides the RDFa version that should be used for distilling. The string should be of the form &quot;1.0&quot; or &quot;1.1&quot;. Default is the highest version the current package implements, currently &quot;1.1&quot;</span>
</span><span id="processURI-718"><a href="#processURI-718"><span class="linenos">718</span></a><span class="sd">     - C{host_language=[xhtml,html,xml]} : the host language. Used when files are uploaded or text is added verbatim, otherwise the HTTP return header should be used. Default C{xml}</span>
</span><span id="processURI-719"><a href="#processURI-719"><span class="linenos">719</span></a><span class="sd">     - C{embedded_rdf=[true|false]} : whether embedded turtle or RDF/XML content should be added to the output graph. Default: C{false}</span>
</span><span id="processURI-720"><a href="#processURI-720"><span class="linenos">720</span></a><span class="sd">     - C{vocab_expansion=[true|false]} : whether the vocabularies should be expanded through the restricted RDFS entailment. Default: C{false}</span>
</span><span id="processURI-721"><a href="#processURI-721"><span class="linenos">721</span></a><span class="sd">     - C{vocab_cache=[true|false]} : whether vocab caching should be performed or whether it should be ignored and vocabulary files should be picked up every time. Default: C{false}</span>
</span><span id="processURI-722"><a href="#processURI-722"><span class="linenos">722</span></a><span class="sd">     - C{vocab_cache_report=[true|false]} : whether vocab caching details should be reported. Default: C{false}</span>
</span><span id="processURI-723"><a href="#processURI-723"><span class="linenos">723</span></a><span class="sd">     - C{vocab_cache_bypass=[true|false]} : whether vocab caches have to be regenerated every time. Default: C{false}</span>
</span><span id="processURI-724"><a href="#processURI-724"><span class="linenos">724</span></a><span class="sd">     - C{rdfa_lite=[true|false]} : whether warnings should be generated for non RDFa Lite attribute usage. Default: C{false}</span>
</span><span id="processURI-725"><a href="#processURI-725"><span class="linenos">725</span></a><span class="sd">     - C{certifi_verify=[true|false]} : whether the SSL certificate needs to be verified. Default: C{true}</span>
</span><span id="processURI-726"><a href="#processURI-726"><span class="linenos">726</span></a>
</span><span id="processURI-727"><a href="#processURI-727"><span class="linenos">727</span></a><span class="sd">    @param uri: URI to access. Note that the C{text:} and C{uploaded:} fake URI values are treated separately; the former is for textual intput (in which case a StringIO is used to get the data) and the latter is for uploaded file, where the form gives access to the file directly.</span>
</span><span id="processURI-728"><a href="#processURI-728"><span class="linenos">728</span></a><span class="sd">    @param outputFormat: serialization format, as defined by the package. Currently &quot;xml&quot;, &quot;turtle&quot;, &quot;nt&quot;, or &quot;json&quot;. Default is &quot;turtle&quot;, also used if any other string is given.</span>
</span><span id="processURI-729"><a href="#processURI-729"><span class="linenos">729</span></a><span class="sd">    @param form: extra call options (from the CGI call) to set up the local options</span>
</span><span id="processURI-730"><a href="#processURI-730"><span class="linenos">730</span></a><span class="sd">    @type form: cgi FieldStorage instance</span>
</span><span id="processURI-731"><a href="#processURI-731"><span class="linenos">731</span></a><span class="sd">    @return: serialized graph</span>
</span><span id="processURI-732"><a href="#processURI-732"><span class="linenos">732</span></a><span class="sd">    @rtype: string</span>
</span><span id="processURI-733"><a href="#processURI-733"><span class="linenos">733</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="processURI-734"><a href="#processURI-734"><span class="linenos">734</span></a>    <span class="k">def</span> <span class="nf">_get_option</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">compare_value</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
</span><span id="processURI-735"><a href="#processURI-735"><span class="linenos">735</span></a>        <span class="n">param_old</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
</span><span id="processURI-736"><a href="#processURI-736"><span class="linenos">736</span></a>        <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="processURI-737"><a href="#processURI-737"><span class="linenos">737</span></a>            <span class="n">val</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="processURI-738"><a href="#processURI-738"><span class="linenos">738</span></a>            <span class="k">return</span> <span class="n">val</span> <span class="o">==</span> <span class="n">compare_value</span>
</span><span id="processURI-739"><a href="#processURI-739"><span class="linenos">739</span></a>        <span class="k">elif</span> <span class="n">param_old</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="processURI-740"><a href="#processURI-740"><span class="linenos">740</span></a>            <span class="c1"># this is to ensure the old style parameters are still valid...</span>
</span><span id="processURI-741"><a href="#processURI-741"><span class="linenos">741</span></a>            <span class="c1"># in the old days I used &#39;-&#39; in the parameters, the standard favours &#39;_&#39;</span>
</span><span id="processURI-742"><a href="#processURI-742"><span class="linenos">742</span></a>            <span class="n">val</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="n">param_old</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="processURI-743"><a href="#processURI-743"><span class="linenos">743</span></a>            <span class="k">return</span> <span class="n">val</span> <span class="o">==</span> <span class="n">compare_value</span>
</span><span id="processURI-744"><a href="#processURI-744"><span class="linenos">744</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="processURI-745"><a href="#processURI-745"><span class="linenos">745</span></a>            <span class="k">return</span> <span class="n">default</span>
</span><span id="processURI-746"><a href="#processURI-746"><span class="linenos">746</span></a>
</span><span id="processURI-747"><a href="#processURI-747"><span class="linenos">747</span></a>    <span class="k">if</span> <span class="n">uri</span> <span class="o">==</span> <span class="s2">&quot;uploaded:&quot;</span><span class="p">:</span>
</span><span id="processURI-748"><a href="#processURI-748"><span class="linenos">748</span></a>        <span class="n">stream</span> <span class="o">=</span> <span class="n">form</span><span class="p">[</span><span class="s2">&quot;uploaded&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">file</span>
</span><span id="processURI-749"><a href="#processURI-749"><span class="linenos">749</span></a>        <span class="n">base</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="processURI-750"><a href="#processURI-750"><span class="linenos">750</span></a>    <span class="k">elif</span> <span class="n">uri</span> <span class="o">==</span> <span class="s2">&quot;text:&quot;</span><span class="p">:</span>
</span><span id="processURI-751"><a href="#processURI-751"><span class="linenos">751</span></a>        <span class="n">stream</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">))</span>
</span><span id="processURI-752"><a href="#processURI-752"><span class="linenos">752</span></a>        <span class="n">base</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="processURI-753"><a href="#processURI-753"><span class="linenos">753</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="processURI-754"><a href="#processURI-754"><span class="linenos">754</span></a>        <span class="n">stream</span> <span class="o">=</span> <span class="n">uri</span>
</span><span id="processURI-755"><a href="#processURI-755"><span class="linenos">755</span></a>        <span class="n">base</span> <span class="o">=</span> <span class="n">uri</span>
</span><span id="processURI-756"><a href="#processURI-756"><span class="linenos">756</span></a>
</span><span id="processURI-757"><a href="#processURI-757"><span class="linenos">757</span></a>    <span class="k">if</span> <span class="s2">&quot;rdfa_version&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="processURI-758"><a href="#processURI-758"><span class="linenos">758</span></a>        <span class="n">rdfa_version</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;rdfa_version&quot;</span><span class="p">)</span>
</span><span id="processURI-759"><a href="#processURI-759"><span class="linenos">759</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="processURI-760"><a href="#processURI-760"><span class="linenos">760</span></a>        <span class="n">rdfa_version</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="processURI-761"><a href="#processURI-761"><span class="linenos">761</span></a>
</span><span id="processURI-762"><a href="#processURI-762"><span class="linenos">762</span></a>    <span class="c1"># working through the possible options</span>
</span><span id="processURI-763"><a href="#processURI-763"><span class="linenos">763</span></a>    <span class="c1"># Host language: HTML, XHTML, or XML</span>
</span><span id="processURI-764"><a href="#processURI-764"><span class="linenos">764</span></a>    <span class="c1"># Note that these options should be used for the upload and inline version only in case of a form</span>
</span><span id="processURI-765"><a href="#processURI-765"><span class="linenos">765</span></a>    <span class="c1"># for real uris the returned content type should be used</span>
</span><span id="processURI-766"><a href="#processURI-766"><span class="linenos">766</span></a>    <span class="k">if</span> <span class="s2">&quot;host_language&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="processURI-767"><a href="#processURI-767"><span class="linenos">767</span></a>        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;host_language&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;xhtml&quot;</span><span class="p">:</span>
</span><span id="processURI-768"><a href="#processURI-768"><span class="linenos">768</span></a>            <span class="n">media_type</span> <span class="o">=</span> <span class="n">MediaTypes</span><span class="o">.</span><span class="n">xhtml</span>
</span><span id="processURI-769"><a href="#processURI-769"><span class="linenos">769</span></a>        <span class="k">elif</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;host_language&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;html&quot;</span><span class="p">:</span>
</span><span id="processURI-770"><a href="#processURI-770"><span class="linenos">770</span></a>            <span class="n">media_type</span> <span class="o">=</span> <span class="n">MediaTypes</span><span class="o">.</span><span class="n">html</span>
</span><span id="processURI-771"><a href="#processURI-771"><span class="linenos">771</span></a>        <span class="k">elif</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;host_language&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;svg&quot;</span><span class="p">:</span>
</span><span id="processURI-772"><a href="#processURI-772"><span class="linenos">772</span></a>            <span class="n">media_type</span> <span class="o">=</span> <span class="n">MediaTypes</span><span class="o">.</span><span class="n">svg</span>
</span><span id="processURI-773"><a href="#processURI-773"><span class="linenos">773</span></a>        <span class="k">elif</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;host_language&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
</span><span id="processURI-774"><a href="#processURI-774"><span class="linenos">774</span></a>            <span class="n">media_type</span> <span class="o">=</span> <span class="n">MediaTypes</span><span class="o">.</span><span class="n">atom</span>
</span><span id="processURI-775"><a href="#processURI-775"><span class="linenos">775</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="processURI-776"><a href="#processURI-776"><span class="linenos">776</span></a>            <span class="n">media_type</span> <span class="o">=</span> <span class="n">MediaTypes</span><span class="o">.</span><span class="n">xml</span>
</span><span id="processURI-777"><a href="#processURI-777"><span class="linenos">777</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="processURI-778"><a href="#processURI-778"><span class="linenos">778</span></a>        <span class="n">media_type</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="processURI-779"><a href="#processURI-779"><span class="linenos">779</span></a>
</span><span id="processURI-780"><a href="#processURI-780"><span class="linenos">780</span></a>    <span class="n">transformers</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="processURI-781"><a href="#processURI-781"><span class="linenos">781</span></a>
</span><span id="processURI-782"><a href="#processURI-782"><span class="linenos">782</span></a>    <span class="n">check_lite</span> <span class="o">=</span> <span class="s2">&quot;rdfa_lite&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;rdfa_lite&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span>
</span><span id="processURI-783"><a href="#processURI-783"><span class="linenos">783</span></a>
</span><span id="processURI-784"><a href="#processURI-784"><span class="linenos">784</span></a>    <span class="c1"># The code below is left for backward compatibility only. In fact, these options are not exposed any more,</span>
</span><span id="processURI-785"><a href="#processURI-785"><span class="linenos">785</span></a>    <span class="c1"># they are not really in use</span>
</span><span id="processURI-786"><a href="#processURI-786"><span class="linenos">786</span></a>    <span class="kn">from</span> <span class="nn">.transform.metaname</span> <span class="kn">import</span> <span class="n">meta_transform</span>
</span><span id="processURI-787"><a href="#processURI-787"><span class="linenos">787</span></a>    <span class="kn">from</span> <span class="nn">.transform.OpenID</span> <span class="kn">import</span> <span class="n">OpenID_transform</span>
</span><span id="processURI-788"><a href="#processURI-788"><span class="linenos">788</span></a>    <span class="kn">from</span> <span class="nn">.transform.DublinCore</span> <span class="kn">import</span> <span class="n">DC_transform</span>
</span><span id="processURI-789"><a href="#processURI-789"><span class="linenos">789</span></a>
</span><span id="processURI-790"><a href="#processURI-790"><span class="linenos">790</span></a>    <span class="k">if</span> <span class="s2">&quot;extras&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;extras&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
</span><span id="processURI-791"><a href="#processURI-791"><span class="linenos">791</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="n">OpenID_transform</span><span class="p">,</span> <span class="n">DC_transform</span><span class="p">,</span> <span class="n">meta_transform</span><span class="p">]:</span>
</span><span id="processURI-792"><a href="#processURI-792"><span class="linenos">792</span></a>            <span class="n">transformers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="processURI-793"><a href="#processURI-793"><span class="linenos">793</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="processURI-794"><a href="#processURI-794"><span class="linenos">794</span></a>        <span class="k">if</span> <span class="s2">&quot;extra-meta&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;extra-meta&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
</span><span id="processURI-795"><a href="#processURI-795"><span class="linenos">795</span></a>            <span class="n">transformers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meta_transform</span><span class="p">)</span>
</span><span id="processURI-796"><a href="#processURI-796"><span class="linenos">796</span></a>        <span class="k">if</span> <span class="s2">&quot;extra-openid&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;extra-openid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
</span><span id="processURI-797"><a href="#processURI-797"><span class="linenos">797</span></a>            <span class="n">transformers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OpenID_transform</span><span class="p">)</span>
</span><span id="processURI-798"><a href="#processURI-798"><span class="linenos">798</span></a>        <span class="k">if</span> <span class="s2">&quot;extra-dc&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;extra-dc&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
</span><span id="processURI-799"><a href="#processURI-799"><span class="linenos">799</span></a>            <span class="n">transformers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DC_transform</span><span class="p">)</span>
</span><span id="processURI-800"><a href="#processURI-800"><span class="linenos">800</span></a>
</span><span id="processURI-801"><a href="#processURI-801"><span class="linenos">801</span></a>    <span class="n">output_default_graph</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="processURI-802"><a href="#processURI-802"><span class="linenos">802</span></a>    <span class="n">output_processor_graph</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="processURI-803"><a href="#processURI-803"><span class="linenos">803</span></a>    <span class="c1"># Note that I use the &#39;graph&#39; and the &#39;rdfagraph&#39; form keys here. Reason is that</span>
</span><span id="processURI-804"><a href="#processURI-804"><span class="linenos">804</span></a>    <span class="c1"># I used &#39;graph&#39; in the previous versions, including the RDFa 1.0 processor,</span>
</span><span id="processURI-805"><a href="#processURI-805"><span class="linenos">805</span></a>    <span class="c1"># so if I removed that altogether that would create backward incompatibilities</span>
</span><span id="processURI-806"><a href="#processURI-806"><span class="linenos">806</span></a>    <span class="c1"># On the other hand, the RDFa 1.1 doc clearly refers to &#39;rdfagraph&#39; as the standard</span>
</span><span id="processURI-807"><a href="#processURI-807"><span class="linenos">807</span></a>    <span class="c1"># key.</span>
</span><span id="processURI-808"><a href="#processURI-808"><span class="linenos">808</span></a>    <span class="n">a</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="processURI-809"><a href="#processURI-809"><span class="linenos">809</span></a>    <span class="k">if</span> <span class="s2">&quot;graph&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="processURI-810"><a href="#processURI-810"><span class="linenos">810</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;graph&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="processURI-811"><a href="#processURI-811"><span class="linenos">811</span></a>    <span class="k">elif</span> <span class="s2">&quot;rdfagraph&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="processURI-812"><a href="#processURI-812"><span class="linenos">812</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;rdfagraph&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="processURI-813"><a href="#processURI-813"><span class="linenos">813</span></a>    <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="processURI-814"><a href="#processURI-814"><span class="linenos">814</span></a>        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;processor&quot;</span><span class="p">:</span>
</span><span id="processURI-815"><a href="#processURI-815"><span class="linenos">815</span></a>            <span class="n">output_default_graph</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="processURI-816"><a href="#processURI-816"><span class="linenos">816</span></a>            <span class="n">output_processor_graph</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="processURI-817"><a href="#processURI-817"><span class="linenos">817</span></a>        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;processor,output&quot;</span> <span class="ow">or</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;output,processor&quot;</span><span class="p">:</span>
</span><span id="processURI-818"><a href="#processURI-818"><span class="linenos">818</span></a>            <span class="n">output_processor_graph</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="processURI-819"><a href="#processURI-819"><span class="linenos">819</span></a>
</span><span id="processURI-820"><a href="#processURI-820"><span class="linenos">820</span></a>    <span class="n">embedded_rdf</span> <span class="o">=</span>        <span class="n">_get_option</span><span class="p">(</span> <span class="s2">&quot;embedded_rdf&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="processURI-821"><a href="#processURI-821"><span class="linenos">821</span></a>    <span class="n">space_preserve</span> <span class="o">=</span>      <span class="n">_get_option</span><span class="p">(</span> <span class="s2">&quot;space_preserve&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="processURI-822"><a href="#processURI-822"><span class="linenos">822</span></a>    <span class="n">vocab_cache</span> <span class="o">=</span>         <span class="n">_get_option</span><span class="p">(</span> <span class="s2">&quot;vocab_cache&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="processURI-823"><a href="#processURI-823"><span class="linenos">823</span></a>    <span class="n">vocab_cache_report</span> <span class="o">=</span>  <span class="n">_get_option</span><span class="p">(</span> <span class="s2">&quot;vocab_cache_report&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="processURI-824"><a href="#processURI-824"><span class="linenos">824</span></a>    <span class="n">refresh_vocab_cache</span> <span class="o">=</span> <span class="n">_get_option</span><span class="p">(</span> <span class="s2">&quot;vocab_cache_refresh&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="processURI-825"><a href="#processURI-825"><span class="linenos">825</span></a>    <span class="n">vocab_expansion</span> <span class="o">=</span>     <span class="n">_get_option</span><span class="p">(</span> <span class="s2">&quot;vocab_expansion&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="processURI-826"><a href="#processURI-826"><span class="linenos">826</span></a>    <span class="n">certifi_verify</span> <span class="o">=</span>      <span class="n">_get_option</span><span class="p">(</span> <span class="s2">&quot;certifi_verify&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="processURI-827"><a href="#processURI-827"><span class="linenos">827</span></a>    <span class="k">if</span> <span class="n">vocab_cache_report</span><span class="p">:</span>
</span><span id="processURI-828"><a href="#processURI-828"><span class="linenos">828</span></a>        <span class="n">output_processor_graph</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="processURI-829"><a href="#processURI-829"><span class="linenos">829</span></a>
</span><span id="processURI-830"><a href="#processURI-830"><span class="linenos">830</span></a>    <span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">(</span><span class="n">output_default_graph</span>   <span class="o">=</span> <span class="n">output_default_graph</span><span class="p">,</span>
</span><span id="processURI-831"><a href="#processURI-831"><span class="linenos">831</span></a>                      <span class="n">output_processor_graph</span> <span class="o">=</span> <span class="n">output_processor_graph</span><span class="p">,</span>
</span><span id="processURI-832"><a href="#processURI-832"><span class="linenos">832</span></a>                      <span class="n">space_preserve</span>         <span class="o">=</span> <span class="n">space_preserve</span><span class="p">,</span>
</span><span id="processURI-833"><a href="#processURI-833"><span class="linenos">833</span></a>                      <span class="n">transformers</span>           <span class="o">=</span> <span class="n">transformers</span><span class="p">,</span>
</span><span id="processURI-834"><a href="#processURI-834"><span class="linenos">834</span></a>                      <span class="n">vocab_cache</span>            <span class="o">=</span> <span class="n">vocab_cache</span><span class="p">,</span>
</span><span id="processURI-835"><a href="#processURI-835"><span class="linenos">835</span></a>                      <span class="n">vocab_cache_report</span>     <span class="o">=</span> <span class="n">vocab_cache_report</span><span class="p">,</span>
</span><span id="processURI-836"><a href="#processURI-836"><span class="linenos">836</span></a>                      <span class="n">refresh_vocab_cache</span>    <span class="o">=</span> <span class="n">refresh_vocab_cache</span><span class="p">,</span>
</span><span id="processURI-837"><a href="#processURI-837"><span class="linenos">837</span></a>                      <span class="n">vocab_expansion</span>        <span class="o">=</span> <span class="n">vocab_expansion</span><span class="p">,</span>
</span><span id="processURI-838"><a href="#processURI-838"><span class="linenos">838</span></a>                      <span class="n">embedded_rdf</span>           <span class="o">=</span> <span class="n">embedded_rdf</span><span class="p">,</span>
</span><span id="processURI-839"><a href="#processURI-839"><span class="linenos">839</span></a>                      <span class="n">check_lite</span>             <span class="o">=</span> <span class="n">check_lite</span><span class="p">,</span>
</span><span id="processURI-840"><a href="#processURI-840"><span class="linenos">840</span></a>                      <span class="n">certifi_verify</span>         <span class="o">=</span> <span class="n">certifi_verify</span><span class="p">)</span>
</span><span id="processURI-841"><a href="#processURI-841"><span class="linenos">841</span></a>
</span><span id="processURI-842"><a href="#processURI-842"><span class="linenos">842</span></a>    <span class="n">processor</span> <span class="o">=</span> <span class="n">pyRdfa</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="n">base</span><span class="p">,</span> <span class="n">media_type</span> <span class="o">=</span> <span class="n">media_type</span><span class="p">,</span> <span class="n">rdfa_version</span> <span class="o">=</span> <span class="n">rdfa_version</span><span class="p">)</span>
</span><span id="processURI-843"><a href="#processURI-843"><span class="linenos">843</span></a>
</span><span id="processURI-844"><a href="#processURI-844"><span class="linenos">844</span></a>    <span class="c1"># Decide the output format; the issue is what should happen in case of a top level error like an inaccessibility of</span>
</span><span id="processURI-845"><a href="#processURI-845"><span class="linenos">845</span></a>    <span class="c1"># the html source: should a graph be returned or an HTML page with an error message?</span>
</span><span id="processURI-846"><a href="#processURI-846"><span class="linenos">846</span></a>
</span><span id="processURI-847"><a href="#processURI-847"><span class="linenos">847</span></a>    <span class="c1"># decide whether HTML or RDF should be sent.</span>
</span><span id="processURI-848"><a href="#processURI-848"><span class="linenos">848</span></a>    <span class="n">htmlOutput</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="processURI-849"><a href="#processURI-849"><span class="linenos">849</span></a>    <span class="c1">#if &#39;HTTP_ACCEPT&#39; in os.environ:</span>
</span><span id="processURI-850"><a href="#processURI-850"><span class="linenos">850</span></a>    <span class="c1">#    acc = os.environ[&#39;HTTP_ACCEPT&#39;]</span>
</span><span id="processURI-851"><a href="#processURI-851"><span class="linenos">851</span></a>    <span class="c1">#    possibilities = [&#39;text/html&#39;,</span>
</span><span id="processURI-852"><a href="#processURI-852"><span class="linenos">852</span></a>    <span class="c1">#                     &#39;application/rdf+xml&#39;,</span>
</span><span id="processURI-853"><a href="#processURI-853"><span class="linenos">853</span></a>    <span class="c1">#                     &#39;text/turtle; charset=utf-8&#39;,</span>
</span><span id="processURI-854"><a href="#processURI-854"><span class="linenos">854</span></a>    <span class="c1">#                     &#39;application/json&#39;,</span>
</span><span id="processURI-855"><a href="#processURI-855"><span class="linenos">855</span></a>    <span class="c1">#                     &#39;application/ld+json&#39;,</span>
</span><span id="processURI-856"><a href="#processURI-856"><span class="linenos">856</span></a>    <span class="c1">#                     &#39;text/rdf+n3&#39;]</span>
</span><span id="processURI-857"><a href="#processURI-857"><span class="linenos">857</span></a>    <span class="c1">#</span>
</span><span id="processURI-858"><a href="#processURI-858"><span class="linenos">858</span></a>    <span class="c1">#    # this nice module does content negotiation and returns the preferred format</span>
</span><span id="processURI-859"><a href="#processURI-859"><span class="linenos">859</span></a>    <span class="c1">#    sg = acceptable_content_type(acc, possibilities)</span>
</span><span id="processURI-860"><a href="#processURI-860"><span class="linenos">860</span></a>    <span class="c1">#    htmlOutput = (sg != None and sg[0] == content_type(&#39;text/html&#39;))</span>
</span><span id="processURI-861"><a href="#processURI-861"><span class="linenos">861</span></a>    <span class="c1">#    os.environ[&#39;rdfaerror&#39;] = &#39;true&#39;</span>
</span><span id="processURI-862"><a href="#processURI-862"><span class="linenos">862</span></a>
</span><span id="processURI-863"><a href="#processURI-863"><span class="linenos">863</span></a>    <span class="c1"># This is really for testing purposes only, it is an unpublished flag to force RDF output no</span>
</span><span id="processURI-864"><a href="#processURI-864"><span class="linenos">864</span></a>    <span class="c1"># matter what</span>
</span><span id="processURI-865"><a href="#processURI-865"><span class="linenos">865</span></a>    <span class="kn">import</span> <span class="nn">html</span>
</span><span id="processURI-866"><a href="#processURI-866"><span class="linenos">866</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="processURI-867"><a href="#processURI-867"><span class="linenos">867</span></a>        <span class="n">outputFormat</span> <span class="o">=</span> <span class="n">pyRdfa</span><span class="o">.</span><span class="n">_validate_output_format</span><span class="p">(</span><span class="n">outputFormat</span><span class="p">);</span>
</span><span id="processURI-868"><a href="#processURI-868"><span class="linenos">868</span></a>        <span class="k">if</span> <span class="n">outputFormat</span> <span class="o">==</span> <span class="s2">&quot;n3&quot;</span><span class="p">:</span>
</span><span id="processURI-869"><a href="#processURI-869"><span class="linenos">869</span></a>            <span class="n">retval</span> <span class="o">=</span> <span class="s1">&#39;Content-Type: text/rdf+n3; charset=utf-8</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="processURI-870"><a href="#processURI-870"><span class="linenos">870</span></a>        <span class="k">elif</span> <span class="n">outputFormat</span> <span class="o">==</span> <span class="s2">&quot;nt&quot;</span> <span class="ow">or</span> <span class="n">outputFormat</span> <span class="o">==</span> <span class="s2">&quot;turtle&quot;</span><span class="p">:</span>
</span><span id="processURI-871"><a href="#processURI-871"><span class="linenos">871</span></a>            <span class="n">retval</span> <span class="o">=</span> <span class="s1">&#39;Content-Type: text/turtle; charset=utf-8</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="processURI-872"><a href="#processURI-872"><span class="linenos">872</span></a>        <span class="k">elif</span> <span class="n">outputFormat</span> <span class="o">==</span> <span class="s2">&quot;json-ld&quot;</span> <span class="ow">or</span> <span class="n">outputFormat</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
</span><span id="processURI-873"><a href="#processURI-873"><span class="linenos">873</span></a>            <span class="n">retval</span> <span class="o">=</span> <span class="s1">&#39;Content-Type: application/ld+json; charset=utf-8</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="processURI-874"><a href="#processURI-874"><span class="linenos">874</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="processURI-875"><a href="#processURI-875"><span class="linenos">875</span></a>            <span class="n">retval</span> <span class="o">=</span> <span class="s1">&#39;Content-Type: application/rdf+xml; charset=utf-8</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="processURI-876"><a href="#processURI-876"><span class="linenos">876</span></a>        <span class="n">graph</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">rdf_from_source</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">outputFormat</span><span class="p">,</span> <span class="n">rdfOutput</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;forceRDFOutput&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">htmlOutput</span><span class="p">)</span>
</span><span id="processURI-877"><a href="#processURI-877"><span class="linenos">877</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="processURI-878"><a href="#processURI-878"><span class="linenos">878</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="n">graph</span>
</span><span id="processURI-879"><a href="#processURI-879"><span class="linenos">879</span></a>        <span class="k">return</span> <span class="n">retval</span>
</span><span id="processURI-880"><a href="#processURI-880"><span class="linenos">880</span></a>    <span class="k">except</span> <span class="n">HTTPError</span><span class="p">:</span>
</span><span id="processURI-881"><a href="#processURI-881"><span class="linenos">881</span></a>        <span class="n">_type</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">_traceback</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
</span><span id="processURI-882"><a href="#processURI-882"><span class="linenos">882</span></a>
</span><span id="processURI-883"><a href="#processURI-883"><span class="linenos">883</span></a>        <span class="n">retval</span> <span class="o">=</span> <span class="s1">&#39;Content-type: text/html; charset=utf-8</span><span class="se">\n</span><span class="s1">Status: </span><span class="si">%s</span><span class="s1"> </span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">h</span><span class="o">.</span><span class="n">http_code</span>
</span><span id="processURI-884"><a href="#processURI-884"><span class="linenos">884</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;html&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="processURI-885"><a href="#processURI-885"><span class="linenos">885</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;head&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="processURI-886"><a href="#processURI-886"><span class="linenos">886</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;title&gt;HTTP Error in distilling RDFa content&lt;/title&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="processURI-887"><a href="#processURI-887"><span class="linenos">887</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/head&gt;&lt;body&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="processURI-888"><a href="#processURI-888"><span class="linenos">888</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h1&gt;HTTP Error in distilling RDFa content&lt;/h1&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="processURI-889"><a href="#processURI-889"><span class="linenos">889</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;p&gt;HTTP Error: </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&lt;/p&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">http_code</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
</span><span id="processURI-890"><a href="#processURI-890"><span class="linenos">890</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;p&gt;On URI: &lt;code&gt;&#39;</span><span class="si">%s</span><span class="s2">&#39;&lt;/code&gt;&lt;/p&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
</span><span id="processURI-891"><a href="#processURI-891"><span class="linenos">891</span></a>        <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;/body&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="processURI-892"><a href="#processURI-892"><span class="linenos">892</span></a>        <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;/html&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="processURI-893"><a href="#processURI-893"><span class="linenos">893</span></a>        <span class="k">return</span> <span class="n">retval</span>
</span><span id="processURI-894"><a href="#processURI-894"><span class="linenos">894</span></a>    <span class="k">except</span><span class="p">:</span>
</span><span id="processURI-895"><a href="#processURI-895"><span class="linenos">895</span></a>        <span class="c1"># This branch should occur only if an exception is really raised, ie, if it is not turned</span>
</span><span id="processURI-896"><a href="#processURI-896"><span class="linenos">896</span></a>        <span class="c1"># into a graph value.</span>
</span><span id="processURI-897"><a href="#processURI-897"><span class="linenos">897</span></a>        <span class="n">_type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">_traceback</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
</span><span id="processURI-898"><a href="#processURI-898"><span class="linenos">898</span></a>
</span><span id="processURI-899"><a href="#processURI-899"><span class="linenos">899</span></a>        <span class="kn">import</span> <span class="nn">traceback</span>
</span><span id="processURI-900"><a href="#processURI-900"><span class="linenos">900</span></a>
</span><span id="processURI-901"><a href="#processURI-901"><span class="linenos">901</span></a>        <span class="n">retval</span> <span class="o">=</span> <span class="s1">&#39;Content-type: text/html; charset=utf-8</span><span class="se">\n</span><span class="s1">Status: </span><span class="si">%s</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">processor</span><span class="o">.</span><span class="n">http_status</span>
</span><span id="processURI-902"><a href="#processURI-902"><span class="linenos">902</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;html&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="processURI-903"><a href="#processURI-903"><span class="linenos">903</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;head&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="processURI-904"><a href="#processURI-904"><span class="linenos">904</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;title&gt;Exception in RDFa processing&lt;/title&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="processURI-905"><a href="#processURI-905"><span class="linenos">905</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/head&gt;&lt;body&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="processURI-906"><a href="#processURI-906"><span class="linenos">906</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h1&gt;Exception in distilling RDFa&lt;/h1&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="processURI-907"><a href="#processURI-907"><span class="linenos">907</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="s2">&quot;&lt;pre&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="processURI-908"><a href="#processURI-908"><span class="linenos">908</span></a>        <span class="n">strio</span>  <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
</span><span id="processURI-909"><a href="#processURI-909"><span class="linenos">909</span></a>        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">strio</span><span class="p">)</span>
</span><span id="processURI-910"><a href="#processURI-910"><span class="linenos">910</span></a>        <span class="n">retval</span> <span class="o">+=</span> <span class="n">strio</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</span><span id="processURI-911"><a href="#processURI-911"><span class="linenos">911</span></a>        <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;/pre&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="processURI-912"><a href="#processURI-912"><span class="linenos">912</span></a>        <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;pre&gt;</span><span class="si">%s</span><span class="s2">&lt;/pre&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span>
</span><span id="processURI-913"><a href="#processURI-913"><span class="linenos">913</span></a>        <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;h1&gt;Distiller request details&lt;/h1&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="processURI-914"><a href="#processURI-914"><span class="linenos">914</span></a>        <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;dl&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="processURI-915"><a href="#processURI-915"><span class="linenos">915</span></a>        <span class="k">if</span> <span class="n">uri</span> <span class="o">==</span> <span class="s2">&quot;text:&quot;</span> <span class="ow">and</span> <span class="s2">&quot;text&quot;</span> <span class="ow">in</span> <span class="n">form</span> <span class="ow">and</span> <span class="n">form</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="processURI-916"><a href="#processURI-916"><span class="linenos">916</span></a>            <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;dt&gt;Text input:&lt;/dt&gt;&lt;dd&gt;</span><span class="si">%s</span><span class="s2">&lt;/dd&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;br/&gt;&#39;</span><span class="p">)</span>
</span><span id="processURI-917"><a href="#processURI-917"><span class="linenos">917</span></a>        <span class="k">elif</span> <span class="n">uri</span> <span class="o">==</span> <span class="s2">&quot;uploaded:&quot;</span><span class="p">:</span>
</span><span id="processURI-918"><a href="#processURI-918"><span class="linenos">918</span></a>            <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;dt&gt;Uploaded file&lt;/dt&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="processURI-919"><a href="#processURI-919"><span class="linenos">919</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="processURI-920"><a href="#processURI-920"><span class="linenos">920</span></a>            <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;dt&gt;URI received:&lt;/dt&gt;&lt;dd&gt;&lt;code&gt;&#39;</span><span class="si">%s</span><span class="s2">&#39;&lt;/code&gt;&lt;/dd&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
</span><span id="processURI-921"><a href="#processURI-921"><span class="linenos">921</span></a>        <span class="k">if</span> <span class="s2">&quot;host_language&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="processURI-922"><a href="#processURI-922"><span class="linenos">922</span></a>            <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;dt&gt;Media Type:&lt;/dt&gt;&lt;dd&gt;</span><span class="si">%s</span><span class="s2">&lt;/dd&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">media_type</span><span class="p">)</span>
</span><span id="processURI-923"><a href="#processURI-923"><span class="linenos">923</span></a>        <span class="k">if</span> <span class="s2">&quot;graph&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="processURI-924"><a href="#processURI-924"><span class="linenos">924</span></a>            <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;dt&gt;Requested graphs:&lt;/dt&gt;&lt;dd&gt;</span><span class="si">%s</span><span class="s2">&lt;/dd&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;graph&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="processURI-925"><a href="#processURI-925"><span class="linenos">925</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="processURI-926"><a href="#processURI-926"><span class="linenos">926</span></a>            <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;dt&gt;Requested graphs:&lt;/dt&gt;&lt;dd&gt;default&lt;/dd&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="processURI-927"><a href="#processURI-927"><span class="linenos">927</span></a>        <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;dt&gt;Output serialization format:&lt;/dt&gt;&lt;dd&gt; </span><span class="si">%s</span><span class="s2">&lt;/dd&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">outputFormat</span>
</span><span id="processURI-928"><a href="#processURI-928"><span class="linenos">928</span></a>        <span class="k">if</span> <span class="s2">&quot;space_preserve&quot;</span> <span class="ow">in</span> <span class="n">form</span> <span class="p">:</span> <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;dt&gt;Space preserve:&lt;/dt&gt;&lt;dd&gt; </span><span class="si">%s</span><span class="s2">&lt;/dd&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;space_preserve&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</span><span id="processURI-929"><a href="#processURI-929"><span class="linenos">929</span></a>        <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;/dl&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="processURI-930"><a href="#processURI-930"><span class="linenos">930</span></a>        <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;/body&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="processURI-931"><a href="#processURI-931"><span class="linenos">931</span></a>        <span class="n">retval</span> <span class="o">+=</span><span class="s2">&quot;&lt;/html&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="processURI-932"><a href="#processURI-932"><span class="linenos">932</span></a>        <span class="k">return</span> <span class="n">retval</span>
</span></pre></div>


            <div class="docstring"><p>The standard processing of an RDFa uri options in a form; used as an entry point from a CGI call.</p>

<p>The call accepts extra form options (i.e., HTTP GET options) as follows:</p>

<ul>
<li>C{graph=[output|processor|output,processor|processor,output]} specifying which graphs are returned. Default: C{output}</li>
<li>C{space_preserve=[true|false]} means that plain literals are normalized in terms of white spaces. Default: C{false}</li>
<li>C{rfa_version} provides the RDFa version that should be used for distilling. The string should be of the form "1.0" or "1.1". Default is the highest version the current package implements, currently "1.1"</li>
<li>C{host_language=[xhtml,html,xml]} : the host language. Used when files are uploaded or text is added verbatim, otherwise the HTTP return header should be used. Default C{xml}</li>
<li>C{embedded_rdf=[true|false]} : whether embedded turtle or RDF/XML content should be added to the output graph. Default: C{false}</li>
<li>C{vocab_expansion=[true|false]} : whether the vocabularies should be expanded through the restricted RDFS entailment. Default: C{false}</li>
<li>C{vocab_cache=[true|false]} : whether vocab caching should be performed or whether it should be ignored and vocabulary files should be picked up every time. Default: C{false}</li>
<li>C{vocab_cache_report=[true|false]} : whether vocab caching details should be reported. Default: C{false}</li>
<li>C{vocab_cache_bypass=[true|false]} : whether vocab caches have to be regenerated every time. Default: C{false}</li>
<li>C{rdfa_lite=[true|false]} : whether warnings should be generated for non RDFa Lite attribute usage. Default: C{false}</li>
<li>C{certifi_verify=[true|false]} : whether the SSL certificate needs to be verified. Default: C{true}</li>
</ul>

<p>@param uri: URI to access. Note that the C{text:} and C{uploaded:} fake URI values are treated separately; the former is for textual intput (in which case a StringIO is used to get the data) and the latter is for uploaded file, where the form gives access to the file directly.
@param outputFormat: serialization format, as defined by the package. Currently "xml", "turtle", "nt", or "json". Default is "turtle", also used if any other string is given.
@param form: extra call options (from the CGI call) to set up the local options
@type form: cgi FieldStorage instance
@return: serialized graph
@rtype: string</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>