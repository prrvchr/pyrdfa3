<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.3.0"/>
    <title>pyRdfa.extras.httpheader API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../extras.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;pyRdfa.extras</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#SEPARATORS">SEPARATORS</a>
            </li>
            <li>
                    <a class="variable" href="#LWS">LWS</a>
            </li>
            <li>
                    <a class="variable" href="#CRLF">CRLF</a>
            </li>
            <li>
                    <a class="variable" href="#DIGIT">DIGIT</a>
            </li>
            <li>
                    <a class="variable" href="#HEX">HEX</a>
            </li>
            <li>
                    <a class="variable" href="#PY3">PY3</a>
            </li>
            <li>
                    <a class="function" href="#http_datetime">http_datetime</a>
            </li>
            <li>
                    <a class="function" href="#parse_http_datetime">parse_http_datetime</a>
            </li>
            <li>
                    <a class="class" href="#RangeUnsatisfiableError">RangeUnsatisfiableError</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#RangeUnsatisfiableError.__init__">RangeUnsatisfiableError</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#RangeUnmergableError">RangeUnmergableError</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#RangeUnmergableError.__init__">RangeUnmergableError</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ParseError">ParseError</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ParseError.__init__">ParseError</a>
                        </li>
                        <li>
                                <a class="variable" href="#ParseError.input_string">input_string</a>
                        </li>
                        <li>
                                <a class="variable" href="#ParseError.at_position">at_position</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#is_token">is_token</a>
            </li>
            <li>
                    <a class="function" href="#parse_comma_list">parse_comma_list</a>
            </li>
            <li>
                    <a class="function" href="#parse_token">parse_token</a>
            </li>
            <li>
                    <a class="function" href="#quote_string">quote_string</a>
            </li>
            <li>
                    <a class="function" href="#parse_quoted_string">parse_quoted_string</a>
            </li>
            <li>
                    <a class="function" href="#parse_token_or_quoted_string">parse_token_or_quoted_string</a>
            </li>
            <li>
                    <a class="function" href="#remove_comments">remove_comments</a>
            </li>
            <li>
                    <a class="function" href="#parse_comment">parse_comment</a>
            </li>
            <li>
                    <a class="class" href="#range_spec">range_spec</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#range_spec.__init__">range_spec</a>
                        </li>
                        <li>
                                <a class="function" href="#range_spec.set">set</a>
                        </li>
                        <li>
                                <a class="function" href="#range_spec.copy">copy</a>
                        </li>
                        <li>
                                <a class="function" href="#range_spec.is_suffix">is_suffix</a>
                        </li>
                        <li>
                                <a class="function" href="#range_spec.is_fixed">is_fixed</a>
                        </li>
                        <li>
                                <a class="function" href="#range_spec.is_unbounded">is_unbounded</a>
                        </li>
                        <li>
                                <a class="function" href="#range_spec.is_whole_file">is_whole_file</a>
                        </li>
                        <li>
                                <a class="function" href="#range_spec.fix_to_size">fix_to_size</a>
                        </li>
                        <li>
                                <a class="function" href="#range_spec.merge_with">merge_with</a>
                        </li>
                        <li>
                                <a class="variable" href="#range_spec.first">first</a>
                        </li>
                        <li>
                                <a class="variable" href="#range_spec.last">last</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#range_set">range_set</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#range_set.units">units</a>
                        </li>
                        <li>
                                <a class="variable" href="#range_set.range_specs">range_specs</a>
                        </li>
                        <li>
                                <a class="function" href="#range_set.from_str">from_str</a>
                        </li>
                        <li>
                                <a class="function" href="#range_set.is_single_range">is_single_range</a>
                        </li>
                        <li>
                                <a class="function" href="#range_set.is_contiguous">is_contiguous</a>
                        </li>
                        <li>
                                <a class="function" href="#range_set.fix_to_size">fix_to_size</a>
                        </li>
                        <li>
                                <a class="function" href="#range_set.coalesce">coalesce</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#parse_number">parse_number</a>
            </li>
            <li>
                    <a class="function" href="#parse_range_spec">parse_range_spec</a>
            </li>
            <li>
                    <a class="function" href="#parse_range_header">parse_range_header</a>
            </li>
            <li>
                    <a class="function" href="#parse_range_set">parse_range_set</a>
            </li>
            <li>
                    <a class="function" href="#parse_qvalue_accept_list">parse_qvalue_accept_list</a>
            </li>
            <li>
                    <a class="function" href="#parse_accept_header">parse_accept_header</a>
            </li>
            <li>
                    <a class="function" href="#parse_media_type">parse_media_type</a>
            </li>
            <li>
                    <a class="function" href="#parse_parameter_list">parse_parameter_list</a>
            </li>
            <li>
                    <a class="class" href="#content_type">content_type</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#content_type.__init__">content_type</a>
                        </li>
                        <li>
                                <a class="function" href="#content_type.set_parameters">set_parameters</a>
                        </li>
                        <li>
                                <a class="function" href="#content_type.set">set</a>
                        </li>
                        <li>
                                <a class="variable" href="#content_type.major">major</a>
                        </li>
                        <li>
                                <a class="variable" href="#content_type.minor">minor</a>
                        </li>
                        <li>
                                <a class="variable" href="#content_type.media_type">media_type</a>
                        </li>
                        <li>
                                <a class="function" href="#content_type.is_wildcard">is_wildcard</a>
                        </li>
                        <li>
                                <a class="function" href="#content_type.is_universal_wildcard">is_universal_wildcard</a>
                        </li>
                        <li>
                                <a class="function" href="#content_type.is_composite">is_composite</a>
                        </li>
                        <li>
                                <a class="function" href="#content_type.is_xml">is_xml</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#content_formdata">content_formdata</a>
            </li>
            <li>
                    <a class="variable" href="#content_urlencoded">content_urlencoded</a>
            </li>
            <li>
                    <a class="variable" href="#content_byteranges">content_byteranges</a>
            </li>
            <li>
                    <a class="variable" href="#content_opaque">content_opaque</a>
            </li>
            <li>
                    <a class="variable" href="#content_html">content_html</a>
            </li>
            <li>
                    <a class="variable" href="#content_xhtml">content_xhtml</a>
            </li>
            <li>
                    <a class="function" href="#acceptable_content_type">acceptable_content_type</a>
            </li>
            <li>
                    <a class="variable" href="#character_set_aliases">character_set_aliases</a>
            </li>
            <li>
                    <a class="function" href="#canonical_charset">canonical_charset</a>
            </li>
            <li>
                    <a class="function" href="#acceptable_charset">acceptable_charset</a>
            </li>
            <li>
                    <a class="class" href="#language_tag">language_tag</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#language_tag.__init__">language_tag</a>
                        </li>
                        <li>
                                <a class="variable" href="#language_tag.parts">parts</a>
                        </li>
                        <li>
                                <a class="function" href="#language_tag.superior">superior</a>
                        </li>
                        <li>
                                <a class="function" href="#language_tag.all_superiors">all_superiors</a>
                        </li>
                        <li>
                                <a class="function" href="#language_tag.is_universal_wildcard">is_universal_wildcard</a>
                        </li>
                        <li>
                                <a class="function" href="#language_tag.dialect_of">dialect_of</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#parse_accept_language_header">parse_accept_language_header</a>
            </li>
            <li>
                    <a class="function" href="#acceptable_language">acceptable_language</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../pyRdfa.html">pyRdfa</a><wbr>.<a href="./../extras.html">extras</a><wbr>.httpheader    </h1>

                        <div class="docstring"><p>Utility functions to work with HTTP headers.</p>

<p>This module provides some utility functions useful for parsing
and dealing with some of the HTTP 1.1 protocol headers which
are not adequately covered by the standard Python libraries.</p>

<p>Requires Python 2.2 or later.</p>

<p>The functionality includes the correct interpretation of the various
Accept-* style headers, content negotiation, byte range requests,
HTTP-style date/times, and more.</p>

<p>There are a few classes defined by this module:</p>

<ul>
<li>class content_type   -- media types such as 'text/plain'</li>
<li>class language_tag   -- language tags such as 'en-US'</li>
<li>class range_set      -- a collection of (byte) range specifiers</li>
<li>class range_spec     -- a single (byte) range specifier</li>
</ul>

<p>The primary functions in this module may be categorized as follows:</p>

<ul>
<li><p>Content negotiation functions...</p>

<ul>
<li>acceptable_content_type()</li>
<li>acceptable_language()</li>
<li>acceptable_charset()</li>
<li>acceptable_encoding()</li>
</ul></li>
<li><p>Mid-level header parsing functions...</p>

<ul>
<li>parse_accept_header()</li>
<li>parse_accept_language_header()</li>
<li>parse_range_header()</li>
</ul></li>
<li><p>Date and time...</p>

<ul>
<li>http_datetime()</li>
<li>parse_http_datetime()</li>
</ul></li>
<li><p>Utility functions...</p>

<ul>
<li>quote_string()</li>
<li>remove_comments()</li>
<li>canonical_charset()</li>
</ul></li>
<li><p>Low level string parsing functions...</p>

<ul>
<li>parse_comma_list()</li>
<li>parse_comment()</li>
<li>parse_qvalue_accept_list()</li>
<li>parse_media_type()</li>
<li>parse_number()</li>
<li>parse_parameter_list()</li>
<li>parse_quoted_string()</li>
<li>parse_range_set()</li>
<li>parse_range_spec()</li>
<li>parse_token()</li>
<li>parse_token_or_quoted_string()</li>
</ul></li>
</ul>

<p>And there are some specialized exception classes:</p>

<ul>
<li>RangeUnsatisfiableError</li>
<li>RangeUnmergableError</li>
<li>ParseError</li>
</ul>

<p>See also:</p>

<ul>
<li>RFC 2616, "Hypertext Transfer Protocol -- HTTP/1.1", June 1999.
<a href="http://www.ietf.org/rfc/rfc2616.txt">http://www.ietf.org/rfc/rfc2616.txt</a>
Errata at <a href="http://purl.org/NET/http-errata">http://purl.org/NET/http-errata</a></li>
<li>RFC 2046, "(MIME) Part Two: Media Types", November 1996.
<a href="http://www.ietf.org/rfc/rfc2046.txt">http://www.ietf.org/rfc/rfc2046.txt</a></li>
<li><p>RFC 3066, "Tags for the Identification of Languages", January 2001.
        <a href="http://www.ietf.org/rfc/rfc3066.txt">http://www.ietf.org/rfc/rfc3066.txt</a></p>

<p>Note: I have made a small modification on the regexp for internet date, 
to make it more liberal (ie, accept a time zone string of the form +0000)
Ivan Herman <a href="http://www.ivan-herman.net">http://www.ivan-herman.net</a>, March 2011.</p>

<p>Have added statements to make it (hopefully) Python 3 compatible.
Ivan Herman <a href="http://www.ivan-herman.net">http://www.ivan-herman.net</a>, August 2012.</p></li>
</ul>
</div>

                        <input id="mod-httpheader-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-httpheader-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="ch">#!/usr/bin/env python</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="c1">#</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="sd">&quot;&quot;&quot; Utility functions to work with HTTP headers.</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd"> This module provides some utility functions useful for parsing</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="sd"> and dealing with some of the HTTP 1.1 protocol headers which</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="sd"> are not adequately covered by the standard Python libraries.</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="sd"> Requires Python 2.2 or later.</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="sd"> The functionality includes the correct interpretation of the various</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="sd"> Accept-* style headers, content negotiation, byte range requests,</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="sd"> HTTP-style date/times, and more.</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="sd"> There are a few classes defined by this module:</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="sd">   * class content_type   -- media types such as &#39;text/plain&#39;</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="sd">   * class language_tag   -- language tags such as &#39;en-US&#39;</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="sd">   * class range_set      -- a collection of (byte) range specifiers</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="sd">   * class range_spec     -- a single (byte) range specifier</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="sd"> The primary functions in this module may be categorized as follows:</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="sd">   * Content negotiation functions...</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="sd">     * acceptable_content_type()</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="sd">     * acceptable_language()</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="sd">     * acceptable_charset()</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="sd">     * acceptable_encoding()</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="sd">   * Mid-level header parsing functions...</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="sd">     * parse_accept_header()</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="sd">     * parse_accept_language_header()</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">     * parse_range_header()</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="sd"> </span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">   * Date and time...</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="sd">     * http_datetime()</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="sd">     * parse_http_datetime()</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="sd">   * Utility functions...</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="sd">     * quote_string()</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="sd">     * remove_comments()</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="sd">     * canonical_charset()</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="sd">   * Low level string parsing functions...</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">     * parse_comma_list()</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="sd">     * parse_comment()</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="sd">     * parse_qvalue_accept_list()</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="sd">     * parse_media_type()</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="sd">     * parse_number()</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="sd">     * parse_parameter_list()</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="sd">     * parse_quoted_string()</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="sd">     * parse_range_set()</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="sd">     * parse_range_spec()</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="sd">     * parse_token()</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="sd">     * parse_token_or_quoted_string()</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="sd"> And there are some specialized exception classes:</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="sd">   * RangeUnsatisfiableError</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a><span class="sd">   * RangeUnmergableError</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="sd">   * ParseError</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="sd"> See also:</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="sd">   * RFC 2616, &quot;Hypertext Transfer Protocol -- HTTP/1.1&quot;, June 1999.</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="sd">             &lt;http://www.ietf.org/rfc/rfc2616.txt&gt;</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="sd">             Errata at &lt;http://purl.org/NET/http-errata&gt;</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a><span class="sd">   * RFC 2046, &quot;(MIME) Part Two: Media Types&quot;, November 1996.</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="sd">             &lt;http://www.ietf.org/rfc/rfc2046.txt&gt;</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="sd">   * RFC 3066, &quot;Tags for the Identification of Languages&quot;, January 2001.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">             &lt;http://www.ietf.org/rfc/rfc3066.txt&gt;</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a><span class="sd">             </span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">             </span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a><span class="sd">  Note: I have made a small modification on the regexp for internet date, </span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="sd">  to make it more liberal (ie, accept a time zone string of the form +0000)</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="sd">  Ivan Herman &lt;http://www.ivan-herman.net&gt;, March 2011.</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="sd">  </span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="sd">  Have added statements to make it (hopefully) Python 3 compatible.</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="sd">  Ivan Herman &lt;http://www.ivan-herman.net&gt;, August 2012.</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Deron Meranda &lt;http://deron.meranda.us/&gt;&quot;</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;2012-08-31&quot;</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;1.02&quot;</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a><span class="n">__credits__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Copyright (c) 2005 Deron E. Meranda &lt;http://deron.meranda.us/&gt;</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a><span class="s2">Licensed under GNU LGPL 2.1 or later.  See &lt;http://www.fsf.org/&gt;.</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a><span class="s2">This library is free software; you can redistribute it and/or</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a><span class="s2">modify it under the terms of the GNU Lesser General Public</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="s2">License as published by the Free Software Foundation; either</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="s2">version 2.1 of the License, or (at your option) any later version.</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a><span class="s2">This library is distributed in the hope that it will be useful,</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a><span class="s2">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a><span class="s2">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a><span class="s2">Lesser General Public License for more details.</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a><span class="s2">You should have received a copy of the GNU Lesser General Public</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a><span class="s2">License along with this library; if not, write to the Free Software</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a><span class="s2">Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a><span class="c1"># Character classes from RFC 2616 section 2.2</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a><span class="n">SEPARATORS</span> <span class="o">=</span> <span class="s1">&#39;()&lt;&gt;@,;:</span><span class="se">\\</span><span class="s1">&quot;/[]?=</span><span class="si">{}</span><span class="s1"> </span><span class="se">\t</span><span class="s1">&#39;</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a><span class="n">LWS</span> <span class="o">=</span> <span class="s1">&#39; </span><span class="se">\t\n\r</span><span class="s1">&#39;</span>  <span class="c1"># linear white space</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a><span class="n">CRLF</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a><span class="n">DIGIT</span> <span class="o">=</span> <span class="s1">&#39;0123456789&#39;</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a><span class="n">HEX</span> <span class="o">=</span> <span class="s1">&#39;0123456789ABCDEFabcdef&#39;</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a><span class="kn">import</span> <span class="nn">sys</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a><span class="n">PY3</span> <span class="o">=</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a><span class="c1"># Try to get a set/frozenset implementation if possible</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="k">try</span><span class="p">:</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>    <span class="nb">type</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">)</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a><span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>        <span class="c1"># The demset.py module is available at http://deron.meranda.us/</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>        <span class="kn">from</span> <span class="nn">demset</span> <span class="kn">import</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">frozenset</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>        <span class="n">__emulating_set</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># So we can clean up global namespace later</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>        <span class="k">pass</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a><span class="k">try</span><span class="p">:</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>    <span class="c1"># Turn character classes into set types (for Python 2.4 or greater)</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>    <span class="n">SEPARATORS</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">SEPARATORS</span><span class="p">])</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>    <span class="n">LWS</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">])</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>    <span class="n">CRLF</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">CRLF</span><span class="p">])</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>    <span class="n">DIGIT</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">DIGIT</span><span class="p">])</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>    <span class="n">HEX</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">HEX</span><span class="p">])</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>    <span class="k">del</span> <span class="n">c</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a><span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>    <span class="c1"># Python 2.3 or earlier, leave as simple strings</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>    <span class="k">pass</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a><span class="k">def</span> <span class="nf">_is_string</span><span class="p">(</span> <span class="n">obj</span> <span class="p">):</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns True if the object is a string or unicode type.&quot;&quot;&quot;</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>    <span class="k">if</span> <span class="n">PY3</span> <span class="p">:</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>    <span class="k">else</span> <span class="p">:</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">unicode</span><span class="p">)</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="k">def</span> <span class="nf">http_datetime</span><span class="p">(</span> <span class="n">dt</span><span class="o">=</span><span class="kc">None</span> <span class="p">):</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Formats a datetime as an HTTP 1.1 Date/Time string.</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="sd">    Takes a standard Python datetime object and returns a string</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="sd">    formatted according to the HTTP 1.1 date/time format.</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="sd">    If no datetime is provided (or None) then the current</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="sd">    time is used.</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">    </span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a><span class="sd">    ABOUT TIMEZONES: If the passed in datetime object is naive it is</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a><span class="sd">    assumed to be in UTC already.  But if it has a tzinfo component,</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a><span class="sd">    the returned timestamp string will have been converted to UTC</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a><span class="sd">    automatically.  So if you use timezone-aware datetimes, you need</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a><span class="sd">    not worry about conversion to UTC.</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">dt</span><span class="p">:</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>        <span class="kn">import</span> <span class="nn">datetime</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>            <span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">-</span> <span class="n">dt</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">()</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>            <span class="k">pass</span>  <span class="c1"># no timezone offset, just assume already in UTC</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>    <span class="n">s</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%a</span><span class="s1">, </span><span class="si">%d</span><span class="s1"> %b %Y %H:%M:%S GMT&#39;</span><span class="p">)</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>    <span class="k">return</span> <span class="n">s</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a><span class="k">def</span> <span class="nf">parse_http_datetime</span><span class="p">(</span> <span class="n">datestring</span><span class="p">,</span> <span class="n">utc_tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span> <span class="p">):</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a datetime object from an HTTP 1.1 Date/Time string.</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="sd">    Note that HTTP dates are always in UTC, so the returned datetime</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="sd">    object will also be in UTC.</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a><span class="sd">    You can optionally pass in a tzinfo object which should represent</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a><span class="sd">    the UTC timezone, and the returned datetime will then be</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a><span class="sd">    timezone-aware (allowing you to more easly translate it into</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a><span class="sd">    different timzeones later).</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a><span class="sd">    If you set &#39;strict&#39; to True, then only the RFC 1123 format</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a><span class="sd">    is recognized.  Otherwise the backwards-compatible RFC 1036</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a><span class="sd">    and Unix asctime(3) formats are also recognized.</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a><span class="sd">    </span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a><span class="sd">    Please note that the day-of-the-week is not validated.</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a><span class="sd">    Also two-digit years, although not HTTP 1.1 compliant, are</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a><span class="sd">    treated according to recommended Y2K rules.</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>    <span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">datetime</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?P&lt;DOW&gt;[a-z]+), (?P&lt;D&gt;\d+) (?P&lt;MON&gt;[a-z]+) (?P&lt;Y&gt;\d+) (?P&lt;H&gt;\d+):(?P&lt;M&gt;\d+):(?P&lt;S&gt;\d+(\.\d+)?) (?P&lt;TZ&gt;[a-zA-Z0-9_+]+)$&#39;</span><span class="p">,</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>                 <span class="n">datestring</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">strict</span><span class="p">:</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?P&lt;DOW&gt;[a-z]+) (?P&lt;MON&gt;[a-z]+) (?P&lt;D&gt;\d+) (?P&lt;H&gt;\d+):(?P&lt;M&gt;\d+):(?P&lt;S&gt;\d+) (?P&lt;Y&gt;\d+)$&#39;</span><span class="p">,</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>                     <span class="n">datestring</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?P&lt;DOW&gt;[a-z]+), (?P&lt;D&gt;\d+)-(?P&lt;MON&gt;[a-z]+)-(?P&lt;Y&gt;\d+) (?P&lt;H&gt;\d+):(?P&lt;M&gt;\d+):(?P&lt;S&gt;\d+(\.\d+)?) (?P&lt;TZ&gt;\w+)$&#39;</span><span class="p">,</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>                         <span class="n">datestring</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;HTTP date is not correctly formatted&#39;</span><span class="p">)</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>        <span class="n">tz</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;TZ&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>    <span class="k">except</span><span class="p">:</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>        <span class="n">tz</span> <span class="o">=</span> <span class="s1">&#39;GMT&#39;</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>    <span class="k">if</span> <span class="n">tz</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;GMT&#39;</span><span class="p">,</span><span class="s1">&#39;UTC&#39;</span><span class="p">,</span><span class="s1">&#39;0000&#39;</span><span class="p">,</span><span class="s1">&#39;00:00&#39;</span><span class="p">):</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;HTTP date is not in GMT timezone&#39;</span><span class="p">)</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>    <span class="n">monname</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;MON&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>    <span class="n">mdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;JAN&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;FEB&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;MAR&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;APR&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;MAY&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;JUN&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>             <span class="s1">&#39;JUL&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;AUG&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;SEP&#39;</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;OCT&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;NOV&#39;</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;DEC&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">}</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>    <span class="n">month</span> <span class="o">=</span> <span class="n">mdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">monname</span><span class="p">)</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">month</span><span class="p">:</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;HTTP date has an unrecognizable month&#39;</span><span class="p">)</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>    <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">))</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>    <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>        <span class="n">century</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">year</span> <span class="o">/</span> <span class="mi">100</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>        <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">century</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">y</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">century</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">y</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>    <span class="n">d</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">))</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>    <span class="n">hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">))</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>    <span class="n">minute</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">))</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>        <span class="n">second</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">))</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>    <span class="k">except</span><span class="p">:</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>        <span class="n">second</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">))</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>    <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span> <span class="n">y</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">utc_tzinfo</span> <span class="p">)</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>    <span class="k">return</span> <span class="n">dt</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a><span class="k">class</span> <span class="nc">RangeUnsatisfiableError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Exception class when a byte range lies outside the file size boundaries.&quot;&quot;&quot;</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">reason</span><span class="p">:</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>            <span class="n">reason</span> <span class="o">=</span> <span class="s1">&#39;Range is unsatisfiable&#39;</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>        <span class="ne">ValueError</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a><span class="k">class</span> <span class="nc">RangeUnmergableError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Exception class when byte ranges are noncontiguous and can not be merged together.&quot;&quot;&quot;</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">reason</span><span class="p">:</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>            <span class="n">reason</span> <span class="o">=</span> <span class="s1">&#39;Ranges can not be merged together&#39;</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>        <span class="ne">ValueError</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a><span class="k">class</span> <span class="nc">ParseError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Exception class representing a string parsing error.&quot;&quot;&quot;</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">input_string</span><span class="p">,</span> <span class="n">at_position</span><span class="p">):</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>        <span class="ne">ValueError</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_string</span> <span class="o">=</span> <span class="n">input_string</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">at_position</span> <span class="o">=</span> <span class="n">at_position</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">at_position</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_string</span><span class="p">):</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n\t</span><span class="s1">Occured at end of string&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n\t</span><span class="s1">Occured near </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_string</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">at_position</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">at_position</span><span class="o">+</span><span class="mi">16</span><span class="p">]))</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a><span class="k">def</span> <span class="nf">is_token</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Determines if the string is a valid token.&quot;&quot;&quot;</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>        <span class="k">if</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">32</span> <span class="ow">or</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">128</span> <span class="ow">or</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">SEPARATORS</span><span class="p">:</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a><span class="k">def</span> <span class="nf">parse_comma_list</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">element_parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_count</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a comma-separated list with optional whitespace.</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a><span class="sd">    Takes an optional callback function `element_parser`, which</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a><span class="sd">    is assumed to be able to parse an individual element.  It</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a><span class="sd">    will be passed the string and a `start` argument, and</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a><span class="sd">    is expected to return a tuple (parsed_result, chars_consumed).</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a><span class="sd">    If no element_parser is given, then either single tokens or</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a><span class="sd">    quoted strings will be parsed.</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a><span class="sd">    If min_count &gt; 0, then at least that many non-empty elements</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a><span class="sd">    must be in the list, or an error is raised.</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a><span class="sd">    If max_count &gt; 0, then no more than that many non-empty elements</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a><span class="sd">    may be in the list, or an error is raised.</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>    <span class="k">if</span> <span class="n">min_count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">start</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Comma-separated list must contain some elements&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>    <span class="k">elif</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Starting position is beyond the end of the string&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">element_parser</span><span class="p">:</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>        <span class="n">element_parser</span> <span class="o">=</span> <span class="n">parse_token_or_quoted_string</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>    <span class="n">pos</span> <span class="o">=</span> <span class="n">start</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">element_parser</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span> <span class="p">)</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">e</span> <span class="ow">or</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>            <span class="k">break</span> <span class="c1"># end of data?</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>        <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>        <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;,&#39;</span><span class="p">:</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>            <span class="k">break</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>        <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span><span class="p">:</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>            <span class="c1"># skip comma and any &quot;empty&quot; elements</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># skip comma</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>            <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_count</span><span class="p">:</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Comma-separated list does not have enough elements&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>    <span class="k">elif</span> <span class="n">max_count</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_count</span><span class="p">:</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Comma-separated list has too many elements&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>    <span class="k">return</span> <span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">pos</span><span class="o">-</span><span class="n">start</span><span class="p">)</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a><span class="k">def</span> <span class="nf">parse_token</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a token.</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a><span class="sd">    A token is a string defined by RFC 2616 section 2.2 as:</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a><span class="sd">       token = 1*&lt;any CHAR except CTLs or separators&gt;</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a><span class="sd">    Returns a tuple (token, chars_consumed), or (&#39;&#39;,0) if no token</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a><span class="sd">    starts at the given string position.  On a syntax error, a</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a><span class="sd">    ParseError exception will be raised.</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>    <span class="k">return</span> <span class="n">parse_token_or_quoted_string</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">allow_quoted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_token</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a><span class="k">def</span> <span class="nf">quote_string</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">always_quote</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Produces a quoted string according to HTTP 1.1 rules.</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a><span class="sd">    If always_quote is False and if the string is also a valid token,</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a><span class="sd">    then this function may return a string without quotes.</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>    <span class="n">need_quotes</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>    <span class="n">q</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>        <span class="k">if</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">32</span> <span class="ow">or</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">127</span> <span class="ow">or</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">SEPARATORS</span><span class="p">:</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>            <span class="n">q</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">c</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>            <span class="n">need_quotes</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>            <span class="n">q</span> <span class="o">+=</span> <span class="n">c</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>    <span class="k">if</span> <span class="n">need_quotes</span> <span class="ow">or</span> <span class="n">always_quote</span><span class="p">:</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>        <span class="k">return</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">q</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>        <span class="k">return</span> <span class="n">q</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a><span class="k">def</span> <span class="nf">parse_quoted_string</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a quoted string.</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a><span class="sd">    Returns a tuple (string, chars_consumed).  The quote marks will</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a><span class="sd">    have been removed and all \-escapes will have been replaced with</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a><span class="sd">    the characters they represent.</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>    <span class="k">return</span> <span class="n">parse_token_or_quoted_string</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">allow_quoted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_token</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a><span class="k">def</span> <span class="nf">parse_token_or_quoted_string</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">allow_quoted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_token</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a token or a quoted-string.</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a><span class="sd">    &#39;s&#39; is the string to parse, while start is the position within the</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a><span class="sd">    string where parsing should begin.  It will returns a tuple</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a><span class="sd">    (token, chars_consumed), with all \-escapes and quotation already</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a><span class="sd">    processed.</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a><span class="sd">    Syntax is according to BNF rules in RFC 2161 section 2.2,</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a><span class="sd">    specifically the &#39;token&#39; and &#39;quoted-string&#39; declarations.</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a><span class="sd">    Syntax errors in the input string will result in ParseError</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a><span class="sd">    being raised.</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a><span class="sd">    If allow_quoted is False, then only tokens will be parsed instead</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a><span class="sd">    of either a token or quoted-string.</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a><span class="sd">    If allow_token is False, then only quoted-strings will be parsed</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a><span class="sd">    instead of either a token or quoted-string.</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_quoted</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">allow_token</span><span class="p">:</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parsing can not continue with options provided&#39;</span><span class="p">)</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>    <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Starting position is beyond the end of the string&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>    <span class="n">has_quote</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>    <span class="k">if</span> <span class="n">has_quote</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">allow_quoted</span><span class="p">:</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;A quoted string was not expected&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_quote</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">allow_token</span><span class="p">:</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Expected a quotation mark&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>    <span class="n">s2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>    <span class="n">pos</span> <span class="o">=</span> <span class="n">start</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>    <span class="k">if</span> <span class="n">has_quote</span><span class="p">:</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="ow">and</span> <span class="n">has_quote</span><span class="p">:</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>            <span class="c1"># Note this is NOT C-style escaping; the character after the \ is</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>            <span class="c1"># taken literally.</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>            <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>                <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s2">&quot;End of string while expecting a character after &#39;</span><span class="se">\\</span><span class="s2">&#39;&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>            <span class="n">s2</span> <span class="o">+=</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">and</span> <span class="n">has_quote</span><span class="p">:</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>            <span class="k">break</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">has_quote</span> <span class="ow">and</span> <span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="n">SEPARATORS</span> <span class="ow">or</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">32</span> <span class="ow">or</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">127</span><span class="p">):</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>            <span class="k">break</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>            <span class="n">s2</span> <span class="o">+=</span> <span class="n">c</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>    <span class="k">if</span> <span class="n">has_quote</span><span class="p">:</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>        <span class="c1"># Make sure we have a closing quote mark</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>        <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">:</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>            <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Quoted string is missing closing quote mark&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>    <span class="k">return</span> <span class="n">s2</span><span class="p">,</span> <span class="p">(</span><span class="n">pos</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a><span class="k">def</span> <span class="nf">remove_comments</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">collapse_spaces</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Removes any ()-style comments from a string.</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a><span class="sd">    In HTTP, ()-comments can nest, and this function will correctly</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a><span class="sd">    deal with that.</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a><span class="sd">    If &#39;collapse_spaces&#39; is True, then if there is any whitespace</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a><span class="sd">    surrounding the comment, it will be replaced with a single space</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a><span class="sd">    character.  Whitespace also collapses across multiple comment</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a><span class="sd">    sequences, so that &quot;a (b) (c) d&quot; becomes just &quot;a d&quot;.</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a><span class="sd">    Otherwise, if &#39;collapse_spaces&#39; is False then all whitespace which</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a><span class="sd">    is outside any comments is left intact as-is.</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>    <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>        <span class="k">return</span> <span class="n">s</span>  <span class="c1"># simple case</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>    <span class="n">A</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>    <span class="n">dostrip</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>    <span class="n">added_comment_space</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>    <span class="k">if</span> <span class="n">collapse_spaces</span><span class="p">:</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>        <span class="c1"># eat any leading spaces before a comment</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>            <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>            <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="n">i</span><span class="p">:</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>                <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>                <span class="n">dostrip</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>                <span class="n">added_comment_space</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># lie</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>        <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;(&#39;</span><span class="p">:</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>            <span class="n">cmt</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_comment</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span> <span class="p">)</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>            <span class="k">if</span> <span class="n">collapse_spaces</span><span class="p">:</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>                <span class="n">dostrip</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">added_comment_space</span><span class="p">:</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>                        <span class="c1"># previous part ended with whitespace</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>                        <span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>                        <span class="n">A</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>  <span class="c1"># comment becomes one space</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>                        <span class="n">added_comment_space</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span> <span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="n">pos</span> <span class="p">)</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>                <span class="k">if</span> <span class="n">dostrip</span><span class="p">:</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>                    <span class="n">text</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>                    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">added_comment_space</span><span class="p">:</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>                        <span class="n">A</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>                        <span class="n">added_comment_space</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>                    <span class="n">text</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>                <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>                    <span class="n">A</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>                    <span class="n">dostrip</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>                    <span class="n">added_comment_space</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>                <span class="k">break</span> <span class="c1"># end of string</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>                <span class="k">if</span> <span class="n">dostrip</span><span class="p">:</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>                    <span class="n">text</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>                    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">added_comment_space</span><span class="p">:</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>                        <span class="n">A</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>                        <span class="n">added_comment_space</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>                    <span class="n">text</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>                <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>                    <span class="n">A</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>                    <span class="n">dostrip</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>                    <span class="n">added_comment_space</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>                <span class="n">pos</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>    <span class="k">if</span> <span class="n">dostrip</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>        <span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a><span class="k">def</span> <span class="nf">_test_comments</span><span class="p">():</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A self-test on comment processing.  Returns number of test failures.&quot;&quot;&quot;</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>    <span class="k">def</span> <span class="nf">_testrm</span><span class="p">(</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">collapse</span> <span class="p">):</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>        <span class="n">b2</span> <span class="o">=</span> <span class="n">remove_comments</span><span class="p">(</span> <span class="n">a</span><span class="p">,</span> <span class="n">collapse</span> <span class="p">)</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>        <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">b2</span><span class="p">:</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>            <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;Comment test failed:&#39;</span> <span class="p">)</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>            <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;   remove_comments( </span><span class="si">%s</span><span class="s1">, collapse_spaces=</span><span class="si">%s</span><span class="s1"> ) -&gt; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">collapse</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">b2</span><span class="p">))</span> <span class="p">)</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>            <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;   expected </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="p">)</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>            <span class="k">return</span> <span class="mi">1</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>        <span class="k">return</span> <span class="mi">0</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>    <span class="n">failures</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>    <span class="n">failures</span> <span class="o">+=</span> <span class="n">_testrm</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">False</span> <span class="p">)</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>    <span class="n">failures</span> <span class="o">+=</span> <span class="n">_testrm</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;(hello)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>    <span class="n">failures</span> <span class="o">+=</span> <span class="n">_testrm</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;abc (hello) def&#39;</span><span class="p">,</span> <span class="s1">&#39;abc  def&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>    <span class="n">failures</span> <span class="o">+=</span> <span class="n">_testrm</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;abc (he(xyz)llo) def&#39;</span><span class="p">,</span> <span class="s1">&#39;abc  def&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>    <span class="n">failures</span> <span class="o">+=</span> <span class="n">_testrm</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;abc (he\(xyz)llo) def&#39;</span><span class="p">,</span> <span class="s1">&#39;abc llo) def&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>    <span class="n">failures</span> <span class="o">+=</span> <span class="n">_testrm</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;abc(hello)def&#39;</span><span class="p">,</span> <span class="s1">&#39;abcdef&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>    <span class="n">failures</span> <span class="o">+=</span> <span class="n">_testrm</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;abc (hello) def&#39;</span><span class="p">,</span> <span class="s1">&#39;abc def&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>    <span class="n">failures</span> <span class="o">+=</span> <span class="n">_testrm</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;abc   (hello)def&#39;</span><span class="p">,</span> <span class="s1">&#39;abc def&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>    <span class="n">failures</span> <span class="o">+=</span> <span class="n">_testrm</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;abc(hello)  def&#39;</span><span class="p">,</span> <span class="s1">&#39;abc def&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>    <span class="n">failures</span> <span class="o">+=</span> <span class="n">_testrm</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;abc(hello) (world)def&#39;</span><span class="p">,</span> <span class="s1">&#39;abc def&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>    <span class="n">failures</span> <span class="o">+=</span> <span class="n">_testrm</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;abc(hello)(world)def&#39;</span><span class="p">,</span> <span class="s1">&#39;abcdef&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>    <span class="n">failures</span> <span class="o">+=</span> <span class="n">_testrm</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;  (hello) (world) def&#39;</span><span class="p">,</span> <span class="s1">&#39;def&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>    <span class="n">failures</span> <span class="o">+=</span> <span class="n">_testrm</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;abc  (hello) (world) &#39;</span><span class="p">,</span> <span class="s1">&#39;abc&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>    <span class="k">return</span> <span class="n">failures</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a><span class="k">def</span> <span class="nf">parse_comment</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a ()-style comment from a header value.</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a><span class="sd">    Returns tuple (comment, chars_consumed), where the comment will</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a><span class="sd">    have had the outer-most parentheses and white space stripped.  Any</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a><span class="sd">    nested comments will still have their parentheses and whitespace</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a><span class="sd">    left intact.</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a><span class="sd">    All \-escaped quoted pairs will have been replaced with the actual</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a><span class="sd">    characters they represent, even within the inner nested comments.</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="sd">    You should note that only a few HTTP headers, such as User-Agent</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="sd">    or Via, allow ()-style comments within the header value.</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a><span class="sd">    A comment is defined by RFC 2616 section 2.2 as:</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="sd">    </span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a><span class="sd">       comment = &quot;(&quot; *( ctext | quoted-pair | comment ) &quot;)&quot;</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a><span class="sd">       ctext   = &lt;any TEXT excluding &quot;(&quot; and &quot;)&quot;&gt;</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>    <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Starting position is beyond the end of the string&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;(&#39;</span><span class="p">:</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Comment must begin with opening parenthesis&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>    <span class="n">s2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>    <span class="n">nestlevel</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>    <span class="n">pos</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>            <span class="c1"># Note this is not C-style escaping; the character after the \ is</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>            <span class="c1"># taken literally.</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>            <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>                <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s2">&quot;End of string while expecting a character after &#39;</span><span class="se">\\</span><span class="s2">&#39;&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>            <span class="n">s2</span> <span class="o">+=</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;(&#39;</span><span class="p">:</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>            <span class="n">nestlevel</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>            <span class="n">s2</span> <span class="o">+=</span> <span class="n">c</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;)&#39;</span><span class="p">:</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>            <span class="n">nestlevel</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>            <span class="k">if</span> <span class="n">nestlevel</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>                <span class="n">s2</span> <span class="o">+=</span> <span class="n">c</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>                <span class="k">break</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>            <span class="n">s2</span> <span class="o">+=</span> <span class="n">c</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>    <span class="k">if</span> <span class="n">nestlevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;End of string reached before comment was closed&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>    <span class="c1"># Now rstrip s2 of all LWS chars.</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>        <span class="n">s2</span> <span class="o">=</span> <span class="n">s2</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>    <span class="k">return</span> <span class="n">s2</span><span class="p">,</span> <span class="p">(</span><span class="n">pos</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>    
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a><span class="k">class</span> <span class="nc">range_spec</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A single contiguous (byte) range.</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a><span class="sd">    A range_spec defines a range (of bytes) by specifying two offsets,</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a><span class="sd">    the &#39;first&#39; and &#39;last&#39;, which are inclusive in the range.  Offsets</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a><span class="sd">    are zero-based (the first byte is offset 0).  The range can not be</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a><span class="sd">    empty or negative (has to satisfy first &lt;= last).</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a><span class="sd">    The range can be unbounded on either end, represented here by the</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a><span class="sd">    None value, with these semantics:</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a><span class="sd">       * A &#39;last&#39; of None always indicates the last possible byte</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a><span class="sd">        (although that offset may not be known).</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a><span class="sd">       * A &#39;first&#39; of None indicates this is a suffix range, where</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a><span class="sd">         the last value is actually interpreted to be the number</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a><span class="sd">         of bytes at the end of the file (regardless of file size).</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a><span class="sd">    Note that it is not valid for both first and last to be None.</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">,</span><span class="s1">&#39;last&#39;</span><span class="p">]</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span> <span class="p">)</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">):</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the value of this range given the first and last offsets.</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>        <span class="k">if</span> <span class="n">first</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">last</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">first</span> <span class="o">&gt;</span> <span class="n">last</span><span class="p">:</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Byte range does not satisfy first &lt;= last.&quot;</span><span class="p">)</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>        <span class="k">elif</span> <span class="n">first</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">last</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Byte range can not omit both first and last offsets.&quot;</span><span class="p">)</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">first</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="n">last</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>                                 <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span><span class="p">)</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a string form of the range as would appear in a Range: header.&quot;&quot;&quot;</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>            <span class="k">return</span> <span class="s1">&#39;&#39;</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>        <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;-&#39;</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>        <span class="k">return</span> <span class="n">s</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compare ranges for equality.</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a><span class="sd">        Note that if non-specific ranges are involved (such as 34- and -5),</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a><span class="sd">        they could compare as not equal even though they may represent</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a><span class="sd">        the same set of bytes in some contexts.</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">first</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">last</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compare ranges for inequality.</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a><span class="sd">        Note that if non-specific ranges are involved (such as 34- and -5),</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a><span class="sd">        they could compare as not equal even though they may represent</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a><span class="sd">        the same set of bytes in some contexts.</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&lt; operator is not defined&quot;&quot;&quot;</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Ranges can not be relationally compared&#39;</span><span class="p">)</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&lt;= operator is not defined&quot;&quot;&quot;</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Ranges can not be ralationally compared&#39;</span><span class="p">)</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&gt; operator is not defined&quot;&quot;&quot;</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Ranges can not be relationally compared&#39;</span><span class="p">)</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&gt;= operator is not defined&quot;&quot;&quot;</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Ranges can not be relationally compared&#39;</span><span class="p">)</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>    
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Makes a copy of this range object.&quot;&quot;&quot;</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="p">)</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>    <span class="k">def</span> <span class="nf">is_suffix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if this is a suffix range.</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a><span class="sd">        A suffix range is one that specifies the last N bytes of a</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a><span class="sd">        file regardless of file size.</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">==</span> <span class="kc">None</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>    <span class="k">def</span> <span class="nf">is_fixed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if this range is absolute and a fixed size.</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a><span class="sd">        This occurs only if neither first or last is None.  Converse</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a><span class="sd">        is the is_unbounded() method.</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>        <span class="k">return</span> <span class="n">first</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">last</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>    <span class="k">def</span> <span class="nf">is_unbounded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if the number of bytes in the range is unspecified.</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a><span class="sd">        This can only occur if either the &#39;first&#39; or the &#39;last&#39; member</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a><span class="sd">        is None.  Converse is the is_fixed() method.</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>    <span class="k">def</span> <span class="nf">is_whole_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if this range includes all possible bytes.</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a><span class="sd">        This can only occur if the &#39;last&#39; member is None and the first</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a><span class="sd">        member is 0.</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Does this byte range contain the given byte offset?</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a><span class="sd">        If the offset &lt; 0, then it is taken as an offset from the end</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a><span class="sd">        of the file, where -1 is the last byte.  This type of offset</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a><span class="sd">        will only work with suffix ranges.</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>        <span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">offset</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">&lt;=</span> <span class="n">offset</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>    <span class="k">def</span> <span class="nf">fix_to_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Changes a length-relative range to an absolute range based upon given file size.</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a><span class="sd">        Ranges that are already absolute are left as is.</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a><span class="sd">        Note that zero-length files are handled as special cases,</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a><span class="sd">        since the only way possible to specify a zero-length range is</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a><span class="sd">        with the suffix range &quot;-0&quot;.  Thus unless this range is a suffix</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a><span class="sd">        range, it can not satisfy a zero-length file.</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a><span class="sd">        If the resulting range (partly) lies outside the file size then an</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="sd">        error is raised.</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>                <span class="k">return</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>                <span class="k">raise</span> <span class="n">RangeUnsatisfiableError</span><span class="p">(</span><span class="s2">&quot;Range can satisfy a zero-length file.&quot;</span><span class="p">)</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>            <span class="c1"># A suffix range</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">&gt;</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>                <span class="k">raise</span> <span class="n">RangeUnsatisfiableError</span><span class="p">(</span><span class="s1">&#39;Range begins beyond the file size.&#39;</span><span class="p">)</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>                    <span class="c1"># An unbounded range</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>        <span class="k">return</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>    <span class="k">def</span> <span class="nf">merge_with</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Tries to merge the given range into this one.</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a><span class="sd">        The size of this range may be enlarged as a result.</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a><span class="sd">        An error is raised if the two ranges do not overlap or are not</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a><span class="sd">        contiguous with each other.</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_whole_file</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">:</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>            <span class="k">return</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>        <span class="k">elif</span> <span class="n">other</span><span class="o">.</span><span class="n">is_whole_file</span><span class="p">():</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>            <span class="k">return</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>        <span class="n">a1</span><span class="p">,</span> <span class="n">z1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>        <span class="n">a2</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">last</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_suffix</span><span class="p">():</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>            <span class="k">if</span> <span class="n">z1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># self is zero-length, so merge becomes a copy</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="n">a2</span><span class="p">,</span> <span class="n">z2</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>                <span class="k">return</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>            <span class="k">elif</span> <span class="n">other</span><span class="o">.</span><span class="n">is_suffix</span><span class="p">():</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">)</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>                <span class="k">raise</span> <span class="n">RangeUnmergableError</span><span class="p">()</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>        <span class="k">elif</span> <span class="n">other</span><span class="o">.</span><span class="n">is_suffix</span><span class="p">():</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>            <span class="k">if</span> <span class="n">z2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># other is zero-length, so nothing to merge</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>                <span class="k">return</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>                <span class="k">raise</span> <span class="n">RangeUnmergableError</span><span class="p">()</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>        <span class="k">assert</span> <span class="n">a1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">a2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>        <span class="k">if</span> <span class="n">a2</span> <span class="o">&lt;</span> <span class="n">a1</span><span class="p">:</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>            <span class="c1"># swap ranges so a1 &lt;= a2</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>            <span class="n">a1</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="n">a2</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">z1</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>        <span class="k">assert</span> <span class="n">a1</span> <span class="o">&lt;=</span> <span class="n">a2</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>        <span class="k">if</span> <span class="n">z1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>            <span class="k">if</span> <span class="n">z2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">z2</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">a1</span><span class="p">:</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>                <span class="k">raise</span> <span class="n">RangeUnmergableError</span><span class="p">()</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>        <span class="k">elif</span> <span class="n">z2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>            <span class="k">if</span> <span class="n">z1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">a2</span><span class="p">:</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>                <span class="k">raise</span> <span class="n">RangeUnmergableError</span><span class="p">()</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>            <span class="k">if</span> <span class="n">a2</span> <span class="o">&gt;</span> <span class="n">z1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>                <span class="k">raise</span> <span class="n">RangeUnmergableError</span><span class="p">()</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">a1</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">)</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>        <span class="k">return</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a><span class="k">class</span> <span class="nc">range_set</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A collection of range_specs, with units (e.g., bytes).</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;range_specs&#39;</span><span class="p">]</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;bytes&#39;</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># a list of range_spec objects</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">])</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>                              <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>                              <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span> <span class="p">)</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>    <span class="k">def</span> <span class="nf">from_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">valid_units</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;bytes&#39;</span><span class="p">,</span><span class="s1">&#39;none&#39;</span><span class="p">)):</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets this range set based upon a string, such as the Range: header.</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a><span class="sd">        You can also use the parse_range_set() function for more control.</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a><span class="sd">        If a parsing error occurs, the pre-exising value of this range</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a><span class="sd">        set is left unchanged.</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>        <span class="n">r</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_range_set</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">valid_units</span><span class="o">=</span><span class="n">valid_units</span> <span class="p">)</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>        <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>            <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s2">&quot;Extra unparsable characters in range set specifier&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">units</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">range_specs</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>    <span class="k">def</span> <span class="nf">is_single_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Does this range specifier consist of only a single range set?&quot;&quot;&quot;</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>    <span class="k">def</span> <span class="nf">is_contiguous</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Can the collection of range_specs be coalesced into a single contiguous range?&quot;&quot;&quot;</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>        <span class="n">merged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>                <span class="n">merged</span><span class="o">.</span><span class="n">merge_with</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>    <span class="k">def</span> <span class="nf">fix_to_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Changes all length-relative range_specs to absolute range_specs based upon given file size.</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a><span class="sd">        If none of the range_specs in this set can be satisfied, then the</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a><span class="sd">        entire set is considered unsatifiable and an error is raised.</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a><span class="sd">        Otherwise any unsatisfiable range_specs will simply be removed</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a><span class="sd">        from this set.</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">)):</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">fix_to_size</span><span class="p">(</span> <span class="n">size</span> <span class="p">)</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>            <span class="k">except</span> <span class="n">RangeUnsatisfiableError</span><span class="p">:</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>            <span class="k">raise</span> <span class="n">RangeUnsatisfiableError</span><span class="p">(</span><span class="s1">&#39;No ranges can be satisfied&#39;</span><span class="p">)</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>    <span class="k">def</span> <span class="nf">coalesce</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Collapses all consecutive range_specs which together define a contiguous range.</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a><span class="sd">        Note though that this method will not re-sort the range_specs, so a</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a><span class="sd">        potentially contiguous range may not be collapsed if they are</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a><span class="sd">        not sorted.  For example the ranges:</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a><span class="sd">            10-20, 30-40, 20-30</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a><span class="sd">        will not be collapsed to just 10-40.  However if the ranges are</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a><span class="sd">        sorted first as with:</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a><span class="sd">            10-20, 20-30, 30-40</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a><span class="sd">        then they will collapse to 10-40.</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>            <span class="k">return</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>            <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>            <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>                    <span class="n">a</span><span class="o">.</span><span class="n">merge_with</span><span class="p">(</span> <span class="n">b</span> <span class="p">)</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># to be deleted later</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>                <span class="k">except</span> <span class="n">RangeUnmergableError</span><span class="p">:</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>                    <span class="k">pass</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span> <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a><span class="k">def</span> <span class="nf">parse_number</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span> <span class="p">):</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a positive decimal integer number from the string.</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a><span class="sd">    A tuple is returned (number, chars_consumed).  If the</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a><span class="sd">    string is not a valid decimal number, then (None,0) is returned.</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>    <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Starting position is beyond the end of the string&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DIGIT</span><span class="p">:</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>        <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># not a number</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>    <span class="n">pos</span> <span class="o">=</span> <span class="n">start</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>        <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">DIGIT</span><span class="p">:</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>            <span class="n">n</span> <span class="o">*=</span> <span class="mi">10</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>            <span class="n">n</span> <span class="o">+=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>            <span class="k">break</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>    <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="n">pos</span><span class="o">-</span><span class="n">start</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a><span class="k">def</span> <span class="nf">parse_range_spec</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span> <span class="p">):</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a (byte) range_spec.</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a><span class="sd">    Returns a tuple (range_spec, chars_consumed).</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>    <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Starting position is beyond the end of the string&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DIGIT</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s2">&quot;Invalid range, expected a digit or &#39;-&#39;&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>    <span class="n">first</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>    <span class="n">pos</span> <span class="o">=</span> <span class="n">start</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>    <span class="n">first</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_number</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span> <span class="p">)</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>    <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>        <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>            <span class="n">last</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_number</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span> <span class="p">)</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s2">&quot;Byte range must include a &#39;-&#39;&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>    <span class="k">if</span> <span class="n">first</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">last</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Byte range can not omit both first and last indices.&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>    <span class="n">R</span> <span class="o">=</span> <span class="n">range_spec</span><span class="p">(</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span> <span class="p">)</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>    <span class="k">return</span> <span class="n">R</span><span class="p">,</span> <span class="n">pos</span><span class="o">-</span><span class="n">start</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a><span class="k">def</span> <span class="nf">parse_range_header</span><span class="p">(</span> <span class="n">header_value</span><span class="p">,</span> <span class="n">valid_units</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;bytes&#39;</span><span class="p">,</span><span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="p">):</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses the value of an HTTP Range: header.</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a><span class="sd">    The value of the header as a string should be passed in; without</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a><span class="sd">    the header name itself.</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a><span class="sd">    Returns a range_set object.</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>    <span class="n">ranges</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_range_set</span><span class="p">(</span> <span class="n">header_value</span><span class="p">,</span> <span class="n">valid_units</span><span class="o">=</span><span class="n">valid_units</span> <span class="p">)</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>    <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_value</span><span class="p">):</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Range header has unexpected or unparsable characters&#39;</span><span class="p">,</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>                         <span class="n">header_value</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>    <span class="k">return</span> <span class="n">ranges</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a><span class="k">def</span> <span class="nf">parse_range_set</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">valid_units</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;bytes&#39;</span><span class="p">,</span><span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="p">):</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a (byte) range set specifier.</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a><span class="sd">    Returns a tuple (range_set, chars_consumed).</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>    <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Starting position is beyond the end of the string&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>    <span class="n">pos</span> <span class="o">=</span> <span class="n">start</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>    <span class="n">units</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_token</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span> <span class="p">)</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>    <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>    <span class="k">if</span> <span class="n">valid_units</span> <span class="ow">and</span> <span class="n">units</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_units</span><span class="p">:</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Unsupported units type in range specifier&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>    <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;=&#39;</span><span class="p">:</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s2">&quot;Invalid range specifier, expected &#39;=&#39;&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>    <span class="n">range_specs</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_comma_list</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">parse_range_spec</span><span class="p">,</span> <span class="n">min_count</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>    <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>    <span class="c1"># Make sure no trash is at the end of the string</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>    <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Unparsable characters in range set specifier&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>    <span class="n">ranges</span> <span class="o">=</span> <span class="n">range_set</span><span class="p">()</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>    <span class="n">ranges</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">units</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>    <span class="n">ranges</span><span class="o">.</span><span class="n">range_specs</span> <span class="o">=</span> <span class="n">range_specs</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>    <span class="k">return</span> <span class="n">ranges</span><span class="p">,</span> <span class="n">pos</span><span class="o">-</span><span class="n">start</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a><span class="k">def</span> <span class="nf">_split_at_qfactor</span><span class="p">(</span> <span class="n">s</span> <span class="p">):</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Splits a string at the quality factor (;q=) parameter.</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a><span class="sd">    Returns the left and right substrings as a two-member tuple.</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>    <span class="c1"># It may be faster, but incorrect, to use s.split(&#39;;q=&#39;,1), since</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>    <span class="c1"># HTTP allows any amount of linear white space (LWS) to appear</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>    <span class="c1"># between the parts, so it could also be &quot;; q = &quot;.</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>    <span class="c1"># We do this parsing &#39;manually&#39; for speed rather than using a</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>    <span class="c1"># regex, which would be r&#39;;[ \t\r\n]*q[ \t\r\n]*=[ \t\r\n]*&#39;</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>    <span class="k">while</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>        <span class="n">pos</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>        <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>            <span class="k">break</span> <span class="c1"># no more parameters</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>        <span class="n">startpos</span> <span class="o">=</span> <span class="n">pos</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>        <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>        <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;q&#39;</span><span class="p">:</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>            <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>                <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>            <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;=&#39;</span><span class="p">:</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>                <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>                <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>                    <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>                <span class="k">return</span> <span class="p">(</span> <span class="n">s</span><span class="p">[:</span><span class="n">startpos</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span> <span class="p">)</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>    <span class="k">return</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a><span class="k">def</span> <span class="nf">parse_qvalue_accept_list</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">item_parser</span><span class="o">=</span><span class="n">parse_token</span> <span class="p">):</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses any of the Accept-* style headers with quality factors.</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a><span class="sd">    This is a low-level function.  It returns a list of tuples, each like:</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a><span class="sd">       (item, item_parms, qvalue, accept_parms)</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a><span class="sd">    You can pass in a function which parses each of the item strings, or</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a><span class="sd">    accept the default where the items must be simple tokens.  Note that</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a><span class="sd">    your parser should not consume any paramters (past the special &quot;q&quot;</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a><span class="sd">    paramter anyway).</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a><span class="sd">    The item_parms and accept_parms are each lists of (name,value) tuples.</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a><span class="sd">    The qvalue is the quality factor, a number from 0 to 1 inclusive.</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>    <span class="n">itemlist</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>    <span class="n">pos</span> <span class="o">=</span> <span class="n">start</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>    <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Starting position is beyond the end of the string&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>    <span class="n">item</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>        <span class="n">item</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">item_parser</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>        <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>        <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>        <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="s1">&#39;,;&#39;</span><span class="p">:</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>            <span class="n">itemparms</span><span class="p">,</span> <span class="n">qvalue</span><span class="p">,</span> <span class="n">acptparms</span> <span class="o">=</span> <span class="p">[],</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[]</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>            <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;;&#39;</span><span class="p">:</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>                <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>                    <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>                <span class="n">parmlist</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_parameter_list</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>                <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">parmlist</span><span class="p">:</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>                    <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s1">&#39;q&#39;</span> <span class="ow">and</span> <span class="n">qvalue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>                            <span class="n">qvalue</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>                            <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;qvalue must be a floating point number&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>                        <span class="k">if</span> <span class="n">qvalue</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">qvalue</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>                            <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;qvalue must be between 0 and 1, inclusive&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>                    <span class="k">elif</span> <span class="n">qvalue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>                        <span class="n">itemparms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="p">)</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>                        <span class="n">acptparms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="p">)</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>                <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>            <span class="k">if</span> <span class="n">item</span><span class="p">:</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>                <span class="c1"># Add the item to the list</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>                <span class="k">if</span> <span class="n">qvalue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>                    <span class="n">qvalue</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>                <span class="n">itemlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">itemparms</span><span class="p">,</span> <span class="n">qvalue</span><span class="p">,</span> <span class="n">acptparms</span><span class="p">)</span> <span class="p">)</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>                <span class="n">item</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>            <span class="c1"># skip commas</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>            <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span><span class="p">:</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>                <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>                    <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>            <span class="k">break</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>    <span class="k">return</span> <span class="n">itemlist</span><span class="p">,</span> <span class="n">pos</span> <span class="o">-</span> <span class="n">start</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a><span class="k">def</span> <span class="nf">parse_accept_header</span><span class="p">(</span> <span class="n">header_value</span> <span class="p">):</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses the Accept: header.</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a><span class="sd">    The value of the header as a string should be passed in; without</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a><span class="sd">    the header name itself.</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a><span class="sd">    </span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a><span class="sd">    This will parse the value of any of the HTTP headers &quot;Accept&quot;,</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a><span class="sd">    &quot;Accept-Charset&quot;, &quot;Accept-Encoding&quot;, or &quot;Accept-Language&quot;.  These</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a><span class="sd">    headers are similarly formatted, in that they are a list of items</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a><span class="sd">    with associated quality factors.  The quality factor, or qvalue,</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a><span class="sd">    is a number in the range [0.0..1.0] which indicates the relative</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a><span class="sd">    preference of each item.</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a><span class="sd">    This function returns a list of those items, sorted by preference</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a><span class="sd">    (from most-prefered to least-prefered).  Each item in the returned</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a><span class="sd">    list is actually a tuple consisting of:</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a><span class="sd">       ( item_name, item_parms, qvalue, accept_parms )</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a><span class="sd">    As an example, the following string,</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a><span class="sd">        text/plain; charset=&quot;utf-8&quot;; q=.5; columns=80</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a><span class="sd">    would be parsed into this resulting tuple,</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a><span class="sd">        ( &#39;text/plain&#39;, [(&#39;charset&#39;,&#39;utf-8&#39;)], 0.5, [(&#39;columns&#39;,&#39;80&#39;)] )</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a><span class="sd">    The value of the returned item_name depends upon which header is</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a><span class="sd">    being parsed, but for example it may be a MIME content or media</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a><span class="sd">    type (without parameters), a language tag, or so on.  Any optional</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a><span class="sd">    parameters (delimited by semicolons) occuring before the &quot;q=&quot;</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a><span class="sd">    attribute will be in the item_parms list as (attribute,value)</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a><span class="sd">    tuples in the same order as they appear in the header.  Any quoted</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a><span class="sd">    values will have been unquoted and unescaped.</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a><span class="sd">    The qvalue is a floating point number in the inclusive range 0.0</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a><span class="sd">    to 1.0, and roughly indicates the preference for this item.</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a><span class="sd">    Values outside this range will be capped to the closest extreme.</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a><span class="sd">         (!) Note that a qvalue of 0 indicates that the item is</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a><span class="sd">         explicitly NOT acceptable to the user agent, and should be</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a><span class="sd">         handled differently by the caller.</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a><span class="sd">    The accept_parms, like the item_parms, is a list of any attributes</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a><span class="sd">    occuring after the &quot;q=&quot; attribute, and will be in the list as</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a><span class="sd">    (attribute,value) tuples in the same order as they occur.</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a><span class="sd">    Usually accept_parms will be an empty list, as the HTTP spec</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a><span class="sd">    allows these extra parameters in the syntax but does not</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a><span class="sd">    currently define any possible values.</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a><span class="sd">    All empty items will be removed from the list.  However, duplicate</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a><span class="sd">    or conflicting values are not detected or handled in any way by</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a><span class="sd">    this function.</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>    <span class="k">def</span> <span class="nf">parse_mt_only</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="p">):</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>        <span class="n">mt</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_media_type</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">with_parameters</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>        <span class="n">ct</span> <span class="o">=</span> <span class="n">content_type</span><span class="p">()</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>        <span class="n">ct</span><span class="o">.</span><span class="n">major</span> <span class="o">=</span> <span class="n">mt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>        <span class="n">ct</span><span class="o">.</span><span class="n">minor</span> <span class="o">=</span> <span class="n">mt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>        <span class="k">return</span> <span class="n">ct</span><span class="p">,</span> <span class="n">k</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a>    <span class="n">alist</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_qvalue_accept_list</span><span class="p">(</span> <span class="n">header_value</span><span class="p">,</span> <span class="n">item_parser</span><span class="o">=</span><span class="n">parse_mt_only</span> <span class="p">)</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>    <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_value</span><span class="p">):</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Accept header is invalid&#39;</span><span class="p">,</span><span class="n">header_value</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>    <span class="n">ctlist</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>    <span class="k">for</span> <span class="n">ct</span><span class="p">,</span> <span class="n">ctparms</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">acptparms</span>  <span class="ow">in</span> <span class="n">alist</span><span class="p">:</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>        <span class="k">if</span> <span class="n">ctparms</span><span class="p">:</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>            <span class="n">ct</span><span class="o">.</span><span class="n">set_parameters</span><span class="p">(</span> <span class="nb">dict</span><span class="p">(</span><span class="n">ctparms</span><span class="p">)</span> <span class="p">)</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>        <span class="n">ctlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">acptparms</span><span class="p">)</span> <span class="p">)</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>    <span class="k">return</span> <span class="n">ctlist</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a><span class="k">def</span> <span class="nf">parse_media_type</span><span class="p">(</span><span class="n">media_type</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">with_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a media type (MIME type) designator into it&#39;s parts.</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a><span class="sd">    Given a media type string, returns a nested tuple of it&#39;s parts.</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a><span class="sd">        ((major,minor,parmlist), chars_consumed)</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a><span class="sd">    where parmlist is a list of tuples of (parm_name, parm_value).</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a><span class="sd">    Quoted-values are appropriately unquoted and unescaped.</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a><span class="sd">    </span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a><span class="sd">    If &#39;with_parameters&#39; is False, then parsing will stop immediately</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a><span class="sd">    after the minor media type; and will not proceed to parse any</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a><span class="sd">    of the semicolon-separated paramters.</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a><span class="sd">    Examples:</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a><span class="sd">        image/png -&gt; ((&#39;image&#39;,&#39;png&#39;,[]), 9)</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a><span class="sd">        text/plain; charset=&quot;utf-16be&quot;</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a><span class="sd">                  -&gt; ((&#39;text&#39;,&#39;plain&#39;,[(&#39;charset,&#39;utf-16be&#39;)]), 30)</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>    <span class="n">s</span> <span class="o">=</span> <span class="n">media_type</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>    <span class="n">pos</span> <span class="o">=</span> <span class="n">start</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>    <span class="n">ctmaj</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_token</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Media type must be of the form &quot;major/minor&quot;.&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>    <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>    <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Media type must be of the form &quot;major/minor&quot;.&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>    <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>    <span class="n">ctmin</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_token</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Media type must be of the form &quot;major/minor&quot;.&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>    <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>    <span class="k">if</span> <span class="n">with_parameters</span><span class="p">:</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>        <span class="n">parmlist</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_parameter_list</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>        <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>        <span class="n">parmlist</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>    <span class="k">return</span> <span class="p">((</span><span class="n">ctmaj</span><span class="p">,</span> <span class="n">ctmin</span><span class="p">,</span> <span class="n">parmlist</span><span class="p">),</span> <span class="n">pos</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a><span class="k">def</span> <span class="nf">parse_parameter_list</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a semicolon-separated &#39;parameter=value&#39; list.</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a><span class="sd">    Returns a tuple (parmlist, chars_consumed), where parmlist</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a><span class="sd">    is a list of tuples (parm_name, parm_value).</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a><span class="sd">    The parameter values will be unquoted and unescaped as needed.</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a><span class="sd">    Empty parameters (as in &quot;;;&quot;) are skipped, as is insignificant</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a><span class="sd">    white space.  The list returned is kept in the same order as the</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a><span class="sd">    parameters appear in the string.</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>    <span class="n">pos</span> <span class="o">=</span> <span class="n">start</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>    <span class="n">parmlist</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>        <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># skip whitespace</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>        <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;;&#39;</span><span class="p">:</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>            <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># skip whitespace</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>        <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>            <span class="k">break</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>        <span class="n">parmname</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_token</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>        <span class="k">if</span> <span class="n">parmname</span><span class="p">:</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>            <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># skip whitespace</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;=&#39;</span><span class="p">):</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>                <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Expected an &quot;=&quot; after parameter name&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>            <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># skip whitespace</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>            <span class="n">parmval</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_token_or_quoted_string</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span> <span class="p">)</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>            <span class="n">parmlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">parmname</span><span class="p">,</span> <span class="n">parmval</span><span class="p">)</span> <span class="p">)</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>            <span class="k">break</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>    <span class="k">return</span> <span class="n">parmlist</span><span class="p">,</span> <span class="n">pos</span> <span class="o">-</span> <span class="n">start</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a><span class="k">class</span> <span class="nc">content_type</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class represents a media type (aka a MIME content type), including parameters.</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a><span class="sd">    You initialize these by passing in a content-type declaration</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a><span class="sd">    string, such as &quot;text/plain; charset=ascii&quot;, to the constructor or</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a><span class="sd">    to the set() method.  If you provide no string value, the object</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a><span class="sd">    returned will represent the wildcard */* content type.</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a><span class="sd">    Normally you will get the value back by using str(), or optionally</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a><span class="sd">    you can access the components via the &#39;major&#39;, &#39;minor&#39;, &#39;media_type&#39;,</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a><span class="sd">    or &#39;parmdict&#39; members.</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content_type_string</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">with_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new content_type object.</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a><span class="sd">        See the set() method for a description of the arguments.</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>        <span class="k">if</span> <span class="n">content_type_string</span><span class="p">:</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span> <span class="n">content_type_string</span><span class="p">,</span> <span class="n">with_parameters</span><span class="o">=</span><span class="n">with_parameters</span> <span class="p">)</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span> <span class="s1">&#39;*/*&#39;</span> <span class="p">)</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>    <span class="k">def</span> <span class="nf">set_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter_list_or_dict</span><span class="p">):</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the optional paramters based upon the parameter list.</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a><span class="sd">        The paramter list should be a semicolon-separated name=value string.</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a><span class="sd">        Any paramters which already exist on this object will be deleted,</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a><span class="sd">        unless they appear in the given paramter_list.</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">parameter_list_or_dict</span><span class="p">,</span> <span class="s1">&#39;has_key&#39;</span><span class="p">):</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>            <span class="c1"># already a dictionary</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>            <span class="n">pl</span> <span class="o">=</span> <span class="n">parameter_list_or_dict</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>            <span class="n">pl</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_parameter_list</span><span class="p">(</span><span class="n">parameter_list</span><span class="p">)</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>            <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameter_list</span><span class="p">):</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>                <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Invalid parameter list&#39;</span><span class="p">,</span><span class="n">paramter_list</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parmdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content_type_string</span><span class="p">,</span> <span class="n">with_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Parses the content type string and sets this object to it&#39;s value.</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a><span class="sd">        For a more complete description of the arguments, see the</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a><span class="sd">        documentation for the parse_media_type() function in this module.</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>        <span class="n">mt</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_media_type</span><span class="p">(</span> <span class="n">content_type_string</span><span class="p">,</span> <span class="n">with_parameters</span><span class="o">=</span><span class="n">with_parameters</span> <span class="p">)</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a>        <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">content_type_string</span><span class="p">):</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>            <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Not a valid content type&#39;</span><span class="p">,</span><span class="n">content_type_string</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>        <span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">pdict</span> <span class="o">=</span> <span class="n">mt</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_major</span><span class="p">(</span> <span class="n">major</span> <span class="p">)</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_minor</span><span class="p">(</span> <span class="n">minor</span> <span class="p">)</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parmdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pdict</span><span class="p">)</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a>        
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>    <span class="k">def</span> <span class="nf">_get_major</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_major</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>    <span class="k">def</span> <span class="nf">_set_major</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="c1"># case-insentive</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_token</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Major media type contains an invalid character&#39;</span><span class="p">)</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_major</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>    <span class="k">def</span> <span class="nf">_get_minor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minor</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>    <span class="k">def</span> <span class="nf">_set_minor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="c1"># case-insentive</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_token</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Minor media type contains an invalid character&#39;</span><span class="p">)</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_minor</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a>    <span class="n">major</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_major</span><span class="p">,</span><span class="n">_set_major</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Major media classification&quot;</span><span class="p">)</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a>    <span class="n">minor</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_minor</span><span class="p">,</span><span class="n">_set_minor</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Minor media sub-classification&quot;</span><span class="p">)</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;String value.&quot;&quot;&quot;</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">major</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span><span class="p">)</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmdict</span><span class="p">:</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a>            <span class="n">extra</span> <span class="o">=</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">quote_string</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="kc">False</span><span class="p">))</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmdict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a>            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;; &#39;</span> <span class="o">+</span> <span class="n">extra</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a>        <span class="k">return</span> <span class="n">s</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unicode string value.&quot;&quot;&quot;</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a>        <span class="c1"># In Python 3 this is probably unnecessary in general, this is just to avoid possible syntax issues. I.H.</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a>        <span class="k">if</span> <span class="n">PY3</span> <span class="p">:</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>        <span class="k">else</span> <span class="p">:</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>            <span class="k">return</span> <span class="n">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Python representation of this object.&quot;&quot;&quot;</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()))</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a>        <span class="k">return</span> <span class="n">s</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Hash this object; the hash is dependent only upon the value.&quot;&quot;&quot;</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a>    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pickler&quot;&quot;&quot;</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a>    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpickler&quot;&quot;&quot;</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Logical length of this media type.</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a><span class="sd">        For example:</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a><span class="sd">           len(&#39;*/*&#39;)  -&gt; 0</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a><span class="sd">           len(&#39;image/*&#39;) -&gt; 1</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a><span class="sd">           len(&#39;image/png&#39;) -&gt; 2</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a><span class="sd">           len(&#39;text/plain; charset=utf-8&#39;)  -&gt; 3</span>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a><span class="sd">           len(&#39;text/plain; charset=utf-8; filename=xyz.txt&#39;) -&gt; 4</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a>            <span class="k">return</span> <span class="mi">1</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>            <span class="k">return</span> <span class="mi">2</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parmdict</span><span class="p">)</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Equality test.</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a><span class="sd">        Note that this is an exact match, including any parameters if any.</span>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">major</span> <span class="ow">and</span> \
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a>                   <span class="bp">self</span><span class="o">.</span><span class="n">minor</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">minor</span> <span class="ow">and</span> \
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a>                   <span class="bp">self</span><span class="o">.</span><span class="n">parmdict</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">parmdict</span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Inequality test.&quot;&quot;&quot;</span>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a>            
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a>    <span class="k">def</span> <span class="nf">_get_media_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the media &#39;type/subtype&#39; string, without parameters.&quot;&quot;&quot;</span>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a>        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">major</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span><span class="p">)</span>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a>    <span class="n">media_type</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_media_type</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Returns the just the media type &#39;type/subtype&#39; without any paramters (read-only).&quot;</span><span class="p">)</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a>    <span class="k">def</span> <span class="nf">is_wildcard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if this is a &#39;something/*&#39; media type.</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a>    <span class="k">def</span> <span class="nf">is_universal_wildcard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if this is the unspecified &#39;*/*&#39; media type.</span>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a>    <span class="k">def</span> <span class="nf">is_composite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Is this media type composed of multiple parts.</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="o">==</span> <span class="s1">&#39;multipart&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="o">==</span> <span class="s1">&#39;message&#39;</span>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a>    <span class="k">def</span> <span class="nf">is_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if this media type is XML-based.</span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a><span class="sd">        Note this does not consider text/html to be XML, but</span>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a><span class="sd">        application/xhtml+xml is.</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span> <span class="o">==</span> <span class="s1">&#39;xml&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;+xml&#39;</span><span class="p">)</span>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a><span class="c1"># Some common media types</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a><span class="n">content_formdata</span> <span class="o">=</span> <span class="n">content_type</span><span class="p">(</span><span class="s1">&#39;multipart/form-data&#39;</span><span class="p">)</span>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a><span class="n">content_urlencoded</span> <span class="o">=</span> <span class="n">content_type</span><span class="p">(</span><span class="s1">&#39;application/x-www-form-urlencoded&#39;</span><span class="p">)</span>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a><span class="n">content_byteranges</span> <span class="o">=</span> <span class="n">content_type</span><span class="p">(</span><span class="s1">&#39;multipart/byteranges&#39;</span><span class="p">)</span> <span class="c1"># RFC 2616 sect 14.16</span>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a><span class="n">content_opaque</span> <span class="o">=</span> <span class="n">content_type</span><span class="p">(</span><span class="s1">&#39;application/octet-stream&#39;</span><span class="p">)</span>
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a><span class="n">content_html</span> <span class="o">=</span> <span class="n">content_type</span><span class="p">(</span><span class="s1">&#39;text/html&#39;</span><span class="p">)</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a><span class="n">content_xhtml</span> <span class="o">=</span> <span class="n">content_type</span><span class="p">(</span><span class="s1">&#39;application/xhtml+xml&#39;</span><span class="p">)</span>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a><span class="k">def</span> <span class="nf">acceptable_content_type</span><span class="p">(</span> <span class="n">accept_header</span><span class="p">,</span> <span class="n">content_types</span><span class="p">,</span> <span class="n">ignore_wildcard</span><span class="o">=</span><span class="kc">True</span> <span class="p">):</span>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Determines if the given content type is acceptable to the user agent.</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a><span class="sd">    The accept_header should be the value present in the HTTP</span>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a><span class="sd">    &quot;Accept:&quot; header.  In mod_python this is typically obtained from</span>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a><span class="sd">    the req.http_headers_in table; in WSGI it is environ[&quot;Accept&quot;];</span>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a><span class="sd">    other web frameworks may provide other methods of obtaining it.</span>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a><span class="sd">    Optionally the accept_header parameter can be pre-parsed, as</span>
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a><span class="sd">    returned from the parse_accept_header() function in this module.</span>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a>
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a><span class="sd">    The content_types argument should either be a single MIME media</span>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a><span class="sd">    type string, or a sequence of them.  It represents the set of</span>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a><span class="sd">    content types that the caller (server) is willing to send.</span>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a><span class="sd">    Generally, the server content_types should not contain any</span>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a><span class="sd">    wildcarded values.</span>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a>
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a><span class="sd">    This function determines which content type which is the most</span>
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a><span class="sd">    preferred and is acceptable to both the user agent and the server.</span>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a><span class="sd">    If one is negotiated it will return a four-valued tuple like:</span>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a><span class="sd">        (server_content_type, ua_content_range, qvalue, accept_parms)</span>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a><span class="sd">    The first tuple value is one of the server&#39;s content_types, while</span>
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a><span class="sd">    the remaining tuple values descript which of the client&#39;s</span>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a><span class="sd">    acceptable content_types was matched.  In most cases accept_parms</span>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a><span class="sd">    will be an empty list (see description of parse_accept_header()</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a><span class="sd">    for more details).</span>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a><span class="sd">    If no content type could be negotiated, then this function will</span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a><span class="sd">    return None (and the caller should typically cause an HTTP 406 Not</span>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a><span class="sd">    Acceptable as a response).</span>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a>
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a><span class="sd">    Note that the wildcarded content type &quot;*/*&quot; sent by the client</span>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a><span class="sd">    will be ignored, since it is often incorrectly sent by web</span>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a><span class="sd">    browsers that don&#39;t really mean it.  To override this, call with</span>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a><span class="sd">    ignore_wildcard=False.  Partial wildcards such as &quot;image/*&quot; will</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a><span class="sd">    always be processed, but be at a lower priority than a complete</span>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a><span class="sd">    matching type.</span>
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a><span class="sd">    See also: RFC 2616 section 14.1, and</span>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a><span class="sd">    &lt;http://www.iana.org/assignments/media-types/&gt;</span>
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a>
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a>    <span class="k">if</span> <span class="n">_is_string</span><span class="p">(</span><span class="n">accept_header</span><span class="p">):</span>
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a>        <span class="n">accept_list</span> <span class="o">=</span> <span class="n">parse_accept_header</span><span class="p">(</span><span class="n">accept_header</span><span class="p">)</span>
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a>        <span class="n">accept_list</span> <span class="o">=</span> <span class="n">accept_header</span>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a>
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a>    <span class="k">if</span> <span class="n">_is_string</span><span class="p">(</span><span class="n">content_types</span><span class="p">):</span>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a>        <span class="n">content_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">content_types</span><span class="p">]</span>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a>
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a>    <span class="n">server_ctlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">content_type</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span> <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">content_types</span><span class="p">]</span>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a>    <span class="k">del</span> <span class="n">ct</span>
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a>    <span class="c1">#print &#39;AC&#39;, repr(accept_list)</span>
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a>    <span class="c1">#print &#39;SV&#39;, repr(server_ctlist)</span>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a>    <span class="n">best</span> <span class="o">=</span> <span class="kc">None</span>   <span class="c1"># (content_type, qvalue, accept_parms, matchlen)</span>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a>
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a>    <span class="k">for</span> <span class="n">server_ct</span> <span class="ow">in</span> <span class="n">server_ctlist</span><span class="p">:</span>
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a>        <span class="n">best_for_this</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a>        <span class="k">for</span> <span class="n">client_ct</span><span class="p">,</span> <span class="n">qvalue</span><span class="p">,</span> <span class="n">aargs</span> <span class="ow">in</span> <span class="n">accept_list</span><span class="p">:</span>
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a>            <span class="k">if</span> <span class="n">ignore_wildcard</span> <span class="ow">and</span> <span class="n">client_ct</span><span class="o">.</span><span class="n">is_universal_wildcard</span><span class="p">():</span>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a>                <span class="k">continue</span>  <span class="c1"># */* being ignored</span>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a>            <span class="n">matchlen</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># how specifically this one matches (0 is a non-match)</span>
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a>            <span class="k">if</span> <span class="n">client_ct</span><span class="o">.</span><span class="n">is_universal_wildcard</span><span class="p">():</span>
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a>                <span class="n">matchlen</span> <span class="o">=</span> <span class="mi">1</span>   <span class="c1"># */* is a 1</span>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a>            <span class="k">elif</span> <span class="n">client_ct</span><span class="o">.</span><span class="n">major</span> <span class="o">==</span> <span class="n">server_ct</span><span class="o">.</span><span class="n">major</span><span class="p">:</span>
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a>                <span class="k">if</span> <span class="n">client_ct</span><span class="o">.</span><span class="n">minor</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>  <span class="c1"># something/* is a 2</span>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a>                    <span class="n">matchlen</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a>                <span class="k">elif</span> <span class="n">client_ct</span><span class="o">.</span><span class="n">minor</span> <span class="o">==</span> <span class="n">server_ct</span><span class="o">.</span><span class="n">minor</span><span class="p">:</span> <span class="c1"># something/something is a 3</span>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a>                    <span class="n">matchlen</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a>                    <span class="c1"># must make sure all the parms match too</span>
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a>                    <span class="k">for</span> <span class="n">pname</span><span class="p">,</span> <span class="n">pval</span> <span class="ow">in</span> <span class="n">client_ct</span><span class="o">.</span><span class="n">parmdict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a>                        <span class="n">sval</span> <span class="o">=</span> <span class="n">server_ct</span><span class="o">.</span><span class="n">parmdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pname</span><span class="p">)</span>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a>                        <span class="k">if</span> <span class="n">pname</span> <span class="o">==</span> <span class="s1">&#39;charset&#39;</span><span class="p">:</span>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a>                            <span class="c1"># special case for charset to match aliases</span>
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a>                            <span class="n">pval</span> <span class="o">=</span> <span class="n">canonical_charset</span><span class="p">(</span><span class="n">pval</span><span class="p">)</span>
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a>                            <span class="n">sval</span> <span class="o">=</span> <span class="n">canonical_charset</span><span class="p">(</span><span class="n">sval</span><span class="p">)</span>
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a>                        <span class="k">if</span> <span class="n">sval</span> <span class="o">==</span> <span class="n">pval</span><span class="p">:</span>
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a>                            <span class="n">matchlen</span> <span class="o">=</span> <span class="n">matchlen</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a>                            <span class="n">matchlen</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a>                            <span class="k">break</span>
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a>                    <span class="n">matchlen</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a>
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a>            <span class="c1">#print &#39;S&#39;,server_ct,&#39;  C&#39;,client_ct,&#39;  M&#39;,matchlen,&#39;Q&#39;,qvalue</span>
</span><span id="L-1540"><a href="#L-1540"><span class="linenos">1540</span></a>            <span class="k">if</span> <span class="n">matchlen</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1541"><a href="#L-1541"><span class="linenos">1541</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">best_for_this</span> \
</span><span id="L-1542"><a href="#L-1542"><span class="linenos">1542</span></a>                       <span class="ow">or</span> <span class="n">matchlen</span> <span class="o">&gt;</span> <span class="n">best_for_this</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> \
</span><span id="L-1543"><a href="#L-1543"><span class="linenos">1543</span></a>                       <span class="ow">or</span> <span class="p">(</span><span class="n">matchlen</span> <span class="o">==</span> <span class="n">best_for_this</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">qvalue</span> <span class="o">&gt;</span> <span class="n">best_for_this</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
</span><span id="L-1544"><a href="#L-1544"><span class="linenos">1544</span></a>                    <span class="c1"># This match is better</span>
</span><span id="L-1545"><a href="#L-1545"><span class="linenos">1545</span></a>                    <span class="n">best_for_this</span> <span class="o">=</span> <span class="p">(</span><span class="n">server_ct</span><span class="p">,</span> <span class="n">client_ct</span><span class="p">,</span> <span class="n">qvalue</span><span class="p">,</span> <span class="n">aargs</span><span class="p">,</span> <span class="n">matchlen</span><span class="p">)</span>
</span><span id="L-1546"><a href="#L-1546"><span class="linenos">1546</span></a>                    <span class="c1">#print &#39;BEST2 NOW&#39;, repr(best_for_this)</span>
</span><span id="L-1547"><a href="#L-1547"><span class="linenos">1547</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">best</span> <span class="ow">or</span> \
</span><span id="L-1548"><a href="#L-1548"><span class="linenos">1548</span></a>               <span class="p">(</span><span class="n">best_for_this</span> <span class="ow">and</span> <span class="n">best_for_this</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">best</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
</span><span id="L-1549"><a href="#L-1549"><span class="linenos">1549</span></a>            <span class="n">best</span> <span class="o">=</span> <span class="n">best_for_this</span>
</span><span id="L-1550"><a href="#L-1550"><span class="linenos">1550</span></a>            <span class="c1">#print &#39;BEST NOW&#39;, repr(best)</span>
</span><span id="L-1551"><a href="#L-1551"><span class="linenos">1551</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">best</span> <span class="ow">or</span> <span class="n">best</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1552"><a href="#L-1552"><span class="linenos">1552</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1553"><a href="#L-1553"><span class="linenos">1553</span></a>    <span class="k">return</span> <span class="n">best</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1554"><a href="#L-1554"><span class="linenos">1554</span></a>
</span><span id="L-1555"><a href="#L-1555"><span class="linenos">1555</span></a>
</span><span id="L-1556"><a href="#L-1556"><span class="linenos">1556</span></a><span class="c1"># Aliases of common charsets, see &lt;http://www.iana.org/assignments/character-sets&gt;.</span>
</span><span id="L-1557"><a href="#L-1557"><span class="linenos">1557</span></a><span class="n">character_set_aliases</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1558"><a href="#L-1558"><span class="linenos">1558</span></a>    <span class="s1">&#39;ASCII&#39;</span><span class="p">:</span> <span class="s1">&#39;US-ASCII&#39;</span><span class="p">,</span>
</span><span id="L-1559"><a href="#L-1559"><span class="linenos">1559</span></a>    <span class="s1">&#39;ISO646-US&#39;</span><span class="p">:</span> <span class="s1">&#39;US-ASCII&#39;</span><span class="p">,</span>
</span><span id="L-1560"><a href="#L-1560"><span class="linenos">1560</span></a>    <span class="s1">&#39;IBM367&#39;</span><span class="p">:</span> <span class="s1">&#39;US-ASCII&#39;</span><span class="p">,</span>
</span><span id="L-1561"><a href="#L-1561"><span class="linenos">1561</span></a>    <span class="s1">&#39;CP367&#39;</span><span class="p">:</span> <span class="s1">&#39;US-ASCII&#39;</span><span class="p">,</span>
</span><span id="L-1562"><a href="#L-1562"><span class="linenos">1562</span></a>    <span class="s1">&#39;CSASCII&#39;</span><span class="p">:</span> <span class="s1">&#39;US-ASCII&#39;</span><span class="p">,</span>
</span><span id="L-1563"><a href="#L-1563"><span class="linenos">1563</span></a>    <span class="s1">&#39;ANSI_X3.4-1968&#39;</span><span class="p">:</span> <span class="s1">&#39;US-ASCII&#39;</span><span class="p">,</span>
</span><span id="L-1564"><a href="#L-1564"><span class="linenos">1564</span></a>    <span class="s1">&#39;ISO_646.IRV:1991&#39;</span><span class="p">:</span> <span class="s1">&#39;US-ASCII&#39;</span><span class="p">,</span>
</span><span id="L-1565"><a href="#L-1565"><span class="linenos">1565</span></a>
</span><span id="L-1566"><a href="#L-1566"><span class="linenos">1566</span></a>    <span class="s1">&#39;UTF7&#39;</span><span class="p">:</span> <span class="s1">&#39;UTF-7&#39;</span><span class="p">,</span>
</span><span id="L-1567"><a href="#L-1567"><span class="linenos">1567</span></a>
</span><span id="L-1568"><a href="#L-1568"><span class="linenos">1568</span></a>    <span class="s1">&#39;UTF8&#39;</span><span class="p">:</span> <span class="s1">&#39;UTF-8&#39;</span><span class="p">,</span>
</span><span id="L-1569"><a href="#L-1569"><span class="linenos">1569</span></a>
</span><span id="L-1570"><a href="#L-1570"><span class="linenos">1570</span></a>    <span class="s1">&#39;UTF16&#39;</span><span class="p">:</span> <span class="s1">&#39;UTF-16&#39;</span><span class="p">,</span>
</span><span id="L-1571"><a href="#L-1571"><span class="linenos">1571</span></a>    <span class="s1">&#39;UTF16LE&#39;</span><span class="p">:</span> <span class="s1">&#39;UTF-16LE&#39;</span><span class="p">,</span>
</span><span id="L-1572"><a href="#L-1572"><span class="linenos">1572</span></a>    <span class="s1">&#39;UTF16BE&#39;</span><span class="p">:</span> <span class="s1">&#39;UTF-16BE&#39;</span><span class="p">,</span>
</span><span id="L-1573"><a href="#L-1573"><span class="linenos">1573</span></a>
</span><span id="L-1574"><a href="#L-1574"><span class="linenos">1574</span></a>    <span class="s1">&#39;UTF32&#39;</span><span class="p">:</span> <span class="s1">&#39;UTF-32&#39;</span><span class="p">,</span>
</span><span id="L-1575"><a href="#L-1575"><span class="linenos">1575</span></a>    <span class="s1">&#39;UTF32LE&#39;</span><span class="p">:</span> <span class="s1">&#39;UTF-32LE&#39;</span><span class="p">,</span>
</span><span id="L-1576"><a href="#L-1576"><span class="linenos">1576</span></a>    <span class="s1">&#39;UTF32BE&#39;</span><span class="p">:</span> <span class="s1">&#39;UTF-32BE&#39;</span><span class="p">,</span>
</span><span id="L-1577"><a href="#L-1577"><span class="linenos">1577</span></a>
</span><span id="L-1578"><a href="#L-1578"><span class="linenos">1578</span></a>    <span class="s1">&#39;UCS2&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-10646-UCS-2&#39;</span><span class="p">,</span>
</span><span id="L-1579"><a href="#L-1579"><span class="linenos">1579</span></a>    <span class="s1">&#39;UCS_2&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-10646-UCS-2&#39;</span><span class="p">,</span>
</span><span id="L-1580"><a href="#L-1580"><span class="linenos">1580</span></a>    <span class="s1">&#39;UCS-2&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-10646-UCS-2&#39;</span><span class="p">,</span>
</span><span id="L-1581"><a href="#L-1581"><span class="linenos">1581</span></a>    <span class="s1">&#39;CSUNICODE&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-10646-UCS-2&#39;</span><span class="p">,</span>
</span><span id="L-1582"><a href="#L-1582"><span class="linenos">1582</span></a>
</span><span id="L-1583"><a href="#L-1583"><span class="linenos">1583</span></a>    <span class="s1">&#39;UCS4&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-10646-UCS-4&#39;</span><span class="p">,</span>
</span><span id="L-1584"><a href="#L-1584"><span class="linenos">1584</span></a>    <span class="s1">&#39;UCS_4&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-10646-UCS-4&#39;</span><span class="p">,</span>
</span><span id="L-1585"><a href="#L-1585"><span class="linenos">1585</span></a>    <span class="s1">&#39;UCS-4&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-10646-UCS-4&#39;</span><span class="p">,</span>
</span><span id="L-1586"><a href="#L-1586"><span class="linenos">1586</span></a>    <span class="s1">&#39;CSUCS4&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-10646-UCS-4&#39;</span><span class="p">,</span>
</span><span id="L-1587"><a href="#L-1587"><span class="linenos">1587</span></a>
</span><span id="L-1588"><a href="#L-1588"><span class="linenos">1588</span></a>    <span class="s1">&#39;ISO_8859-1&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-1&#39;</span><span class="p">,</span>
</span><span id="L-1589"><a href="#L-1589"><span class="linenos">1589</span></a>    <span class="s1">&#39;LATIN1&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-1&#39;</span><span class="p">,</span>
</span><span id="L-1590"><a href="#L-1590"><span class="linenos">1590</span></a>    <span class="s1">&#39;CP819&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-1&#39;</span><span class="p">,</span>
</span><span id="L-1591"><a href="#L-1591"><span class="linenos">1591</span></a>    <span class="s1">&#39;IBM819&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-1&#39;</span><span class="p">,</span>
</span><span id="L-1592"><a href="#L-1592"><span class="linenos">1592</span></a>
</span><span id="L-1593"><a href="#L-1593"><span class="linenos">1593</span></a>    <span class="s1">&#39;ISO_8859-2&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-2&#39;</span><span class="p">,</span>
</span><span id="L-1594"><a href="#L-1594"><span class="linenos">1594</span></a>    <span class="s1">&#39;LATIN2&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-2&#39;</span><span class="p">,</span>
</span><span id="L-1595"><a href="#L-1595"><span class="linenos">1595</span></a>
</span><span id="L-1596"><a href="#L-1596"><span class="linenos">1596</span></a>    <span class="s1">&#39;ISO_8859-3&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-3&#39;</span><span class="p">,</span>
</span><span id="L-1597"><a href="#L-1597"><span class="linenos">1597</span></a>    <span class="s1">&#39;LATIN3&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-3&#39;</span><span class="p">,</span>
</span><span id="L-1598"><a href="#L-1598"><span class="linenos">1598</span></a>
</span><span id="L-1599"><a href="#L-1599"><span class="linenos">1599</span></a>    <span class="s1">&#39;ISO_8859-4&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-4&#39;</span><span class="p">,</span>
</span><span id="L-1600"><a href="#L-1600"><span class="linenos">1600</span></a>    <span class="s1">&#39;LATIN4&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-4&#39;</span><span class="p">,</span>
</span><span id="L-1601"><a href="#L-1601"><span class="linenos">1601</span></a>
</span><span id="L-1602"><a href="#L-1602"><span class="linenos">1602</span></a>    <span class="s1">&#39;ISO_8859-5&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-5&#39;</span><span class="p">,</span>
</span><span id="L-1603"><a href="#L-1603"><span class="linenos">1603</span></a>    <span class="s1">&#39;CYRILLIC&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-5&#39;</span><span class="p">,</span>
</span><span id="L-1604"><a href="#L-1604"><span class="linenos">1604</span></a>
</span><span id="L-1605"><a href="#L-1605"><span class="linenos">1605</span></a>    <span class="s1">&#39;ISO_8859-6&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-6&#39;</span><span class="p">,</span>
</span><span id="L-1606"><a href="#L-1606"><span class="linenos">1606</span></a>    <span class="s1">&#39;ARABIC&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-6&#39;</span><span class="p">,</span>
</span><span id="L-1607"><a href="#L-1607"><span class="linenos">1607</span></a>    <span class="s1">&#39;ECMA-114&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-6&#39;</span><span class="p">,</span>
</span><span id="L-1608"><a href="#L-1608"><span class="linenos">1608</span></a>
</span><span id="L-1609"><a href="#L-1609"><span class="linenos">1609</span></a>    <span class="s1">&#39;ISO_8859-6-E&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-6-E&#39;</span><span class="p">,</span>
</span><span id="L-1610"><a href="#L-1610"><span class="linenos">1610</span></a>    <span class="s1">&#39;ISO_8859-6-I&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-6-I&#39;</span><span class="p">,</span>
</span><span id="L-1611"><a href="#L-1611"><span class="linenos">1611</span></a>
</span><span id="L-1612"><a href="#L-1612"><span class="linenos">1612</span></a>    <span class="s1">&#39;ISO_8859-7&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-7&#39;</span><span class="p">,</span>
</span><span id="L-1613"><a href="#L-1613"><span class="linenos">1613</span></a>    <span class="s1">&#39;GREEK&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-7&#39;</span><span class="p">,</span>
</span><span id="L-1614"><a href="#L-1614"><span class="linenos">1614</span></a>    <span class="s1">&#39;GREEK8&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-7&#39;</span><span class="p">,</span>
</span><span id="L-1615"><a href="#L-1615"><span class="linenos">1615</span></a>    <span class="s1">&#39;ECMA-118&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-7&#39;</span><span class="p">,</span>
</span><span id="L-1616"><a href="#L-1616"><span class="linenos">1616</span></a>
</span><span id="L-1617"><a href="#L-1617"><span class="linenos">1617</span></a>    <span class="s1">&#39;ISO_8859-8&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-8&#39;</span><span class="p">,</span>
</span><span id="L-1618"><a href="#L-1618"><span class="linenos">1618</span></a>    <span class="s1">&#39;HEBREW&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-8&#39;</span><span class="p">,</span>
</span><span id="L-1619"><a href="#L-1619"><span class="linenos">1619</span></a>
</span><span id="L-1620"><a href="#L-1620"><span class="linenos">1620</span></a>    <span class="s1">&#39;ISO_8859-8-E&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-8-E&#39;</span><span class="p">,</span>
</span><span id="L-1621"><a href="#L-1621"><span class="linenos">1621</span></a>    <span class="s1">&#39;ISO_8859-8-I&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-8-I&#39;</span><span class="p">,</span>
</span><span id="L-1622"><a href="#L-1622"><span class="linenos">1622</span></a>
</span><span id="L-1623"><a href="#L-1623"><span class="linenos">1623</span></a>    <span class="s1">&#39;ISO_8859-9&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-9&#39;</span><span class="p">,</span>
</span><span id="L-1624"><a href="#L-1624"><span class="linenos">1624</span></a>    <span class="s1">&#39;LATIN5&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-9&#39;</span><span class="p">,</span>
</span><span id="L-1625"><a href="#L-1625"><span class="linenos">1625</span></a>
</span><span id="L-1626"><a href="#L-1626"><span class="linenos">1626</span></a>    <span class="s1">&#39;ISO_8859-10&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-10&#39;</span><span class="p">,</span>
</span><span id="L-1627"><a href="#L-1627"><span class="linenos">1627</span></a>    <span class="s1">&#39;LATIN6&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-10&#39;</span><span class="p">,</span>
</span><span id="L-1628"><a href="#L-1628"><span class="linenos">1628</span></a>
</span><span id="L-1629"><a href="#L-1629"><span class="linenos">1629</span></a>    <span class="s1">&#39;ISO_8859-13&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-13&#39;</span><span class="p">,</span>
</span><span id="L-1630"><a href="#L-1630"><span class="linenos">1630</span></a>
</span><span id="L-1631"><a href="#L-1631"><span class="linenos">1631</span></a>    <span class="s1">&#39;ISO_8859-14&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-14&#39;</span><span class="p">,</span>
</span><span id="L-1632"><a href="#L-1632"><span class="linenos">1632</span></a>    <span class="s1">&#39;LATIN8&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-14&#39;</span><span class="p">,</span>
</span><span id="L-1633"><a href="#L-1633"><span class="linenos">1633</span></a>
</span><span id="L-1634"><a href="#L-1634"><span class="linenos">1634</span></a>    <span class="s1">&#39;ISO_8859-15&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-15&#39;</span><span class="p">,</span>
</span><span id="L-1635"><a href="#L-1635"><span class="linenos">1635</span></a>    <span class="s1">&#39;LATIN9&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-15&#39;</span><span class="p">,</span>
</span><span id="L-1636"><a href="#L-1636"><span class="linenos">1636</span></a>
</span><span id="L-1637"><a href="#L-1637"><span class="linenos">1637</span></a>    <span class="s1">&#39;ISO_8859-16&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-16&#39;</span><span class="p">,</span>
</span><span id="L-1638"><a href="#L-1638"><span class="linenos">1638</span></a>    <span class="s1">&#39;LATIN10&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-16&#39;</span><span class="p">,</span>
</span><span id="L-1639"><a href="#L-1639"><span class="linenos">1639</span></a>    <span class="p">}</span>
</span><span id="L-1640"><a href="#L-1640"><span class="linenos">1640</span></a>
</span><span id="L-1641"><a href="#L-1641"><span class="linenos">1641</span></a><span class="k">def</span> <span class="nf">canonical_charset</span><span class="p">(</span> <span class="n">charset</span> <span class="p">):</span>
</span><span id="L-1642"><a href="#L-1642"><span class="linenos">1642</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the canonical or preferred name of a charset.</span>
</span><span id="L-1643"><a href="#L-1643"><span class="linenos">1643</span></a>
</span><span id="L-1644"><a href="#L-1644"><span class="linenos">1644</span></a><span class="sd">    Additional character sets can be recognized by this function by</span>
</span><span id="L-1645"><a href="#L-1645"><span class="linenos">1645</span></a><span class="sd">    altering the character_set_aliases dictionary in this module.</span>
</span><span id="L-1646"><a href="#L-1646"><span class="linenos">1646</span></a><span class="sd">    Charsets which are not recognized are simply converted to</span>
</span><span id="L-1647"><a href="#L-1647"><span class="linenos">1647</span></a><span class="sd">    upper-case (as charset names are always case-insensitive).</span>
</span><span id="L-1648"><a href="#L-1648"><span class="linenos">1648</span></a><span class="sd">    </span>
</span><span id="L-1649"><a href="#L-1649"><span class="linenos">1649</span></a><span class="sd">    See &lt;http://www.iana.org/assignments/character-sets&gt;.</span>
</span><span id="L-1650"><a href="#L-1650"><span class="linenos">1650</span></a>
</span><span id="L-1651"><a href="#L-1651"><span class="linenos">1651</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1652"><a href="#L-1652"><span class="linenos">1652</span></a>    <span class="c1"># It would be nice to use Python&#39;s codecs modules for this, but</span>
</span><span id="L-1653"><a href="#L-1653"><span class="linenos">1653</span></a>    <span class="c1"># there is no fixed public interface to it&#39;s alias mappings.</span>
</span><span id="L-1654"><a href="#L-1654"><span class="linenos">1654</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">charset</span><span class="p">:</span>
</span><span id="L-1655"><a href="#L-1655"><span class="linenos">1655</span></a>        <span class="k">return</span> <span class="n">charset</span>
</span><span id="L-1656"><a href="#L-1656"><span class="linenos">1656</span></a>    <span class="n">uc</span> <span class="o">=</span> <span class="n">charset</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="L-1657"><a href="#L-1657"><span class="linenos">1657</span></a>    <span class="n">uccon</span> <span class="o">=</span> <span class="n">character_set_aliases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">uc</span><span class="p">,</span> <span class="n">uc</span> <span class="p">)</span>
</span><span id="L-1658"><a href="#L-1658"><span class="linenos">1658</span></a>    <span class="k">return</span> <span class="n">uccon</span>
</span><span id="L-1659"><a href="#L-1659"><span class="linenos">1659</span></a>
</span><span id="L-1660"><a href="#L-1660"><span class="linenos">1660</span></a>
</span><span id="L-1661"><a href="#L-1661"><span class="linenos">1661</span></a><span class="k">def</span> <span class="nf">acceptable_charset</span><span class="p">(</span> <span class="n">accept_charset_header</span><span class="p">,</span> <span class="n">charsets</span><span class="p">,</span> <span class="n">ignore_wildcard</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;ISO-8859-1&#39;</span> <span class="p">):</span>
</span><span id="L-1662"><a href="#L-1662"><span class="linenos">1662</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1663"><a href="#L-1663"><span class="linenos">1663</span></a><span class="sd">    Determines if the given charset is acceptable to the user agent.</span>
</span><span id="L-1664"><a href="#L-1664"><span class="linenos">1664</span></a>
</span><span id="L-1665"><a href="#L-1665"><span class="linenos">1665</span></a><span class="sd">    The accept_charset_header should be the value present in the HTTP</span>
</span><span id="L-1666"><a href="#L-1666"><span class="linenos">1666</span></a><span class="sd">    &quot;Accept-Charset:&quot; header.  In mod_python this is typically</span>
</span><span id="L-1667"><a href="#L-1667"><span class="linenos">1667</span></a><span class="sd">    obtained from the req.http_headers table; in WSGI it is</span>
</span><span id="L-1668"><a href="#L-1668"><span class="linenos">1668</span></a><span class="sd">    environ[&quot;Accept-Charset&quot;]; other web frameworks may provide other</span>
</span><span id="L-1669"><a href="#L-1669"><span class="linenos">1669</span></a><span class="sd">    methods of obtaining it.</span>
</span><span id="L-1670"><a href="#L-1670"><span class="linenos">1670</span></a>
</span><span id="L-1671"><a href="#L-1671"><span class="linenos">1671</span></a><span class="sd">    Optionally the accept_charset_header parameter can instead be the</span>
</span><span id="L-1672"><a href="#L-1672"><span class="linenos">1672</span></a><span class="sd">    list returned from the parse_accept_header() function in this</span>
</span><span id="L-1673"><a href="#L-1673"><span class="linenos">1673</span></a><span class="sd">    module.</span>
</span><span id="L-1674"><a href="#L-1674"><span class="linenos">1674</span></a>
</span><span id="L-1675"><a href="#L-1675"><span class="linenos">1675</span></a><span class="sd">    The charsets argument should either be a charset identifier string,</span>
</span><span id="L-1676"><a href="#L-1676"><span class="linenos">1676</span></a><span class="sd">    or a sequence of them.</span>
</span><span id="L-1677"><a href="#L-1677"><span class="linenos">1677</span></a>
</span><span id="L-1678"><a href="#L-1678"><span class="linenos">1678</span></a><span class="sd">    This function returns the charset identifier string which is the</span>
</span><span id="L-1679"><a href="#L-1679"><span class="linenos">1679</span></a><span class="sd">    most prefered and is acceptable to both the user agent and the</span>
</span><span id="L-1680"><a href="#L-1680"><span class="linenos">1680</span></a><span class="sd">    caller.  It will return the default value if no charset is negotiable.</span>
</span><span id="L-1681"><a href="#L-1681"><span class="linenos">1681</span></a><span class="sd">    </span>
</span><span id="L-1682"><a href="#L-1682"><span class="linenos">1682</span></a><span class="sd">    Note that the wildcarded charset &quot;*&quot; will be ignored.  To override</span>
</span><span id="L-1683"><a href="#L-1683"><span class="linenos">1683</span></a><span class="sd">    this, call with ignore_wildcard=False.</span>
</span><span id="L-1684"><a href="#L-1684"><span class="linenos">1684</span></a>
</span><span id="L-1685"><a href="#L-1685"><span class="linenos">1685</span></a><span class="sd">    See also: RFC 2616 section 14.2, and</span>
</span><span id="L-1686"><a href="#L-1686"><span class="linenos">1686</span></a><span class="sd">    &lt;http://www.iana.org/assignments/character-sets&gt;</span>
</span><span id="L-1687"><a href="#L-1687"><span class="linenos">1687</span></a>
</span><span id="L-1688"><a href="#L-1688"><span class="linenos">1688</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1689"><a href="#L-1689"><span class="linenos">1689</span></a>    <span class="k">if</span> <span class="n">default</span><span class="p">:</span>
</span><span id="L-1690"><a href="#L-1690"><span class="linenos">1690</span></a>        <span class="n">default</span> <span class="o">=</span> <span class="n">_canonical_charset</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
</span><span id="L-1691"><a href="#L-1691"><span class="linenos">1691</span></a>
</span><span id="L-1692"><a href="#L-1692"><span class="linenos">1692</span></a>    <span class="k">if</span> <span class="n">_is_string</span><span class="p">(</span><span class="n">accept_charset_header</span><span class="p">):</span>
</span><span id="L-1693"><a href="#L-1693"><span class="linenos">1693</span></a>        <span class="n">accept_list</span> <span class="o">=</span> <span class="n">parse_accept_header</span><span class="p">(</span><span class="n">accept_charset_header</span><span class="p">)</span>
</span><span id="L-1694"><a href="#L-1694"><span class="linenos">1694</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1695"><a href="#L-1695"><span class="linenos">1695</span></a>        <span class="n">accept_list</span> <span class="o">=</span> <span class="n">accept_charset_header</span>
</span><span id="L-1696"><a href="#L-1696"><span class="linenos">1696</span></a>
</span><span id="L-1697"><a href="#L-1697"><span class="linenos">1697</span></a>    <span class="k">if</span> <span class="n">_is_string</span><span class="p">(</span><span class="n">charsets</span><span class="p">):</span>
</span><span id="L-1698"><a href="#L-1698"><span class="linenos">1698</span></a>        <span class="n">charsets</span> <span class="o">=</span> <span class="p">[</span><span class="n">_canonical_charset</span><span class="p">(</span><span class="n">charsets</span><span class="p">)]</span>
</span><span id="L-1699"><a href="#L-1699"><span class="linenos">1699</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1700"><a href="#L-1700"><span class="linenos">1700</span></a>        <span class="n">charsets</span> <span class="o">=</span> <span class="p">[</span><span class="n">_canonical_charset</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">charsets</span><span class="p">]</span>
</span><span id="L-1701"><a href="#L-1701"><span class="linenos">1701</span></a>
</span><span id="L-1702"><a href="#L-1702"><span class="linenos">1702</span></a>    <span class="c1"># Note per RFC that &#39;ISO-8859-1&#39; is special, and is implictly in the</span>
</span><span id="L-1703"><a href="#L-1703"><span class="linenos">1703</span></a>    <span class="c1"># accept list with q=1; unless it is already in the list, or &#39;*&#39; is in the list.</span>
</span><span id="L-1704"><a href="#L-1704"><span class="linenos">1704</span></a>
</span><span id="L-1705"><a href="#L-1705"><span class="linenos">1705</span></a>    <span class="n">best</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1706"><a href="#L-1706"><span class="linenos">1706</span></a>    <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">qvalue</span><span class="p">,</span> <span class="n">junk</span> <span class="ow">in</span> <span class="n">accept_list</span><span class="p">:</span>
</span><span id="L-1707"><a href="#L-1707"><span class="linenos">1707</span></a>        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
</span><span id="L-1708"><a href="#L-1708"><span class="linenos">1708</span></a>            <span class="n">default</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1709"><a href="#L-1709"><span class="linenos">1709</span></a>            <span class="k">if</span> <span class="n">ignore_wildcard</span><span class="p">:</span>
</span><span id="L-1710"><a href="#L-1710"><span class="linenos">1710</span></a>                <span class="k">continue</span>
</span><span id="L-1711"><a href="#L-1711"><span class="linenos">1711</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">best</span> <span class="ow">or</span> <span class="n">qvalue</span> <span class="o">&gt;</span> <span class="n">best</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-1712"><a href="#L-1712"><span class="linenos">1712</span></a>                <span class="n">best</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">qvalue</span><span class="p">)</span>
</span><span id="L-1713"><a href="#L-1713"><span class="linenos">1713</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1714"><a href="#L-1714"><span class="linenos">1714</span></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">_canonical_charset</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="L-1715"><a href="#L-1715"><span class="linenos">1715</span></a>            <span class="k">for</span> <span class="n">test_c</span> <span class="ow">in</span> <span class="n">charsets</span><span class="p">:</span>
</span><span id="L-1716"><a href="#L-1716"><span class="linenos">1716</span></a>                <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">default</span><span class="p">:</span>
</span><span id="L-1717"><a href="#L-1717"><span class="linenos">1717</span></a>                    <span class="n">default</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1718"><a href="#L-1718"><span class="linenos">1718</span></a>                <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">test_c</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">best</span> <span class="ow">or</span> <span class="n">best</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;*&#39;</span> <span class="ow">or</span> <span class="n">qvalue</span> <span class="o">&gt;</span> <span class="n">best</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-1719"><a href="#L-1719"><span class="linenos">1719</span></a>                    <span class="n">best</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">qvalue</span><span class="p">)</span>
</span><span id="L-1720"><a href="#L-1720"><span class="linenos">1720</span></a>    <span class="k">if</span> <span class="n">default</span> <span class="ow">and</span> <span class="n">default</span> <span class="ow">in</span> <span class="p">[</span><span class="n">test_c</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">test_c</span> <span class="ow">in</span> <span class="n">charsets</span><span class="p">]:</span>
</span><span id="L-1721"><a href="#L-1721"><span class="linenos">1721</span></a>        <span class="n">best</span> <span class="o">=</span> <span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-1722"><a href="#L-1722"><span class="linenos">1722</span></a>    <span class="k">if</span> <span class="n">best</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
</span><span id="L-1723"><a href="#L-1723"><span class="linenos">1723</span></a>        <span class="n">best</span> <span class="o">=</span> <span class="p">(</span><span class="n">charsets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">best</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-1724"><a href="#L-1724"><span class="linenos">1724</span></a>    <span class="k">return</span> <span class="n">best</span>
</span><span id="L-1725"><a href="#L-1725"><span class="linenos">1725</span></a>
</span><span id="L-1726"><a href="#L-1726"><span class="linenos">1726</span></a>
</span><span id="L-1727"><a href="#L-1727"><span class="linenos">1727</span></a>
</span><span id="L-1728"><a href="#L-1728"><span class="linenos">1728</span></a><span class="k">class</span> <span class="nc">language_tag</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="L-1729"><a href="#L-1729"><span class="linenos">1729</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class represents an RFC 3066 language tag.</span>
</span><span id="L-1730"><a href="#L-1730"><span class="linenos">1730</span></a>
</span><span id="L-1731"><a href="#L-1731"><span class="linenos">1731</span></a><span class="sd">    Initialize objects of this class with a single string representing</span>
</span><span id="L-1732"><a href="#L-1732"><span class="linenos">1732</span></a><span class="sd">    the language tag, such as &quot;en-US&quot;.</span>
</span><span id="L-1733"><a href="#L-1733"><span class="linenos">1733</span></a><span class="sd">        </span>
</span><span id="L-1734"><a href="#L-1734"><span class="linenos">1734</span></a><span class="sd">    Case is insensitive. Wildcarded subtags are ignored or stripped as</span>
</span><span id="L-1735"><a href="#L-1735"><span class="linenos">1735</span></a><span class="sd">    they have no significance, so that &quot;en-*&quot; is the same as &quot;en&quot;.</span>
</span><span id="L-1736"><a href="#L-1736"><span class="linenos">1736</span></a><span class="sd">    However the universal wildcard &quot;*&quot; language tag is kept as-is.</span>
</span><span id="L-1737"><a href="#L-1737"><span class="linenos">1737</span></a>
</span><span id="L-1738"><a href="#L-1738"><span class="linenos">1738</span></a><span class="sd">    Note that although relational operators such as &lt; are defined,</span>
</span><span id="L-1739"><a href="#L-1739"><span class="linenos">1739</span></a><span class="sd">    they only form a partial order based upon specialization.</span>
</span><span id="L-1740"><a href="#L-1740"><span class="linenos">1740</span></a>
</span><span id="L-1741"><a href="#L-1741"><span class="linenos">1741</span></a><span class="sd">    Thus for example,</span>
</span><span id="L-1742"><a href="#L-1742"><span class="linenos">1742</span></a><span class="sd">         &quot;en&quot; &lt;= &quot;en-US&quot;</span>
</span><span id="L-1743"><a href="#L-1743"><span class="linenos">1743</span></a><span class="sd">    but,</span>
</span><span id="L-1744"><a href="#L-1744"><span class="linenos">1744</span></a><span class="sd">         not &quot;en&quot; &lt;= &quot;de&quot;, and</span>
</span><span id="L-1745"><a href="#L-1745"><span class="linenos">1745</span></a><span class="sd">         not &quot;de&quot; &lt;= &quot;en&quot;.</span>
</span><span id="L-1746"><a href="#L-1746"><span class="linenos">1746</span></a>
</span><span id="L-1747"><a href="#L-1747"><span class="linenos">1747</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1748"><a href="#L-1748"><span class="linenos">1748</span></a>
</span><span id="L-1749"><a href="#L-1749"><span class="linenos">1749</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagname</span><span class="p">):</span>
</span><span id="L-1750"><a href="#L-1750"><span class="linenos">1750</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize objects of this class with a single string representing</span>
</span><span id="L-1751"><a href="#L-1751"><span class="linenos">1751</span></a><span class="sd">        the language tag, such as &quot;en-US&quot;.  Case is insensitive.</span>
</span><span id="L-1752"><a href="#L-1752"><span class="linenos">1752</span></a>
</span><span id="L-1753"><a href="#L-1753"><span class="linenos">1753</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1754"><a href="#L-1754"><span class="linenos">1754</span></a>
</span><span id="L-1755"><a href="#L-1755"><span class="linenos">1755</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parts</span> <span class="o">=</span> <span class="n">tagname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
</span><span id="L-1756"><a href="#L-1756"><span class="linenos">1756</span></a>        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
</span><span id="L-1757"><a href="#L-1757"><span class="linenos">1757</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1758"><a href="#L-1758"><span class="linenos">1758</span></a>
</span><span id="L-1759"><a href="#L-1759"><span class="linenos">1759</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1760"><a href="#L-1760"><span class="linenos">1760</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of subtags in this tag.&quot;&quot;&quot;</span>
</span><span id="L-1761"><a href="#L-1761"><span class="linenos">1761</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
</span><span id="L-1762"><a href="#L-1762"><span class="linenos">1762</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="L-1763"><a href="#L-1763"><span class="linenos">1763</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span>
</span><span id="L-1764"><a href="#L-1764"><span class="linenos">1764</span></a>
</span><span id="L-1765"><a href="#L-1765"><span class="linenos">1765</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1766"><a href="#L-1766"><span class="linenos">1766</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The standard string form of this language tag.&quot;&quot;&quot;</span>
</span><span id="L-1767"><a href="#L-1767"><span class="linenos">1767</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1768"><a href="#L-1768"><span class="linenos">1768</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1769"><a href="#L-1769"><span class="linenos">1769</span></a>            <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1770"><a href="#L-1770"><span class="linenos">1770</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-1771"><a href="#L-1771"><span class="linenos">1771</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-1772"><a href="#L-1772"><span class="linenos">1772</span></a>                <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="p">)</span>
</span><span id="L-1773"><a href="#L-1773"><span class="linenos">1773</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1774"><a href="#L-1774"><span class="linenos">1774</span></a>                <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
</span><span id="L-1775"><a href="#L-1775"><span class="linenos">1775</span></a>        <span class="n">a</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="p">)</span>
</span><span id="L-1776"><a href="#L-1776"><span class="linenos">1776</span></a>        <span class="k">return</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="L-1777"><a href="#L-1777"><span class="linenos">1777</span></a>
</span><span id="L-1778"><a href="#L-1778"><span class="linenos">1778</span></a>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1779"><a href="#L-1779"><span class="linenos">1779</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The unicode string form of this language tag.&quot;&quot;&quot;</span>
</span><span id="L-1780"><a href="#L-1780"><span class="linenos">1780</span></a>        <span class="c1"># Probably unnecessary in Python 3</span>
</span><span id="L-1781"><a href="#L-1781"><span class="linenos">1781</span></a>        <span class="k">if</span> <span class="n">PY3</span> <span class="p">:</span>
</span><span id="L-1782"><a href="#L-1782"><span class="linenos">1782</span></a>            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span><span id="L-1783"><a href="#L-1783"><span class="linenos">1783</span></a>        <span class="k">else</span> <span class="p">:</span>
</span><span id="L-1784"><a href="#L-1784"><span class="linenos">1784</span></a>            <span class="k">return</span> <span class="n">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span><span id="L-1785"><a href="#L-1785"><span class="linenos">1785</span></a>
</span><span id="L-1786"><a href="#L-1786"><span class="linenos">1786</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1787"><a href="#L-1787"><span class="linenos">1787</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The python representation of this language tag.&quot;&quot;&quot;</span>
</span><span id="L-1788"><a href="#L-1788"><span class="linenos">1788</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(&quot;</span><span class="si">%s</span><span class="s1">&quot;)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span><span id="L-1789"><a href="#L-1789"><span class="linenos">1789</span></a>        <span class="k">return</span> <span class="n">s</span>
</span><span id="L-1790"><a href="#L-1790"><span class="linenos">1790</span></a>
</span><span id="L-1791"><a href="#L-1791"><span class="linenos">1791</span></a>    <span class="k">def</span> <span class="nf">superior</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1792"><a href="#L-1792"><span class="linenos">1792</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns another instance of language_tag which is the superior.</span>
</span><span id="L-1793"><a href="#L-1793"><span class="linenos">1793</span></a>
</span><span id="L-1794"><a href="#L-1794"><span class="linenos">1794</span></a><span class="sd">        Thus en-US gives en, and en gives *.</span>
</span><span id="L-1795"><a href="#L-1795"><span class="linenos">1795</span></a>
</span><span id="L-1796"><a href="#L-1796"><span class="linenos">1796</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1797"><a href="#L-1797"><span class="linenos">1797</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1798"><a href="#L-1798"><span class="linenos">1798</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span id="L-1799"><a href="#L-1799"><span class="linenos">1799</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
</span><span id="L-1800"><a href="#L-1800"><span class="linenos">1800</span></a>
</span><span id="L-1801"><a href="#L-1801"><span class="linenos">1801</span></a>    <span class="k">def</span> <span class="nf">all_superiors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_wildcard</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-1802"><a href="#L-1802"><span class="linenos">1802</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of this language and all it&#39;s superiors.</span>
</span><span id="L-1803"><a href="#L-1803"><span class="linenos">1803</span></a>
</span><span id="L-1804"><a href="#L-1804"><span class="linenos">1804</span></a><span class="sd">        If include_wildcard is False, then &quot;*&quot; will not be among the</span>
</span><span id="L-1805"><a href="#L-1805"><span class="linenos">1805</span></a><span class="sd">        output list, unless this language is itself &quot;*&quot;.</span>
</span><span id="L-1806"><a href="#L-1806"><span class="linenos">1806</span></a>
</span><span id="L-1807"><a href="#L-1807"><span class="linenos">1807</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1808"><a href="#L-1808"><span class="linenos">1808</span></a>        <span class="n">langlist</span> <span class="o">=</span> <span class="p">[</span> <span class="bp">self</span> <span class="p">]</span>
</span><span id="L-1809"><a href="#L-1809"><span class="linenos">1809</span></a>        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="L-1810"><a href="#L-1810"><span class="linenos">1810</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">l</span><span class="o">.</span><span class="n">is_universal_wildcard</span><span class="p">():</span>
</span><span id="L-1811"><a href="#L-1811"><span class="linenos">1811</span></a>            <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">superior</span><span class="p">()</span>
</span><span id="L-1812"><a href="#L-1812"><span class="linenos">1812</span></a>            <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">is_universal_wildcard</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">include_wildcard</span><span class="p">:</span>
</span><span id="L-1813"><a href="#L-1813"><span class="linenos">1813</span></a>                <span class="k">continue</span>
</span><span id="L-1814"><a href="#L-1814"><span class="linenos">1814</span></a>            <span class="n">langlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</span><span id="L-1815"><a href="#L-1815"><span class="linenos">1815</span></a>        <span class="k">return</span> <span class="n">langlist</span>
</span><span id="L-1816"><a href="#L-1816"><span class="linenos">1816</span></a>                
</span><span id="L-1817"><a href="#L-1817"><span class="linenos">1817</span></a>    <span class="k">def</span> <span class="nf">is_universal_wildcard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1818"><a href="#L-1818"><span class="linenos">1818</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if this language tag represents all possible</span>
</span><span id="L-1819"><a href="#L-1819"><span class="linenos">1819</span></a><span class="sd">        languages, by using the reserved tag of &quot;*&quot;.</span>
</span><span id="L-1820"><a href="#L-1820"><span class="linenos">1820</span></a>
</span><span id="L-1821"><a href="#L-1821"><span class="linenos">1821</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1822"><a href="#L-1822"><span class="linenos">1822</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span>
</span><span id="L-1823"><a href="#L-1823"><span class="linenos">1823</span></a>
</span><span id="L-1824"><a href="#L-1824"><span class="linenos">1824</span></a>    <span class="k">def</span> <span class="nf">dialect_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">ignore_wildcard</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-1825"><a href="#L-1825"><span class="linenos">1825</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Is this language a dialect (or subset/specialization) of another.</span>
</span><span id="L-1826"><a href="#L-1826"><span class="linenos">1826</span></a>
</span><span id="L-1827"><a href="#L-1827"><span class="linenos">1827</span></a><span class="sd">        This method returns True if this language is the same as or a</span>
</span><span id="L-1828"><a href="#L-1828"><span class="linenos">1828</span></a><span class="sd">        specialization (dialect) of the other language_tag.</span>
</span><span id="L-1829"><a href="#L-1829"><span class="linenos">1829</span></a>
</span><span id="L-1830"><a href="#L-1830"><span class="linenos">1830</span></a><span class="sd">        If ignore_wildcard is False, then all languages will be</span>
</span><span id="L-1831"><a href="#L-1831"><span class="linenos">1831</span></a><span class="sd">        considered to be a dialect of the special language tag of &quot;*&quot;.</span>
</span><span id="L-1832"><a href="#L-1832"><span class="linenos">1832</span></a>
</span><span id="L-1833"><a href="#L-1833"><span class="linenos">1833</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1834"><a href="#L-1834"><span class="linenos">1834</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_wildcard</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_universal_wildcard</span><span class="p">():</span>
</span><span id="L-1835"><a href="#L-1835"><span class="linenos">1835</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-1836"><a href="#L-1836"><span class="linenos">1836</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">))</span> <span class="p">):</span>
</span><span id="L-1837"><a href="#L-1837"><span class="linenos">1837</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="L-1838"><a href="#L-1838"><span class="linenos">1838</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-1839"><a href="#L-1839"><span class="linenos">1839</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
</span><span id="L-1840"><a href="#L-1840"><span class="linenos">1840</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-1841"><a href="#L-1841"><span class="linenos">1841</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-1842"><a href="#L-1842"><span class="linenos">1842</span></a>
</span><span id="L-1843"><a href="#L-1843"><span class="linenos">1843</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="L-1844"><a href="#L-1844"><span class="linenos">1844</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;== operator. Are the two languages the same?&quot;&quot;&quot;</span>
</span><span id="L-1845"><a href="#L-1845"><span class="linenos">1845</span></a>
</span><span id="L-1846"><a href="#L-1846"><span class="linenos">1846</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">parts</span>
</span><span id="L-1847"><a href="#L-1847"><span class="linenos">1847</span></a>
</span><span id="L-1848"><a href="#L-1848"><span class="linenos">1848</span></a>    <span class="k">def</span> <span class="nf">__neq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="L-1849"><a href="#L-1849"><span class="linenos">1849</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;!= operator. Are the two languages different?&quot;&quot;&quot;</span>
</span><span id="L-1850"><a href="#L-1850"><span class="linenos">1850</span></a>
</span><span id="L-1851"><a href="#L-1851"><span class="linenos">1851</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="L-1852"><a href="#L-1852"><span class="linenos">1852</span></a>
</span><span id="L-1853"><a href="#L-1853"><span class="linenos">1853</span></a>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="L-1854"><a href="#L-1854"><span class="linenos">1854</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&lt; operator. Returns True if the other language is a more</span>
</span><span id="L-1855"><a href="#L-1855"><span class="linenos">1855</span></a><span class="sd">        specialized dialect of this one.&quot;&quot;&quot;</span>
</span><span id="L-1856"><a href="#L-1856"><span class="linenos">1856</span></a>
</span><span id="L-1857"><a href="#L-1857"><span class="linenos">1857</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">dialect_of</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span> <span class="o">!=</span> <span class="n">other</span>
</span><span id="L-1858"><a href="#L-1858"><span class="linenos">1858</span></a>
</span><span id="L-1859"><a href="#L-1859"><span class="linenos">1859</span></a>    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="L-1860"><a href="#L-1860"><span class="linenos">1860</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&lt;= operator. Returns True if the other language is the same</span>
</span><span id="L-1861"><a href="#L-1861"><span class="linenos">1861</span></a><span class="sd">        as or a more specialized dialect of this one.&quot;&quot;&quot;</span>
</span><span id="L-1862"><a href="#L-1862"><span class="linenos">1862</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">dialect_of</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-1863"><a href="#L-1863"><span class="linenos">1863</span></a>
</span><span id="L-1864"><a href="#L-1864"><span class="linenos">1864</span></a>    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="L-1865"><a href="#L-1865"><span class="linenos">1865</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&gt; operator.  Returns True if this language is a more</span>
</span><span id="L-1866"><a href="#L-1866"><span class="linenos">1866</span></a><span class="sd">        specialized dialect of the other one.&quot;&quot;&quot;</span>
</span><span id="L-1867"><a href="#L-1867"><span class="linenos">1867</span></a>
</span><span id="L-1868"><a href="#L-1868"><span class="linenos">1868</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialect_of</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span> <span class="o">!=</span> <span class="n">other</span>
</span><span id="L-1869"><a href="#L-1869"><span class="linenos">1869</span></a>
</span><span id="L-1870"><a href="#L-1870"><span class="linenos">1870</span></a>    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="L-1871"><a href="#L-1871"><span class="linenos">1871</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&gt;= operator.  Returns True if this language is the same as</span>
</span><span id="L-1872"><a href="#L-1872"><span class="linenos">1872</span></a><span class="sd">        or a more specialized dialect of the other one.&quot;&quot;&quot;</span>
</span><span id="L-1873"><a href="#L-1873"><span class="linenos">1873</span></a>
</span><span id="L-1874"><a href="#L-1874"><span class="linenos">1874</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialect_of</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="L-1875"><a href="#L-1875"><span class="linenos">1875</span></a>
</span><span id="L-1876"><a href="#L-1876"><span class="linenos">1876</span></a>
</span><span id="L-1877"><a href="#L-1877"><span class="linenos">1877</span></a><span class="k">def</span> <span class="nf">parse_accept_language_header</span><span class="p">(</span> <span class="n">header_value</span> <span class="p">):</span>
</span><span id="L-1878"><a href="#L-1878"><span class="linenos">1878</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses the Accept-Language header.</span>
</span><span id="L-1879"><a href="#L-1879"><span class="linenos">1879</span></a>
</span><span id="L-1880"><a href="#L-1880"><span class="linenos">1880</span></a><span class="sd">    Returns a list of tuples, each like:</span>
</span><span id="L-1881"><a href="#L-1881"><span class="linenos">1881</span></a>
</span><span id="L-1882"><a href="#L-1882"><span class="linenos">1882</span></a><span class="sd">        (language_tag, qvalue, accept_parameters)</span>
</span><span id="L-1883"><a href="#L-1883"><span class="linenos">1883</span></a>
</span><span id="L-1884"><a href="#L-1884"><span class="linenos">1884</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1885"><a href="#L-1885"><span class="linenos">1885</span></a>    <span class="n">alist</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_qvalue_accept_list</span><span class="p">(</span> <span class="n">header_value</span><span class="p">)</span>
</span><span id="L-1886"><a href="#L-1886"><span class="linenos">1886</span></a>    <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_value</span><span class="p">):</span>
</span><span id="L-1887"><a href="#L-1887"><span class="linenos">1887</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Accept-Language header is invalid&#39;</span><span class="p">,</span><span class="n">header_value</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
</span><span id="L-1888"><a href="#L-1888"><span class="linenos">1888</span></a>
</span><span id="L-1889"><a href="#L-1889"><span class="linenos">1889</span></a>    <span class="n">langlist</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1890"><a href="#L-1890"><span class="linenos">1890</span></a>    <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">langparms</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">acptparms</span> <span class="ow">in</span> <span class="n">alist</span><span class="p">:</span>
</span><span id="L-1891"><a href="#L-1891"><span class="linenos">1891</span></a>        <span class="k">if</span> <span class="n">langparms</span><span class="p">:</span>
</span><span id="L-1892"><a href="#L-1892"><span class="linenos">1892</span></a>            <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Language tag may not have any parameters&#39;</span><span class="p">,</span><span class="n">header_value</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1893"><a href="#L-1893"><span class="linenos">1893</span></a>        <span class="n">lang</span> <span class="o">=</span> <span class="n">language_tag</span><span class="p">(</span> <span class="n">token</span> <span class="p">)</span>
</span><span id="L-1894"><a href="#L-1894"><span class="linenos">1894</span></a>        <span class="n">langlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">lang</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">acptparms</span><span class="p">)</span> <span class="p">)</span>
</span><span id="L-1895"><a href="#L-1895"><span class="linenos">1895</span></a>
</span><span id="L-1896"><a href="#L-1896"><span class="linenos">1896</span></a>    <span class="k">return</span> <span class="n">langlist</span>
</span><span id="L-1897"><a href="#L-1897"><span class="linenos">1897</span></a>
</span><span id="L-1898"><a href="#L-1898"><span class="linenos">1898</span></a>
</span><span id="L-1899"><a href="#L-1899"><span class="linenos">1899</span></a><span class="k">def</span> <span class="nf">acceptable_language</span><span class="p">(</span> <span class="n">accept_header</span><span class="p">,</span> <span class="n">server_languages</span><span class="p">,</span> <span class="n">ignore_wildcard</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">assume_superiors</span><span class="o">=</span><span class="kc">True</span> <span class="p">):</span>
</span><span id="L-1900"><a href="#L-1900"><span class="linenos">1900</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Determines if the given language is acceptable to the user agent.</span>
</span><span id="L-1901"><a href="#L-1901"><span class="linenos">1901</span></a>
</span><span id="L-1902"><a href="#L-1902"><span class="linenos">1902</span></a><span class="sd">    The accept_header should be the value present in the HTTP</span>
</span><span id="L-1903"><a href="#L-1903"><span class="linenos">1903</span></a><span class="sd">    &quot;Accept-Language:&quot; header.  In mod_python this is typically</span>
</span><span id="L-1904"><a href="#L-1904"><span class="linenos">1904</span></a><span class="sd">    obtained from the req.http_headers_in table; in WSGI it is</span>
</span><span id="L-1905"><a href="#L-1905"><span class="linenos">1905</span></a><span class="sd">    environ[&quot;Accept-Language&quot;]; other web frameworks may provide other</span>
</span><span id="L-1906"><a href="#L-1906"><span class="linenos">1906</span></a><span class="sd">    methods of obtaining it.</span>
</span><span id="L-1907"><a href="#L-1907"><span class="linenos">1907</span></a>
</span><span id="L-1908"><a href="#L-1908"><span class="linenos">1908</span></a><span class="sd">    Optionally the accept_header parameter can be pre-parsed, as</span>
</span><span id="L-1909"><a href="#L-1909"><span class="linenos">1909</span></a><span class="sd">    returned by the parse_accept_language_header() function defined in</span>
</span><span id="L-1910"><a href="#L-1910"><span class="linenos">1910</span></a><span class="sd">    this module.</span>
</span><span id="L-1911"><a href="#L-1911"><span class="linenos">1911</span></a>
</span><span id="L-1912"><a href="#L-1912"><span class="linenos">1912</span></a><span class="sd">    The server_languages argument should either be a single language</span>
</span><span id="L-1913"><a href="#L-1913"><span class="linenos">1913</span></a><span class="sd">    string, a language_tag object, or a sequence of them.  It</span>
</span><span id="L-1914"><a href="#L-1914"><span class="linenos">1914</span></a><span class="sd">    represents the set of languages that the server is willing to</span>
</span><span id="L-1915"><a href="#L-1915"><span class="linenos">1915</span></a><span class="sd">    send to the user agent.</span>
</span><span id="L-1916"><a href="#L-1916"><span class="linenos">1916</span></a>
</span><span id="L-1917"><a href="#L-1917"><span class="linenos">1917</span></a><span class="sd">    Note that the wildcarded language tag &quot;*&quot; will be ignored.  To</span>
</span><span id="L-1918"><a href="#L-1918"><span class="linenos">1918</span></a><span class="sd">    override this, call with ignore_wildcard=False, and even then</span>
</span><span id="L-1919"><a href="#L-1919"><span class="linenos">1919</span></a><span class="sd">    it will be the lowest-priority choice regardless of it&#39;s</span>
</span><span id="L-1920"><a href="#L-1920"><span class="linenos">1920</span></a><span class="sd">    quality factor (as per HTTP spec).</span>
</span><span id="L-1921"><a href="#L-1921"><span class="linenos">1921</span></a>
</span><span id="L-1922"><a href="#L-1922"><span class="linenos">1922</span></a><span class="sd">    If the assume_superiors is True then it the languages that the</span>
</span><span id="L-1923"><a href="#L-1923"><span class="linenos">1923</span></a><span class="sd">    browser accepts will automatically include all superior languages.</span>
</span><span id="L-1924"><a href="#L-1924"><span class="linenos">1924</span></a><span class="sd">    Any superior languages which must be added are done so with one</span>
</span><span id="L-1925"><a href="#L-1925"><span class="linenos">1925</span></a><span class="sd">    half the qvalue of the language which is present.  For example, if</span>
</span><span id="L-1926"><a href="#L-1926"><span class="linenos">1926</span></a><span class="sd">    the accept string is &quot;en-US&quot;, then it will be treated as if it</span>
</span><span id="L-1927"><a href="#L-1927"><span class="linenos">1927</span></a><span class="sd">    were &quot;en-US, en;q=0.5&quot;.  Note that although the HTTP 1.1 spec says</span>
</span><span id="L-1928"><a href="#L-1928"><span class="linenos">1928</span></a><span class="sd">    that browsers are supposed to encourage users to configure all</span>
</span><span id="L-1929"><a href="#L-1929"><span class="linenos">1929</span></a><span class="sd">    acceptable languages, sometimes they don&#39;t, thus the ability</span>
</span><span id="L-1930"><a href="#L-1930"><span class="linenos">1930</span></a><span class="sd">    for this function to assume this.  But setting assume_superiors</span>
</span><span id="L-1931"><a href="#L-1931"><span class="linenos">1931</span></a><span class="sd">    to False will insure strict adherence to the HTTP 1.1 spec; which</span>
</span><span id="L-1932"><a href="#L-1932"><span class="linenos">1932</span></a><span class="sd">    means that if the browser accepts &quot;en-US&quot;, then it will not</span>
</span><span id="L-1933"><a href="#L-1933"><span class="linenos">1933</span></a><span class="sd">    be acceptable to send just &quot;en&quot; to it.</span>
</span><span id="L-1934"><a href="#L-1934"><span class="linenos">1934</span></a>
</span><span id="L-1935"><a href="#L-1935"><span class="linenos">1935</span></a><span class="sd">    This function returns the language which is the most prefered and</span>
</span><span id="L-1936"><a href="#L-1936"><span class="linenos">1936</span></a><span class="sd">    is acceptable to both the user agent and the caller.  It will</span>
</span><span id="L-1937"><a href="#L-1937"><span class="linenos">1937</span></a><span class="sd">    return None if no language is negotiable, otherwise the return</span>
</span><span id="L-1938"><a href="#L-1938"><span class="linenos">1938</span></a><span class="sd">    value is always an instance of language_tag.</span>
</span><span id="L-1939"><a href="#L-1939"><span class="linenos">1939</span></a>
</span><span id="L-1940"><a href="#L-1940"><span class="linenos">1940</span></a><span class="sd">    See also: RFC 3066 &lt;http://www.ietf.org/rfc/rfc3066.txt&gt;, and</span>
</span><span id="L-1941"><a href="#L-1941"><span class="linenos">1941</span></a><span class="sd">    ISO 639, links at &lt;http://en.wikipedia.org/wiki/ISO_639&gt;, and</span>
</span><span id="L-1942"><a href="#L-1942"><span class="linenos">1942</span></a><span class="sd">    &lt;http://www.iana.org/assignments/language-tags&gt;.</span>
</span><span id="L-1943"><a href="#L-1943"><span class="linenos">1943</span></a><span class="sd">    </span>
</span><span id="L-1944"><a href="#L-1944"><span class="linenos">1944</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1945"><a href="#L-1945"><span class="linenos">1945</span></a>    <span class="c1"># Note special instructions from RFC 2616 sect. 14.1:</span>
</span><span id="L-1946"><a href="#L-1946"><span class="linenos">1946</span></a>    <span class="c1">#   &quot;The language quality factor assigned to a language-tag by the</span>
</span><span id="L-1947"><a href="#L-1947"><span class="linenos">1947</span></a>    <span class="c1">#   Accept-Language field is the quality value of the longest</span>
</span><span id="L-1948"><a href="#L-1948"><span class="linenos">1948</span></a>    <span class="c1">#   language- range in the field that matches the language-tag.&quot;</span>
</span><span id="L-1949"><a href="#L-1949"><span class="linenos">1949</span></a>
</span><span id="L-1950"><a href="#L-1950"><span class="linenos">1950</span></a>    <span class="k">if</span> <span class="n">_is_string</span><span class="p">(</span><span class="n">accept_header</span><span class="p">):</span>
</span><span id="L-1951"><a href="#L-1951"><span class="linenos">1951</span></a>        <span class="n">accept_list</span> <span class="o">=</span> <span class="n">parse_accept_language_header</span><span class="p">(</span><span class="n">accept_header</span><span class="p">)</span>
</span><span id="L-1952"><a href="#L-1952"><span class="linenos">1952</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1953"><a href="#L-1953"><span class="linenos">1953</span></a>        <span class="n">accept_list</span> <span class="o">=</span> <span class="n">accept_header</span>
</span><span id="L-1954"><a href="#L-1954"><span class="linenos">1954</span></a>
</span><span id="L-1955"><a href="#L-1955"><span class="linenos">1955</span></a>    <span class="c1"># Possibly add in any &quot;missing&quot; languages that the browser may</span>
</span><span id="L-1956"><a href="#L-1956"><span class="linenos">1956</span></a>    <span class="c1"># have forgotten to include in the list. Insure list is sorted so</span>
</span><span id="L-1957"><a href="#L-1957"><span class="linenos">1957</span></a>    <span class="c1"># more general languages come before more specific ones.</span>
</span><span id="L-1958"><a href="#L-1958"><span class="linenos">1958</span></a>
</span><span id="L-1959"><a href="#L-1959"><span class="linenos">1959</span></a>    <span class="n">accept_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="L-1960"><a href="#L-1960"><span class="linenos">1960</span></a>    <span class="n">all_tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">accept_list</span><span class="p">]</span>
</span><span id="L-1961"><a href="#L-1961"><span class="linenos">1961</span></a>    <span class="k">if</span> <span class="n">assume_superiors</span><span class="p">:</span>
</span><span id="L-1962"><a href="#L-1962"><span class="linenos">1962</span></a>        <span class="n">to_add</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1963"><a href="#L-1963"><span class="linenos">1963</span></a>        <span class="k">for</span> <span class="n">langtag</span><span class="p">,</span> <span class="n">qvalue</span><span class="p">,</span> <span class="n">aargs</span> <span class="ow">in</span> <span class="n">accept_list</span><span class="p">:</span>
</span><span id="L-1964"><a href="#L-1964"><span class="linenos">1964</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">langtag</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-1965"><a href="#L-1965"><span class="linenos">1965</span></a>                <span class="k">for</span> <span class="n">suptag</span> <span class="ow">in</span> <span class="n">langtag</span><span class="o">.</span><span class="n">all_superiors</span><span class="p">(</span> <span class="n">include_wildcard</span><span class="o">=</span><span class="kc">False</span> <span class="p">):</span>
</span><span id="L-1966"><a href="#L-1966"><span class="linenos">1966</span></a>                    <span class="k">if</span> <span class="n">suptag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_tags</span><span class="p">:</span>
</span><span id="L-1967"><a href="#L-1967"><span class="linenos">1967</span></a>                        <span class="c1"># Add in superior at half the qvalue</span>
</span><span id="L-1968"><a href="#L-1968"><span class="linenos">1968</span></a>                        <span class="n">to_add</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">suptag</span><span class="p">,</span> <span class="n">qvalue</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">)</span>
</span><span id="L-1969"><a href="#L-1969"><span class="linenos">1969</span></a>                        <span class="n">all_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">suptag</span> <span class="p">)</span>
</span><span id="L-1970"><a href="#L-1970"><span class="linenos">1970</span></a>        <span class="n">accept_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="n">to_add</span> <span class="p">)</span>
</span><span id="L-1971"><a href="#L-1971"><span class="linenos">1971</span></a>
</span><span id="L-1972"><a href="#L-1972"><span class="linenos">1972</span></a>    <span class="c1"># Convert server_languages to a list of language_tags</span>
</span><span id="L-1973"><a href="#L-1973"><span class="linenos">1973</span></a>    <span class="k">if</span> <span class="n">_is_string</span><span class="p">(</span><span class="n">server_languages</span><span class="p">):</span>
</span><span id="L-1974"><a href="#L-1974"><span class="linenos">1974</span></a>        <span class="n">server_languages</span> <span class="o">=</span> <span class="p">[</span><span class="n">language_tag</span><span class="p">(</span><span class="n">server_languages</span><span class="p">)]</span>
</span><span id="L-1975"><a href="#L-1975"><span class="linenos">1975</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_languages</span><span class="p">,</span> <span class="n">language_tag</span><span class="p">):</span>
</span><span id="L-1976"><a href="#L-1976"><span class="linenos">1976</span></a>        <span class="n">server_languages</span> <span class="o">=</span> <span class="p">[</span><span class="n">server_languages</span><span class="p">]</span>
</span><span id="L-1977"><a href="#L-1977"><span class="linenos">1977</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1978"><a href="#L-1978"><span class="linenos">1978</span></a>        <span class="n">server_languages</span> <span class="o">=</span> <span class="p">[</span><span class="n">language_tag</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span> <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">server_languages</span><span class="p">]</span>
</span><span id="L-1979"><a href="#L-1979"><span class="linenos">1979</span></a>
</span><span id="L-1980"><a href="#L-1980"><span class="linenos">1980</span></a>    <span class="c1"># Select the best one</span>
</span><span id="L-1981"><a href="#L-1981"><span class="linenos">1981</span></a>    <span class="n">best</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># tuple (langtag, qvalue, matchlen)</span>
</span><span id="L-1982"><a href="#L-1982"><span class="linenos">1982</span></a>    
</span><span id="L-1983"><a href="#L-1983"><span class="linenos">1983</span></a>    <span class="k">for</span> <span class="n">langtag</span><span class="p">,</span> <span class="n">qvalue</span><span class="p">,</span> <span class="n">aargs</span> <span class="ow">in</span> <span class="n">accept_list</span><span class="p">:</span>
</span><span id="L-1984"><a href="#L-1984"><span class="linenos">1984</span></a>        <span class="c1"># aargs is ignored for Accept-Language</span>
</span><span id="L-1985"><a href="#L-1985"><span class="linenos">1985</span></a>        <span class="k">if</span> <span class="n">qvalue</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1986"><a href="#L-1986"><span class="linenos">1986</span></a>            <span class="k">continue</span> <span class="c1"># UA doesn&#39;t accept this language</span>
</span><span id="L-1987"><a href="#L-1987"><span class="linenos">1987</span></a>
</span><span id="L-1988"><a href="#L-1988"><span class="linenos">1988</span></a>        <span class="k">if</span> <span class="n">ignore_wildcard</span> <span class="ow">and</span> <span class="n">langtag</span><span class="o">.</span><span class="n">is_universal_wildcard</span><span class="p">():</span>
</span><span id="L-1989"><a href="#L-1989"><span class="linenos">1989</span></a>            <span class="k">continue</span>  <span class="c1"># &quot;*&quot; being ignored</span>
</span><span id="L-1990"><a href="#L-1990"><span class="linenos">1990</span></a>
</span><span id="L-1991"><a href="#L-1991"><span class="linenos">1991</span></a>        <span class="k">for</span> <span class="n">svrlang</span> <span class="ow">in</span> <span class="n">server_languages</span><span class="p">:</span>
</span><span id="L-1992"><a href="#L-1992"><span class="linenos">1992</span></a>            <span class="c1"># The best match is determined first by the quality factor,</span>
</span><span id="L-1993"><a href="#L-1993"><span class="linenos">1993</span></a>            <span class="c1"># and then by the most specific match.</span>
</span><span id="L-1994"><a href="#L-1994"><span class="linenos">1994</span></a>
</span><span id="L-1995"><a href="#L-1995"><span class="linenos">1995</span></a>            <span class="n">matchlen</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1"># how specifically this one matches (0 is a non-match)</span>
</span><span id="L-1996"><a href="#L-1996"><span class="linenos">1996</span></a>            <span class="k">if</span> <span class="n">svrlang</span><span class="o">.</span><span class="n">dialect_of</span><span class="p">(</span> <span class="n">langtag</span><span class="p">,</span> <span class="n">ignore_wildcard</span><span class="o">=</span><span class="n">ignore_wildcard</span> <span class="p">):</span>
</span><span id="L-1997"><a href="#L-1997"><span class="linenos">1997</span></a>                <span class="n">matchlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">langtag</span><span class="p">)</span>
</span><span id="L-1998"><a href="#L-1998"><span class="linenos">1998</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">best</span> \
</span><span id="L-1999"><a href="#L-1999"><span class="linenos">1999</span></a>                       <span class="ow">or</span> <span class="n">matchlen</span> <span class="o">&gt;</span> <span class="n">best</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> \
</span><span id="L-2000"><a href="#L-2000"><span class="linenos">2000</span></a>                       <span class="ow">or</span> <span class="p">(</span><span class="n">matchlen</span> <span class="o">==</span> <span class="n">best</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="n">qvalue</span> <span class="o">&gt;</span> <span class="n">best</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-2001"><a href="#L-2001"><span class="linenos">2001</span></a>                    <span class="c1"># This match is better</span>
</span><span id="L-2002"><a href="#L-2002"><span class="linenos">2002</span></a>                    <span class="n">best</span> <span class="o">=</span> <span class="p">(</span><span class="n">langtag</span><span class="p">,</span> <span class="n">qvalue</span><span class="p">,</span> <span class="n">matchlen</span><span class="p">)</span>
</span><span id="L-2003"><a href="#L-2003"><span class="linenos">2003</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">best</span><span class="p">:</span>
</span><span id="L-2004"><a href="#L-2004"><span class="linenos">2004</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-2005"><a href="#L-2005"><span class="linenos">2005</span></a>    <span class="k">return</span> <span class="n">best</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2006"><a href="#L-2006"><span class="linenos">2006</span></a>
</span><span id="L-2007"><a href="#L-2007"><span class="linenos">2007</span></a>
</span><span id="L-2008"><a href="#L-2008"><span class="linenos">2008</span></a><span class="c1"># Clean up global namespace</span>
</span><span id="L-2009"><a href="#L-2009"><span class="linenos">2009</span></a><span class="k">try</span><span class="p">:</span>
</span><span id="L-2010"><a href="#L-2010"><span class="linenos">2010</span></a>    <span class="k">if</span> <span class="n">__emulating_set</span><span class="p">:</span>
</span><span id="L-2011"><a href="#L-2011"><span class="linenos">2011</span></a>        <span class="k">del</span> <span class="nb">set</span>
</span><span id="L-2012"><a href="#L-2012"><span class="linenos">2012</span></a>        <span class="k">del</span> <span class="nb">frozenset</span>
</span><span id="L-2013"><a href="#L-2013"><span class="linenos">2013</span></a><span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
</span><span id="L-2014"><a href="#L-2014"><span class="linenos">2014</span></a>    <span class="k">pass</span>
</span><span id="L-2015"><a href="#L-2015"><span class="linenos">2015</span></a>
</span><span id="L-2016"><a href="#L-2016"><span class="linenos">2016</span></a><span class="c1"># end of file</span>
</span></pre></div>


            </section>
                <section id="SEPARATORS">
                    <div class="attr variable">
            <span class="name">SEPARATORS</span>        =
<input id="SEPARATORS-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="SEPARATORS-view-value"></label><span class="default_value">frozenset({&#39;&#34;&#39;, &#39;&lt;&#39;, &#39;\t&#39;, &#39;)&#39;, &#39;;&#39;, &#39;\\&#39;, &#39;:&#39;, &#39;=&#39;, &#39;[&#39;, &#39;/&#39;, &#39;}&#39;, &#39;?&#39;, &#39;{&#39;, &#39;&gt;&#39;, &#39;]&#39;, &#39;(&#39;, &#39;,&#39;, &#39; &#39;, &#39;@&#39;})</span>

        
    </div>
    <a class="headerlink" href="#SEPARATORS"></a>
    
    

                </section>
                <section id="LWS">
                    <div class="attr variable">
            <span class="name">LWS</span>        =
<span class="default_value">frozenset({&#39; &#39;, &#39;\r&#39;, &#39;\t&#39;, &#39;\n&#39;})</span>

        
    </div>
    <a class="headerlink" href="#LWS"></a>
    
    

                </section>
                <section id="CRLF">
                    <div class="attr variable">
            <span class="name">CRLF</span>        =
<span class="default_value">frozenset({&#39;\r&#39;, &#39;\n&#39;})</span>

        
    </div>
    <a class="headerlink" href="#CRLF"></a>
    
    

                </section>
                <section id="DIGIT">
                    <div class="attr variable">
            <span class="name">DIGIT</span>        =
<span class="default_value">frozenset({&#39;2&#39;, &#39;0&#39;, &#39;3&#39;, &#39;7&#39;, &#39;8&#39;, &#39;5&#39;, &#39;6&#39;, &#39;9&#39;, &#39;4&#39;, &#39;1&#39;})</span>

        
    </div>
    <a class="headerlink" href="#DIGIT"></a>
    
    

                </section>
                <section id="HEX">
                    <div class="attr variable">
            <span class="name">HEX</span>        =
<input id="HEX-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="HEX-view-value"></label><span class="default_value">frozenset({&#39;4&#39;, &#39;1&#39;, &#39;b&#39;, &#39;8&#39;, &#39;F&#39;, &#39;B&#39;, &#39;c&#39;, &#39;f&#39;, &#39;d&#39;, &#39;a&#39;, &#39;E&#39;, &#39;D&#39;, &#39;7&#39;, &#39;2&#39;, &#39;0&#39;, &#39;3&#39;, &#39;e&#39;, &#39;6&#39;, &#39;A&#39;, &#39;9&#39;, &#39;C&#39;, &#39;5&#39;})</span>

        
    </div>
    <a class="headerlink" href="#HEX"></a>
    
    

                </section>
                <section id="PY3">
                    <div class="attr variable">
            <span class="name">PY3</span>        =
<span class="default_value">True</span>

        
    </div>
    <a class="headerlink" href="#PY3"></a>
    
    

                </section>
                <section id="http_datetime">
                            <input id="http_datetime-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">http_datetime</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">dt</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="http_datetime-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#http_datetime"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="http_datetime-147"><a href="#http_datetime-147"><span class="linenos">147</span></a><span class="k">def</span> <span class="nf">http_datetime</span><span class="p">(</span> <span class="n">dt</span><span class="o">=</span><span class="kc">None</span> <span class="p">):</span>
</span><span id="http_datetime-148"><a href="#http_datetime-148"><span class="linenos">148</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Formats a datetime as an HTTP 1.1 Date/Time string.</span>
</span><span id="http_datetime-149"><a href="#http_datetime-149"><span class="linenos">149</span></a>
</span><span id="http_datetime-150"><a href="#http_datetime-150"><span class="linenos">150</span></a><span class="sd">    Takes a standard Python datetime object and returns a string</span>
</span><span id="http_datetime-151"><a href="#http_datetime-151"><span class="linenos">151</span></a><span class="sd">    formatted according to the HTTP 1.1 date/time format.</span>
</span><span id="http_datetime-152"><a href="#http_datetime-152"><span class="linenos">152</span></a>
</span><span id="http_datetime-153"><a href="#http_datetime-153"><span class="linenos">153</span></a><span class="sd">    If no datetime is provided (or None) then the current</span>
</span><span id="http_datetime-154"><a href="#http_datetime-154"><span class="linenos">154</span></a><span class="sd">    time is used.</span>
</span><span id="http_datetime-155"><a href="#http_datetime-155"><span class="linenos">155</span></a><span class="sd">    </span>
</span><span id="http_datetime-156"><a href="#http_datetime-156"><span class="linenos">156</span></a><span class="sd">    ABOUT TIMEZONES: If the passed in datetime object is naive it is</span>
</span><span id="http_datetime-157"><a href="#http_datetime-157"><span class="linenos">157</span></a><span class="sd">    assumed to be in UTC already.  But if it has a tzinfo component,</span>
</span><span id="http_datetime-158"><a href="#http_datetime-158"><span class="linenos">158</span></a><span class="sd">    the returned timestamp string will have been converted to UTC</span>
</span><span id="http_datetime-159"><a href="#http_datetime-159"><span class="linenos">159</span></a><span class="sd">    automatically.  So if you use timezone-aware datetimes, you need</span>
</span><span id="http_datetime-160"><a href="#http_datetime-160"><span class="linenos">160</span></a><span class="sd">    not worry about conversion to UTC.</span>
</span><span id="http_datetime-161"><a href="#http_datetime-161"><span class="linenos">161</span></a>
</span><span id="http_datetime-162"><a href="#http_datetime-162"><span class="linenos">162</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="http_datetime-163"><a href="#http_datetime-163"><span class="linenos">163</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">dt</span><span class="p">:</span>
</span><span id="http_datetime-164"><a href="#http_datetime-164"><span class="linenos">164</span></a>        <span class="kn">import</span> <span class="nn">datetime</span>
</span><span id="http_datetime-165"><a href="#http_datetime-165"><span class="linenos">165</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
</span><span id="http_datetime-166"><a href="#http_datetime-166"><span class="linenos">166</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="http_datetime-167"><a href="#http_datetime-167"><span class="linenos">167</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="http_datetime-168"><a href="#http_datetime-168"><span class="linenos">168</span></a>            <span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">-</span> <span class="n">dt</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">()</span>
</span><span id="http_datetime-169"><a href="#http_datetime-169"><span class="linenos">169</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="http_datetime-170"><a href="#http_datetime-170"><span class="linenos">170</span></a>            <span class="k">pass</span>  <span class="c1"># no timezone offset, just assume already in UTC</span>
</span><span id="http_datetime-171"><a href="#http_datetime-171"><span class="linenos">171</span></a>
</span><span id="http_datetime-172"><a href="#http_datetime-172"><span class="linenos">172</span></a>    <span class="n">s</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%a</span><span class="s1">, </span><span class="si">%d</span><span class="s1"> %b %Y %H:%M:%S GMT&#39;</span><span class="p">)</span>
</span><span id="http_datetime-173"><a href="#http_datetime-173"><span class="linenos">173</span></a>    <span class="k">return</span> <span class="n">s</span>
</span></pre></div>


            <div class="docstring"><p>Formats a datetime as an HTTP 1.1 Date/Time string.</p>

<p>Takes a standard Python datetime object and returns a string
formatted according to the HTTP 1.1 date/time format.</p>

<p>If no datetime is provided (or None) then the current
time is used.</p>

<p>ABOUT TIMEZONES: If the passed in datetime object is naive it is
assumed to be in UTC already.  But if it has a tzinfo component,
the returned timestamp string will have been converted to UTC
automatically.  So if you use timezone-aware datetimes, you need
not worry about conversion to UTC.</p>
</div>


                </section>
                <section id="parse_http_datetime">
                            <input id="parse_http_datetime-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse_http_datetime</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">datestring</span>, </span><span class="param"><span class="n">utc_tzinfo</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">strict</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="parse_http_datetime-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parse_http_datetime"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parse_http_datetime-176"><a href="#parse_http_datetime-176"><span class="linenos">176</span></a><span class="k">def</span> <span class="nf">parse_http_datetime</span><span class="p">(</span> <span class="n">datestring</span><span class="p">,</span> <span class="n">utc_tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span> <span class="p">):</span>
</span><span id="parse_http_datetime-177"><a href="#parse_http_datetime-177"><span class="linenos">177</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a datetime object from an HTTP 1.1 Date/Time string.</span>
</span><span id="parse_http_datetime-178"><a href="#parse_http_datetime-178"><span class="linenos">178</span></a>
</span><span id="parse_http_datetime-179"><a href="#parse_http_datetime-179"><span class="linenos">179</span></a><span class="sd">    Note that HTTP dates are always in UTC, so the returned datetime</span>
</span><span id="parse_http_datetime-180"><a href="#parse_http_datetime-180"><span class="linenos">180</span></a><span class="sd">    object will also be in UTC.</span>
</span><span id="parse_http_datetime-181"><a href="#parse_http_datetime-181"><span class="linenos">181</span></a>
</span><span id="parse_http_datetime-182"><a href="#parse_http_datetime-182"><span class="linenos">182</span></a><span class="sd">    You can optionally pass in a tzinfo object which should represent</span>
</span><span id="parse_http_datetime-183"><a href="#parse_http_datetime-183"><span class="linenos">183</span></a><span class="sd">    the UTC timezone, and the returned datetime will then be</span>
</span><span id="parse_http_datetime-184"><a href="#parse_http_datetime-184"><span class="linenos">184</span></a><span class="sd">    timezone-aware (allowing you to more easly translate it into</span>
</span><span id="parse_http_datetime-185"><a href="#parse_http_datetime-185"><span class="linenos">185</span></a><span class="sd">    different timzeones later).</span>
</span><span id="parse_http_datetime-186"><a href="#parse_http_datetime-186"><span class="linenos">186</span></a>
</span><span id="parse_http_datetime-187"><a href="#parse_http_datetime-187"><span class="linenos">187</span></a><span class="sd">    If you set &#39;strict&#39; to True, then only the RFC 1123 format</span>
</span><span id="parse_http_datetime-188"><a href="#parse_http_datetime-188"><span class="linenos">188</span></a><span class="sd">    is recognized.  Otherwise the backwards-compatible RFC 1036</span>
</span><span id="parse_http_datetime-189"><a href="#parse_http_datetime-189"><span class="linenos">189</span></a><span class="sd">    and Unix asctime(3) formats are also recognized.</span>
</span><span id="parse_http_datetime-190"><a href="#parse_http_datetime-190"><span class="linenos">190</span></a><span class="sd">    </span>
</span><span id="parse_http_datetime-191"><a href="#parse_http_datetime-191"><span class="linenos">191</span></a><span class="sd">    Please note that the day-of-the-week is not validated.</span>
</span><span id="parse_http_datetime-192"><a href="#parse_http_datetime-192"><span class="linenos">192</span></a><span class="sd">    Also two-digit years, although not HTTP 1.1 compliant, are</span>
</span><span id="parse_http_datetime-193"><a href="#parse_http_datetime-193"><span class="linenos">193</span></a><span class="sd">    treated according to recommended Y2K rules.</span>
</span><span id="parse_http_datetime-194"><a href="#parse_http_datetime-194"><span class="linenos">194</span></a>
</span><span id="parse_http_datetime-195"><a href="#parse_http_datetime-195"><span class="linenos">195</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="parse_http_datetime-196"><a href="#parse_http_datetime-196"><span class="linenos">196</span></a>    <span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">datetime</span>
</span><span id="parse_http_datetime-197"><a href="#parse_http_datetime-197"><span class="linenos">197</span></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?P&lt;DOW&gt;[a-z]+), (?P&lt;D&gt;\d+) (?P&lt;MON&gt;[a-z]+) (?P&lt;Y&gt;\d+) (?P&lt;H&gt;\d+):(?P&lt;M&gt;\d+):(?P&lt;S&gt;\d+(\.\d+)?) (?P&lt;TZ&gt;[a-zA-Z0-9_+]+)$&#39;</span><span class="p">,</span>
</span><span id="parse_http_datetime-198"><a href="#parse_http_datetime-198"><span class="linenos">198</span></a>                 <span class="n">datestring</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
</span><span id="parse_http_datetime-199"><a href="#parse_http_datetime-199"><span class="linenos">199</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">strict</span><span class="p">:</span>
</span><span id="parse_http_datetime-200"><a href="#parse_http_datetime-200"><span class="linenos">200</span></a>        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?P&lt;DOW&gt;[a-z]+) (?P&lt;MON&gt;[a-z]+) (?P&lt;D&gt;\d+) (?P&lt;H&gt;\d+):(?P&lt;M&gt;\d+):(?P&lt;S&gt;\d+) (?P&lt;Y&gt;\d+)$&#39;</span><span class="p">,</span>
</span><span id="parse_http_datetime-201"><a href="#parse_http_datetime-201"><span class="linenos">201</span></a>                     <span class="n">datestring</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
</span><span id="parse_http_datetime-202"><a href="#parse_http_datetime-202"><span class="linenos">202</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
</span><span id="parse_http_datetime-203"><a href="#parse_http_datetime-203"><span class="linenos">203</span></a>            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?P&lt;DOW&gt;[a-z]+), (?P&lt;D&gt;\d+)-(?P&lt;MON&gt;[a-z]+)-(?P&lt;Y&gt;\d+) (?P&lt;H&gt;\d+):(?P&lt;M&gt;\d+):(?P&lt;S&gt;\d+(\.\d+)?) (?P&lt;TZ&gt;\w+)$&#39;</span><span class="p">,</span>
</span><span id="parse_http_datetime-204"><a href="#parse_http_datetime-204"><span class="linenos">204</span></a>                         <span class="n">datestring</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
</span><span id="parse_http_datetime-205"><a href="#parse_http_datetime-205"><span class="linenos">205</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
</span><span id="parse_http_datetime-206"><a href="#parse_http_datetime-206"><span class="linenos">206</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;HTTP date is not correctly formatted&#39;</span><span class="p">)</span>
</span><span id="parse_http_datetime-207"><a href="#parse_http_datetime-207"><span class="linenos">207</span></a>
</span><span id="parse_http_datetime-208"><a href="#parse_http_datetime-208"><span class="linenos">208</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="parse_http_datetime-209"><a href="#parse_http_datetime-209"><span class="linenos">209</span></a>        <span class="n">tz</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;TZ&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="parse_http_datetime-210"><a href="#parse_http_datetime-210"><span class="linenos">210</span></a>    <span class="k">except</span><span class="p">:</span>
</span><span id="parse_http_datetime-211"><a href="#parse_http_datetime-211"><span class="linenos">211</span></a>        <span class="n">tz</span> <span class="o">=</span> <span class="s1">&#39;GMT&#39;</span>
</span><span id="parse_http_datetime-212"><a href="#parse_http_datetime-212"><span class="linenos">212</span></a>    <span class="k">if</span> <span class="n">tz</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;GMT&#39;</span><span class="p">,</span><span class="s1">&#39;UTC&#39;</span><span class="p">,</span><span class="s1">&#39;0000&#39;</span><span class="p">,</span><span class="s1">&#39;00:00&#39;</span><span class="p">):</span>
</span><span id="parse_http_datetime-213"><a href="#parse_http_datetime-213"><span class="linenos">213</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;HTTP date is not in GMT timezone&#39;</span><span class="p">)</span>
</span><span id="parse_http_datetime-214"><a href="#parse_http_datetime-214"><span class="linenos">214</span></a>
</span><span id="parse_http_datetime-215"><a href="#parse_http_datetime-215"><span class="linenos">215</span></a>    <span class="n">monname</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;MON&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="parse_http_datetime-216"><a href="#parse_http_datetime-216"><span class="linenos">216</span></a>    <span class="n">mdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;JAN&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;FEB&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;MAR&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;APR&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;MAY&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;JUN&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span>
</span><span id="parse_http_datetime-217"><a href="#parse_http_datetime-217"><span class="linenos">217</span></a>             <span class="s1">&#39;JUL&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;AUG&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;SEP&#39;</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;OCT&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;NOV&#39;</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;DEC&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">}</span>
</span><span id="parse_http_datetime-218"><a href="#parse_http_datetime-218"><span class="linenos">218</span></a>    <span class="n">month</span> <span class="o">=</span> <span class="n">mdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">monname</span><span class="p">)</span>
</span><span id="parse_http_datetime-219"><a href="#parse_http_datetime-219"><span class="linenos">219</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">month</span><span class="p">:</span>
</span><span id="parse_http_datetime-220"><a href="#parse_http_datetime-220"><span class="linenos">220</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;HTTP date has an unrecognizable month&#39;</span><span class="p">)</span>
</span><span id="parse_http_datetime-221"><a href="#parse_http_datetime-221"><span class="linenos">221</span></a>    <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">))</span>
</span><span id="parse_http_datetime-222"><a href="#parse_http_datetime-222"><span class="linenos">222</span></a>    <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="parse_http_datetime-223"><a href="#parse_http_datetime-223"><span class="linenos">223</span></a>        <span class="n">century</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">year</span> <span class="o">/</span> <span class="mi">100</span>
</span><span id="parse_http_datetime-224"><a href="#parse_http_datetime-224"><span class="linenos">224</span></a>        <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
</span><span id="parse_http_datetime-225"><a href="#parse_http_datetime-225"><span class="linenos">225</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">century</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">y</span>
</span><span id="parse_http_datetime-226"><a href="#parse_http_datetime-226"><span class="linenos">226</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="parse_http_datetime-227"><a href="#parse_http_datetime-227"><span class="linenos">227</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">century</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">y</span>
</span><span id="parse_http_datetime-228"><a href="#parse_http_datetime-228"><span class="linenos">228</span></a>    <span class="n">d</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">))</span>
</span><span id="parse_http_datetime-229"><a href="#parse_http_datetime-229"><span class="linenos">229</span></a>    <span class="n">hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">))</span>
</span><span id="parse_http_datetime-230"><a href="#parse_http_datetime-230"><span class="linenos">230</span></a>    <span class="n">minute</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">))</span>
</span><span id="parse_http_datetime-231"><a href="#parse_http_datetime-231"><span class="linenos">231</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="parse_http_datetime-232"><a href="#parse_http_datetime-232"><span class="linenos">232</span></a>        <span class="n">second</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">))</span>
</span><span id="parse_http_datetime-233"><a href="#parse_http_datetime-233"><span class="linenos">233</span></a>    <span class="k">except</span><span class="p">:</span>
</span><span id="parse_http_datetime-234"><a href="#parse_http_datetime-234"><span class="linenos">234</span></a>        <span class="n">second</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">))</span>
</span><span id="parse_http_datetime-235"><a href="#parse_http_datetime-235"><span class="linenos">235</span></a>    <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span> <span class="n">y</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">utc_tzinfo</span> <span class="p">)</span>
</span><span id="parse_http_datetime-236"><a href="#parse_http_datetime-236"><span class="linenos">236</span></a>    <span class="k">return</span> <span class="n">dt</span>
</span></pre></div>


            <div class="docstring"><p>Returns a datetime object from an HTTP 1.1 Date/Time string.</p>

<p>Note that HTTP dates are always in UTC, so the returned datetime
object will also be in UTC.</p>

<p>You can optionally pass in a tzinfo object which should represent
the UTC timezone, and the returned datetime will then be
timezone-aware (allowing you to more easly translate it into
different timzeones later).</p>

<p>If you set 'strict' to True, then only the RFC 1123 format
is recognized.  Otherwise the backwards-compatible RFC 1036
and Unix asctime(3) formats are also recognized.</p>

<p>Please note that the day-of-the-week is not validated.
Also two-digit years, although not HTTP 1.1 compliant, are
treated according to recommended Y2K rules.</p>
</div>


                </section>
                <section id="RangeUnsatisfiableError">
                            <input id="RangeUnsatisfiableError-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">RangeUnsatisfiableError</span><wbr>(<span class="base">builtins.ValueError</span>):

                <label class="view-source-button" for="RangeUnsatisfiableError-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RangeUnsatisfiableError"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RangeUnsatisfiableError-239"><a href="#RangeUnsatisfiableError-239"><span class="linenos">239</span></a><span class="k">class</span> <span class="nc">RangeUnsatisfiableError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
</span><span id="RangeUnsatisfiableError-240"><a href="#RangeUnsatisfiableError-240"><span class="linenos">240</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Exception class when a byte range lies outside the file size boundaries.&quot;&quot;&quot;</span>
</span><span id="RangeUnsatisfiableError-241"><a href="#RangeUnsatisfiableError-241"><span class="linenos">241</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="RangeUnsatisfiableError-242"><a href="#RangeUnsatisfiableError-242"><span class="linenos">242</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">reason</span><span class="p">:</span>
</span><span id="RangeUnsatisfiableError-243"><a href="#RangeUnsatisfiableError-243"><span class="linenos">243</span></a>            <span class="n">reason</span> <span class="o">=</span> <span class="s1">&#39;Range is unsatisfiable&#39;</span>
</span><span id="RangeUnsatisfiableError-244"><a href="#RangeUnsatisfiableError-244"><span class="linenos">244</span></a>        <span class="ne">ValueError</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Exception class when a byte range lies outside the file size boundaries.</p>
</div>


                            <div id="RangeUnsatisfiableError.__init__" class="classattr">
                                        <input id="RangeUnsatisfiableError.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">RangeUnsatisfiableError</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">reason</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="RangeUnsatisfiableError.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RangeUnsatisfiableError.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RangeUnsatisfiableError.__init__-241"><a href="#RangeUnsatisfiableError.__init__-241"><span class="linenos">241</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="RangeUnsatisfiableError.__init__-242"><a href="#RangeUnsatisfiableError.__init__-242"><span class="linenos">242</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">reason</span><span class="p">:</span>
</span><span id="RangeUnsatisfiableError.__init__-243"><a href="#RangeUnsatisfiableError.__init__-243"><span class="linenos">243</span></a>            <span class="n">reason</span> <span class="o">=</span> <span class="s1">&#39;Range is unsatisfiable&#39;</span>
</span><span id="RangeUnsatisfiableError.__init__-244"><a href="#RangeUnsatisfiableError.__init__-244"><span class="linenos">244</span></a>        <span class="ne">ValueError</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.BaseException</dt>
                                <dd id="RangeUnsatisfiableError.with_traceback" class="function">with_traceback</dd>
                <dd id="RangeUnsatisfiableError.args" class="variable">args</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="RangeUnmergableError">
                            <input id="RangeUnmergableError-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">RangeUnmergableError</span><wbr>(<span class="base">builtins.ValueError</span>):

                <label class="view-source-button" for="RangeUnmergableError-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RangeUnmergableError"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RangeUnmergableError-247"><a href="#RangeUnmergableError-247"><span class="linenos">247</span></a><span class="k">class</span> <span class="nc">RangeUnmergableError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
</span><span id="RangeUnmergableError-248"><a href="#RangeUnmergableError-248"><span class="linenos">248</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Exception class when byte ranges are noncontiguous and can not be merged together.&quot;&quot;&quot;</span>
</span><span id="RangeUnmergableError-249"><a href="#RangeUnmergableError-249"><span class="linenos">249</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="RangeUnmergableError-250"><a href="#RangeUnmergableError-250"><span class="linenos">250</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">reason</span><span class="p">:</span>
</span><span id="RangeUnmergableError-251"><a href="#RangeUnmergableError-251"><span class="linenos">251</span></a>            <span class="n">reason</span> <span class="o">=</span> <span class="s1">&#39;Ranges can not be merged together&#39;</span>
</span><span id="RangeUnmergableError-252"><a href="#RangeUnmergableError-252"><span class="linenos">252</span></a>        <span class="ne">ValueError</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Exception class when byte ranges are noncontiguous and can not be merged together.</p>
</div>


                            <div id="RangeUnmergableError.__init__" class="classattr">
                                        <input id="RangeUnmergableError.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">RangeUnmergableError</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">reason</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="RangeUnmergableError.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RangeUnmergableError.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RangeUnmergableError.__init__-249"><a href="#RangeUnmergableError.__init__-249"><span class="linenos">249</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="RangeUnmergableError.__init__-250"><a href="#RangeUnmergableError.__init__-250"><span class="linenos">250</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">reason</span><span class="p">:</span>
</span><span id="RangeUnmergableError.__init__-251"><a href="#RangeUnmergableError.__init__-251"><span class="linenos">251</span></a>            <span class="n">reason</span> <span class="o">=</span> <span class="s1">&#39;Ranges can not be merged together&#39;</span>
</span><span id="RangeUnmergableError.__init__-252"><a href="#RangeUnmergableError.__init__-252"><span class="linenos">252</span></a>        <span class="ne">ValueError</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.BaseException</dt>
                                <dd id="RangeUnmergableError.with_traceback" class="function">with_traceback</dd>
                <dd id="RangeUnmergableError.args" class="variable">args</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ParseError">
                            <input id="ParseError-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ParseError</span><wbr>(<span class="base">builtins.ValueError</span>):

                <label class="view-source-button" for="ParseError-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ParseError"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ParseError-255"><a href="#ParseError-255"><span class="linenos">255</span></a><span class="k">class</span> <span class="nc">ParseError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
</span><span id="ParseError-256"><a href="#ParseError-256"><span class="linenos">256</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Exception class representing a string parsing error.&quot;&quot;&quot;</span>
</span><span id="ParseError-257"><a href="#ParseError-257"><span class="linenos">257</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">input_string</span><span class="p">,</span> <span class="n">at_position</span><span class="p">):</span>
</span><span id="ParseError-258"><a href="#ParseError-258"><span class="linenos">258</span></a>        <span class="ne">ValueError</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</span><span id="ParseError-259"><a href="#ParseError-259"><span class="linenos">259</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_string</span> <span class="o">=</span> <span class="n">input_string</span>
</span><span id="ParseError-260"><a href="#ParseError-260"><span class="linenos">260</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">at_position</span> <span class="o">=</span> <span class="n">at_position</span>
</span><span id="ParseError-261"><a href="#ParseError-261"><span class="linenos">261</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ParseError-262"><a href="#ParseError-262"><span class="linenos">262</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">at_position</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_string</span><span class="p">):</span>
</span><span id="ParseError-263"><a href="#ParseError-263"><span class="linenos">263</span></a>            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n\t</span><span class="s1">Occured at end of string&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ParseError-264"><a href="#ParseError-264"><span class="linenos">264</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ParseError-265"><a href="#ParseError-265"><span class="linenos">265</span></a>            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n\t</span><span class="s1">Occured near </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_string</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">at_position</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">at_position</span><span class="o">+</span><span class="mi">16</span><span class="p">]))</span>
</span></pre></div>


            <div class="docstring"><p>Exception class representing a string parsing error.</p>
</div>


                            <div id="ParseError.__init__" class="classattr">
                                        <input id="ParseError.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ParseError</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">args</span>, </span><span class="param"><span class="n">input_string</span>, </span><span class="param"><span class="n">at_position</span></span>)</span>

                <label class="view-source-button" for="ParseError.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ParseError.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ParseError.__init__-257"><a href="#ParseError.__init__-257"><span class="linenos">257</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">input_string</span><span class="p">,</span> <span class="n">at_position</span><span class="p">):</span>
</span><span id="ParseError.__init__-258"><a href="#ParseError.__init__-258"><span class="linenos">258</span></a>        <span class="ne">ValueError</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</span><span id="ParseError.__init__-259"><a href="#ParseError.__init__-259"><span class="linenos">259</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_string</span> <span class="o">=</span> <span class="n">input_string</span>
</span><span id="ParseError.__init__-260"><a href="#ParseError.__init__-260"><span class="linenos">260</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">at_position</span> <span class="o">=</span> <span class="n">at_position</span>
</span></pre></div>


    

                            </div>
                            <div id="ParseError.input_string" class="classattr">
                                <div class="attr variable">
            <span class="name">input_string</span>

        
    </div>
    <a class="headerlink" href="#ParseError.input_string"></a>
    
    

                            </div>
                            <div id="ParseError.at_position" class="classattr">
                                <div class="attr variable">
            <span class="name">at_position</span>

        
    </div>
    <a class="headerlink" href="#ParseError.at_position"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.BaseException</dt>
                                <dd id="ParseError.with_traceback" class="function">with_traceback</dd>
                <dd id="ParseError.args" class="variable">args</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="is_token">
                            <input id="is_token-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_token</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">s</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="is_token-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#is_token"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="is_token-268"><a href="#is_token-268"><span class="linenos">268</span></a><span class="k">def</span> <span class="nf">is_token</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="is_token-269"><a href="#is_token-269"><span class="linenos">269</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Determines if the string is a valid token.&quot;&quot;&quot;</span>
</span><span id="is_token-270"><a href="#is_token-270"><span class="linenos">270</span></a>    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
</span><span id="is_token-271"><a href="#is_token-271"><span class="linenos">271</span></a>        <span class="k">if</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">32</span> <span class="ow">or</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">128</span> <span class="ow">or</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">SEPARATORS</span><span class="p">:</span>
</span><span id="is_token-272"><a href="#is_token-272"><span class="linenos">272</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="is_token-273"><a href="#is_token-273"><span class="linenos">273</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Determines if the string is a valid token.</p>
</div>


                </section>
                <section id="parse_comma_list">
                            <input id="parse_comma_list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse_comma_list</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">start</span><span class="o">=</span><span class="mi">0</span>, </span><span class="param"><span class="n">element_parser</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">min_count</span><span class="o">=</span><span class="mi">0</span>, </span><span class="param"><span class="n">max_count</span><span class="o">=</span><span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="parse_comma_list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parse_comma_list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parse_comma_list-276"><a href="#parse_comma_list-276"><span class="linenos">276</span></a><span class="k">def</span> <span class="nf">parse_comma_list</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">element_parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_count</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="parse_comma_list-277"><a href="#parse_comma_list-277"><span class="linenos">277</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a comma-separated list with optional whitespace.</span>
</span><span id="parse_comma_list-278"><a href="#parse_comma_list-278"><span class="linenos">278</span></a>
</span><span id="parse_comma_list-279"><a href="#parse_comma_list-279"><span class="linenos">279</span></a><span class="sd">    Takes an optional callback function `element_parser`, which</span>
</span><span id="parse_comma_list-280"><a href="#parse_comma_list-280"><span class="linenos">280</span></a><span class="sd">    is assumed to be able to parse an individual element.  It</span>
</span><span id="parse_comma_list-281"><a href="#parse_comma_list-281"><span class="linenos">281</span></a><span class="sd">    will be passed the string and a `start` argument, and</span>
</span><span id="parse_comma_list-282"><a href="#parse_comma_list-282"><span class="linenos">282</span></a><span class="sd">    is expected to return a tuple (parsed_result, chars_consumed).</span>
</span><span id="parse_comma_list-283"><a href="#parse_comma_list-283"><span class="linenos">283</span></a>
</span><span id="parse_comma_list-284"><a href="#parse_comma_list-284"><span class="linenos">284</span></a><span class="sd">    If no element_parser is given, then either single tokens or</span>
</span><span id="parse_comma_list-285"><a href="#parse_comma_list-285"><span class="linenos">285</span></a><span class="sd">    quoted strings will be parsed.</span>
</span><span id="parse_comma_list-286"><a href="#parse_comma_list-286"><span class="linenos">286</span></a>
</span><span id="parse_comma_list-287"><a href="#parse_comma_list-287"><span class="linenos">287</span></a><span class="sd">    If min_count &gt; 0, then at least that many non-empty elements</span>
</span><span id="parse_comma_list-288"><a href="#parse_comma_list-288"><span class="linenos">288</span></a><span class="sd">    must be in the list, or an error is raised.</span>
</span><span id="parse_comma_list-289"><a href="#parse_comma_list-289"><span class="linenos">289</span></a>
</span><span id="parse_comma_list-290"><a href="#parse_comma_list-290"><span class="linenos">290</span></a><span class="sd">    If max_count &gt; 0, then no more than that many non-empty elements</span>
</span><span id="parse_comma_list-291"><a href="#parse_comma_list-291"><span class="linenos">291</span></a><span class="sd">    may be in the list, or an error is raised.</span>
</span><span id="parse_comma_list-292"><a href="#parse_comma_list-292"><span class="linenos">292</span></a>
</span><span id="parse_comma_list-293"><a href="#parse_comma_list-293"><span class="linenos">293</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="parse_comma_list-294"><a href="#parse_comma_list-294"><span class="linenos">294</span></a>    <span class="k">if</span> <span class="n">min_count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">start</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="parse_comma_list-295"><a href="#parse_comma_list-295"><span class="linenos">295</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Comma-separated list must contain some elements&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
</span><span id="parse_comma_list-296"><a href="#parse_comma_list-296"><span class="linenos">296</span></a>    <span class="k">elif</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="parse_comma_list-297"><a href="#parse_comma_list-297"><span class="linenos">297</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Starting position is beyond the end of the string&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
</span><span id="parse_comma_list-298"><a href="#parse_comma_list-298"><span class="linenos">298</span></a>
</span><span id="parse_comma_list-299"><a href="#parse_comma_list-299"><span class="linenos">299</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">element_parser</span><span class="p">:</span>
</span><span id="parse_comma_list-300"><a href="#parse_comma_list-300"><span class="linenos">300</span></a>        <span class="n">element_parser</span> <span class="o">=</span> <span class="n">parse_token_or_quoted_string</span>
</span><span id="parse_comma_list-301"><a href="#parse_comma_list-301"><span class="linenos">301</span></a>    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="parse_comma_list-302"><a href="#parse_comma_list-302"><span class="linenos">302</span></a>    <span class="n">pos</span> <span class="o">=</span> <span class="n">start</span>
</span><span id="parse_comma_list-303"><a href="#parse_comma_list-303"><span class="linenos">303</span></a>    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="parse_comma_list-304"><a href="#parse_comma_list-304"><span class="linenos">304</span></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">element_parser</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span> <span class="p">)</span>
</span><span id="parse_comma_list-305"><a href="#parse_comma_list-305"><span class="linenos">305</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">e</span> <span class="ow">or</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="parse_comma_list-306"><a href="#parse_comma_list-306"><span class="linenos">306</span></a>            <span class="k">break</span> <span class="c1"># end of data?</span>
</span><span id="parse_comma_list-307"><a href="#parse_comma_list-307"><span class="linenos">307</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="parse_comma_list-308"><a href="#parse_comma_list-308"><span class="linenos">308</span></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
</span><span id="parse_comma_list-309"><a href="#parse_comma_list-309"><span class="linenos">309</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="parse_comma_list-310"><a href="#parse_comma_list-310"><span class="linenos">310</span></a>        <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="parse_comma_list-311"><a href="#parse_comma_list-311"><span class="linenos">311</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_comma_list-312"><a href="#parse_comma_list-312"><span class="linenos">312</span></a>        <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;,&#39;</span><span class="p">:</span>
</span><span id="parse_comma_list-313"><a href="#parse_comma_list-313"><span class="linenos">313</span></a>            <span class="k">break</span>
</span><span id="parse_comma_list-314"><a href="#parse_comma_list-314"><span class="linenos">314</span></a>        <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span><span class="p">:</span>
</span><span id="parse_comma_list-315"><a href="#parse_comma_list-315"><span class="linenos">315</span></a>            <span class="c1"># skip comma and any &quot;empty&quot; elements</span>
</span><span id="parse_comma_list-316"><a href="#parse_comma_list-316"><span class="linenos">316</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># skip comma</span>
</span><span id="parse_comma_list-317"><a href="#parse_comma_list-317"><span class="linenos">317</span></a>            <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="parse_comma_list-318"><a href="#parse_comma_list-318"><span class="linenos">318</span></a>                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_comma_list-319"><a href="#parse_comma_list-319"><span class="linenos">319</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_count</span><span class="p">:</span>
</span><span id="parse_comma_list-320"><a href="#parse_comma_list-320"><span class="linenos">320</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Comma-separated list does not have enough elements&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="parse_comma_list-321"><a href="#parse_comma_list-321"><span class="linenos">321</span></a>    <span class="k">elif</span> <span class="n">max_count</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_count</span><span class="p">:</span>
</span><span id="parse_comma_list-322"><a href="#parse_comma_list-322"><span class="linenos">322</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Comma-separated list has too many elements&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="parse_comma_list-323"><a href="#parse_comma_list-323"><span class="linenos">323</span></a>    <span class="k">return</span> <span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">pos</span><span class="o">-</span><span class="n">start</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Parses a comma-separated list with optional whitespace.</p>

<p>Takes an optional callback function <code>element_parser</code>, which
is assumed to be able to parse an individual element.  It
will be passed the string and a <code>start</code> argument, and
is expected to return a tuple (parsed_result, chars_consumed).</p>

<p>If no element_parser is given, then either single tokens or
quoted strings will be parsed.</p>

<p>If min_count &gt; 0, then at least that many non-empty elements
must be in the list, or an error is raised.</p>

<p>If max_count &gt; 0, then no more than that many non-empty elements
may be in the list, or an error is raised.</p>
</div>


                </section>
                <section id="parse_token">
                            <input id="parse_token-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse_token</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">start</span><span class="o">=</span><span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="parse_token-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parse_token"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parse_token-326"><a href="#parse_token-326"><span class="linenos">326</span></a><span class="k">def</span> <span class="nf">parse_token</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="parse_token-327"><a href="#parse_token-327"><span class="linenos">327</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a token.</span>
</span><span id="parse_token-328"><a href="#parse_token-328"><span class="linenos">328</span></a>
</span><span id="parse_token-329"><a href="#parse_token-329"><span class="linenos">329</span></a><span class="sd">    A token is a string defined by RFC 2616 section 2.2 as:</span>
</span><span id="parse_token-330"><a href="#parse_token-330"><span class="linenos">330</span></a><span class="sd">       token = 1*&lt;any CHAR except CTLs or separators&gt;</span>
</span><span id="parse_token-331"><a href="#parse_token-331"><span class="linenos">331</span></a>
</span><span id="parse_token-332"><a href="#parse_token-332"><span class="linenos">332</span></a><span class="sd">    Returns a tuple (token, chars_consumed), or (&#39;&#39;,0) if no token</span>
</span><span id="parse_token-333"><a href="#parse_token-333"><span class="linenos">333</span></a><span class="sd">    starts at the given string position.  On a syntax error, a</span>
</span><span id="parse_token-334"><a href="#parse_token-334"><span class="linenos">334</span></a><span class="sd">    ParseError exception will be raised.</span>
</span><span id="parse_token-335"><a href="#parse_token-335"><span class="linenos">335</span></a>
</span><span id="parse_token-336"><a href="#parse_token-336"><span class="linenos">336</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="parse_token-337"><a href="#parse_token-337"><span class="linenos">337</span></a>    <span class="k">return</span> <span class="n">parse_token_or_quoted_string</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">allow_quoted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_token</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Parses a token.</p>

<p>A token is a string defined by RFC 2616 section 2.2 as:
   token = 1*<any CHAR except CTLs or separators></p>

<p>Returns a tuple (token, chars_consumed), or ('',0) if no token
starts at the given string position.  On a syntax error, a
ParseError exception will be raised.</p>
</div>


                </section>
                <section id="quote_string">
                            <input id="quote_string-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">quote_string</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">always_quote</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="quote_string-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#quote_string"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="quote_string-340"><a href="#quote_string-340"><span class="linenos">340</span></a><span class="k">def</span> <span class="nf">quote_string</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">always_quote</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="quote_string-341"><a href="#quote_string-341"><span class="linenos">341</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Produces a quoted string according to HTTP 1.1 rules.</span>
</span><span id="quote_string-342"><a href="#quote_string-342"><span class="linenos">342</span></a>
</span><span id="quote_string-343"><a href="#quote_string-343"><span class="linenos">343</span></a><span class="sd">    If always_quote is False and if the string is also a valid token,</span>
</span><span id="quote_string-344"><a href="#quote_string-344"><span class="linenos">344</span></a><span class="sd">    then this function may return a string without quotes.</span>
</span><span id="quote_string-345"><a href="#quote_string-345"><span class="linenos">345</span></a>
</span><span id="quote_string-346"><a href="#quote_string-346"><span class="linenos">346</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="quote_string-347"><a href="#quote_string-347"><span class="linenos">347</span></a>    <span class="n">need_quotes</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="quote_string-348"><a href="#quote_string-348"><span class="linenos">348</span></a>    <span class="n">q</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="quote_string-349"><a href="#quote_string-349"><span class="linenos">349</span></a>    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
</span><span id="quote_string-350"><a href="#quote_string-350"><span class="linenos">350</span></a>        <span class="k">if</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">32</span> <span class="ow">or</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">127</span> <span class="ow">or</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">SEPARATORS</span><span class="p">:</span>
</span><span id="quote_string-351"><a href="#quote_string-351"><span class="linenos">351</span></a>            <span class="n">q</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">c</span>
</span><span id="quote_string-352"><a href="#quote_string-352"><span class="linenos">352</span></a>            <span class="n">need_quotes</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="quote_string-353"><a href="#quote_string-353"><span class="linenos">353</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="quote_string-354"><a href="#quote_string-354"><span class="linenos">354</span></a>            <span class="n">q</span> <span class="o">+=</span> <span class="n">c</span>
</span><span id="quote_string-355"><a href="#quote_string-355"><span class="linenos">355</span></a>    <span class="k">if</span> <span class="n">need_quotes</span> <span class="ow">or</span> <span class="n">always_quote</span><span class="p">:</span>
</span><span id="quote_string-356"><a href="#quote_string-356"><span class="linenos">356</span></a>        <span class="k">return</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">q</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
</span><span id="quote_string-357"><a href="#quote_string-357"><span class="linenos">357</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="quote_string-358"><a href="#quote_string-358"><span class="linenos">358</span></a>        <span class="k">return</span> <span class="n">q</span>
</span></pre></div>


            <div class="docstring"><p>Produces a quoted string according to HTTP 1.1 rules.</p>

<p>If always_quote is False and if the string is also a valid token,
then this function may return a string without quotes.</p>
</div>


                </section>
                <section id="parse_quoted_string">
                            <input id="parse_quoted_string-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse_quoted_string</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">start</span><span class="o">=</span><span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="parse_quoted_string-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parse_quoted_string"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parse_quoted_string-361"><a href="#parse_quoted_string-361"><span class="linenos">361</span></a><span class="k">def</span> <span class="nf">parse_quoted_string</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="parse_quoted_string-362"><a href="#parse_quoted_string-362"><span class="linenos">362</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a quoted string.</span>
</span><span id="parse_quoted_string-363"><a href="#parse_quoted_string-363"><span class="linenos">363</span></a>
</span><span id="parse_quoted_string-364"><a href="#parse_quoted_string-364"><span class="linenos">364</span></a><span class="sd">    Returns a tuple (string, chars_consumed).  The quote marks will</span>
</span><span id="parse_quoted_string-365"><a href="#parse_quoted_string-365"><span class="linenos">365</span></a><span class="sd">    have been removed and all \-escapes will have been replaced with</span>
</span><span id="parse_quoted_string-366"><a href="#parse_quoted_string-366"><span class="linenos">366</span></a><span class="sd">    the characters they represent.</span>
</span><span id="parse_quoted_string-367"><a href="#parse_quoted_string-367"><span class="linenos">367</span></a>
</span><span id="parse_quoted_string-368"><a href="#parse_quoted_string-368"><span class="linenos">368</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="parse_quoted_string-369"><a href="#parse_quoted_string-369"><span class="linenos">369</span></a>    <span class="k">return</span> <span class="n">parse_token_or_quoted_string</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">allow_quoted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_token</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Parses a quoted string.</p>

<p>Returns a tuple (string, chars_consumed).  The quote marks will
have been removed and all -escapes will have been replaced with
the characters they represent.</p>
</div>


                </section>
                <section id="parse_token_or_quoted_string">
                            <input id="parse_token_or_quoted_string-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse_token_or_quoted_string</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">start</span><span class="o">=</span><span class="mi">0</span>, </span><span class="param"><span class="n">allow_quoted</span><span class="o">=</span><span class="kc">True</span>, </span><span class="param"><span class="n">allow_token</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="parse_token_or_quoted_string-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parse_token_or_quoted_string"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parse_token_or_quoted_string-372"><a href="#parse_token_or_quoted_string-372"><span class="linenos">372</span></a><span class="k">def</span> <span class="nf">parse_token_or_quoted_string</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">allow_quoted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_token</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="parse_token_or_quoted_string-373"><a href="#parse_token_or_quoted_string-373"><span class="linenos">373</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a token or a quoted-string.</span>
</span><span id="parse_token_or_quoted_string-374"><a href="#parse_token_or_quoted_string-374"><span class="linenos">374</span></a>
</span><span id="parse_token_or_quoted_string-375"><a href="#parse_token_or_quoted_string-375"><span class="linenos">375</span></a><span class="sd">    &#39;s&#39; is the string to parse, while start is the position within the</span>
</span><span id="parse_token_or_quoted_string-376"><a href="#parse_token_or_quoted_string-376"><span class="linenos">376</span></a><span class="sd">    string where parsing should begin.  It will returns a tuple</span>
</span><span id="parse_token_or_quoted_string-377"><a href="#parse_token_or_quoted_string-377"><span class="linenos">377</span></a><span class="sd">    (token, chars_consumed), with all \-escapes and quotation already</span>
</span><span id="parse_token_or_quoted_string-378"><a href="#parse_token_or_quoted_string-378"><span class="linenos">378</span></a><span class="sd">    processed.</span>
</span><span id="parse_token_or_quoted_string-379"><a href="#parse_token_or_quoted_string-379"><span class="linenos">379</span></a>
</span><span id="parse_token_or_quoted_string-380"><a href="#parse_token_or_quoted_string-380"><span class="linenos">380</span></a><span class="sd">    Syntax is according to BNF rules in RFC 2161 section 2.2,</span>
</span><span id="parse_token_or_quoted_string-381"><a href="#parse_token_or_quoted_string-381"><span class="linenos">381</span></a><span class="sd">    specifically the &#39;token&#39; and &#39;quoted-string&#39; declarations.</span>
</span><span id="parse_token_or_quoted_string-382"><a href="#parse_token_or_quoted_string-382"><span class="linenos">382</span></a><span class="sd">    Syntax errors in the input string will result in ParseError</span>
</span><span id="parse_token_or_quoted_string-383"><a href="#parse_token_or_quoted_string-383"><span class="linenos">383</span></a><span class="sd">    being raised.</span>
</span><span id="parse_token_or_quoted_string-384"><a href="#parse_token_or_quoted_string-384"><span class="linenos">384</span></a>
</span><span id="parse_token_or_quoted_string-385"><a href="#parse_token_or_quoted_string-385"><span class="linenos">385</span></a><span class="sd">    If allow_quoted is False, then only tokens will be parsed instead</span>
</span><span id="parse_token_or_quoted_string-386"><a href="#parse_token_or_quoted_string-386"><span class="linenos">386</span></a><span class="sd">    of either a token or quoted-string.</span>
</span><span id="parse_token_or_quoted_string-387"><a href="#parse_token_or_quoted_string-387"><span class="linenos">387</span></a>
</span><span id="parse_token_or_quoted_string-388"><a href="#parse_token_or_quoted_string-388"><span class="linenos">388</span></a><span class="sd">    If allow_token is False, then only quoted-strings will be parsed</span>
</span><span id="parse_token_or_quoted_string-389"><a href="#parse_token_or_quoted_string-389"><span class="linenos">389</span></a><span class="sd">    instead of either a token or quoted-string.</span>
</span><span id="parse_token_or_quoted_string-390"><a href="#parse_token_or_quoted_string-390"><span class="linenos">390</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="parse_token_or_quoted_string-391"><a href="#parse_token_or_quoted_string-391"><span class="linenos">391</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_quoted</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">allow_token</span><span class="p">:</span>
</span><span id="parse_token_or_quoted_string-392"><a href="#parse_token_or_quoted_string-392"><span class="linenos">392</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parsing can not continue with options provided&#39;</span><span class="p">)</span>
</span><span id="parse_token_or_quoted_string-393"><a href="#parse_token_or_quoted_string-393"><span class="linenos">393</span></a>
</span><span id="parse_token_or_quoted_string-394"><a href="#parse_token_or_quoted_string-394"><span class="linenos">394</span></a>    <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="parse_token_or_quoted_string-395"><a href="#parse_token_or_quoted_string-395"><span class="linenos">395</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Starting position is beyond the end of the string&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
</span><span id="parse_token_or_quoted_string-396"><a href="#parse_token_or_quoted_string-396"><span class="linenos">396</span></a>    <span class="n">has_quote</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
</span><span id="parse_token_or_quoted_string-397"><a href="#parse_token_or_quoted_string-397"><span class="linenos">397</span></a>    <span class="k">if</span> <span class="n">has_quote</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">allow_quoted</span><span class="p">:</span>
</span><span id="parse_token_or_quoted_string-398"><a href="#parse_token_or_quoted_string-398"><span class="linenos">398</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;A quoted string was not expected&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
</span><span id="parse_token_or_quoted_string-399"><a href="#parse_token_or_quoted_string-399"><span class="linenos">399</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_quote</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">allow_token</span><span class="p">:</span>
</span><span id="parse_token_or_quoted_string-400"><a href="#parse_token_or_quoted_string-400"><span class="linenos">400</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Expected a quotation mark&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
</span><span id="parse_token_or_quoted_string-401"><a href="#parse_token_or_quoted_string-401"><span class="linenos">401</span></a>
</span><span id="parse_token_or_quoted_string-402"><a href="#parse_token_or_quoted_string-402"><span class="linenos">402</span></a>    <span class="n">s2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="parse_token_or_quoted_string-403"><a href="#parse_token_or_quoted_string-403"><span class="linenos">403</span></a>    <span class="n">pos</span> <span class="o">=</span> <span class="n">start</span>
</span><span id="parse_token_or_quoted_string-404"><a href="#parse_token_or_quoted_string-404"><span class="linenos">404</span></a>    <span class="k">if</span> <span class="n">has_quote</span><span class="p">:</span>
</span><span id="parse_token_or_quoted_string-405"><a href="#parse_token_or_quoted_string-405"><span class="linenos">405</span></a>        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_token_or_quoted_string-406"><a href="#parse_token_or_quoted_string-406"><span class="linenos">406</span></a>    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="parse_token_or_quoted_string-407"><a href="#parse_token_or_quoted_string-407"><span class="linenos">407</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
</span><span id="parse_token_or_quoted_string-408"><a href="#parse_token_or_quoted_string-408"><span class="linenos">408</span></a>        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="ow">and</span> <span class="n">has_quote</span><span class="p">:</span>
</span><span id="parse_token_or_quoted_string-409"><a href="#parse_token_or_quoted_string-409"><span class="linenos">409</span></a>            <span class="c1"># Note this is NOT C-style escaping; the character after the \ is</span>
</span><span id="parse_token_or_quoted_string-410"><a href="#parse_token_or_quoted_string-410"><span class="linenos">410</span></a>            <span class="c1"># taken literally.</span>
</span><span id="parse_token_or_quoted_string-411"><a href="#parse_token_or_quoted_string-411"><span class="linenos">411</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_token_or_quoted_string-412"><a href="#parse_token_or_quoted_string-412"><span class="linenos">412</span></a>            <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="parse_token_or_quoted_string-413"><a href="#parse_token_or_quoted_string-413"><span class="linenos">413</span></a>                <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s2">&quot;End of string while expecting a character after &#39;</span><span class="se">\\</span><span class="s2">&#39;&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="parse_token_or_quoted_string-414"><a href="#parse_token_or_quoted_string-414"><span class="linenos">414</span></a>            <span class="n">s2</span> <span class="o">+=</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
</span><span id="parse_token_or_quoted_string-415"><a href="#parse_token_or_quoted_string-415"><span class="linenos">415</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_token_or_quoted_string-416"><a href="#parse_token_or_quoted_string-416"><span class="linenos">416</span></a>        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">and</span> <span class="n">has_quote</span><span class="p">:</span>
</span><span id="parse_token_or_quoted_string-417"><a href="#parse_token_or_quoted_string-417"><span class="linenos">417</span></a>            <span class="k">break</span>
</span><span id="parse_token_or_quoted_string-418"><a href="#parse_token_or_quoted_string-418"><span class="linenos">418</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">has_quote</span> <span class="ow">and</span> <span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="n">SEPARATORS</span> <span class="ow">or</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">32</span> <span class="ow">or</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">127</span><span class="p">):</span>
</span><span id="parse_token_or_quoted_string-419"><a href="#parse_token_or_quoted_string-419"><span class="linenos">419</span></a>            <span class="k">break</span>
</span><span id="parse_token_or_quoted_string-420"><a href="#parse_token_or_quoted_string-420"><span class="linenos">420</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="parse_token_or_quoted_string-421"><a href="#parse_token_or_quoted_string-421"><span class="linenos">421</span></a>            <span class="n">s2</span> <span class="o">+=</span> <span class="n">c</span>
</span><span id="parse_token_or_quoted_string-422"><a href="#parse_token_or_quoted_string-422"><span class="linenos">422</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_token_or_quoted_string-423"><a href="#parse_token_or_quoted_string-423"><span class="linenos">423</span></a>    <span class="k">if</span> <span class="n">has_quote</span><span class="p">:</span>
</span><span id="parse_token_or_quoted_string-424"><a href="#parse_token_or_quoted_string-424"><span class="linenos">424</span></a>        <span class="c1"># Make sure we have a closing quote mark</span>
</span><span id="parse_token_or_quoted_string-425"><a href="#parse_token_or_quoted_string-425"><span class="linenos">425</span></a>        <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">:</span>
</span><span id="parse_token_or_quoted_string-426"><a href="#parse_token_or_quoted_string-426"><span class="linenos">426</span></a>            <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Quoted string is missing closing quote mark&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="parse_token_or_quoted_string-427"><a href="#parse_token_or_quoted_string-427"><span class="linenos">427</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="parse_token_or_quoted_string-428"><a href="#parse_token_or_quoted_string-428"><span class="linenos">428</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_token_or_quoted_string-429"><a href="#parse_token_or_quoted_string-429"><span class="linenos">429</span></a>    <span class="k">return</span> <span class="n">s2</span><span class="p">,</span> <span class="p">(</span><span class="n">pos</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Parses a token or a quoted-string.</p>

<p>'s' is the string to parse, while start is the position within the
string where parsing should begin.  It will returns a tuple
(token, chars_consumed), with all -escapes and quotation already
processed.</p>

<p>Syntax is according to BNF rules in RFC 2161 section 2.2,
specifically the 'token' and 'quoted-string' declarations.
Syntax errors in the input string will result in ParseError
being raised.</p>

<p>If allow_quoted is False, then only tokens will be parsed instead
of either a token or quoted-string.</p>

<p>If allow_token is False, then only quoted-strings will be parsed
instead of either a token or quoted-string.</p>
</div>


                </section>
                <section id="remove_comments">
                            <input id="remove_comments-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_comments</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">collapse_spaces</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="remove_comments-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#remove_comments"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="remove_comments-432"><a href="#remove_comments-432"><span class="linenos">432</span></a><span class="k">def</span> <span class="nf">remove_comments</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">collapse_spaces</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="remove_comments-433"><a href="#remove_comments-433"><span class="linenos">433</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Removes any ()-style comments from a string.</span>
</span><span id="remove_comments-434"><a href="#remove_comments-434"><span class="linenos">434</span></a>
</span><span id="remove_comments-435"><a href="#remove_comments-435"><span class="linenos">435</span></a><span class="sd">    In HTTP, ()-comments can nest, and this function will correctly</span>
</span><span id="remove_comments-436"><a href="#remove_comments-436"><span class="linenos">436</span></a><span class="sd">    deal with that.</span>
</span><span id="remove_comments-437"><a href="#remove_comments-437"><span class="linenos">437</span></a>
</span><span id="remove_comments-438"><a href="#remove_comments-438"><span class="linenos">438</span></a><span class="sd">    If &#39;collapse_spaces&#39; is True, then if there is any whitespace</span>
</span><span id="remove_comments-439"><a href="#remove_comments-439"><span class="linenos">439</span></a><span class="sd">    surrounding the comment, it will be replaced with a single space</span>
</span><span id="remove_comments-440"><a href="#remove_comments-440"><span class="linenos">440</span></a><span class="sd">    character.  Whitespace also collapses across multiple comment</span>
</span><span id="remove_comments-441"><a href="#remove_comments-441"><span class="linenos">441</span></a><span class="sd">    sequences, so that &quot;a (b) (c) d&quot; becomes just &quot;a d&quot;.</span>
</span><span id="remove_comments-442"><a href="#remove_comments-442"><span class="linenos">442</span></a>
</span><span id="remove_comments-443"><a href="#remove_comments-443"><span class="linenos">443</span></a><span class="sd">    Otherwise, if &#39;collapse_spaces&#39; is False then all whitespace which</span>
</span><span id="remove_comments-444"><a href="#remove_comments-444"><span class="linenos">444</span></a><span class="sd">    is outside any comments is left intact as-is.</span>
</span><span id="remove_comments-445"><a href="#remove_comments-445"><span class="linenos">445</span></a>
</span><span id="remove_comments-446"><a href="#remove_comments-446"><span class="linenos">446</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="remove_comments-447"><a href="#remove_comments-447"><span class="linenos">447</span></a>    <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
</span><span id="remove_comments-448"><a href="#remove_comments-448"><span class="linenos">448</span></a>        <span class="k">return</span> <span class="n">s</span>  <span class="c1"># simple case</span>
</span><span id="remove_comments-449"><a href="#remove_comments-449"><span class="linenos">449</span></a>    <span class="n">A</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="remove_comments-450"><a href="#remove_comments-450"><span class="linenos">450</span></a>    <span class="n">dostrip</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="remove_comments-451"><a href="#remove_comments-451"><span class="linenos">451</span></a>    <span class="n">added_comment_space</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="remove_comments-452"><a href="#remove_comments-452"><span class="linenos">452</span></a>    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="remove_comments-453"><a href="#remove_comments-453"><span class="linenos">453</span></a>    <span class="k">if</span> <span class="n">collapse_spaces</span><span class="p">:</span>
</span><span id="remove_comments-454"><a href="#remove_comments-454"><span class="linenos">454</span></a>        <span class="c1"># eat any leading spaces before a comment</span>
</span><span id="remove_comments-455"><a href="#remove_comments-455"><span class="linenos">455</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span>
</span><span id="remove_comments-456"><a href="#remove_comments-456"><span class="linenos">456</span></a>        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="remove_comments-457"><a href="#remove_comments-457"><span class="linenos">457</span></a>            <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="remove_comments-458"><a href="#remove_comments-458"><span class="linenos">458</span></a>                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="remove_comments-459"><a href="#remove_comments-459"><span class="linenos">459</span></a>            <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="n">i</span><span class="p">:</span>
</span><span id="remove_comments-460"><a href="#remove_comments-460"><span class="linenos">460</span></a>                <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="remove_comments-461"><a href="#remove_comments-461"><span class="linenos">461</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="remove_comments-462"><a href="#remove_comments-462"><span class="linenos">462</span></a>                <span class="n">dostrip</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="remove_comments-463"><a href="#remove_comments-463"><span class="linenos">463</span></a>                <span class="n">added_comment_space</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># lie</span>
</span><span id="remove_comments-464"><a href="#remove_comments-464"><span class="linenos">464</span></a>    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="remove_comments-465"><a href="#remove_comments-465"><span class="linenos">465</span></a>        <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;(&#39;</span><span class="p">:</span>
</span><span id="remove_comments-466"><a href="#remove_comments-466"><span class="linenos">466</span></a>            <span class="n">cmt</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_comment</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span> <span class="p">)</span>
</span><span id="remove_comments-467"><a href="#remove_comments-467"><span class="linenos">467</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="remove_comments-468"><a href="#remove_comments-468"><span class="linenos">468</span></a>            <span class="k">if</span> <span class="n">collapse_spaces</span><span class="p">:</span>
</span><span id="remove_comments-469"><a href="#remove_comments-469"><span class="linenos">469</span></a>                <span class="n">dostrip</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="remove_comments-470"><a href="#remove_comments-470"><span class="linenos">470</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">added_comment_space</span><span class="p">:</span>
</span><span id="remove_comments-471"><a href="#remove_comments-471"><span class="linenos">471</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="remove_comments-472"><a href="#remove_comments-472"><span class="linenos">472</span></a>                        <span class="c1"># previous part ended with whitespace</span>
</span><span id="remove_comments-473"><a href="#remove_comments-473"><span class="linenos">473</span></a>                        <span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</span><span id="remove_comments-474"><a href="#remove_comments-474"><span class="linenos">474</span></a>                        <span class="n">A</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>  <span class="c1"># comment becomes one space</span>
</span><span id="remove_comments-475"><a href="#remove_comments-475"><span class="linenos">475</span></a>                        <span class="n">added_comment_space</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="remove_comments-476"><a href="#remove_comments-476"><span class="linenos">476</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="remove_comments-477"><a href="#remove_comments-477"><span class="linenos">477</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span> <span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="n">pos</span> <span class="p">)</span>
</span><span id="remove_comments-478"><a href="#remove_comments-478"><span class="linenos">478</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="remove_comments-479"><a href="#remove_comments-479"><span class="linenos">479</span></a>                <span class="k">if</span> <span class="n">dostrip</span><span class="p">:</span>
</span><span id="remove_comments-480"><a href="#remove_comments-480"><span class="linenos">480</span></a>                    <span class="n">text</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
</span><span id="remove_comments-481"><a href="#remove_comments-481"><span class="linenos">481</span></a>                    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">added_comment_space</span><span class="p">:</span>
</span><span id="remove_comments-482"><a href="#remove_comments-482"><span class="linenos">482</span></a>                        <span class="n">A</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="remove_comments-483"><a href="#remove_comments-483"><span class="linenos">483</span></a>                        <span class="n">added_comment_space</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="remove_comments-484"><a href="#remove_comments-484"><span class="linenos">484</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="remove_comments-485"><a href="#remove_comments-485"><span class="linenos">485</span></a>                    <span class="n">text</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span>
</span><span id="remove_comments-486"><a href="#remove_comments-486"><span class="linenos">486</span></a>                <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
</span><span id="remove_comments-487"><a href="#remove_comments-487"><span class="linenos">487</span></a>                    <span class="n">A</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="remove_comments-488"><a href="#remove_comments-488"><span class="linenos">488</span></a>                    <span class="n">dostrip</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="remove_comments-489"><a href="#remove_comments-489"><span class="linenos">489</span></a>                    <span class="n">added_comment_space</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="remove_comments-490"><a href="#remove_comments-490"><span class="linenos">490</span></a>                <span class="k">break</span> <span class="c1"># end of string</span>
</span><span id="remove_comments-491"><a href="#remove_comments-491"><span class="linenos">491</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="remove_comments-492"><a href="#remove_comments-492"><span class="linenos">492</span></a>                <span class="k">if</span> <span class="n">dostrip</span><span class="p">:</span>
</span><span id="remove_comments-493"><a href="#remove_comments-493"><span class="linenos">493</span></a>                    <span class="n">text</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
</span><span id="remove_comments-494"><a href="#remove_comments-494"><span class="linenos">494</span></a>                    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">added_comment_space</span><span class="p">:</span>
</span><span id="remove_comments-495"><a href="#remove_comments-495"><span class="linenos">495</span></a>                        <span class="n">A</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="remove_comments-496"><a href="#remove_comments-496"><span class="linenos">496</span></a>                        <span class="n">added_comment_space</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="remove_comments-497"><a href="#remove_comments-497"><span class="linenos">497</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="remove_comments-498"><a href="#remove_comments-498"><span class="linenos">498</span></a>                    <span class="n">text</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">i</span><span class="p">]</span>
</span><span id="remove_comments-499"><a href="#remove_comments-499"><span class="linenos">499</span></a>                <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
</span><span id="remove_comments-500"><a href="#remove_comments-500"><span class="linenos">500</span></a>                    <span class="n">A</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="remove_comments-501"><a href="#remove_comments-501"><span class="linenos">501</span></a>                    <span class="n">dostrip</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="remove_comments-502"><a href="#remove_comments-502"><span class="linenos">502</span></a>                    <span class="n">added_comment_space</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="remove_comments-503"><a href="#remove_comments-503"><span class="linenos">503</span></a>                <span class="n">pos</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="remove_comments-504"><a href="#remove_comments-504"><span class="linenos">504</span></a>    <span class="k">if</span> <span class="n">dostrip</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="remove_comments-505"><a href="#remove_comments-505"><span class="linenos">505</span></a>        <span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</span><span id="remove_comments-506"><a href="#remove_comments-506"><span class="linenos">506</span></a>    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Removes any ()-style comments from a string.</p>

<p>In HTTP, ()-comments can nest, and this function will correctly
deal with that.</p>

<p>If 'collapse_spaces' is True, then if there is any whitespace
surrounding the comment, it will be replaced with a single space
character.  Whitespace also collapses across multiple comment
sequences, so that "a (b) (c) d" becomes just "a d".</p>

<p>Otherwise, if 'collapse_spaces' is False then all whitespace which
is outside any comments is left intact as-is.</p>
</div>


                </section>
                <section id="parse_comment">
                            <input id="parse_comment-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse_comment</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">start</span><span class="o">=</span><span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="parse_comment-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parse_comment"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parse_comment-535"><a href="#parse_comment-535"><span class="linenos">535</span></a><span class="k">def</span> <span class="nf">parse_comment</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="parse_comment-536"><a href="#parse_comment-536"><span class="linenos">536</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a ()-style comment from a header value.</span>
</span><span id="parse_comment-537"><a href="#parse_comment-537"><span class="linenos">537</span></a>
</span><span id="parse_comment-538"><a href="#parse_comment-538"><span class="linenos">538</span></a><span class="sd">    Returns tuple (comment, chars_consumed), where the comment will</span>
</span><span id="parse_comment-539"><a href="#parse_comment-539"><span class="linenos">539</span></a><span class="sd">    have had the outer-most parentheses and white space stripped.  Any</span>
</span><span id="parse_comment-540"><a href="#parse_comment-540"><span class="linenos">540</span></a><span class="sd">    nested comments will still have their parentheses and whitespace</span>
</span><span id="parse_comment-541"><a href="#parse_comment-541"><span class="linenos">541</span></a><span class="sd">    left intact.</span>
</span><span id="parse_comment-542"><a href="#parse_comment-542"><span class="linenos">542</span></a>
</span><span id="parse_comment-543"><a href="#parse_comment-543"><span class="linenos">543</span></a><span class="sd">    All \-escaped quoted pairs will have been replaced with the actual</span>
</span><span id="parse_comment-544"><a href="#parse_comment-544"><span class="linenos">544</span></a><span class="sd">    characters they represent, even within the inner nested comments.</span>
</span><span id="parse_comment-545"><a href="#parse_comment-545"><span class="linenos">545</span></a>
</span><span id="parse_comment-546"><a href="#parse_comment-546"><span class="linenos">546</span></a><span class="sd">    You should note that only a few HTTP headers, such as User-Agent</span>
</span><span id="parse_comment-547"><a href="#parse_comment-547"><span class="linenos">547</span></a><span class="sd">    or Via, allow ()-style comments within the header value.</span>
</span><span id="parse_comment-548"><a href="#parse_comment-548"><span class="linenos">548</span></a>
</span><span id="parse_comment-549"><a href="#parse_comment-549"><span class="linenos">549</span></a><span class="sd">    A comment is defined by RFC 2616 section 2.2 as:</span>
</span><span id="parse_comment-550"><a href="#parse_comment-550"><span class="linenos">550</span></a><span class="sd">    </span>
</span><span id="parse_comment-551"><a href="#parse_comment-551"><span class="linenos">551</span></a><span class="sd">       comment = &quot;(&quot; *( ctext | quoted-pair | comment ) &quot;)&quot;</span>
</span><span id="parse_comment-552"><a href="#parse_comment-552"><span class="linenos">552</span></a><span class="sd">       ctext   = &lt;any TEXT excluding &quot;(&quot; and &quot;)&quot;&gt;</span>
</span><span id="parse_comment-553"><a href="#parse_comment-553"><span class="linenos">553</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="parse_comment-554"><a href="#parse_comment-554"><span class="linenos">554</span></a>    <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="parse_comment-555"><a href="#parse_comment-555"><span class="linenos">555</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Starting position is beyond the end of the string&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
</span><span id="parse_comment-556"><a href="#parse_comment-556"><span class="linenos">556</span></a>    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;(&#39;</span><span class="p">:</span>
</span><span id="parse_comment-557"><a href="#parse_comment-557"><span class="linenos">557</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Comment must begin with opening parenthesis&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
</span><span id="parse_comment-558"><a href="#parse_comment-558"><span class="linenos">558</span></a>
</span><span id="parse_comment-559"><a href="#parse_comment-559"><span class="linenos">559</span></a>    <span class="n">s2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="parse_comment-560"><a href="#parse_comment-560"><span class="linenos">560</span></a>    <span class="n">nestlevel</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="parse_comment-561"><a href="#parse_comment-561"><span class="linenos">561</span></a>    <span class="n">pos</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="parse_comment-562"><a href="#parse_comment-562"><span class="linenos">562</span></a>    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="parse_comment-563"><a href="#parse_comment-563"><span class="linenos">563</span></a>        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_comment-564"><a href="#parse_comment-564"><span class="linenos">564</span></a>
</span><span id="parse_comment-565"><a href="#parse_comment-565"><span class="linenos">565</span></a>    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="parse_comment-566"><a href="#parse_comment-566"><span class="linenos">566</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
</span><span id="parse_comment-567"><a href="#parse_comment-567"><span class="linenos">567</span></a>        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>
</span><span id="parse_comment-568"><a href="#parse_comment-568"><span class="linenos">568</span></a>            <span class="c1"># Note this is not C-style escaping; the character after the \ is</span>
</span><span id="parse_comment-569"><a href="#parse_comment-569"><span class="linenos">569</span></a>            <span class="c1"># taken literally.</span>
</span><span id="parse_comment-570"><a href="#parse_comment-570"><span class="linenos">570</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_comment-571"><a href="#parse_comment-571"><span class="linenos">571</span></a>            <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="parse_comment-572"><a href="#parse_comment-572"><span class="linenos">572</span></a>                <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s2">&quot;End of string while expecting a character after &#39;</span><span class="se">\\</span><span class="s2">&#39;&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="parse_comment-573"><a href="#parse_comment-573"><span class="linenos">573</span></a>            <span class="n">s2</span> <span class="o">+=</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
</span><span id="parse_comment-574"><a href="#parse_comment-574"><span class="linenos">574</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_comment-575"><a href="#parse_comment-575"><span class="linenos">575</span></a>        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;(&#39;</span><span class="p">:</span>
</span><span id="parse_comment-576"><a href="#parse_comment-576"><span class="linenos">576</span></a>            <span class="n">nestlevel</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_comment-577"><a href="#parse_comment-577"><span class="linenos">577</span></a>            <span class="n">s2</span> <span class="o">+=</span> <span class="n">c</span>
</span><span id="parse_comment-578"><a href="#parse_comment-578"><span class="linenos">578</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_comment-579"><a href="#parse_comment-579"><span class="linenos">579</span></a>        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;)&#39;</span><span class="p">:</span>
</span><span id="parse_comment-580"><a href="#parse_comment-580"><span class="linenos">580</span></a>            <span class="n">nestlevel</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="parse_comment-581"><a href="#parse_comment-581"><span class="linenos">581</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_comment-582"><a href="#parse_comment-582"><span class="linenos">582</span></a>            <span class="k">if</span> <span class="n">nestlevel</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="parse_comment-583"><a href="#parse_comment-583"><span class="linenos">583</span></a>                <span class="n">s2</span> <span class="o">+=</span> <span class="n">c</span>
</span><span id="parse_comment-584"><a href="#parse_comment-584"><span class="linenos">584</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="parse_comment-585"><a href="#parse_comment-585"><span class="linenos">585</span></a>                <span class="k">break</span>
</span><span id="parse_comment-586"><a href="#parse_comment-586"><span class="linenos">586</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="parse_comment-587"><a href="#parse_comment-587"><span class="linenos">587</span></a>            <span class="n">s2</span> <span class="o">+=</span> <span class="n">c</span>
</span><span id="parse_comment-588"><a href="#parse_comment-588"><span class="linenos">588</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_comment-589"><a href="#parse_comment-589"><span class="linenos">589</span></a>    <span class="k">if</span> <span class="n">nestlevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="parse_comment-590"><a href="#parse_comment-590"><span class="linenos">590</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;End of string reached before comment was closed&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="parse_comment-591"><a href="#parse_comment-591"><span class="linenos">591</span></a>    <span class="c1"># Now rstrip s2 of all LWS chars.</span>
</span><span id="parse_comment-592"><a href="#parse_comment-592"><span class="linenos">592</span></a>    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="parse_comment-593"><a href="#parse_comment-593"><span class="linenos">593</span></a>        <span class="n">s2</span> <span class="o">=</span> <span class="n">s2</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="parse_comment-594"><a href="#parse_comment-594"><span class="linenos">594</span></a>    <span class="k">return</span> <span class="n">s2</span><span class="p">,</span> <span class="p">(</span><span class="n">pos</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Parses a ()-style comment from a header value.</p>

<p>Returns tuple (comment, chars_consumed), where the comment will
have had the outer-most parentheses and white space stripped.  Any
nested comments will still have their parentheses and whitespace
left intact.</p>

<p>All -escaped quoted pairs will have been replaced with the actual
characters they represent, even within the inner nested comments.</p>

<p>You should note that only a few HTTP headers, such as User-Agent
or Via, allow ()-style comments within the header value.</p>

<p>A comment is defined by RFC 2616 section 2.2 as:</p>

<p>comment = "(" *( ctext | quoted-pair | comment ) ")"
   ctext   = <any TEXT excluding "(" and ")"></p>
</div>


                </section>
                <section id="range_spec">
                            <input id="range_spec-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">range_spec</span>:

                <label class="view-source-button" for="range_spec-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#range_spec"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="range_spec-597"><a href="#range_spec-597"><span class="linenos">597</span></a><span class="k">class</span> <span class="nc">range_spec</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="range_spec-598"><a href="#range_spec-598"><span class="linenos">598</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A single contiguous (byte) range.</span>
</span><span id="range_spec-599"><a href="#range_spec-599"><span class="linenos">599</span></a>
</span><span id="range_spec-600"><a href="#range_spec-600"><span class="linenos">600</span></a><span class="sd">    A range_spec defines a range (of bytes) by specifying two offsets,</span>
</span><span id="range_spec-601"><a href="#range_spec-601"><span class="linenos">601</span></a><span class="sd">    the &#39;first&#39; and &#39;last&#39;, which are inclusive in the range.  Offsets</span>
</span><span id="range_spec-602"><a href="#range_spec-602"><span class="linenos">602</span></a><span class="sd">    are zero-based (the first byte is offset 0).  The range can not be</span>
</span><span id="range_spec-603"><a href="#range_spec-603"><span class="linenos">603</span></a><span class="sd">    empty or negative (has to satisfy first &lt;= last).</span>
</span><span id="range_spec-604"><a href="#range_spec-604"><span class="linenos">604</span></a>
</span><span id="range_spec-605"><a href="#range_spec-605"><span class="linenos">605</span></a><span class="sd">    The range can be unbounded on either end, represented here by the</span>
</span><span id="range_spec-606"><a href="#range_spec-606"><span class="linenos">606</span></a><span class="sd">    None value, with these semantics:</span>
</span><span id="range_spec-607"><a href="#range_spec-607"><span class="linenos">607</span></a>
</span><span id="range_spec-608"><a href="#range_spec-608"><span class="linenos">608</span></a><span class="sd">       * A &#39;last&#39; of None always indicates the last possible byte</span>
</span><span id="range_spec-609"><a href="#range_spec-609"><span class="linenos">609</span></a><span class="sd">        (although that offset may not be known).</span>
</span><span id="range_spec-610"><a href="#range_spec-610"><span class="linenos">610</span></a>
</span><span id="range_spec-611"><a href="#range_spec-611"><span class="linenos">611</span></a><span class="sd">       * A &#39;first&#39; of None indicates this is a suffix range, where</span>
</span><span id="range_spec-612"><a href="#range_spec-612"><span class="linenos">612</span></a><span class="sd">         the last value is actually interpreted to be the number</span>
</span><span id="range_spec-613"><a href="#range_spec-613"><span class="linenos">613</span></a><span class="sd">         of bytes at the end of the file (regardless of file size).</span>
</span><span id="range_spec-614"><a href="#range_spec-614"><span class="linenos">614</span></a>
</span><span id="range_spec-615"><a href="#range_spec-615"><span class="linenos">615</span></a><span class="sd">    Note that it is not valid for both first and last to be None.</span>
</span><span id="range_spec-616"><a href="#range_spec-616"><span class="linenos">616</span></a>
</span><span id="range_spec-617"><a href="#range_spec-617"><span class="linenos">617</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="range_spec-618"><a href="#range_spec-618"><span class="linenos">618</span></a>
</span><span id="range_spec-619"><a href="#range_spec-619"><span class="linenos">619</span></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">,</span><span class="s1">&#39;last&#39;</span><span class="p">]</span>
</span><span id="range_spec-620"><a href="#range_spec-620"><span class="linenos">620</span></a>
</span><span id="range_spec-621"><a href="#range_spec-621"><span class="linenos">621</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="range_spec-622"><a href="#range_spec-622"><span class="linenos">622</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span> <span class="p">)</span>
</span><span id="range_spec-623"><a href="#range_spec-623"><span class="linenos">623</span></a>
</span><span id="range_spec-624"><a href="#range_spec-624"><span class="linenos">624</span></a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">):</span>
</span><span id="range_spec-625"><a href="#range_spec-625"><span class="linenos">625</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the value of this range given the first and last offsets.</span>
</span><span id="range_spec-626"><a href="#range_spec-626"><span class="linenos">626</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_spec-627"><a href="#range_spec-627"><span class="linenos">627</span></a>        <span class="k">if</span> <span class="n">first</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">last</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">first</span> <span class="o">&gt;</span> <span class="n">last</span><span class="p">:</span>
</span><span id="range_spec-628"><a href="#range_spec-628"><span class="linenos">628</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Byte range does not satisfy first &lt;= last.&quot;</span><span class="p">)</span>
</span><span id="range_spec-629"><a href="#range_spec-629"><span class="linenos">629</span></a>        <span class="k">elif</span> <span class="n">first</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">last</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="range_spec-630"><a href="#range_spec-630"><span class="linenos">630</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Byte range can not omit both first and last offsets.&quot;</span><span class="p">)</span>
</span><span id="range_spec-631"><a href="#range_spec-631"><span class="linenos">631</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">first</span>
</span><span id="range_spec-632"><a href="#range_spec-632"><span class="linenos">632</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="n">last</span>
</span><span id="range_spec-633"><a href="#range_spec-633"><span class="linenos">633</span></a>
</span><span id="range_spec-634"><a href="#range_spec-634"><span class="linenos">634</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="range_spec-635"><a href="#range_spec-635"><span class="linenos">635</span></a>        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="range_spec-636"><a href="#range_spec-636"><span class="linenos">636</span></a>                                 <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span><span class="p">)</span>
</span><span id="range_spec-637"><a href="#range_spec-637"><span class="linenos">637</span></a>
</span><span id="range_spec-638"><a href="#range_spec-638"><span class="linenos">638</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="range_spec-639"><a href="#range_spec-639"><span class="linenos">639</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a string form of the range as would appear in a Range: header.&quot;&quot;&quot;</span>
</span><span id="range_spec-640"><a href="#range_spec-640"><span class="linenos">640</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="range_spec-641"><a href="#range_spec-641"><span class="linenos">641</span></a>            <span class="k">return</span> <span class="s1">&#39;&#39;</span>
</span><span id="range_spec-642"><a href="#range_spec-642"><span class="linenos">642</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="range_spec-643"><a href="#range_spec-643"><span class="linenos">643</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="range_spec-644"><a href="#range_spec-644"><span class="linenos">644</span></a>            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span>
</span><span id="range_spec-645"><a href="#range_spec-645"><span class="linenos">645</span></a>        <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;-&#39;</span>
</span><span id="range_spec-646"><a href="#range_spec-646"><span class="linenos">646</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="range_spec-647"><a href="#range_spec-647"><span class="linenos">647</span></a>            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span>
</span><span id="range_spec-648"><a href="#range_spec-648"><span class="linenos">648</span></a>        <span class="k">return</span> <span class="n">s</span>
</span><span id="range_spec-649"><a href="#range_spec-649"><span class="linenos">649</span></a>
</span><span id="range_spec-650"><a href="#range_spec-650"><span class="linenos">650</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="range_spec-651"><a href="#range_spec-651"><span class="linenos">651</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compare ranges for equality.</span>
</span><span id="range_spec-652"><a href="#range_spec-652"><span class="linenos">652</span></a>
</span><span id="range_spec-653"><a href="#range_spec-653"><span class="linenos">653</span></a><span class="sd">        Note that if non-specific ranges are involved (such as 34- and -5),</span>
</span><span id="range_spec-654"><a href="#range_spec-654"><span class="linenos">654</span></a><span class="sd">        they could compare as not equal even though they may represent</span>
</span><span id="range_spec-655"><a href="#range_spec-655"><span class="linenos">655</span></a><span class="sd">        the same set of bytes in some contexts.</span>
</span><span id="range_spec-656"><a href="#range_spec-656"><span class="linenos">656</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_spec-657"><a href="#range_spec-657"><span class="linenos">657</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">first</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">last</span>
</span><span id="range_spec-658"><a href="#range_spec-658"><span class="linenos">658</span></a>
</span><span id="range_spec-659"><a href="#range_spec-659"><span class="linenos">659</span></a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="range_spec-660"><a href="#range_spec-660"><span class="linenos">660</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compare ranges for inequality.</span>
</span><span id="range_spec-661"><a href="#range_spec-661"><span class="linenos">661</span></a>
</span><span id="range_spec-662"><a href="#range_spec-662"><span class="linenos">662</span></a><span class="sd">        Note that if non-specific ranges are involved (such as 34- and -5),</span>
</span><span id="range_spec-663"><a href="#range_spec-663"><span class="linenos">663</span></a><span class="sd">        they could compare as not equal even though they may represent</span>
</span><span id="range_spec-664"><a href="#range_spec-664"><span class="linenos">664</span></a><span class="sd">        the same set of bytes in some contexts.</span>
</span><span id="range_spec-665"><a href="#range_spec-665"><span class="linenos">665</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_spec-666"><a href="#range_spec-666"><span class="linenos">666</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="range_spec-667"><a href="#range_spec-667"><span class="linenos">667</span></a>
</span><span id="range_spec-668"><a href="#range_spec-668"><span class="linenos">668</span></a>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="range_spec-669"><a href="#range_spec-669"><span class="linenos">669</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&lt; operator is not defined&quot;&quot;&quot;</span>
</span><span id="range_spec-670"><a href="#range_spec-670"><span class="linenos">670</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Ranges can not be relationally compared&#39;</span><span class="p">)</span>
</span><span id="range_spec-671"><a href="#range_spec-671"><span class="linenos">671</span></a>    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="range_spec-672"><a href="#range_spec-672"><span class="linenos">672</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&lt;= operator is not defined&quot;&quot;&quot;</span>
</span><span id="range_spec-673"><a href="#range_spec-673"><span class="linenos">673</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Ranges can not be ralationally compared&#39;</span><span class="p">)</span>
</span><span id="range_spec-674"><a href="#range_spec-674"><span class="linenos">674</span></a>    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="range_spec-675"><a href="#range_spec-675"><span class="linenos">675</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&gt; operator is not defined&quot;&quot;&quot;</span>
</span><span id="range_spec-676"><a href="#range_spec-676"><span class="linenos">676</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Ranges can not be relationally compared&#39;</span><span class="p">)</span>
</span><span id="range_spec-677"><a href="#range_spec-677"><span class="linenos">677</span></a>    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="range_spec-678"><a href="#range_spec-678"><span class="linenos">678</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&gt;= operator is not defined&quot;&quot;&quot;</span>
</span><span id="range_spec-679"><a href="#range_spec-679"><span class="linenos">679</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Ranges can not be relationally compared&#39;</span><span class="p">)</span>
</span><span id="range_spec-680"><a href="#range_spec-680"><span class="linenos">680</span></a>    
</span><span id="range_spec-681"><a href="#range_spec-681"><span class="linenos">681</span></a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="range_spec-682"><a href="#range_spec-682"><span class="linenos">682</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Makes a copy of this range object.&quot;&quot;&quot;</span>
</span><span id="range_spec-683"><a href="#range_spec-683"><span class="linenos">683</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="p">)</span>
</span><span id="range_spec-684"><a href="#range_spec-684"><span class="linenos">684</span></a>
</span><span id="range_spec-685"><a href="#range_spec-685"><span class="linenos">685</span></a>    <span class="k">def</span> <span class="nf">is_suffix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="range_spec-686"><a href="#range_spec-686"><span class="linenos">686</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if this is a suffix range.</span>
</span><span id="range_spec-687"><a href="#range_spec-687"><span class="linenos">687</span></a>
</span><span id="range_spec-688"><a href="#range_spec-688"><span class="linenos">688</span></a><span class="sd">        A suffix range is one that specifies the last N bytes of a</span>
</span><span id="range_spec-689"><a href="#range_spec-689"><span class="linenos">689</span></a><span class="sd">        file regardless of file size.</span>
</span><span id="range_spec-690"><a href="#range_spec-690"><span class="linenos">690</span></a>
</span><span id="range_spec-691"><a href="#range_spec-691"><span class="linenos">691</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_spec-692"><a href="#range_spec-692"><span class="linenos">692</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">==</span> <span class="kc">None</span>
</span><span id="range_spec-693"><a href="#range_spec-693"><span class="linenos">693</span></a>
</span><span id="range_spec-694"><a href="#range_spec-694"><span class="linenos">694</span></a>    <span class="k">def</span> <span class="nf">is_fixed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="range_spec-695"><a href="#range_spec-695"><span class="linenos">695</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if this range is absolute and a fixed size.</span>
</span><span id="range_spec-696"><a href="#range_spec-696"><span class="linenos">696</span></a>
</span><span id="range_spec-697"><a href="#range_spec-697"><span class="linenos">697</span></a><span class="sd">        This occurs only if neither first or last is None.  Converse</span>
</span><span id="range_spec-698"><a href="#range_spec-698"><span class="linenos">698</span></a><span class="sd">        is the is_unbounded() method.</span>
</span><span id="range_spec-699"><a href="#range_spec-699"><span class="linenos">699</span></a>
</span><span id="range_spec-700"><a href="#range_spec-700"><span class="linenos">700</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_spec-701"><a href="#range_spec-701"><span class="linenos">701</span></a>        <span class="k">return</span> <span class="n">first</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">last</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="range_spec-702"><a href="#range_spec-702"><span class="linenos">702</span></a>
</span><span id="range_spec-703"><a href="#range_spec-703"><span class="linenos">703</span></a>    <span class="k">def</span> <span class="nf">is_unbounded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="range_spec-704"><a href="#range_spec-704"><span class="linenos">704</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if the number of bytes in the range is unspecified.</span>
</span><span id="range_spec-705"><a href="#range_spec-705"><span class="linenos">705</span></a>
</span><span id="range_spec-706"><a href="#range_spec-706"><span class="linenos">706</span></a><span class="sd">        This can only occur if either the &#39;first&#39; or the &#39;last&#39; member</span>
</span><span id="range_spec-707"><a href="#range_spec-707"><span class="linenos">707</span></a><span class="sd">        is None.  Converse is the is_fixed() method.</span>
</span><span id="range_spec-708"><a href="#range_spec-708"><span class="linenos">708</span></a>
</span><span id="range_spec-709"><a href="#range_spec-709"><span class="linenos">709</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_spec-710"><a href="#range_spec-710"><span class="linenos">710</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="range_spec-711"><a href="#range_spec-711"><span class="linenos">711</span></a>
</span><span id="range_spec-712"><a href="#range_spec-712"><span class="linenos">712</span></a>    <span class="k">def</span> <span class="nf">is_whole_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="range_spec-713"><a href="#range_spec-713"><span class="linenos">713</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if this range includes all possible bytes.</span>
</span><span id="range_spec-714"><a href="#range_spec-714"><span class="linenos">714</span></a>
</span><span id="range_spec-715"><a href="#range_spec-715"><span class="linenos">715</span></a><span class="sd">        This can only occur if the &#39;last&#39; member is None and the first</span>
</span><span id="range_spec-716"><a href="#range_spec-716"><span class="linenos">716</span></a><span class="sd">        member is 0.</span>
</span><span id="range_spec-717"><a href="#range_spec-717"><span class="linenos">717</span></a>
</span><span id="range_spec-718"><a href="#range_spec-718"><span class="linenos">718</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_spec-719"><a href="#range_spec-719"><span class="linenos">719</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="range_spec-720"><a href="#range_spec-720"><span class="linenos">720</span></a>
</span><span id="range_spec-721"><a href="#range_spec-721"><span class="linenos">721</span></a>    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
</span><span id="range_spec-722"><a href="#range_spec-722"><span class="linenos">722</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Does this byte range contain the given byte offset?</span>
</span><span id="range_spec-723"><a href="#range_spec-723"><span class="linenos">723</span></a>
</span><span id="range_spec-724"><a href="#range_spec-724"><span class="linenos">724</span></a><span class="sd">        If the offset &lt; 0, then it is taken as an offset from the end</span>
</span><span id="range_spec-725"><a href="#range_spec-725"><span class="linenos">725</span></a><span class="sd">        of the file, where -1 is the last byte.  This type of offset</span>
</span><span id="range_spec-726"><a href="#range_spec-726"><span class="linenos">726</span></a><span class="sd">        will only work with suffix ranges.</span>
</span><span id="range_spec-727"><a href="#range_spec-727"><span class="linenos">727</span></a>
</span><span id="range_spec-728"><a href="#range_spec-728"><span class="linenos">728</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_spec-729"><a href="#range_spec-729"><span class="linenos">729</span></a>        <span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="range_spec-730"><a href="#range_spec-730"><span class="linenos">730</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="range_spec-731"><a href="#range_spec-731"><span class="linenos">731</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="range_spec-732"><a href="#range_spec-732"><span class="linenos">732</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="range_spec-733"><a href="#range_spec-733"><span class="linenos">733</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">offset</span>
</span><span id="range_spec-734"><a href="#range_spec-734"><span class="linenos">734</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="range_spec-735"><a href="#range_spec-735"><span class="linenos">735</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="range_spec-736"><a href="#range_spec-736"><span class="linenos">736</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="range_spec-737"><a href="#range_spec-737"><span class="linenos">737</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="range_spec-738"><a href="#range_spec-738"><span class="linenos">738</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="range_spec-739"><a href="#range_spec-739"><span class="linenos">739</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">&lt;=</span> <span class="n">offset</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span>
</span><span id="range_spec-740"><a href="#range_spec-740"><span class="linenos">740</span></a>
</span><span id="range_spec-741"><a href="#range_spec-741"><span class="linenos">741</span></a>    <span class="k">def</span> <span class="nf">fix_to_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
</span><span id="range_spec-742"><a href="#range_spec-742"><span class="linenos">742</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Changes a length-relative range to an absolute range based upon given file size.</span>
</span><span id="range_spec-743"><a href="#range_spec-743"><span class="linenos">743</span></a>
</span><span id="range_spec-744"><a href="#range_spec-744"><span class="linenos">744</span></a><span class="sd">        Ranges that are already absolute are left as is.</span>
</span><span id="range_spec-745"><a href="#range_spec-745"><span class="linenos">745</span></a>
</span><span id="range_spec-746"><a href="#range_spec-746"><span class="linenos">746</span></a><span class="sd">        Note that zero-length files are handled as special cases,</span>
</span><span id="range_spec-747"><a href="#range_spec-747"><span class="linenos">747</span></a><span class="sd">        since the only way possible to specify a zero-length range is</span>
</span><span id="range_spec-748"><a href="#range_spec-748"><span class="linenos">748</span></a><span class="sd">        with the suffix range &quot;-0&quot;.  Thus unless this range is a suffix</span>
</span><span id="range_spec-749"><a href="#range_spec-749"><span class="linenos">749</span></a><span class="sd">        range, it can not satisfy a zero-length file.</span>
</span><span id="range_spec-750"><a href="#range_spec-750"><span class="linenos">750</span></a>
</span><span id="range_spec-751"><a href="#range_spec-751"><span class="linenos">751</span></a><span class="sd">        If the resulting range (partly) lies outside the file size then an</span>
</span><span id="range_spec-752"><a href="#range_spec-752"><span class="linenos">752</span></a><span class="sd">        error is raised.</span>
</span><span id="range_spec-753"><a href="#range_spec-753"><span class="linenos">753</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_spec-754"><a href="#range_spec-754"><span class="linenos">754</span></a>
</span><span id="range_spec-755"><a href="#range_spec-755"><span class="linenos">755</span></a>        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="range_spec-756"><a href="#range_spec-756"><span class="linenos">756</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="range_spec-757"><a href="#range_spec-757"><span class="linenos">757</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="range_spec-758"><a href="#range_spec-758"><span class="linenos">758</span></a>                <span class="k">return</span>
</span><span id="range_spec-759"><a href="#range_spec-759"><span class="linenos">759</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="range_spec-760"><a href="#range_spec-760"><span class="linenos">760</span></a>                <span class="k">raise</span> <span class="n">RangeUnsatisfiableError</span><span class="p">(</span><span class="s2">&quot;Range can satisfy a zero-length file.&quot;</span><span class="p">)</span>
</span><span id="range_spec-761"><a href="#range_spec-761"><span class="linenos">761</span></a>
</span><span id="range_spec-762"><a href="#range_spec-762"><span class="linenos">762</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="range_spec-763"><a href="#range_spec-763"><span class="linenos">763</span></a>            <span class="c1"># A suffix range</span>
</span><span id="range_spec-764"><a href="#range_spec-764"><span class="linenos">764</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span>
</span><span id="range_spec-765"><a href="#range_spec-765"><span class="linenos">765</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="range_spec-766"><a href="#range_spec-766"><span class="linenos">766</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="range_spec-767"><a href="#range_spec-767"><span class="linenos">767</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="range_spec-768"><a href="#range_spec-768"><span class="linenos">768</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="range_spec-769"><a href="#range_spec-769"><span class="linenos">769</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">&gt;</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="range_spec-770"><a href="#range_spec-770"><span class="linenos">770</span></a>                <span class="k">raise</span> <span class="n">RangeUnsatisfiableError</span><span class="p">(</span><span class="s1">&#39;Range begins beyond the file size.&#39;</span><span class="p">)</span>
</span><span id="range_spec-771"><a href="#range_spec-771"><span class="linenos">771</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="range_spec-772"><a href="#range_spec-772"><span class="linenos">772</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="range_spec-773"><a href="#range_spec-773"><span class="linenos">773</span></a>                    <span class="c1"># An unbounded range</span>
</span><span id="range_spec-774"><a href="#range_spec-774"><span class="linenos">774</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="range_spec-775"><a href="#range_spec-775"><span class="linenos">775</span></a>        <span class="k">return</span>
</span><span id="range_spec-776"><a href="#range_spec-776"><span class="linenos">776</span></a>
</span><span id="range_spec-777"><a href="#range_spec-777"><span class="linenos">777</span></a>    <span class="k">def</span> <span class="nf">merge_with</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="range_spec-778"><a href="#range_spec-778"><span class="linenos">778</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Tries to merge the given range into this one.</span>
</span><span id="range_spec-779"><a href="#range_spec-779"><span class="linenos">779</span></a>
</span><span id="range_spec-780"><a href="#range_spec-780"><span class="linenos">780</span></a><span class="sd">        The size of this range may be enlarged as a result.</span>
</span><span id="range_spec-781"><a href="#range_spec-781"><span class="linenos">781</span></a>
</span><span id="range_spec-782"><a href="#range_spec-782"><span class="linenos">782</span></a><span class="sd">        An error is raised if the two ranges do not overlap or are not</span>
</span><span id="range_spec-783"><a href="#range_spec-783"><span class="linenos">783</span></a><span class="sd">        contiguous with each other.</span>
</span><span id="range_spec-784"><a href="#range_spec-784"><span class="linenos">784</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_spec-785"><a href="#range_spec-785"><span class="linenos">785</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_whole_file</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">:</span>
</span><span id="range_spec-786"><a href="#range_spec-786"><span class="linenos">786</span></a>            <span class="k">return</span>
</span><span id="range_spec-787"><a href="#range_spec-787"><span class="linenos">787</span></a>        <span class="k">elif</span> <span class="n">other</span><span class="o">.</span><span class="n">is_whole_file</span><span class="p">():</span>
</span><span id="range_spec-788"><a href="#range_spec-788"><span class="linenos">788</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="range_spec-789"><a href="#range_spec-789"><span class="linenos">789</span></a>            <span class="k">return</span>
</span><span id="range_spec-790"><a href="#range_spec-790"><span class="linenos">790</span></a>
</span><span id="range_spec-791"><a href="#range_spec-791"><span class="linenos">791</span></a>        <span class="n">a1</span><span class="p">,</span> <span class="n">z1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span>
</span><span id="range_spec-792"><a href="#range_spec-792"><span class="linenos">792</span></a>        <span class="n">a2</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">last</span>
</span><span id="range_spec-793"><a href="#range_spec-793"><span class="linenos">793</span></a>
</span><span id="range_spec-794"><a href="#range_spec-794"><span class="linenos">794</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_suffix</span><span class="p">():</span>
</span><span id="range_spec-795"><a href="#range_spec-795"><span class="linenos">795</span></a>            <span class="k">if</span> <span class="n">z1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># self is zero-length, so merge becomes a copy</span>
</span><span id="range_spec-796"><a href="#range_spec-796"><span class="linenos">796</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="n">a2</span><span class="p">,</span> <span class="n">z2</span>
</span><span id="range_spec-797"><a href="#range_spec-797"><span class="linenos">797</span></a>                <span class="k">return</span>
</span><span id="range_spec-798"><a href="#range_spec-798"><span class="linenos">798</span></a>            <span class="k">elif</span> <span class="n">other</span><span class="o">.</span><span class="n">is_suffix</span><span class="p">():</span>
</span><span id="range_spec-799"><a href="#range_spec-799"><span class="linenos">799</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">)</span>
</span><span id="range_spec-800"><a href="#range_spec-800"><span class="linenos">800</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="range_spec-801"><a href="#range_spec-801"><span class="linenos">801</span></a>                <span class="k">raise</span> <span class="n">RangeUnmergableError</span><span class="p">()</span>
</span><span id="range_spec-802"><a href="#range_spec-802"><span class="linenos">802</span></a>        <span class="k">elif</span> <span class="n">other</span><span class="o">.</span><span class="n">is_suffix</span><span class="p">():</span>
</span><span id="range_spec-803"><a href="#range_spec-803"><span class="linenos">803</span></a>            <span class="k">if</span> <span class="n">z2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># other is zero-length, so nothing to merge</span>
</span><span id="range_spec-804"><a href="#range_spec-804"><span class="linenos">804</span></a>                <span class="k">return</span>
</span><span id="range_spec-805"><a href="#range_spec-805"><span class="linenos">805</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="range_spec-806"><a href="#range_spec-806"><span class="linenos">806</span></a>                <span class="k">raise</span> <span class="n">RangeUnmergableError</span><span class="p">()</span>
</span><span id="range_spec-807"><a href="#range_spec-807"><span class="linenos">807</span></a>
</span><span id="range_spec-808"><a href="#range_spec-808"><span class="linenos">808</span></a>        <span class="k">assert</span> <span class="n">a1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">a2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="range_spec-809"><a href="#range_spec-809"><span class="linenos">809</span></a>
</span><span id="range_spec-810"><a href="#range_spec-810"><span class="linenos">810</span></a>        <span class="k">if</span> <span class="n">a2</span> <span class="o">&lt;</span> <span class="n">a1</span><span class="p">:</span>
</span><span id="range_spec-811"><a href="#range_spec-811"><span class="linenos">811</span></a>            <span class="c1"># swap ranges so a1 &lt;= a2</span>
</span><span id="range_spec-812"><a href="#range_spec-812"><span class="linenos">812</span></a>            <span class="n">a1</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="n">a2</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">z1</span>
</span><span id="range_spec-813"><a href="#range_spec-813"><span class="linenos">813</span></a>
</span><span id="range_spec-814"><a href="#range_spec-814"><span class="linenos">814</span></a>        <span class="k">assert</span> <span class="n">a1</span> <span class="o">&lt;=</span> <span class="n">a2</span>
</span><span id="range_spec-815"><a href="#range_spec-815"><span class="linenos">815</span></a>
</span><span id="range_spec-816"><a href="#range_spec-816"><span class="linenos">816</span></a>        <span class="k">if</span> <span class="n">z1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="range_spec-817"><a href="#range_spec-817"><span class="linenos">817</span></a>            <span class="k">if</span> <span class="n">z2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">z2</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">a1</span><span class="p">:</span>
</span><span id="range_spec-818"><a href="#range_spec-818"><span class="linenos">818</span></a>                <span class="k">raise</span> <span class="n">RangeUnmergableError</span><span class="p">()</span>
</span><span id="range_spec-819"><a href="#range_spec-819"><span class="linenos">819</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="range_spec-820"><a href="#range_spec-820"><span class="linenos">820</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span>
</span><span id="range_spec-821"><a href="#range_spec-821"><span class="linenos">821</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="range_spec-822"><a href="#range_spec-822"><span class="linenos">822</span></a>        <span class="k">elif</span> <span class="n">z2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="range_spec-823"><a href="#range_spec-823"><span class="linenos">823</span></a>            <span class="k">if</span> <span class="n">z1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">a2</span><span class="p">:</span>
</span><span id="range_spec-824"><a href="#range_spec-824"><span class="linenos">824</span></a>                <span class="k">raise</span> <span class="n">RangeUnmergableError</span><span class="p">()</span>
</span><span id="range_spec-825"><a href="#range_spec-825"><span class="linenos">825</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="range_spec-826"><a href="#range_spec-826"><span class="linenos">826</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span>
</span><span id="range_spec-827"><a href="#range_spec-827"><span class="linenos">827</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="range_spec-828"><a href="#range_spec-828"><span class="linenos">828</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="range_spec-829"><a href="#range_spec-829"><span class="linenos">829</span></a>            <span class="k">if</span> <span class="n">a2</span> <span class="o">&gt;</span> <span class="n">z1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="range_spec-830"><a href="#range_spec-830"><span class="linenos">830</span></a>                <span class="k">raise</span> <span class="n">RangeUnmergableError</span><span class="p">()</span>
</span><span id="range_spec-831"><a href="#range_spec-831"><span class="linenos">831</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="range_spec-832"><a href="#range_spec-832"><span class="linenos">832</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">a1</span>
</span><span id="range_spec-833"><a href="#range_spec-833"><span class="linenos">833</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">)</span>
</span><span id="range_spec-834"><a href="#range_spec-834"><span class="linenos">834</span></a>        <span class="k">return</span>
</span></pre></div>


            <div class="docstring"><p>A single contiguous (byte) range.</p>

<p>A range_spec defines a range (of bytes) by specifying two offsets,
the 'first' and 'last', which are inclusive in the range.  Offsets
are zero-based (the first byte is offset 0).  The range can not be
empty or negative (has to satisfy first &lt;= last).</p>

<p>The range can be unbounded on either end, represented here by the
None value, with these semantics:</p>

<ul>
<li><p>A 'last' of None always indicates the last possible byte
(although that offset may not be known).</p></li>
<li><p>A 'first' of None indicates this is a suffix range, where
 the last value is actually interpreted to be the number
 of bytes at the end of the file (regardless of file size).</p></li>
</ul>

<p>Note that it is not valid for both first and last to be None.</p>
</div>


                            <div id="range_spec.__init__" class="classattr">
                                        <input id="range_spec.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">range_spec</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">first</span><span class="o">=</span><span class="mi">0</span>, </span><span class="param"><span class="n">last</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="range_spec.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#range_spec.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="range_spec.__init__-621"><a href="#range_spec.__init__-621"><span class="linenos">621</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="range_spec.__init__-622"><a href="#range_spec.__init__-622"><span class="linenos">622</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span> <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="range_spec.set" class="classattr">
                                        <input id="range_spec.set-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">first</span>, </span><span class="param"><span class="n">last</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="range_spec.set-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#range_spec.set"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="range_spec.set-624"><a href="#range_spec.set-624"><span class="linenos">624</span></a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">):</span>
</span><span id="range_spec.set-625"><a href="#range_spec.set-625"><span class="linenos">625</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the value of this range given the first and last offsets.</span>
</span><span id="range_spec.set-626"><a href="#range_spec.set-626"><span class="linenos">626</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_spec.set-627"><a href="#range_spec.set-627"><span class="linenos">627</span></a>        <span class="k">if</span> <span class="n">first</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">last</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">first</span> <span class="o">&gt;</span> <span class="n">last</span><span class="p">:</span>
</span><span id="range_spec.set-628"><a href="#range_spec.set-628"><span class="linenos">628</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Byte range does not satisfy first &lt;= last.&quot;</span><span class="p">)</span>
</span><span id="range_spec.set-629"><a href="#range_spec.set-629"><span class="linenos">629</span></a>        <span class="k">elif</span> <span class="n">first</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">last</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="range_spec.set-630"><a href="#range_spec.set-630"><span class="linenos">630</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Byte range can not omit both first and last offsets.&quot;</span><span class="p">)</span>
</span><span id="range_spec.set-631"><a href="#range_spec.set-631"><span class="linenos">631</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">first</span>
</span><span id="range_spec.set-632"><a href="#range_spec.set-632"><span class="linenos">632</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="n">last</span>
</span></pre></div>


            <div class="docstring"><p>Sets the value of this range given the first and last offsets.</p>
</div>


                            </div>
                            <div id="range_spec.copy" class="classattr">
                                        <input id="range_spec.copy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">copy</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="range_spec.copy-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#range_spec.copy"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="range_spec.copy-681"><a href="#range_spec.copy-681"><span class="linenos">681</span></a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="range_spec.copy-682"><a href="#range_spec.copy-682"><span class="linenos">682</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Makes a copy of this range object.&quot;&quot;&quot;</span>
</span><span id="range_spec.copy-683"><a href="#range_spec.copy-683"><span class="linenos">683</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Makes a copy of this range object.</p>
</div>


                            </div>
                            <div id="range_spec.is_suffix" class="classattr">
                                        <input id="range_spec.is_suffix-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_suffix</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="range_spec.is_suffix-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#range_spec.is_suffix"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="range_spec.is_suffix-685"><a href="#range_spec.is_suffix-685"><span class="linenos">685</span></a>    <span class="k">def</span> <span class="nf">is_suffix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="range_spec.is_suffix-686"><a href="#range_spec.is_suffix-686"><span class="linenos">686</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if this is a suffix range.</span>
</span><span id="range_spec.is_suffix-687"><a href="#range_spec.is_suffix-687"><span class="linenos">687</span></a>
</span><span id="range_spec.is_suffix-688"><a href="#range_spec.is_suffix-688"><span class="linenos">688</span></a><span class="sd">        A suffix range is one that specifies the last N bytes of a</span>
</span><span id="range_spec.is_suffix-689"><a href="#range_spec.is_suffix-689"><span class="linenos">689</span></a><span class="sd">        file regardless of file size.</span>
</span><span id="range_spec.is_suffix-690"><a href="#range_spec.is_suffix-690"><span class="linenos">690</span></a>
</span><span id="range_spec.is_suffix-691"><a href="#range_spec.is_suffix-691"><span class="linenos">691</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_spec.is_suffix-692"><a href="#range_spec.is_suffix-692"><span class="linenos">692</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">==</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Returns True if this is a suffix range.</p>

<p>A suffix range is one that specifies the last N bytes of a
file regardless of file size.</p>
</div>


                            </div>
                            <div id="range_spec.is_fixed" class="classattr">
                                        <input id="range_spec.is_fixed-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_fixed</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="range_spec.is_fixed-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#range_spec.is_fixed"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="range_spec.is_fixed-694"><a href="#range_spec.is_fixed-694"><span class="linenos">694</span></a>    <span class="k">def</span> <span class="nf">is_fixed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="range_spec.is_fixed-695"><a href="#range_spec.is_fixed-695"><span class="linenos">695</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if this range is absolute and a fixed size.</span>
</span><span id="range_spec.is_fixed-696"><a href="#range_spec.is_fixed-696"><span class="linenos">696</span></a>
</span><span id="range_spec.is_fixed-697"><a href="#range_spec.is_fixed-697"><span class="linenos">697</span></a><span class="sd">        This occurs only if neither first or last is None.  Converse</span>
</span><span id="range_spec.is_fixed-698"><a href="#range_spec.is_fixed-698"><span class="linenos">698</span></a><span class="sd">        is the is_unbounded() method.</span>
</span><span id="range_spec.is_fixed-699"><a href="#range_spec.is_fixed-699"><span class="linenos">699</span></a>
</span><span id="range_spec.is_fixed-700"><a href="#range_spec.is_fixed-700"><span class="linenos">700</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_spec.is_fixed-701"><a href="#range_spec.is_fixed-701"><span class="linenos">701</span></a>        <span class="k">return</span> <span class="n">first</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">last</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Returns True if this range is absolute and a fixed size.</p>

<p>This occurs only if neither first or last is None.  Converse
is the is_unbounded() method.</p>
</div>


                            </div>
                            <div id="range_spec.is_unbounded" class="classattr">
                                        <input id="range_spec.is_unbounded-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_unbounded</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="range_spec.is_unbounded-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#range_spec.is_unbounded"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="range_spec.is_unbounded-703"><a href="#range_spec.is_unbounded-703"><span class="linenos">703</span></a>    <span class="k">def</span> <span class="nf">is_unbounded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="range_spec.is_unbounded-704"><a href="#range_spec.is_unbounded-704"><span class="linenos">704</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if the number of bytes in the range is unspecified.</span>
</span><span id="range_spec.is_unbounded-705"><a href="#range_spec.is_unbounded-705"><span class="linenos">705</span></a>
</span><span id="range_spec.is_unbounded-706"><a href="#range_spec.is_unbounded-706"><span class="linenos">706</span></a><span class="sd">        This can only occur if either the &#39;first&#39; or the &#39;last&#39; member</span>
</span><span id="range_spec.is_unbounded-707"><a href="#range_spec.is_unbounded-707"><span class="linenos">707</span></a><span class="sd">        is None.  Converse is the is_fixed() method.</span>
</span><span id="range_spec.is_unbounded-708"><a href="#range_spec.is_unbounded-708"><span class="linenos">708</span></a>
</span><span id="range_spec.is_unbounded-709"><a href="#range_spec.is_unbounded-709"><span class="linenos">709</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_spec.is_unbounded-710"><a href="#range_spec.is_unbounded-710"><span class="linenos">710</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="ow">is</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Returns True if the number of bytes in the range is unspecified.</p>

<p>This can only occur if either the 'first' or the 'last' member
is None.  Converse is the is_fixed() method.</p>
</div>


                            </div>
                            <div id="range_spec.is_whole_file" class="classattr">
                                        <input id="range_spec.is_whole_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_whole_file</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="range_spec.is_whole_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#range_spec.is_whole_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="range_spec.is_whole_file-712"><a href="#range_spec.is_whole_file-712"><span class="linenos">712</span></a>    <span class="k">def</span> <span class="nf">is_whole_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="range_spec.is_whole_file-713"><a href="#range_spec.is_whole_file-713"><span class="linenos">713</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if this range includes all possible bytes.</span>
</span><span id="range_spec.is_whole_file-714"><a href="#range_spec.is_whole_file-714"><span class="linenos">714</span></a>
</span><span id="range_spec.is_whole_file-715"><a href="#range_spec.is_whole_file-715"><span class="linenos">715</span></a><span class="sd">        This can only occur if the &#39;last&#39; member is None and the first</span>
</span><span id="range_spec.is_whole_file-716"><a href="#range_spec.is_whole_file-716"><span class="linenos">716</span></a><span class="sd">        member is 0.</span>
</span><span id="range_spec.is_whole_file-717"><a href="#range_spec.is_whole_file-717"><span class="linenos">717</span></a>
</span><span id="range_spec.is_whole_file-718"><a href="#range_spec.is_whole_file-718"><span class="linenos">718</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_spec.is_whole_file-719"><a href="#range_spec.is_whole_file-719"><span class="linenos">719</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="ow">is</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Returns True if this range includes all possible bytes.</p>

<p>This can only occur if the 'last' member is None and the first
member is 0.</p>
</div>


                            </div>
                            <div id="range_spec.fix_to_size" class="classattr">
                                        <input id="range_spec.fix_to_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fix_to_size</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">size</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="range_spec.fix_to_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#range_spec.fix_to_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="range_spec.fix_to_size-741"><a href="#range_spec.fix_to_size-741"><span class="linenos">741</span></a>    <span class="k">def</span> <span class="nf">fix_to_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
</span><span id="range_spec.fix_to_size-742"><a href="#range_spec.fix_to_size-742"><span class="linenos">742</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Changes a length-relative range to an absolute range based upon given file size.</span>
</span><span id="range_spec.fix_to_size-743"><a href="#range_spec.fix_to_size-743"><span class="linenos">743</span></a>
</span><span id="range_spec.fix_to_size-744"><a href="#range_spec.fix_to_size-744"><span class="linenos">744</span></a><span class="sd">        Ranges that are already absolute are left as is.</span>
</span><span id="range_spec.fix_to_size-745"><a href="#range_spec.fix_to_size-745"><span class="linenos">745</span></a>
</span><span id="range_spec.fix_to_size-746"><a href="#range_spec.fix_to_size-746"><span class="linenos">746</span></a><span class="sd">        Note that zero-length files are handled as special cases,</span>
</span><span id="range_spec.fix_to_size-747"><a href="#range_spec.fix_to_size-747"><span class="linenos">747</span></a><span class="sd">        since the only way possible to specify a zero-length range is</span>
</span><span id="range_spec.fix_to_size-748"><a href="#range_spec.fix_to_size-748"><span class="linenos">748</span></a><span class="sd">        with the suffix range &quot;-0&quot;.  Thus unless this range is a suffix</span>
</span><span id="range_spec.fix_to_size-749"><a href="#range_spec.fix_to_size-749"><span class="linenos">749</span></a><span class="sd">        range, it can not satisfy a zero-length file.</span>
</span><span id="range_spec.fix_to_size-750"><a href="#range_spec.fix_to_size-750"><span class="linenos">750</span></a>
</span><span id="range_spec.fix_to_size-751"><a href="#range_spec.fix_to_size-751"><span class="linenos">751</span></a><span class="sd">        If the resulting range (partly) lies outside the file size then an</span>
</span><span id="range_spec.fix_to_size-752"><a href="#range_spec.fix_to_size-752"><span class="linenos">752</span></a><span class="sd">        error is raised.</span>
</span><span id="range_spec.fix_to_size-753"><a href="#range_spec.fix_to_size-753"><span class="linenos">753</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_spec.fix_to_size-754"><a href="#range_spec.fix_to_size-754"><span class="linenos">754</span></a>
</span><span id="range_spec.fix_to_size-755"><a href="#range_spec.fix_to_size-755"><span class="linenos">755</span></a>        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="range_spec.fix_to_size-756"><a href="#range_spec.fix_to_size-756"><span class="linenos">756</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="range_spec.fix_to_size-757"><a href="#range_spec.fix_to_size-757"><span class="linenos">757</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="range_spec.fix_to_size-758"><a href="#range_spec.fix_to_size-758"><span class="linenos">758</span></a>                <span class="k">return</span>
</span><span id="range_spec.fix_to_size-759"><a href="#range_spec.fix_to_size-759"><span class="linenos">759</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="range_spec.fix_to_size-760"><a href="#range_spec.fix_to_size-760"><span class="linenos">760</span></a>                <span class="k">raise</span> <span class="n">RangeUnsatisfiableError</span><span class="p">(</span><span class="s2">&quot;Range can satisfy a zero-length file.&quot;</span><span class="p">)</span>
</span><span id="range_spec.fix_to_size-761"><a href="#range_spec.fix_to_size-761"><span class="linenos">761</span></a>
</span><span id="range_spec.fix_to_size-762"><a href="#range_spec.fix_to_size-762"><span class="linenos">762</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="range_spec.fix_to_size-763"><a href="#range_spec.fix_to_size-763"><span class="linenos">763</span></a>            <span class="c1"># A suffix range</span>
</span><span id="range_spec.fix_to_size-764"><a href="#range_spec.fix_to_size-764"><span class="linenos">764</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span>
</span><span id="range_spec.fix_to_size-765"><a href="#range_spec.fix_to_size-765"><span class="linenos">765</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="range_spec.fix_to_size-766"><a href="#range_spec.fix_to_size-766"><span class="linenos">766</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="range_spec.fix_to_size-767"><a href="#range_spec.fix_to_size-767"><span class="linenos">767</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="range_spec.fix_to_size-768"><a href="#range_spec.fix_to_size-768"><span class="linenos">768</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="range_spec.fix_to_size-769"><a href="#range_spec.fix_to_size-769"><span class="linenos">769</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">&gt;</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="range_spec.fix_to_size-770"><a href="#range_spec.fix_to_size-770"><span class="linenos">770</span></a>                <span class="k">raise</span> <span class="n">RangeUnsatisfiableError</span><span class="p">(</span><span class="s1">&#39;Range begins beyond the file size.&#39;</span><span class="p">)</span>
</span><span id="range_spec.fix_to_size-771"><a href="#range_spec.fix_to_size-771"><span class="linenos">771</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="range_spec.fix_to_size-772"><a href="#range_spec.fix_to_size-772"><span class="linenos">772</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="range_spec.fix_to_size-773"><a href="#range_spec.fix_to_size-773"><span class="linenos">773</span></a>                    <span class="c1"># An unbounded range</span>
</span><span id="range_spec.fix_to_size-774"><a href="#range_spec.fix_to_size-774"><span class="linenos">774</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="range_spec.fix_to_size-775"><a href="#range_spec.fix_to_size-775"><span class="linenos">775</span></a>        <span class="k">return</span>
</span></pre></div>


            <div class="docstring"><p>Changes a length-relative range to an absolute range based upon given file size.</p>

<p>Ranges that are already absolute are left as is.</p>

<p>Note that zero-length files are handled as special cases,
since the only way possible to specify a zero-length range is
with the suffix range "-0".  Thus unless this range is a suffix
range, it can not satisfy a zero-length file.</p>

<p>If the resulting range (partly) lies outside the file size then an
error is raised.</p>
</div>


                            </div>
                            <div id="range_spec.merge_with" class="classattr">
                                        <input id="range_spec.merge_with-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">merge_with</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="range_spec.merge_with-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#range_spec.merge_with"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="range_spec.merge_with-777"><a href="#range_spec.merge_with-777"><span class="linenos">777</span></a>    <span class="k">def</span> <span class="nf">merge_with</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="range_spec.merge_with-778"><a href="#range_spec.merge_with-778"><span class="linenos">778</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Tries to merge the given range into this one.</span>
</span><span id="range_spec.merge_with-779"><a href="#range_spec.merge_with-779"><span class="linenos">779</span></a>
</span><span id="range_spec.merge_with-780"><a href="#range_spec.merge_with-780"><span class="linenos">780</span></a><span class="sd">        The size of this range may be enlarged as a result.</span>
</span><span id="range_spec.merge_with-781"><a href="#range_spec.merge_with-781"><span class="linenos">781</span></a>
</span><span id="range_spec.merge_with-782"><a href="#range_spec.merge_with-782"><span class="linenos">782</span></a><span class="sd">        An error is raised if the two ranges do not overlap or are not</span>
</span><span id="range_spec.merge_with-783"><a href="#range_spec.merge_with-783"><span class="linenos">783</span></a><span class="sd">        contiguous with each other.</span>
</span><span id="range_spec.merge_with-784"><a href="#range_spec.merge_with-784"><span class="linenos">784</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_spec.merge_with-785"><a href="#range_spec.merge_with-785"><span class="linenos">785</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_whole_file</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">:</span>
</span><span id="range_spec.merge_with-786"><a href="#range_spec.merge_with-786"><span class="linenos">786</span></a>            <span class="k">return</span>
</span><span id="range_spec.merge_with-787"><a href="#range_spec.merge_with-787"><span class="linenos">787</span></a>        <span class="k">elif</span> <span class="n">other</span><span class="o">.</span><span class="n">is_whole_file</span><span class="p">():</span>
</span><span id="range_spec.merge_with-788"><a href="#range_spec.merge_with-788"><span class="linenos">788</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="range_spec.merge_with-789"><a href="#range_spec.merge_with-789"><span class="linenos">789</span></a>            <span class="k">return</span>
</span><span id="range_spec.merge_with-790"><a href="#range_spec.merge_with-790"><span class="linenos">790</span></a>
</span><span id="range_spec.merge_with-791"><a href="#range_spec.merge_with-791"><span class="linenos">791</span></a>        <span class="n">a1</span><span class="p">,</span> <span class="n">z1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span>
</span><span id="range_spec.merge_with-792"><a href="#range_spec.merge_with-792"><span class="linenos">792</span></a>        <span class="n">a2</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">last</span>
</span><span id="range_spec.merge_with-793"><a href="#range_spec.merge_with-793"><span class="linenos">793</span></a>
</span><span id="range_spec.merge_with-794"><a href="#range_spec.merge_with-794"><span class="linenos">794</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_suffix</span><span class="p">():</span>
</span><span id="range_spec.merge_with-795"><a href="#range_spec.merge_with-795"><span class="linenos">795</span></a>            <span class="k">if</span> <span class="n">z1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># self is zero-length, so merge becomes a copy</span>
</span><span id="range_spec.merge_with-796"><a href="#range_spec.merge_with-796"><span class="linenos">796</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="n">a2</span><span class="p">,</span> <span class="n">z2</span>
</span><span id="range_spec.merge_with-797"><a href="#range_spec.merge_with-797"><span class="linenos">797</span></a>                <span class="k">return</span>
</span><span id="range_spec.merge_with-798"><a href="#range_spec.merge_with-798"><span class="linenos">798</span></a>            <span class="k">elif</span> <span class="n">other</span><span class="o">.</span><span class="n">is_suffix</span><span class="p">():</span>
</span><span id="range_spec.merge_with-799"><a href="#range_spec.merge_with-799"><span class="linenos">799</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">)</span>
</span><span id="range_spec.merge_with-800"><a href="#range_spec.merge_with-800"><span class="linenos">800</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="range_spec.merge_with-801"><a href="#range_spec.merge_with-801"><span class="linenos">801</span></a>                <span class="k">raise</span> <span class="n">RangeUnmergableError</span><span class="p">()</span>
</span><span id="range_spec.merge_with-802"><a href="#range_spec.merge_with-802"><span class="linenos">802</span></a>        <span class="k">elif</span> <span class="n">other</span><span class="o">.</span><span class="n">is_suffix</span><span class="p">():</span>
</span><span id="range_spec.merge_with-803"><a href="#range_spec.merge_with-803"><span class="linenos">803</span></a>            <span class="k">if</span> <span class="n">z2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># other is zero-length, so nothing to merge</span>
</span><span id="range_spec.merge_with-804"><a href="#range_spec.merge_with-804"><span class="linenos">804</span></a>                <span class="k">return</span>
</span><span id="range_spec.merge_with-805"><a href="#range_spec.merge_with-805"><span class="linenos">805</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="range_spec.merge_with-806"><a href="#range_spec.merge_with-806"><span class="linenos">806</span></a>                <span class="k">raise</span> <span class="n">RangeUnmergableError</span><span class="p">()</span>
</span><span id="range_spec.merge_with-807"><a href="#range_spec.merge_with-807"><span class="linenos">807</span></a>
</span><span id="range_spec.merge_with-808"><a href="#range_spec.merge_with-808"><span class="linenos">808</span></a>        <span class="k">assert</span> <span class="n">a1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">a2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="range_spec.merge_with-809"><a href="#range_spec.merge_with-809"><span class="linenos">809</span></a>
</span><span id="range_spec.merge_with-810"><a href="#range_spec.merge_with-810"><span class="linenos">810</span></a>        <span class="k">if</span> <span class="n">a2</span> <span class="o">&lt;</span> <span class="n">a1</span><span class="p">:</span>
</span><span id="range_spec.merge_with-811"><a href="#range_spec.merge_with-811"><span class="linenos">811</span></a>            <span class="c1"># swap ranges so a1 &lt;= a2</span>
</span><span id="range_spec.merge_with-812"><a href="#range_spec.merge_with-812"><span class="linenos">812</span></a>            <span class="n">a1</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="n">a2</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">z1</span>
</span><span id="range_spec.merge_with-813"><a href="#range_spec.merge_with-813"><span class="linenos">813</span></a>
</span><span id="range_spec.merge_with-814"><a href="#range_spec.merge_with-814"><span class="linenos">814</span></a>        <span class="k">assert</span> <span class="n">a1</span> <span class="o">&lt;=</span> <span class="n">a2</span>
</span><span id="range_spec.merge_with-815"><a href="#range_spec.merge_with-815"><span class="linenos">815</span></a>
</span><span id="range_spec.merge_with-816"><a href="#range_spec.merge_with-816"><span class="linenos">816</span></a>        <span class="k">if</span> <span class="n">z1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="range_spec.merge_with-817"><a href="#range_spec.merge_with-817"><span class="linenos">817</span></a>            <span class="k">if</span> <span class="n">z2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">z2</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">a1</span><span class="p">:</span>
</span><span id="range_spec.merge_with-818"><a href="#range_spec.merge_with-818"><span class="linenos">818</span></a>                <span class="k">raise</span> <span class="n">RangeUnmergableError</span><span class="p">()</span>
</span><span id="range_spec.merge_with-819"><a href="#range_spec.merge_with-819"><span class="linenos">819</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="range_spec.merge_with-820"><a href="#range_spec.merge_with-820"><span class="linenos">820</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span>
</span><span id="range_spec.merge_with-821"><a href="#range_spec.merge_with-821"><span class="linenos">821</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="range_spec.merge_with-822"><a href="#range_spec.merge_with-822"><span class="linenos">822</span></a>        <span class="k">elif</span> <span class="n">z2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="range_spec.merge_with-823"><a href="#range_spec.merge_with-823"><span class="linenos">823</span></a>            <span class="k">if</span> <span class="n">z1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">a2</span><span class="p">:</span>
</span><span id="range_spec.merge_with-824"><a href="#range_spec.merge_with-824"><span class="linenos">824</span></a>                <span class="k">raise</span> <span class="n">RangeUnmergableError</span><span class="p">()</span>
</span><span id="range_spec.merge_with-825"><a href="#range_spec.merge_with-825"><span class="linenos">825</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="range_spec.merge_with-826"><a href="#range_spec.merge_with-826"><span class="linenos">826</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span>
</span><span id="range_spec.merge_with-827"><a href="#range_spec.merge_with-827"><span class="linenos">827</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="range_spec.merge_with-828"><a href="#range_spec.merge_with-828"><span class="linenos">828</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="range_spec.merge_with-829"><a href="#range_spec.merge_with-829"><span class="linenos">829</span></a>            <span class="k">if</span> <span class="n">a2</span> <span class="o">&gt;</span> <span class="n">z1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="range_spec.merge_with-830"><a href="#range_spec.merge_with-830"><span class="linenos">830</span></a>                <span class="k">raise</span> <span class="n">RangeUnmergableError</span><span class="p">()</span>
</span><span id="range_spec.merge_with-831"><a href="#range_spec.merge_with-831"><span class="linenos">831</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="range_spec.merge_with-832"><a href="#range_spec.merge_with-832"><span class="linenos">832</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">a1</span>
</span><span id="range_spec.merge_with-833"><a href="#range_spec.merge_with-833"><span class="linenos">833</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">)</span>
</span><span id="range_spec.merge_with-834"><a href="#range_spec.merge_with-834"><span class="linenos">834</span></a>        <span class="k">return</span>
</span></pre></div>


            <div class="docstring"><p>Tries to merge the given range into this one.</p>

<p>The size of this range may be enlarged as a result.</p>

<p>An error is raised if the two ranges do not overlap or are not
contiguous with each other.</p>
</div>


                            </div>
                            <div id="range_spec.first" class="classattr">
                                <div class="attr variable">
            <span class="name">first</span>

        
    </div>
    <a class="headerlink" href="#range_spec.first"></a>
    
    

                            </div>
                            <div id="range_spec.last" class="classattr">
                                <div class="attr variable">
            <span class="name">last</span>

        
    </div>
    <a class="headerlink" href="#range_spec.last"></a>
    
    

                            </div>
                </section>
                <section id="range_set">
                            <input id="range_set-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">range_set</span>:

                <label class="view-source-button" for="range_set-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#range_set"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="range_set-837"><a href="#range_set-837"><span class="linenos">837</span></a><span class="k">class</span> <span class="nc">range_set</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="range_set-838"><a href="#range_set-838"><span class="linenos">838</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A collection of range_specs, with units (e.g., bytes).</span>
</span><span id="range_set-839"><a href="#range_set-839"><span class="linenos">839</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="range_set-840"><a href="#range_set-840"><span class="linenos">840</span></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;range_specs&#39;</span><span class="p">]</span>
</span><span id="range_set-841"><a href="#range_set-841"><span class="linenos">841</span></a>
</span><span id="range_set-842"><a href="#range_set-842"><span class="linenos">842</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="range_set-843"><a href="#range_set-843"><span class="linenos">843</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;bytes&#39;</span>
</span><span id="range_set-844"><a href="#range_set-844"><span class="linenos">844</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># a list of range_spec objects</span>
</span><span id="range_set-845"><a href="#range_set-845"><span class="linenos">845</span></a>
</span><span id="range_set-846"><a href="#range_set-846"><span class="linenos">846</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="range_set-847"><a href="#range_set-847"><span class="linenos">847</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">])</span>
</span><span id="range_set-848"><a href="#range_set-848"><span class="linenos">848</span></a>
</span><span id="range_set-849"><a href="#range_set-849"><span class="linenos">849</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="range_set-850"><a href="#range_set-850"><span class="linenos">850</span></a>        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span>
</span><span id="range_set-851"><a href="#range_set-851"><span class="linenos">851</span></a>                              <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="range_set-852"><a href="#range_set-852"><span class="linenos">852</span></a>                              <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span> <span class="p">)</span>
</span><span id="range_set-853"><a href="#range_set-853"><span class="linenos">853</span></a>
</span><span id="range_set-854"><a href="#range_set-854"><span class="linenos">854</span></a>    <span class="k">def</span> <span class="nf">from_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">valid_units</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;bytes&#39;</span><span class="p">,</span><span class="s1">&#39;none&#39;</span><span class="p">)):</span>
</span><span id="range_set-855"><a href="#range_set-855"><span class="linenos">855</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets this range set based upon a string, such as the Range: header.</span>
</span><span id="range_set-856"><a href="#range_set-856"><span class="linenos">856</span></a>
</span><span id="range_set-857"><a href="#range_set-857"><span class="linenos">857</span></a><span class="sd">        You can also use the parse_range_set() function for more control.</span>
</span><span id="range_set-858"><a href="#range_set-858"><span class="linenos">858</span></a>
</span><span id="range_set-859"><a href="#range_set-859"><span class="linenos">859</span></a><span class="sd">        If a parsing error occurs, the pre-exising value of this range</span>
</span><span id="range_set-860"><a href="#range_set-860"><span class="linenos">860</span></a><span class="sd">        set is left unchanged.</span>
</span><span id="range_set-861"><a href="#range_set-861"><span class="linenos">861</span></a>
</span><span id="range_set-862"><a href="#range_set-862"><span class="linenos">862</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_set-863"><a href="#range_set-863"><span class="linenos">863</span></a>        <span class="n">r</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_range_set</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">valid_units</span><span class="o">=</span><span class="n">valid_units</span> <span class="p">)</span>
</span><span id="range_set-864"><a href="#range_set-864"><span class="linenos">864</span></a>        <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="range_set-865"><a href="#range_set-865"><span class="linenos">865</span></a>            <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s2">&quot;Extra unparsable characters in range set specifier&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
</span><span id="range_set-866"><a href="#range_set-866"><span class="linenos">866</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">units</span>
</span><span id="range_set-867"><a href="#range_set-867"><span class="linenos">867</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">range_specs</span>
</span><span id="range_set-868"><a href="#range_set-868"><span class="linenos">868</span></a>
</span><span id="range_set-869"><a href="#range_set-869"><span class="linenos">869</span></a>    <span class="k">def</span> <span class="nf">is_single_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="range_set-870"><a href="#range_set-870"><span class="linenos">870</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Does this range specifier consist of only a single range set?&quot;&quot;&quot;</span>
</span><span id="range_set-871"><a href="#range_set-871"><span class="linenos">871</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="range_set-872"><a href="#range_set-872"><span class="linenos">872</span></a>
</span><span id="range_set-873"><a href="#range_set-873"><span class="linenos">873</span></a>    <span class="k">def</span> <span class="nf">is_contiguous</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="range_set-874"><a href="#range_set-874"><span class="linenos">874</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Can the collection of range_specs be coalesced into a single contiguous range?&quot;&quot;&quot;</span>
</span><span id="range_set-875"><a href="#range_set-875"><span class="linenos">875</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="range_set-876"><a href="#range_set-876"><span class="linenos">876</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="range_set-877"><a href="#range_set-877"><span class="linenos">877</span></a>        <span class="n">merged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="range_set-878"><a href="#range_set-878"><span class="linenos">878</span></a>        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="range_set-879"><a href="#range_set-879"><span class="linenos">879</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="range_set-880"><a href="#range_set-880"><span class="linenos">880</span></a>                <span class="n">merged</span><span class="o">.</span><span class="n">merge_with</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="range_set-881"><a href="#range_set-881"><span class="linenos">881</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="range_set-882"><a href="#range_set-882"><span class="linenos">882</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="range_set-883"><a href="#range_set-883"><span class="linenos">883</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="range_set-884"><a href="#range_set-884"><span class="linenos">884</span></a>
</span><span id="range_set-885"><a href="#range_set-885"><span class="linenos">885</span></a>    <span class="k">def</span> <span class="nf">fix_to_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
</span><span id="range_set-886"><a href="#range_set-886"><span class="linenos">886</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Changes all length-relative range_specs to absolute range_specs based upon given file size.</span>
</span><span id="range_set-887"><a href="#range_set-887"><span class="linenos">887</span></a><span class="sd">        If none of the range_specs in this set can be satisfied, then the</span>
</span><span id="range_set-888"><a href="#range_set-888"><span class="linenos">888</span></a><span class="sd">        entire set is considered unsatifiable and an error is raised.</span>
</span><span id="range_set-889"><a href="#range_set-889"><span class="linenos">889</span></a><span class="sd">        Otherwise any unsatisfiable range_specs will simply be removed</span>
</span><span id="range_set-890"><a href="#range_set-890"><span class="linenos">890</span></a><span class="sd">        from this set.</span>
</span><span id="range_set-891"><a href="#range_set-891"><span class="linenos">891</span></a>
</span><span id="range_set-892"><a href="#range_set-892"><span class="linenos">892</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_set-893"><a href="#range_set-893"><span class="linenos">893</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">)):</span>
</span><span id="range_set-894"><a href="#range_set-894"><span class="linenos">894</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="range_set-895"><a href="#range_set-895"><span class="linenos">895</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">fix_to_size</span><span class="p">(</span> <span class="n">size</span> <span class="p">)</span>
</span><span id="range_set-896"><a href="#range_set-896"><span class="linenos">896</span></a>            <span class="k">except</span> <span class="n">RangeUnsatisfiableError</span><span class="p">:</span>
</span><span id="range_set-897"><a href="#range_set-897"><span class="linenos">897</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="range_set-898"><a href="#range_set-898"><span class="linenos">898</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="range_set-899"><a href="#range_set-899"><span class="linenos">899</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="range_set-900"><a href="#range_set-900"><span class="linenos">900</span></a>            <span class="k">raise</span> <span class="n">RangeUnsatisfiableError</span><span class="p">(</span><span class="s1">&#39;No ranges can be satisfied&#39;</span><span class="p">)</span>
</span><span id="range_set-901"><a href="#range_set-901"><span class="linenos">901</span></a>
</span><span id="range_set-902"><a href="#range_set-902"><span class="linenos">902</span></a>    <span class="k">def</span> <span class="nf">coalesce</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="range_set-903"><a href="#range_set-903"><span class="linenos">903</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Collapses all consecutive range_specs which together define a contiguous range.</span>
</span><span id="range_set-904"><a href="#range_set-904"><span class="linenos">904</span></a>
</span><span id="range_set-905"><a href="#range_set-905"><span class="linenos">905</span></a><span class="sd">        Note though that this method will not re-sort the range_specs, so a</span>
</span><span id="range_set-906"><a href="#range_set-906"><span class="linenos">906</span></a><span class="sd">        potentially contiguous range may not be collapsed if they are</span>
</span><span id="range_set-907"><a href="#range_set-907"><span class="linenos">907</span></a><span class="sd">        not sorted.  For example the ranges:</span>
</span><span id="range_set-908"><a href="#range_set-908"><span class="linenos">908</span></a><span class="sd">            10-20, 30-40, 20-30</span>
</span><span id="range_set-909"><a href="#range_set-909"><span class="linenos">909</span></a><span class="sd">        will not be collapsed to just 10-40.  However if the ranges are</span>
</span><span id="range_set-910"><a href="#range_set-910"><span class="linenos">910</span></a><span class="sd">        sorted first as with:</span>
</span><span id="range_set-911"><a href="#range_set-911"><span class="linenos">911</span></a><span class="sd">            10-20, 20-30, 30-40</span>
</span><span id="range_set-912"><a href="#range_set-912"><span class="linenos">912</span></a><span class="sd">        then they will collapse to 10-40.</span>
</span><span id="range_set-913"><a href="#range_set-913"><span class="linenos">913</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_set-914"><a href="#range_set-914"><span class="linenos">914</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="range_set-915"><a href="#range_set-915"><span class="linenos">915</span></a>            <span class="k">return</span>
</span><span id="range_set-916"><a href="#range_set-916"><span class="linenos">916</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="range_set-917"><a href="#range_set-917"><span class="linenos">917</span></a>            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="range_set-918"><a href="#range_set-918"><span class="linenos">918</span></a>            <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="range_set-919"><a href="#range_set-919"><span class="linenos">919</span></a>            <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="range_set-920"><a href="#range_set-920"><span class="linenos">920</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="range_set-921"><a href="#range_set-921"><span class="linenos">921</span></a>                    <span class="n">a</span><span class="o">.</span><span class="n">merge_with</span><span class="p">(</span> <span class="n">b</span> <span class="p">)</span>
</span><span id="range_set-922"><a href="#range_set-922"><span class="linenos">922</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># to be deleted later</span>
</span><span id="range_set-923"><a href="#range_set-923"><span class="linenos">923</span></a>                <span class="k">except</span> <span class="n">RangeUnmergableError</span><span class="p">:</span>
</span><span id="range_set-924"><a href="#range_set-924"><span class="linenos">924</span></a>                    <span class="k">pass</span>
</span><span id="range_set-925"><a href="#range_set-925"><span class="linenos">925</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span> <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>A collection of range_specs, with units (e.g., bytes).</p>
</div>


                            <div id="range_set.units" class="classattr">
                                <div class="attr variable">
            <span class="name">units</span>

        
    </div>
    <a class="headerlink" href="#range_set.units"></a>
    
    

                            </div>
                            <div id="range_set.range_specs" class="classattr">
                                <div class="attr variable">
            <span class="name">range_specs</span>

        
    </div>
    <a class="headerlink" href="#range_set.range_specs"></a>
    
    

                            </div>
                            <div id="range_set.from_str" class="classattr">
                                        <input id="range_set.from_str-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">from_str</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">valid_units</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;bytes&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="range_set.from_str-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#range_set.from_str"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="range_set.from_str-854"><a href="#range_set.from_str-854"><span class="linenos">854</span></a>    <span class="k">def</span> <span class="nf">from_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">valid_units</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;bytes&#39;</span><span class="p">,</span><span class="s1">&#39;none&#39;</span><span class="p">)):</span>
</span><span id="range_set.from_str-855"><a href="#range_set.from_str-855"><span class="linenos">855</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets this range set based upon a string, such as the Range: header.</span>
</span><span id="range_set.from_str-856"><a href="#range_set.from_str-856"><span class="linenos">856</span></a>
</span><span id="range_set.from_str-857"><a href="#range_set.from_str-857"><span class="linenos">857</span></a><span class="sd">        You can also use the parse_range_set() function for more control.</span>
</span><span id="range_set.from_str-858"><a href="#range_set.from_str-858"><span class="linenos">858</span></a>
</span><span id="range_set.from_str-859"><a href="#range_set.from_str-859"><span class="linenos">859</span></a><span class="sd">        If a parsing error occurs, the pre-exising value of this range</span>
</span><span id="range_set.from_str-860"><a href="#range_set.from_str-860"><span class="linenos">860</span></a><span class="sd">        set is left unchanged.</span>
</span><span id="range_set.from_str-861"><a href="#range_set.from_str-861"><span class="linenos">861</span></a>
</span><span id="range_set.from_str-862"><a href="#range_set.from_str-862"><span class="linenos">862</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_set.from_str-863"><a href="#range_set.from_str-863"><span class="linenos">863</span></a>        <span class="n">r</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_range_set</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">valid_units</span><span class="o">=</span><span class="n">valid_units</span> <span class="p">)</span>
</span><span id="range_set.from_str-864"><a href="#range_set.from_str-864"><span class="linenos">864</span></a>        <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="range_set.from_str-865"><a href="#range_set.from_str-865"><span class="linenos">865</span></a>            <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s2">&quot;Extra unparsable characters in range set specifier&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
</span><span id="range_set.from_str-866"><a href="#range_set.from_str-866"><span class="linenos">866</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">units</span>
</span><span id="range_set.from_str-867"><a href="#range_set.from_str-867"><span class="linenos">867</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">range_specs</span>
</span></pre></div>


            <div class="docstring"><p>Sets this range set based upon a string, such as the Range: header.</p>

<p>You can also use the parse_range_set() function for more control.</p>

<p>If a parsing error occurs, the pre-exising value of this range
set is left unchanged.</p>
</div>


                            </div>
                            <div id="range_set.is_single_range" class="classattr">
                                        <input id="range_set.is_single_range-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_single_range</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="range_set.is_single_range-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#range_set.is_single_range"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="range_set.is_single_range-869"><a href="#range_set.is_single_range-869"><span class="linenos">869</span></a>    <span class="k">def</span> <span class="nf">is_single_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="range_set.is_single_range-870"><a href="#range_set.is_single_range-870"><span class="linenos">870</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Does this range specifier consist of only a single range set?&quot;&quot;&quot;</span>
</span><span id="range_set.is_single_range-871"><a href="#range_set.is_single_range-871"><span class="linenos">871</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</span></pre></div>


            <div class="docstring"><p>Does this range specifier consist of only a single range set?</p>
</div>


                            </div>
                            <div id="range_set.is_contiguous" class="classattr">
                                        <input id="range_set.is_contiguous-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_contiguous</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="range_set.is_contiguous-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#range_set.is_contiguous"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="range_set.is_contiguous-873"><a href="#range_set.is_contiguous-873"><span class="linenos">873</span></a>    <span class="k">def</span> <span class="nf">is_contiguous</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="range_set.is_contiguous-874"><a href="#range_set.is_contiguous-874"><span class="linenos">874</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Can the collection of range_specs be coalesced into a single contiguous range?&quot;&quot;&quot;</span>
</span><span id="range_set.is_contiguous-875"><a href="#range_set.is_contiguous-875"><span class="linenos">875</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="range_set.is_contiguous-876"><a href="#range_set.is_contiguous-876"><span class="linenos">876</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="range_set.is_contiguous-877"><a href="#range_set.is_contiguous-877"><span class="linenos">877</span></a>        <span class="n">merged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="range_set.is_contiguous-878"><a href="#range_set.is_contiguous-878"><span class="linenos">878</span></a>        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="range_set.is_contiguous-879"><a href="#range_set.is_contiguous-879"><span class="linenos">879</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="range_set.is_contiguous-880"><a href="#range_set.is_contiguous-880"><span class="linenos">880</span></a>                <span class="n">merged</span><span class="o">.</span><span class="n">merge_with</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="range_set.is_contiguous-881"><a href="#range_set.is_contiguous-881"><span class="linenos">881</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="range_set.is_contiguous-882"><a href="#range_set.is_contiguous-882"><span class="linenos">882</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="range_set.is_contiguous-883"><a href="#range_set.is_contiguous-883"><span class="linenos">883</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Can the collection of range_specs be coalesced into a single contiguous range?</p>
</div>


                            </div>
                            <div id="range_set.fix_to_size" class="classattr">
                                        <input id="range_set.fix_to_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fix_to_size</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">size</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="range_set.fix_to_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#range_set.fix_to_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="range_set.fix_to_size-885"><a href="#range_set.fix_to_size-885"><span class="linenos">885</span></a>    <span class="k">def</span> <span class="nf">fix_to_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
</span><span id="range_set.fix_to_size-886"><a href="#range_set.fix_to_size-886"><span class="linenos">886</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Changes all length-relative range_specs to absolute range_specs based upon given file size.</span>
</span><span id="range_set.fix_to_size-887"><a href="#range_set.fix_to_size-887"><span class="linenos">887</span></a><span class="sd">        If none of the range_specs in this set can be satisfied, then the</span>
</span><span id="range_set.fix_to_size-888"><a href="#range_set.fix_to_size-888"><span class="linenos">888</span></a><span class="sd">        entire set is considered unsatifiable and an error is raised.</span>
</span><span id="range_set.fix_to_size-889"><a href="#range_set.fix_to_size-889"><span class="linenos">889</span></a><span class="sd">        Otherwise any unsatisfiable range_specs will simply be removed</span>
</span><span id="range_set.fix_to_size-890"><a href="#range_set.fix_to_size-890"><span class="linenos">890</span></a><span class="sd">        from this set.</span>
</span><span id="range_set.fix_to_size-891"><a href="#range_set.fix_to_size-891"><span class="linenos">891</span></a>
</span><span id="range_set.fix_to_size-892"><a href="#range_set.fix_to_size-892"><span class="linenos">892</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_set.fix_to_size-893"><a href="#range_set.fix_to_size-893"><span class="linenos">893</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">)):</span>
</span><span id="range_set.fix_to_size-894"><a href="#range_set.fix_to_size-894"><span class="linenos">894</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="range_set.fix_to_size-895"><a href="#range_set.fix_to_size-895"><span class="linenos">895</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">fix_to_size</span><span class="p">(</span> <span class="n">size</span> <span class="p">)</span>
</span><span id="range_set.fix_to_size-896"><a href="#range_set.fix_to_size-896"><span class="linenos">896</span></a>            <span class="k">except</span> <span class="n">RangeUnsatisfiableError</span><span class="p">:</span>
</span><span id="range_set.fix_to_size-897"><a href="#range_set.fix_to_size-897"><span class="linenos">897</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="range_set.fix_to_size-898"><a href="#range_set.fix_to_size-898"><span class="linenos">898</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="range_set.fix_to_size-899"><a href="#range_set.fix_to_size-899"><span class="linenos">899</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="range_set.fix_to_size-900"><a href="#range_set.fix_to_size-900"><span class="linenos">900</span></a>            <span class="k">raise</span> <span class="n">RangeUnsatisfiableError</span><span class="p">(</span><span class="s1">&#39;No ranges can be satisfied&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Changes all length-relative range_specs to absolute range_specs based upon given file size.
If none of the range_specs in this set can be satisfied, then the
entire set is considered unsatifiable and an error is raised.
Otherwise any unsatisfiable range_specs will simply be removed
from this set.</p>
</div>


                            </div>
                            <div id="range_set.coalesce" class="classattr">
                                        <input id="range_set.coalesce-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">coalesce</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="range_set.coalesce-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#range_set.coalesce"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="range_set.coalesce-902"><a href="#range_set.coalesce-902"><span class="linenos">902</span></a>    <span class="k">def</span> <span class="nf">coalesce</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="range_set.coalesce-903"><a href="#range_set.coalesce-903"><span class="linenos">903</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Collapses all consecutive range_specs which together define a contiguous range.</span>
</span><span id="range_set.coalesce-904"><a href="#range_set.coalesce-904"><span class="linenos">904</span></a>
</span><span id="range_set.coalesce-905"><a href="#range_set.coalesce-905"><span class="linenos">905</span></a><span class="sd">        Note though that this method will not re-sort the range_specs, so a</span>
</span><span id="range_set.coalesce-906"><a href="#range_set.coalesce-906"><span class="linenos">906</span></a><span class="sd">        potentially contiguous range may not be collapsed if they are</span>
</span><span id="range_set.coalesce-907"><a href="#range_set.coalesce-907"><span class="linenos">907</span></a><span class="sd">        not sorted.  For example the ranges:</span>
</span><span id="range_set.coalesce-908"><a href="#range_set.coalesce-908"><span class="linenos">908</span></a><span class="sd">            10-20, 30-40, 20-30</span>
</span><span id="range_set.coalesce-909"><a href="#range_set.coalesce-909"><span class="linenos">909</span></a><span class="sd">        will not be collapsed to just 10-40.  However if the ranges are</span>
</span><span id="range_set.coalesce-910"><a href="#range_set.coalesce-910"><span class="linenos">910</span></a><span class="sd">        sorted first as with:</span>
</span><span id="range_set.coalesce-911"><a href="#range_set.coalesce-911"><span class="linenos">911</span></a><span class="sd">            10-20, 20-30, 30-40</span>
</span><span id="range_set.coalesce-912"><a href="#range_set.coalesce-912"><span class="linenos">912</span></a><span class="sd">        then they will collapse to 10-40.</span>
</span><span id="range_set.coalesce-913"><a href="#range_set.coalesce-913"><span class="linenos">913</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="range_set.coalesce-914"><a href="#range_set.coalesce-914"><span class="linenos">914</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="range_set.coalesce-915"><a href="#range_set.coalesce-915"><span class="linenos">915</span></a>            <span class="k">return</span>
</span><span id="range_set.coalesce-916"><a href="#range_set.coalesce-916"><span class="linenos">916</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="range_set.coalesce-917"><a href="#range_set.coalesce-917"><span class="linenos">917</span></a>            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="range_set.coalesce-918"><a href="#range_set.coalesce-918"><span class="linenos">918</span></a>            <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="range_set.coalesce-919"><a href="#range_set.coalesce-919"><span class="linenos">919</span></a>            <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="range_set.coalesce-920"><a href="#range_set.coalesce-920"><span class="linenos">920</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="range_set.coalesce-921"><a href="#range_set.coalesce-921"><span class="linenos">921</span></a>                    <span class="n">a</span><span class="o">.</span><span class="n">merge_with</span><span class="p">(</span> <span class="n">b</span> <span class="p">)</span>
</span><span id="range_set.coalesce-922"><a href="#range_set.coalesce-922"><span class="linenos">922</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># to be deleted later</span>
</span><span id="range_set.coalesce-923"><a href="#range_set.coalesce-923"><span class="linenos">923</span></a>                <span class="k">except</span> <span class="n">RangeUnmergableError</span><span class="p">:</span>
</span><span id="range_set.coalesce-924"><a href="#range_set.coalesce-924"><span class="linenos">924</span></a>                    <span class="k">pass</span>
</span><span id="range_set.coalesce-925"><a href="#range_set.coalesce-925"><span class="linenos">925</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_specs</span> <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Collapses all consecutive range_specs which together define a contiguous range.</p>

<p>Note though that this method will not re-sort the range_specs, so a
potentially contiguous range may not be collapsed if they are
not sorted.  For example the ranges:
    10-20, 30-40, 20-30
will not be collapsed to just 10-40.  However if the ranges are
sorted first as with:
    10-20, 20-30, 30-40
then they will collapse to 10-40.</p>
</div>


                            </div>
                </section>
                <section id="parse_number">
                            <input id="parse_number-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse_number</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">start</span><span class="o">=</span><span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="parse_number-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parse_number"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parse_number-928"><a href="#parse_number-928"><span class="linenos">928</span></a><span class="k">def</span> <span class="nf">parse_number</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span> <span class="p">):</span>
</span><span id="parse_number-929"><a href="#parse_number-929"><span class="linenos">929</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a positive decimal integer number from the string.</span>
</span><span id="parse_number-930"><a href="#parse_number-930"><span class="linenos">930</span></a>
</span><span id="parse_number-931"><a href="#parse_number-931"><span class="linenos">931</span></a><span class="sd">    A tuple is returned (number, chars_consumed).  If the</span>
</span><span id="parse_number-932"><a href="#parse_number-932"><span class="linenos">932</span></a><span class="sd">    string is not a valid decimal number, then (None,0) is returned.</span>
</span><span id="parse_number-933"><a href="#parse_number-933"><span class="linenos">933</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="parse_number-934"><a href="#parse_number-934"><span class="linenos">934</span></a>    <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="parse_number-935"><a href="#parse_number-935"><span class="linenos">935</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Starting position is beyond the end of the string&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
</span><span id="parse_number-936"><a href="#parse_number-936"><span class="linenos">936</span></a>    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DIGIT</span><span class="p">:</span>
</span><span id="parse_number-937"><a href="#parse_number-937"><span class="linenos">937</span></a>        <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># not a number</span>
</span><span id="parse_number-938"><a href="#parse_number-938"><span class="linenos">938</span></a>    <span class="n">pos</span> <span class="o">=</span> <span class="n">start</span>
</span><span id="parse_number-939"><a href="#parse_number-939"><span class="linenos">939</span></a>    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="parse_number-940"><a href="#parse_number-940"><span class="linenos">940</span></a>    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="parse_number-941"><a href="#parse_number-941"><span class="linenos">941</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
</span><span id="parse_number-942"><a href="#parse_number-942"><span class="linenos">942</span></a>        <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">DIGIT</span><span class="p">:</span>
</span><span id="parse_number-943"><a href="#parse_number-943"><span class="linenos">943</span></a>            <span class="n">n</span> <span class="o">*=</span> <span class="mi">10</span>
</span><span id="parse_number-944"><a href="#parse_number-944"><span class="linenos">944</span></a>            <span class="n">n</span> <span class="o">+=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
</span><span id="parse_number-945"><a href="#parse_number-945"><span class="linenos">945</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_number-946"><a href="#parse_number-946"><span class="linenos">946</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="parse_number-947"><a href="#parse_number-947"><span class="linenos">947</span></a>            <span class="k">break</span>
</span><span id="parse_number-948"><a href="#parse_number-948"><span class="linenos">948</span></a>    <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="n">pos</span><span class="o">-</span><span class="n">start</span>
</span></pre></div>


            <div class="docstring"><p>Parses a positive decimal integer number from the string.</p>

<p>A tuple is returned (number, chars_consumed).  If the
string is not a valid decimal number, then (None,0) is returned.</p>
</div>


                </section>
                <section id="parse_range_spec">
                            <input id="parse_range_spec-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse_range_spec</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">start</span><span class="o">=</span><span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="parse_range_spec-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parse_range_spec"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parse_range_spec-951"><a href="#parse_range_spec-951"><span class="linenos">951</span></a><span class="k">def</span> <span class="nf">parse_range_spec</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span> <span class="p">):</span>
</span><span id="parse_range_spec-952"><a href="#parse_range_spec-952"><span class="linenos">952</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a (byte) range_spec.</span>
</span><span id="parse_range_spec-953"><a href="#parse_range_spec-953"><span class="linenos">953</span></a>
</span><span id="parse_range_spec-954"><a href="#parse_range_spec-954"><span class="linenos">954</span></a><span class="sd">    Returns a tuple (range_spec, chars_consumed).</span>
</span><span id="parse_range_spec-955"><a href="#parse_range_spec-955"><span class="linenos">955</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="parse_range_spec-956"><a href="#parse_range_spec-956"><span class="linenos">956</span></a>    <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="parse_range_spec-957"><a href="#parse_range_spec-957"><span class="linenos">957</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Starting position is beyond the end of the string&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
</span><span id="parse_range_spec-958"><a href="#parse_range_spec-958"><span class="linenos">958</span></a>    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DIGIT</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
</span><span id="parse_range_spec-959"><a href="#parse_range_spec-959"><span class="linenos">959</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s2">&quot;Invalid range, expected a digit or &#39;-&#39;&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
</span><span id="parse_range_spec-960"><a href="#parse_range_spec-960"><span class="linenos">960</span></a>    <span class="n">first</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="parse_range_spec-961"><a href="#parse_range_spec-961"><span class="linenos">961</span></a>    <span class="n">pos</span> <span class="o">=</span> <span class="n">start</span>
</span><span id="parse_range_spec-962"><a href="#parse_range_spec-962"><span class="linenos">962</span></a>    <span class="n">first</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_number</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span> <span class="p">)</span>
</span><span id="parse_range_spec-963"><a href="#parse_range_spec-963"><span class="linenos">963</span></a>    <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="parse_range_spec-964"><a href="#parse_range_spec-964"><span class="linenos">964</span></a>    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
</span><span id="parse_range_spec-965"><a href="#parse_range_spec-965"><span class="linenos">965</span></a>        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_range_spec-966"><a href="#parse_range_spec-966"><span class="linenos">966</span></a>        <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="parse_range_spec-967"><a href="#parse_range_spec-967"><span class="linenos">967</span></a>            <span class="n">last</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_number</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span> <span class="p">)</span>
</span><span id="parse_range_spec-968"><a href="#parse_range_spec-968"><span class="linenos">968</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="parse_range_spec-969"><a href="#parse_range_spec-969"><span class="linenos">969</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="parse_range_spec-970"><a href="#parse_range_spec-970"><span class="linenos">970</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s2">&quot;Byte range must include a &#39;-&#39;&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="parse_range_spec-971"><a href="#parse_range_spec-971"><span class="linenos">971</span></a>    <span class="k">if</span> <span class="n">first</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">last</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="parse_range_spec-972"><a href="#parse_range_spec-972"><span class="linenos">972</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Byte range can not omit both first and last indices.&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
</span><span id="parse_range_spec-973"><a href="#parse_range_spec-973"><span class="linenos">973</span></a>    <span class="n">R</span> <span class="o">=</span> <span class="n">range_spec</span><span class="p">(</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span> <span class="p">)</span>
</span><span id="parse_range_spec-974"><a href="#parse_range_spec-974"><span class="linenos">974</span></a>    <span class="k">return</span> <span class="n">R</span><span class="p">,</span> <span class="n">pos</span><span class="o">-</span><span class="n">start</span>
</span></pre></div>


            <div class="docstring"><p>Parses a (byte) range_spec.</p>

<p>Returns a tuple (range_spec, chars_consumed).</p>
</div>


                </section>
                <section id="parse_range_header">
                            <input id="parse_range_header-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse_range_header</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">header_value</span>, </span><span class="param"><span class="n">valid_units</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;bytes&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="parse_range_header-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parse_range_header"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parse_range_header-977"><a href="#parse_range_header-977"><span class="linenos">977</span></a><span class="k">def</span> <span class="nf">parse_range_header</span><span class="p">(</span> <span class="n">header_value</span><span class="p">,</span> <span class="n">valid_units</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;bytes&#39;</span><span class="p">,</span><span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="p">):</span>
</span><span id="parse_range_header-978"><a href="#parse_range_header-978"><span class="linenos">978</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses the value of an HTTP Range: header.</span>
</span><span id="parse_range_header-979"><a href="#parse_range_header-979"><span class="linenos">979</span></a>
</span><span id="parse_range_header-980"><a href="#parse_range_header-980"><span class="linenos">980</span></a><span class="sd">    The value of the header as a string should be passed in; without</span>
</span><span id="parse_range_header-981"><a href="#parse_range_header-981"><span class="linenos">981</span></a><span class="sd">    the header name itself.</span>
</span><span id="parse_range_header-982"><a href="#parse_range_header-982"><span class="linenos">982</span></a>
</span><span id="parse_range_header-983"><a href="#parse_range_header-983"><span class="linenos">983</span></a><span class="sd">    Returns a range_set object.</span>
</span><span id="parse_range_header-984"><a href="#parse_range_header-984"><span class="linenos">984</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="parse_range_header-985"><a href="#parse_range_header-985"><span class="linenos">985</span></a>    <span class="n">ranges</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_range_set</span><span class="p">(</span> <span class="n">header_value</span><span class="p">,</span> <span class="n">valid_units</span><span class="o">=</span><span class="n">valid_units</span> <span class="p">)</span>
</span><span id="parse_range_header-986"><a href="#parse_range_header-986"><span class="linenos">986</span></a>    <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_value</span><span class="p">):</span>
</span><span id="parse_range_header-987"><a href="#parse_range_header-987"><span class="linenos">987</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Range header has unexpected or unparsable characters&#39;</span><span class="p">,</span>
</span><span id="parse_range_header-988"><a href="#parse_range_header-988"><span class="linenos">988</span></a>                         <span class="n">header_value</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</span><span id="parse_range_header-989"><a href="#parse_range_header-989"><span class="linenos">989</span></a>    <span class="k">return</span> <span class="n">ranges</span>
</span></pre></div>


            <div class="docstring"><p>Parses the value of an HTTP Range: header.</p>

<p>The value of the header as a string should be passed in; without
the header name itself.</p>

<p>Returns a range_set object.</p>
</div>


                </section>
                <section id="parse_range_set">
                            <input id="parse_range_set-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse_range_set</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">start</span><span class="o">=</span><span class="mi">0</span>, </span><span class="param"><span class="n">valid_units</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;bytes&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="parse_range_set-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parse_range_set"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parse_range_set-992"><a href="#parse_range_set-992"><span class="linenos"> 992</span></a><span class="k">def</span> <span class="nf">parse_range_set</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">valid_units</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;bytes&#39;</span><span class="p">,</span><span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="p">):</span>
</span><span id="parse_range_set-993"><a href="#parse_range_set-993"><span class="linenos"> 993</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a (byte) range set specifier.</span>
</span><span id="parse_range_set-994"><a href="#parse_range_set-994"><span class="linenos"> 994</span></a>
</span><span id="parse_range_set-995"><a href="#parse_range_set-995"><span class="linenos"> 995</span></a><span class="sd">    Returns a tuple (range_set, chars_consumed).</span>
</span><span id="parse_range_set-996"><a href="#parse_range_set-996"><span class="linenos"> 996</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="parse_range_set-997"><a href="#parse_range_set-997"><span class="linenos"> 997</span></a>    <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="parse_range_set-998"><a href="#parse_range_set-998"><span class="linenos"> 998</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Starting position is beyond the end of the string&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
</span><span id="parse_range_set-999"><a href="#parse_range_set-999"><span class="linenos"> 999</span></a>    <span class="n">pos</span> <span class="o">=</span> <span class="n">start</span>
</span><span id="parse_range_set-1000"><a href="#parse_range_set-1000"><span class="linenos">1000</span></a>    <span class="n">units</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_token</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span> <span class="p">)</span>
</span><span id="parse_range_set-1001"><a href="#parse_range_set-1001"><span class="linenos">1001</span></a>    <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="parse_range_set-1002"><a href="#parse_range_set-1002"><span class="linenos">1002</span></a>    <span class="k">if</span> <span class="n">valid_units</span> <span class="ow">and</span> <span class="n">units</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_units</span><span class="p">:</span>
</span><span id="parse_range_set-1003"><a href="#parse_range_set-1003"><span class="linenos">1003</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Unsupported units type in range specifier&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
</span><span id="parse_range_set-1004"><a href="#parse_range_set-1004"><span class="linenos">1004</span></a>    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="parse_range_set-1005"><a href="#parse_range_set-1005"><span class="linenos">1005</span></a>        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_range_set-1006"><a href="#parse_range_set-1006"><span class="linenos">1006</span></a>    <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;=&#39;</span><span class="p">:</span>
</span><span id="parse_range_set-1007"><a href="#parse_range_set-1007"><span class="linenos">1007</span></a>        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_range_set-1008"><a href="#parse_range_set-1008"><span class="linenos">1008</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="parse_range_set-1009"><a href="#parse_range_set-1009"><span class="linenos">1009</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s2">&quot;Invalid range specifier, expected &#39;=&#39;&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="parse_range_set-1010"><a href="#parse_range_set-1010"><span class="linenos">1010</span></a>    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="parse_range_set-1011"><a href="#parse_range_set-1011"><span class="linenos">1011</span></a>        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_range_set-1012"><a href="#parse_range_set-1012"><span class="linenos">1012</span></a>    <span class="n">range_specs</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_comma_list</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">parse_range_spec</span><span class="p">,</span> <span class="n">min_count</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>
</span><span id="parse_range_set-1013"><a href="#parse_range_set-1013"><span class="linenos">1013</span></a>    <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="parse_range_set-1014"><a href="#parse_range_set-1014"><span class="linenos">1014</span></a>    <span class="c1"># Make sure no trash is at the end of the string</span>
</span><span id="parse_range_set-1015"><a href="#parse_range_set-1015"><span class="linenos">1015</span></a>    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="parse_range_set-1016"><a href="#parse_range_set-1016"><span class="linenos">1016</span></a>        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_range_set-1017"><a href="#parse_range_set-1017"><span class="linenos">1017</span></a>    <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="parse_range_set-1018"><a href="#parse_range_set-1018"><span class="linenos">1018</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Unparsable characters in range set specifier&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="parse_range_set-1019"><a href="#parse_range_set-1019"><span class="linenos">1019</span></a>
</span><span id="parse_range_set-1020"><a href="#parse_range_set-1020"><span class="linenos">1020</span></a>    <span class="n">ranges</span> <span class="o">=</span> <span class="n">range_set</span><span class="p">()</span>
</span><span id="parse_range_set-1021"><a href="#parse_range_set-1021"><span class="linenos">1021</span></a>    <span class="n">ranges</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">units</span>
</span><span id="parse_range_set-1022"><a href="#parse_range_set-1022"><span class="linenos">1022</span></a>    <span class="n">ranges</span><span class="o">.</span><span class="n">range_specs</span> <span class="o">=</span> <span class="n">range_specs</span>
</span><span id="parse_range_set-1023"><a href="#parse_range_set-1023"><span class="linenos">1023</span></a>    <span class="k">return</span> <span class="n">ranges</span><span class="p">,</span> <span class="n">pos</span><span class="o">-</span><span class="n">start</span>
</span></pre></div>


            <div class="docstring"><p>Parses a (byte) range set specifier.</p>

<p>Returns a tuple (range_set, chars_consumed).</p>
</div>


                </section>
                <section id="parse_qvalue_accept_list">
                            <input id="parse_qvalue_accept_list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse_qvalue_accept_list</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">start</span><span class="o">=</span><span class="mi">0</span>, </span><span class="param"><span class="n">item_parser</span><span class="o">=&lt;</span><span class="n">function</span> <span class="n">parse_token</span><span class="o">&gt;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="parse_qvalue_accept_list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parse_qvalue_accept_list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parse_qvalue_accept_list-1060"><a href="#parse_qvalue_accept_list-1060"><span class="linenos">1060</span></a><span class="k">def</span> <span class="nf">parse_qvalue_accept_list</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">item_parser</span><span class="o">=</span><span class="n">parse_token</span> <span class="p">):</span>
</span><span id="parse_qvalue_accept_list-1061"><a href="#parse_qvalue_accept_list-1061"><span class="linenos">1061</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses any of the Accept-* style headers with quality factors.</span>
</span><span id="parse_qvalue_accept_list-1062"><a href="#parse_qvalue_accept_list-1062"><span class="linenos">1062</span></a>
</span><span id="parse_qvalue_accept_list-1063"><a href="#parse_qvalue_accept_list-1063"><span class="linenos">1063</span></a><span class="sd">    This is a low-level function.  It returns a list of tuples, each like:</span>
</span><span id="parse_qvalue_accept_list-1064"><a href="#parse_qvalue_accept_list-1064"><span class="linenos">1064</span></a><span class="sd">       (item, item_parms, qvalue, accept_parms)</span>
</span><span id="parse_qvalue_accept_list-1065"><a href="#parse_qvalue_accept_list-1065"><span class="linenos">1065</span></a>
</span><span id="parse_qvalue_accept_list-1066"><a href="#parse_qvalue_accept_list-1066"><span class="linenos">1066</span></a><span class="sd">    You can pass in a function which parses each of the item strings, or</span>
</span><span id="parse_qvalue_accept_list-1067"><a href="#parse_qvalue_accept_list-1067"><span class="linenos">1067</span></a><span class="sd">    accept the default where the items must be simple tokens.  Note that</span>
</span><span id="parse_qvalue_accept_list-1068"><a href="#parse_qvalue_accept_list-1068"><span class="linenos">1068</span></a><span class="sd">    your parser should not consume any paramters (past the special &quot;q&quot;</span>
</span><span id="parse_qvalue_accept_list-1069"><a href="#parse_qvalue_accept_list-1069"><span class="linenos">1069</span></a><span class="sd">    paramter anyway).</span>
</span><span id="parse_qvalue_accept_list-1070"><a href="#parse_qvalue_accept_list-1070"><span class="linenos">1070</span></a>
</span><span id="parse_qvalue_accept_list-1071"><a href="#parse_qvalue_accept_list-1071"><span class="linenos">1071</span></a><span class="sd">    The item_parms and accept_parms are each lists of (name,value) tuples.</span>
</span><span id="parse_qvalue_accept_list-1072"><a href="#parse_qvalue_accept_list-1072"><span class="linenos">1072</span></a>
</span><span id="parse_qvalue_accept_list-1073"><a href="#parse_qvalue_accept_list-1073"><span class="linenos">1073</span></a><span class="sd">    The qvalue is the quality factor, a number from 0 to 1 inclusive.</span>
</span><span id="parse_qvalue_accept_list-1074"><a href="#parse_qvalue_accept_list-1074"><span class="linenos">1074</span></a>
</span><span id="parse_qvalue_accept_list-1075"><a href="#parse_qvalue_accept_list-1075"><span class="linenos">1075</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="parse_qvalue_accept_list-1076"><a href="#parse_qvalue_accept_list-1076"><span class="linenos">1076</span></a>    <span class="n">itemlist</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="parse_qvalue_accept_list-1077"><a href="#parse_qvalue_accept_list-1077"><span class="linenos">1077</span></a>    <span class="n">pos</span> <span class="o">=</span> <span class="n">start</span>
</span><span id="parse_qvalue_accept_list-1078"><a href="#parse_qvalue_accept_list-1078"><span class="linenos">1078</span></a>    <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="parse_qvalue_accept_list-1079"><a href="#parse_qvalue_accept_list-1079"><span class="linenos">1079</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Starting position is beyond the end of the string&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="parse_qvalue_accept_list-1080"><a href="#parse_qvalue_accept_list-1080"><span class="linenos">1080</span></a>    <span class="n">item</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="parse_qvalue_accept_list-1081"><a href="#parse_qvalue_accept_list-1081"><span class="linenos">1081</span></a>    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="parse_qvalue_accept_list-1082"><a href="#parse_qvalue_accept_list-1082"><span class="linenos">1082</span></a>        <span class="n">item</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">item_parser</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="parse_qvalue_accept_list-1083"><a href="#parse_qvalue_accept_list-1083"><span class="linenos">1083</span></a>        <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="parse_qvalue_accept_list-1084"><a href="#parse_qvalue_accept_list-1084"><span class="linenos">1084</span></a>        <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="parse_qvalue_accept_list-1085"><a href="#parse_qvalue_accept_list-1085"><span class="linenos">1085</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_qvalue_accept_list-1086"><a href="#parse_qvalue_accept_list-1086"><span class="linenos">1086</span></a>        <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="s1">&#39;,;&#39;</span><span class="p">:</span>
</span><span id="parse_qvalue_accept_list-1087"><a href="#parse_qvalue_accept_list-1087"><span class="linenos">1087</span></a>            <span class="n">itemparms</span><span class="p">,</span> <span class="n">qvalue</span><span class="p">,</span> <span class="n">acptparms</span> <span class="o">=</span> <span class="p">[],</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[]</span>
</span><span id="parse_qvalue_accept_list-1088"><a href="#parse_qvalue_accept_list-1088"><span class="linenos">1088</span></a>            <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;;&#39;</span><span class="p">:</span>
</span><span id="parse_qvalue_accept_list-1089"><a href="#parse_qvalue_accept_list-1089"><span class="linenos">1089</span></a>                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_qvalue_accept_list-1090"><a href="#parse_qvalue_accept_list-1090"><span class="linenos">1090</span></a>                <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="parse_qvalue_accept_list-1091"><a href="#parse_qvalue_accept_list-1091"><span class="linenos">1091</span></a>                    <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_qvalue_accept_list-1092"><a href="#parse_qvalue_accept_list-1092"><span class="linenos">1092</span></a>                <span class="n">parmlist</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_parameter_list</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="parse_qvalue_accept_list-1093"><a href="#parse_qvalue_accept_list-1093"><span class="linenos">1093</span></a>                <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">parmlist</span><span class="p">:</span>
</span><span id="parse_qvalue_accept_list-1094"><a href="#parse_qvalue_accept_list-1094"><span class="linenos">1094</span></a>                    <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s1">&#39;q&#39;</span> <span class="ow">and</span> <span class="n">qvalue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="parse_qvalue_accept_list-1095"><a href="#parse_qvalue_accept_list-1095"><span class="linenos">1095</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="parse_qvalue_accept_list-1096"><a href="#parse_qvalue_accept_list-1096"><span class="linenos">1096</span></a>                            <span class="n">qvalue</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="parse_qvalue_accept_list-1097"><a href="#parse_qvalue_accept_list-1097"><span class="linenos">1097</span></a>                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="parse_qvalue_accept_list-1098"><a href="#parse_qvalue_accept_list-1098"><span class="linenos">1098</span></a>                            <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;qvalue must be a floating point number&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="parse_qvalue_accept_list-1099"><a href="#parse_qvalue_accept_list-1099"><span class="linenos">1099</span></a>                        <span class="k">if</span> <span class="n">qvalue</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">qvalue</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="parse_qvalue_accept_list-1100"><a href="#parse_qvalue_accept_list-1100"><span class="linenos">1100</span></a>                            <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;qvalue must be between 0 and 1, inclusive&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
</span><span id="parse_qvalue_accept_list-1101"><a href="#parse_qvalue_accept_list-1101"><span class="linenos">1101</span></a>                    <span class="k">elif</span> <span class="n">qvalue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="parse_qvalue_accept_list-1102"><a href="#parse_qvalue_accept_list-1102"><span class="linenos">1102</span></a>                        <span class="n">itemparms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="p">)</span>
</span><span id="parse_qvalue_accept_list-1103"><a href="#parse_qvalue_accept_list-1103"><span class="linenos">1103</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="parse_qvalue_accept_list-1104"><a href="#parse_qvalue_accept_list-1104"><span class="linenos">1104</span></a>                        <span class="n">acptparms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="p">)</span>
</span><span id="parse_qvalue_accept_list-1105"><a href="#parse_qvalue_accept_list-1105"><span class="linenos">1105</span></a>                <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="parse_qvalue_accept_list-1106"><a href="#parse_qvalue_accept_list-1106"><span class="linenos">1106</span></a>            <span class="k">if</span> <span class="n">item</span><span class="p">:</span>
</span><span id="parse_qvalue_accept_list-1107"><a href="#parse_qvalue_accept_list-1107"><span class="linenos">1107</span></a>                <span class="c1"># Add the item to the list</span>
</span><span id="parse_qvalue_accept_list-1108"><a href="#parse_qvalue_accept_list-1108"><span class="linenos">1108</span></a>                <span class="k">if</span> <span class="n">qvalue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="parse_qvalue_accept_list-1109"><a href="#parse_qvalue_accept_list-1109"><span class="linenos">1109</span></a>                    <span class="n">qvalue</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="parse_qvalue_accept_list-1110"><a href="#parse_qvalue_accept_list-1110"><span class="linenos">1110</span></a>                <span class="n">itemlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">itemparms</span><span class="p">,</span> <span class="n">qvalue</span><span class="p">,</span> <span class="n">acptparms</span><span class="p">)</span> <span class="p">)</span>
</span><span id="parse_qvalue_accept_list-1111"><a href="#parse_qvalue_accept_list-1111"><span class="linenos">1111</span></a>                <span class="n">item</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="parse_qvalue_accept_list-1112"><a href="#parse_qvalue_accept_list-1112"><span class="linenos">1112</span></a>            <span class="c1"># skip commas</span>
</span><span id="parse_qvalue_accept_list-1113"><a href="#parse_qvalue_accept_list-1113"><span class="linenos">1113</span></a>            <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span><span class="p">:</span>
</span><span id="parse_qvalue_accept_list-1114"><a href="#parse_qvalue_accept_list-1114"><span class="linenos">1114</span></a>                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_qvalue_accept_list-1115"><a href="#parse_qvalue_accept_list-1115"><span class="linenos">1115</span></a>                <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="parse_qvalue_accept_list-1116"><a href="#parse_qvalue_accept_list-1116"><span class="linenos">1116</span></a>                    <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_qvalue_accept_list-1117"><a href="#parse_qvalue_accept_list-1117"><span class="linenos">1117</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="parse_qvalue_accept_list-1118"><a href="#parse_qvalue_accept_list-1118"><span class="linenos">1118</span></a>            <span class="k">break</span>
</span><span id="parse_qvalue_accept_list-1119"><a href="#parse_qvalue_accept_list-1119"><span class="linenos">1119</span></a>    <span class="k">return</span> <span class="n">itemlist</span><span class="p">,</span> <span class="n">pos</span> <span class="o">-</span> <span class="n">start</span>
</span></pre></div>


            <div class="docstring"><p>Parses any of the Accept-* style headers with quality factors.</p>

<p>This is a low-level function.  It returns a list of tuples, each like:
   (item, item_parms, qvalue, accept_parms)</p>

<p>You can pass in a function which parses each of the item strings, or
accept the default where the items must be simple tokens.  Note that
your parser should not consume any paramters (past the special "q"
paramter anyway).</p>

<p>The item_parms and accept_parms are each lists of (name,value) tuples.</p>

<p>The qvalue is the quality factor, a number from 0 to 1 inclusive.</p>
</div>


                </section>
                <section id="parse_accept_header">
                            <input id="parse_accept_header-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse_accept_header</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">header_value</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="parse_accept_header-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parse_accept_header"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parse_accept_header-1122"><a href="#parse_accept_header-1122"><span class="linenos">1122</span></a><span class="k">def</span> <span class="nf">parse_accept_header</span><span class="p">(</span> <span class="n">header_value</span> <span class="p">):</span>
</span><span id="parse_accept_header-1123"><a href="#parse_accept_header-1123"><span class="linenos">1123</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses the Accept: header.</span>
</span><span id="parse_accept_header-1124"><a href="#parse_accept_header-1124"><span class="linenos">1124</span></a>
</span><span id="parse_accept_header-1125"><a href="#parse_accept_header-1125"><span class="linenos">1125</span></a><span class="sd">    The value of the header as a string should be passed in; without</span>
</span><span id="parse_accept_header-1126"><a href="#parse_accept_header-1126"><span class="linenos">1126</span></a><span class="sd">    the header name itself.</span>
</span><span id="parse_accept_header-1127"><a href="#parse_accept_header-1127"><span class="linenos">1127</span></a><span class="sd">    </span>
</span><span id="parse_accept_header-1128"><a href="#parse_accept_header-1128"><span class="linenos">1128</span></a><span class="sd">    This will parse the value of any of the HTTP headers &quot;Accept&quot;,</span>
</span><span id="parse_accept_header-1129"><a href="#parse_accept_header-1129"><span class="linenos">1129</span></a><span class="sd">    &quot;Accept-Charset&quot;, &quot;Accept-Encoding&quot;, or &quot;Accept-Language&quot;.  These</span>
</span><span id="parse_accept_header-1130"><a href="#parse_accept_header-1130"><span class="linenos">1130</span></a><span class="sd">    headers are similarly formatted, in that they are a list of items</span>
</span><span id="parse_accept_header-1131"><a href="#parse_accept_header-1131"><span class="linenos">1131</span></a><span class="sd">    with associated quality factors.  The quality factor, or qvalue,</span>
</span><span id="parse_accept_header-1132"><a href="#parse_accept_header-1132"><span class="linenos">1132</span></a><span class="sd">    is a number in the range [0.0..1.0] which indicates the relative</span>
</span><span id="parse_accept_header-1133"><a href="#parse_accept_header-1133"><span class="linenos">1133</span></a><span class="sd">    preference of each item.</span>
</span><span id="parse_accept_header-1134"><a href="#parse_accept_header-1134"><span class="linenos">1134</span></a>
</span><span id="parse_accept_header-1135"><a href="#parse_accept_header-1135"><span class="linenos">1135</span></a><span class="sd">    This function returns a list of those items, sorted by preference</span>
</span><span id="parse_accept_header-1136"><a href="#parse_accept_header-1136"><span class="linenos">1136</span></a><span class="sd">    (from most-prefered to least-prefered).  Each item in the returned</span>
</span><span id="parse_accept_header-1137"><a href="#parse_accept_header-1137"><span class="linenos">1137</span></a><span class="sd">    list is actually a tuple consisting of:</span>
</span><span id="parse_accept_header-1138"><a href="#parse_accept_header-1138"><span class="linenos">1138</span></a>
</span><span id="parse_accept_header-1139"><a href="#parse_accept_header-1139"><span class="linenos">1139</span></a><span class="sd">       ( item_name, item_parms, qvalue, accept_parms )</span>
</span><span id="parse_accept_header-1140"><a href="#parse_accept_header-1140"><span class="linenos">1140</span></a>
</span><span id="parse_accept_header-1141"><a href="#parse_accept_header-1141"><span class="linenos">1141</span></a><span class="sd">    As an example, the following string,</span>
</span><span id="parse_accept_header-1142"><a href="#parse_accept_header-1142"><span class="linenos">1142</span></a><span class="sd">        text/plain; charset=&quot;utf-8&quot;; q=.5; columns=80</span>
</span><span id="parse_accept_header-1143"><a href="#parse_accept_header-1143"><span class="linenos">1143</span></a><span class="sd">    would be parsed into this resulting tuple,</span>
</span><span id="parse_accept_header-1144"><a href="#parse_accept_header-1144"><span class="linenos">1144</span></a><span class="sd">        ( &#39;text/plain&#39;, [(&#39;charset&#39;,&#39;utf-8&#39;)], 0.5, [(&#39;columns&#39;,&#39;80&#39;)] )</span>
</span><span id="parse_accept_header-1145"><a href="#parse_accept_header-1145"><span class="linenos">1145</span></a>
</span><span id="parse_accept_header-1146"><a href="#parse_accept_header-1146"><span class="linenos">1146</span></a><span class="sd">    The value of the returned item_name depends upon which header is</span>
</span><span id="parse_accept_header-1147"><a href="#parse_accept_header-1147"><span class="linenos">1147</span></a><span class="sd">    being parsed, but for example it may be a MIME content or media</span>
</span><span id="parse_accept_header-1148"><a href="#parse_accept_header-1148"><span class="linenos">1148</span></a><span class="sd">    type (without parameters), a language tag, or so on.  Any optional</span>
</span><span id="parse_accept_header-1149"><a href="#parse_accept_header-1149"><span class="linenos">1149</span></a><span class="sd">    parameters (delimited by semicolons) occuring before the &quot;q=&quot;</span>
</span><span id="parse_accept_header-1150"><a href="#parse_accept_header-1150"><span class="linenos">1150</span></a><span class="sd">    attribute will be in the item_parms list as (attribute,value)</span>
</span><span id="parse_accept_header-1151"><a href="#parse_accept_header-1151"><span class="linenos">1151</span></a><span class="sd">    tuples in the same order as they appear in the header.  Any quoted</span>
</span><span id="parse_accept_header-1152"><a href="#parse_accept_header-1152"><span class="linenos">1152</span></a><span class="sd">    values will have been unquoted and unescaped.</span>
</span><span id="parse_accept_header-1153"><a href="#parse_accept_header-1153"><span class="linenos">1153</span></a>
</span><span id="parse_accept_header-1154"><a href="#parse_accept_header-1154"><span class="linenos">1154</span></a><span class="sd">    The qvalue is a floating point number in the inclusive range 0.0</span>
</span><span id="parse_accept_header-1155"><a href="#parse_accept_header-1155"><span class="linenos">1155</span></a><span class="sd">    to 1.0, and roughly indicates the preference for this item.</span>
</span><span id="parse_accept_header-1156"><a href="#parse_accept_header-1156"><span class="linenos">1156</span></a><span class="sd">    Values outside this range will be capped to the closest extreme.</span>
</span><span id="parse_accept_header-1157"><a href="#parse_accept_header-1157"><span class="linenos">1157</span></a>
</span><span id="parse_accept_header-1158"><a href="#parse_accept_header-1158"><span class="linenos">1158</span></a><span class="sd">         (!) Note that a qvalue of 0 indicates that the item is</span>
</span><span id="parse_accept_header-1159"><a href="#parse_accept_header-1159"><span class="linenos">1159</span></a><span class="sd">         explicitly NOT acceptable to the user agent, and should be</span>
</span><span id="parse_accept_header-1160"><a href="#parse_accept_header-1160"><span class="linenos">1160</span></a><span class="sd">         handled differently by the caller.</span>
</span><span id="parse_accept_header-1161"><a href="#parse_accept_header-1161"><span class="linenos">1161</span></a>
</span><span id="parse_accept_header-1162"><a href="#parse_accept_header-1162"><span class="linenos">1162</span></a><span class="sd">    The accept_parms, like the item_parms, is a list of any attributes</span>
</span><span id="parse_accept_header-1163"><a href="#parse_accept_header-1163"><span class="linenos">1163</span></a><span class="sd">    occuring after the &quot;q=&quot; attribute, and will be in the list as</span>
</span><span id="parse_accept_header-1164"><a href="#parse_accept_header-1164"><span class="linenos">1164</span></a><span class="sd">    (attribute,value) tuples in the same order as they occur.</span>
</span><span id="parse_accept_header-1165"><a href="#parse_accept_header-1165"><span class="linenos">1165</span></a><span class="sd">    Usually accept_parms will be an empty list, as the HTTP spec</span>
</span><span id="parse_accept_header-1166"><a href="#parse_accept_header-1166"><span class="linenos">1166</span></a><span class="sd">    allows these extra parameters in the syntax but does not</span>
</span><span id="parse_accept_header-1167"><a href="#parse_accept_header-1167"><span class="linenos">1167</span></a><span class="sd">    currently define any possible values.</span>
</span><span id="parse_accept_header-1168"><a href="#parse_accept_header-1168"><span class="linenos">1168</span></a>
</span><span id="parse_accept_header-1169"><a href="#parse_accept_header-1169"><span class="linenos">1169</span></a><span class="sd">    All empty items will be removed from the list.  However, duplicate</span>
</span><span id="parse_accept_header-1170"><a href="#parse_accept_header-1170"><span class="linenos">1170</span></a><span class="sd">    or conflicting values are not detected or handled in any way by</span>
</span><span id="parse_accept_header-1171"><a href="#parse_accept_header-1171"><span class="linenos">1171</span></a><span class="sd">    this function.</span>
</span><span id="parse_accept_header-1172"><a href="#parse_accept_header-1172"><span class="linenos">1172</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="parse_accept_header-1173"><a href="#parse_accept_header-1173"><span class="linenos">1173</span></a>    <span class="k">def</span> <span class="nf">parse_mt_only</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="p">):</span>
</span><span id="parse_accept_header-1174"><a href="#parse_accept_header-1174"><span class="linenos">1174</span></a>        <span class="n">mt</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_media_type</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">with_parameters</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="parse_accept_header-1175"><a href="#parse_accept_header-1175"><span class="linenos">1175</span></a>        <span class="n">ct</span> <span class="o">=</span> <span class="n">content_type</span><span class="p">()</span>
</span><span id="parse_accept_header-1176"><a href="#parse_accept_header-1176"><span class="linenos">1176</span></a>        <span class="n">ct</span><span class="o">.</span><span class="n">major</span> <span class="o">=</span> <span class="n">mt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="parse_accept_header-1177"><a href="#parse_accept_header-1177"><span class="linenos">1177</span></a>        <span class="n">ct</span><span class="o">.</span><span class="n">minor</span> <span class="o">=</span> <span class="n">mt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="parse_accept_header-1178"><a href="#parse_accept_header-1178"><span class="linenos">1178</span></a>        <span class="k">return</span> <span class="n">ct</span><span class="p">,</span> <span class="n">k</span>
</span><span id="parse_accept_header-1179"><a href="#parse_accept_header-1179"><span class="linenos">1179</span></a>
</span><span id="parse_accept_header-1180"><a href="#parse_accept_header-1180"><span class="linenos">1180</span></a>    <span class="n">alist</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_qvalue_accept_list</span><span class="p">(</span> <span class="n">header_value</span><span class="p">,</span> <span class="n">item_parser</span><span class="o">=</span><span class="n">parse_mt_only</span> <span class="p">)</span>
</span><span id="parse_accept_header-1181"><a href="#parse_accept_header-1181"><span class="linenos">1181</span></a>    <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_value</span><span class="p">):</span>
</span><span id="parse_accept_header-1182"><a href="#parse_accept_header-1182"><span class="linenos">1182</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Accept header is invalid&#39;</span><span class="p">,</span><span class="n">header_value</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
</span><span id="parse_accept_header-1183"><a href="#parse_accept_header-1183"><span class="linenos">1183</span></a>
</span><span id="parse_accept_header-1184"><a href="#parse_accept_header-1184"><span class="linenos">1184</span></a>    <span class="n">ctlist</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="parse_accept_header-1185"><a href="#parse_accept_header-1185"><span class="linenos">1185</span></a>    <span class="k">for</span> <span class="n">ct</span><span class="p">,</span> <span class="n">ctparms</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">acptparms</span>  <span class="ow">in</span> <span class="n">alist</span><span class="p">:</span>
</span><span id="parse_accept_header-1186"><a href="#parse_accept_header-1186"><span class="linenos">1186</span></a>        <span class="k">if</span> <span class="n">ctparms</span><span class="p">:</span>
</span><span id="parse_accept_header-1187"><a href="#parse_accept_header-1187"><span class="linenos">1187</span></a>            <span class="n">ct</span><span class="o">.</span><span class="n">set_parameters</span><span class="p">(</span> <span class="nb">dict</span><span class="p">(</span><span class="n">ctparms</span><span class="p">)</span> <span class="p">)</span>
</span><span id="parse_accept_header-1188"><a href="#parse_accept_header-1188"><span class="linenos">1188</span></a>        <span class="n">ctlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">acptparms</span><span class="p">)</span> <span class="p">)</span>
</span><span id="parse_accept_header-1189"><a href="#parse_accept_header-1189"><span class="linenos">1189</span></a>    <span class="k">return</span> <span class="n">ctlist</span>
</span></pre></div>


            <div class="docstring"><p>Parses the Accept: header.</p>

<p>The value of the header as a string should be passed in; without
the header name itself.</p>

<p>This will parse the value of any of the HTTP headers "Accept",
"Accept-Charset", "Accept-Encoding", or "Accept-Language".  These
headers are similarly formatted, in that they are a list of items
with associated quality factors.  The quality factor, or qvalue,
is a number in the range [0.0..1.0] which indicates the relative
preference of each item.</p>

<p>This function returns a list of those items, sorted by preference
(from most-prefered to least-prefered).  Each item in the returned
list is actually a tuple consisting of:</p>

<p>( item_name, item_parms, qvalue, accept_parms )</p>

<p>As an example, the following string,
    text/plain; charset="utf-8"; q=.5; columns=80
would be parsed into this resulting tuple,
    ( 'text/plain', [('charset','utf-8')], 0.5, [('columns','80')] )</p>

<p>The value of the returned item_name depends upon which header is
being parsed, but for example it may be a MIME content or media
type (without parameters), a language tag, or so on.  Any optional
parameters (delimited by semicolons) occuring before the "q="
attribute will be in the item_parms list as (attribute,value)
tuples in the same order as they appear in the header.  Any quoted
values will have been unquoted and unescaped.</p>

<p>The qvalue is a floating point number in the inclusive range 0.0
to 1.0, and roughly indicates the preference for this item.
Values outside this range will be capped to the closest extreme.</p>

<pre><code> (!) Note that a qvalue of 0 indicates that the item is
 explicitly NOT acceptable to the user agent, and should be
 handled differently by the caller.
</code></pre>

<p>The accept_parms, like the item_parms, is a list of any attributes
occuring after the "q=" attribute, and will be in the list as
(attribute,value) tuples in the same order as they occur.
Usually accept_parms will be an empty list, as the HTTP spec
allows these extra parameters in the syntax but does not
currently define any possible values.</p>

<p>All empty items will be removed from the list.  However, duplicate
or conflicting values are not detected or handled in any way by
this function.</p>
</div>


                </section>
                <section id="parse_media_type">
                            <input id="parse_media_type-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse_media_type</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">media_type</span>, </span><span class="param"><span class="n">start</span><span class="o">=</span><span class="mi">0</span>, </span><span class="param"><span class="n">with_parameters</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="parse_media_type-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parse_media_type"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parse_media_type-1192"><a href="#parse_media_type-1192"><span class="linenos">1192</span></a><span class="k">def</span> <span class="nf">parse_media_type</span><span class="p">(</span><span class="n">media_type</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">with_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="parse_media_type-1193"><a href="#parse_media_type-1193"><span class="linenos">1193</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a media type (MIME type) designator into it&#39;s parts.</span>
</span><span id="parse_media_type-1194"><a href="#parse_media_type-1194"><span class="linenos">1194</span></a>
</span><span id="parse_media_type-1195"><a href="#parse_media_type-1195"><span class="linenos">1195</span></a><span class="sd">    Given a media type string, returns a nested tuple of it&#39;s parts.</span>
</span><span id="parse_media_type-1196"><a href="#parse_media_type-1196"><span class="linenos">1196</span></a>
</span><span id="parse_media_type-1197"><a href="#parse_media_type-1197"><span class="linenos">1197</span></a><span class="sd">        ((major,minor,parmlist), chars_consumed)</span>
</span><span id="parse_media_type-1198"><a href="#parse_media_type-1198"><span class="linenos">1198</span></a>
</span><span id="parse_media_type-1199"><a href="#parse_media_type-1199"><span class="linenos">1199</span></a><span class="sd">    where parmlist is a list of tuples of (parm_name, parm_value).</span>
</span><span id="parse_media_type-1200"><a href="#parse_media_type-1200"><span class="linenos">1200</span></a><span class="sd">    Quoted-values are appropriately unquoted and unescaped.</span>
</span><span id="parse_media_type-1201"><a href="#parse_media_type-1201"><span class="linenos">1201</span></a><span class="sd">    </span>
</span><span id="parse_media_type-1202"><a href="#parse_media_type-1202"><span class="linenos">1202</span></a><span class="sd">    If &#39;with_parameters&#39; is False, then parsing will stop immediately</span>
</span><span id="parse_media_type-1203"><a href="#parse_media_type-1203"><span class="linenos">1203</span></a><span class="sd">    after the minor media type; and will not proceed to parse any</span>
</span><span id="parse_media_type-1204"><a href="#parse_media_type-1204"><span class="linenos">1204</span></a><span class="sd">    of the semicolon-separated paramters.</span>
</span><span id="parse_media_type-1205"><a href="#parse_media_type-1205"><span class="linenos">1205</span></a>
</span><span id="parse_media_type-1206"><a href="#parse_media_type-1206"><span class="linenos">1206</span></a><span class="sd">    Examples:</span>
</span><span id="parse_media_type-1207"><a href="#parse_media_type-1207"><span class="linenos">1207</span></a><span class="sd">        image/png -&gt; ((&#39;image&#39;,&#39;png&#39;,[]), 9)</span>
</span><span id="parse_media_type-1208"><a href="#parse_media_type-1208"><span class="linenos">1208</span></a><span class="sd">        text/plain; charset=&quot;utf-16be&quot;</span>
</span><span id="parse_media_type-1209"><a href="#parse_media_type-1209"><span class="linenos">1209</span></a><span class="sd">                  -&gt; ((&#39;text&#39;,&#39;plain&#39;,[(&#39;charset,&#39;utf-16be&#39;)]), 30)</span>
</span><span id="parse_media_type-1210"><a href="#parse_media_type-1210"><span class="linenos">1210</span></a>
</span><span id="parse_media_type-1211"><a href="#parse_media_type-1211"><span class="linenos">1211</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="parse_media_type-1212"><a href="#parse_media_type-1212"><span class="linenos">1212</span></a>
</span><span id="parse_media_type-1213"><a href="#parse_media_type-1213"><span class="linenos">1213</span></a>    <span class="n">s</span> <span class="o">=</span> <span class="n">media_type</span>
</span><span id="parse_media_type-1214"><a href="#parse_media_type-1214"><span class="linenos">1214</span></a>    <span class="n">pos</span> <span class="o">=</span> <span class="n">start</span>
</span><span id="parse_media_type-1215"><a href="#parse_media_type-1215"><span class="linenos">1215</span></a>    <span class="n">ctmaj</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_token</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="parse_media_type-1216"><a href="#parse_media_type-1216"><span class="linenos">1216</span></a>    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="parse_media_type-1217"><a href="#parse_media_type-1217"><span class="linenos">1217</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Media type must be of the form &quot;major/minor&quot;.&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="parse_media_type-1218"><a href="#parse_media_type-1218"><span class="linenos">1218</span></a>    <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="parse_media_type-1219"><a href="#parse_media_type-1219"><span class="linenos">1219</span></a>    <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="parse_media_type-1220"><a href="#parse_media_type-1220"><span class="linenos">1220</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Media type must be of the form &quot;major/minor&quot;.&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="parse_media_type-1221"><a href="#parse_media_type-1221"><span class="linenos">1221</span></a>    <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_media_type-1222"><a href="#parse_media_type-1222"><span class="linenos">1222</span></a>    <span class="n">ctmin</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_token</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="parse_media_type-1223"><a href="#parse_media_type-1223"><span class="linenos">1223</span></a>    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="parse_media_type-1224"><a href="#parse_media_type-1224"><span class="linenos">1224</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Media type must be of the form &quot;major/minor&quot;.&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="parse_media_type-1225"><a href="#parse_media_type-1225"><span class="linenos">1225</span></a>    <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="parse_media_type-1226"><a href="#parse_media_type-1226"><span class="linenos">1226</span></a>    <span class="k">if</span> <span class="n">with_parameters</span><span class="p">:</span>
</span><span id="parse_media_type-1227"><a href="#parse_media_type-1227"><span class="linenos">1227</span></a>        <span class="n">parmlist</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_parameter_list</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="parse_media_type-1228"><a href="#parse_media_type-1228"><span class="linenos">1228</span></a>        <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="parse_media_type-1229"><a href="#parse_media_type-1229"><span class="linenos">1229</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="parse_media_type-1230"><a href="#parse_media_type-1230"><span class="linenos">1230</span></a>        <span class="n">parmlist</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="parse_media_type-1231"><a href="#parse_media_type-1231"><span class="linenos">1231</span></a>    <span class="k">return</span> <span class="p">((</span><span class="n">ctmaj</span><span class="p">,</span> <span class="n">ctmin</span><span class="p">,</span> <span class="n">parmlist</span><span class="p">),</span> <span class="n">pos</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Parses a media type (MIME type) designator into it's parts.</p>

<p>Given a media type string, returns a nested tuple of it's parts.</p>

<pre><code>((major,minor,parmlist), chars_consumed)
</code></pre>

<p>where parmlist is a list of tuples of (parm_name, parm_value).
Quoted-values are appropriately unquoted and unescaped.</p>

<p>If 'with_parameters' is False, then parsing will stop immediately
after the minor media type; and will not proceed to parse any
of the semicolon-separated paramters.</p>

<p>Examples:
    image/png -> (('image','png',[]), 9)
    text/plain; charset="utf-16be"
              -> (('text','plain',[('charset,'utf-16be')]), 30)</p>
</div>


                </section>
                <section id="parse_parameter_list">
                            <input id="parse_parameter_list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse_parameter_list</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">start</span><span class="o">=</span><span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="parse_parameter_list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parse_parameter_list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parse_parameter_list-1234"><a href="#parse_parameter_list-1234"><span class="linenos">1234</span></a><span class="k">def</span> <span class="nf">parse_parameter_list</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="parse_parameter_list-1235"><a href="#parse_parameter_list-1235"><span class="linenos">1235</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a semicolon-separated &#39;parameter=value&#39; list.</span>
</span><span id="parse_parameter_list-1236"><a href="#parse_parameter_list-1236"><span class="linenos">1236</span></a>
</span><span id="parse_parameter_list-1237"><a href="#parse_parameter_list-1237"><span class="linenos">1237</span></a><span class="sd">    Returns a tuple (parmlist, chars_consumed), where parmlist</span>
</span><span id="parse_parameter_list-1238"><a href="#parse_parameter_list-1238"><span class="linenos">1238</span></a><span class="sd">    is a list of tuples (parm_name, parm_value).</span>
</span><span id="parse_parameter_list-1239"><a href="#parse_parameter_list-1239"><span class="linenos">1239</span></a>
</span><span id="parse_parameter_list-1240"><a href="#parse_parameter_list-1240"><span class="linenos">1240</span></a><span class="sd">    The parameter values will be unquoted and unescaped as needed.</span>
</span><span id="parse_parameter_list-1241"><a href="#parse_parameter_list-1241"><span class="linenos">1241</span></a>
</span><span id="parse_parameter_list-1242"><a href="#parse_parameter_list-1242"><span class="linenos">1242</span></a><span class="sd">    Empty parameters (as in &quot;;;&quot;) are skipped, as is insignificant</span>
</span><span id="parse_parameter_list-1243"><a href="#parse_parameter_list-1243"><span class="linenos">1243</span></a><span class="sd">    white space.  The list returned is kept in the same order as the</span>
</span><span id="parse_parameter_list-1244"><a href="#parse_parameter_list-1244"><span class="linenos">1244</span></a><span class="sd">    parameters appear in the string.</span>
</span><span id="parse_parameter_list-1245"><a href="#parse_parameter_list-1245"><span class="linenos">1245</span></a>
</span><span id="parse_parameter_list-1246"><a href="#parse_parameter_list-1246"><span class="linenos">1246</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="parse_parameter_list-1247"><a href="#parse_parameter_list-1247"><span class="linenos">1247</span></a>    <span class="n">pos</span> <span class="o">=</span> <span class="n">start</span>
</span><span id="parse_parameter_list-1248"><a href="#parse_parameter_list-1248"><span class="linenos">1248</span></a>    <span class="n">parmlist</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="parse_parameter_list-1249"><a href="#parse_parameter_list-1249"><span class="linenos">1249</span></a>    <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="parse_parameter_list-1250"><a href="#parse_parameter_list-1250"><span class="linenos">1250</span></a>        <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="parse_parameter_list-1251"><a href="#parse_parameter_list-1251"><span class="linenos">1251</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># skip whitespace</span>
</span><span id="parse_parameter_list-1252"><a href="#parse_parameter_list-1252"><span class="linenos">1252</span></a>        <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;;&#39;</span><span class="p">:</span>
</span><span id="parse_parameter_list-1253"><a href="#parse_parameter_list-1253"><span class="linenos">1253</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_parameter_list-1254"><a href="#parse_parameter_list-1254"><span class="linenos">1254</span></a>            <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="parse_parameter_list-1255"><a href="#parse_parameter_list-1255"><span class="linenos">1255</span></a>                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># skip whitespace</span>
</span><span id="parse_parameter_list-1256"><a href="#parse_parameter_list-1256"><span class="linenos">1256</span></a>        <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="parse_parameter_list-1257"><a href="#parse_parameter_list-1257"><span class="linenos">1257</span></a>            <span class="k">break</span>
</span><span id="parse_parameter_list-1258"><a href="#parse_parameter_list-1258"><span class="linenos">1258</span></a>        <span class="n">parmname</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_token</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="parse_parameter_list-1259"><a href="#parse_parameter_list-1259"><span class="linenos">1259</span></a>        <span class="k">if</span> <span class="n">parmname</span><span class="p">:</span>
</span><span id="parse_parameter_list-1260"><a href="#parse_parameter_list-1260"><span class="linenos">1260</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="parse_parameter_list-1261"><a href="#parse_parameter_list-1261"><span class="linenos">1261</span></a>            <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="parse_parameter_list-1262"><a href="#parse_parameter_list-1262"><span class="linenos">1262</span></a>                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># skip whitespace</span>
</span><span id="parse_parameter_list-1263"><a href="#parse_parameter_list-1263"><span class="linenos">1263</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;=&#39;</span><span class="p">):</span>
</span><span id="parse_parameter_list-1264"><a href="#parse_parameter_list-1264"><span class="linenos">1264</span></a>                <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Expected an &quot;=&quot; after parameter name&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="parse_parameter_list-1265"><a href="#parse_parameter_list-1265"><span class="linenos">1265</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="parse_parameter_list-1266"><a href="#parse_parameter_list-1266"><span class="linenos">1266</span></a>            <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LWS</span><span class="p">:</span>
</span><span id="parse_parameter_list-1267"><a href="#parse_parameter_list-1267"><span class="linenos">1267</span></a>                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># skip whitespace</span>
</span><span id="parse_parameter_list-1268"><a href="#parse_parameter_list-1268"><span class="linenos">1268</span></a>            <span class="n">parmval</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_token_or_quoted_string</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span> <span class="p">)</span>
</span><span id="parse_parameter_list-1269"><a href="#parse_parameter_list-1269"><span class="linenos">1269</span></a>            <span class="n">pos</span> <span class="o">+=</span> <span class="n">k</span>
</span><span id="parse_parameter_list-1270"><a href="#parse_parameter_list-1270"><span class="linenos">1270</span></a>            <span class="n">parmlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">parmname</span><span class="p">,</span> <span class="n">parmval</span><span class="p">)</span> <span class="p">)</span>
</span><span id="parse_parameter_list-1271"><a href="#parse_parameter_list-1271"><span class="linenos">1271</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="parse_parameter_list-1272"><a href="#parse_parameter_list-1272"><span class="linenos">1272</span></a>            <span class="k">break</span>
</span><span id="parse_parameter_list-1273"><a href="#parse_parameter_list-1273"><span class="linenos">1273</span></a>    <span class="k">return</span> <span class="n">parmlist</span><span class="p">,</span> <span class="n">pos</span> <span class="o">-</span> <span class="n">start</span>
</span></pre></div>


            <div class="docstring"><p>Parses a semicolon-separated 'parameter=value' list.</p>

<p>Returns a tuple (parmlist, chars_consumed), where parmlist
is a list of tuples (parm_name, parm_value).</p>

<p>The parameter values will be unquoted and unescaped as needed.</p>

<p>Empty parameters (as in ";;") are skipped, as is insignificant
white space.  The list returned is kept in the same order as the
parameters appear in the string.</p>
</div>


                </section>
                <section id="content_type">
                            <input id="content_type-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">content_type</span>:

                <label class="view-source-button" for="content_type-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#content_type"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="content_type-1276"><a href="#content_type-1276"><span class="linenos">1276</span></a><span class="k">class</span> <span class="nc">content_type</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="content_type-1277"><a href="#content_type-1277"><span class="linenos">1277</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class represents a media type (aka a MIME content type), including parameters.</span>
</span><span id="content_type-1278"><a href="#content_type-1278"><span class="linenos">1278</span></a>
</span><span id="content_type-1279"><a href="#content_type-1279"><span class="linenos">1279</span></a><span class="sd">    You initialize these by passing in a content-type declaration</span>
</span><span id="content_type-1280"><a href="#content_type-1280"><span class="linenos">1280</span></a><span class="sd">    string, such as &quot;text/plain; charset=ascii&quot;, to the constructor or</span>
</span><span id="content_type-1281"><a href="#content_type-1281"><span class="linenos">1281</span></a><span class="sd">    to the set() method.  If you provide no string value, the object</span>
</span><span id="content_type-1282"><a href="#content_type-1282"><span class="linenos">1282</span></a><span class="sd">    returned will represent the wildcard */* content type.</span>
</span><span id="content_type-1283"><a href="#content_type-1283"><span class="linenos">1283</span></a>
</span><span id="content_type-1284"><a href="#content_type-1284"><span class="linenos">1284</span></a><span class="sd">    Normally you will get the value back by using str(), or optionally</span>
</span><span id="content_type-1285"><a href="#content_type-1285"><span class="linenos">1285</span></a><span class="sd">    you can access the components via the &#39;major&#39;, &#39;minor&#39;, &#39;media_type&#39;,</span>
</span><span id="content_type-1286"><a href="#content_type-1286"><span class="linenos">1286</span></a><span class="sd">    or &#39;parmdict&#39; members.</span>
</span><span id="content_type-1287"><a href="#content_type-1287"><span class="linenos">1287</span></a>
</span><span id="content_type-1288"><a href="#content_type-1288"><span class="linenos">1288</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="content_type-1289"><a href="#content_type-1289"><span class="linenos">1289</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content_type_string</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">with_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="content_type-1290"><a href="#content_type-1290"><span class="linenos">1290</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new content_type object.</span>
</span><span id="content_type-1291"><a href="#content_type-1291"><span class="linenos">1291</span></a>
</span><span id="content_type-1292"><a href="#content_type-1292"><span class="linenos">1292</span></a><span class="sd">        See the set() method for a description of the arguments.</span>
</span><span id="content_type-1293"><a href="#content_type-1293"><span class="linenos">1293</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="content_type-1294"><a href="#content_type-1294"><span class="linenos">1294</span></a>        <span class="k">if</span> <span class="n">content_type_string</span><span class="p">:</span>
</span><span id="content_type-1295"><a href="#content_type-1295"><span class="linenos">1295</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span> <span class="n">content_type_string</span><span class="p">,</span> <span class="n">with_parameters</span><span class="o">=</span><span class="n">with_parameters</span> <span class="p">)</span>
</span><span id="content_type-1296"><a href="#content_type-1296"><span class="linenos">1296</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="content_type-1297"><a href="#content_type-1297"><span class="linenos">1297</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span> <span class="s1">&#39;*/*&#39;</span> <span class="p">)</span>
</span><span id="content_type-1298"><a href="#content_type-1298"><span class="linenos">1298</span></a>
</span><span id="content_type-1299"><a href="#content_type-1299"><span class="linenos">1299</span></a>    <span class="k">def</span> <span class="nf">set_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter_list_or_dict</span><span class="p">):</span>
</span><span id="content_type-1300"><a href="#content_type-1300"><span class="linenos">1300</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the optional paramters based upon the parameter list.</span>
</span><span id="content_type-1301"><a href="#content_type-1301"><span class="linenos">1301</span></a>
</span><span id="content_type-1302"><a href="#content_type-1302"><span class="linenos">1302</span></a><span class="sd">        The paramter list should be a semicolon-separated name=value string.</span>
</span><span id="content_type-1303"><a href="#content_type-1303"><span class="linenos">1303</span></a><span class="sd">        Any paramters which already exist on this object will be deleted,</span>
</span><span id="content_type-1304"><a href="#content_type-1304"><span class="linenos">1304</span></a><span class="sd">        unless they appear in the given paramter_list.</span>
</span><span id="content_type-1305"><a href="#content_type-1305"><span class="linenos">1305</span></a>
</span><span id="content_type-1306"><a href="#content_type-1306"><span class="linenos">1306</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="content_type-1307"><a href="#content_type-1307"><span class="linenos">1307</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">parameter_list_or_dict</span><span class="p">,</span> <span class="s1">&#39;has_key&#39;</span><span class="p">):</span>
</span><span id="content_type-1308"><a href="#content_type-1308"><span class="linenos">1308</span></a>            <span class="c1"># already a dictionary</span>
</span><span id="content_type-1309"><a href="#content_type-1309"><span class="linenos">1309</span></a>            <span class="n">pl</span> <span class="o">=</span> <span class="n">parameter_list_or_dict</span>
</span><span id="content_type-1310"><a href="#content_type-1310"><span class="linenos">1310</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="content_type-1311"><a href="#content_type-1311"><span class="linenos">1311</span></a>            <span class="n">pl</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_parameter_list</span><span class="p">(</span><span class="n">parameter_list</span><span class="p">)</span>
</span><span id="content_type-1312"><a href="#content_type-1312"><span class="linenos">1312</span></a>            <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameter_list</span><span class="p">):</span>
</span><span id="content_type-1313"><a href="#content_type-1313"><span class="linenos">1313</span></a>                <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Invalid parameter list&#39;</span><span class="p">,</span><span class="n">paramter_list</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
</span><span id="content_type-1314"><a href="#content_type-1314"><span class="linenos">1314</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parmdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span>
</span><span id="content_type-1315"><a href="#content_type-1315"><span class="linenos">1315</span></a>
</span><span id="content_type-1316"><a href="#content_type-1316"><span class="linenos">1316</span></a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content_type_string</span><span class="p">,</span> <span class="n">with_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="content_type-1317"><a href="#content_type-1317"><span class="linenos">1317</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Parses the content type string and sets this object to it&#39;s value.</span>
</span><span id="content_type-1318"><a href="#content_type-1318"><span class="linenos">1318</span></a>
</span><span id="content_type-1319"><a href="#content_type-1319"><span class="linenos">1319</span></a><span class="sd">        For a more complete description of the arguments, see the</span>
</span><span id="content_type-1320"><a href="#content_type-1320"><span class="linenos">1320</span></a><span class="sd">        documentation for the parse_media_type() function in this module.</span>
</span><span id="content_type-1321"><a href="#content_type-1321"><span class="linenos">1321</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="content_type-1322"><a href="#content_type-1322"><span class="linenos">1322</span></a>        <span class="n">mt</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_media_type</span><span class="p">(</span> <span class="n">content_type_string</span><span class="p">,</span> <span class="n">with_parameters</span><span class="o">=</span><span class="n">with_parameters</span> <span class="p">)</span>
</span><span id="content_type-1323"><a href="#content_type-1323"><span class="linenos">1323</span></a>        <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">content_type_string</span><span class="p">):</span>
</span><span id="content_type-1324"><a href="#content_type-1324"><span class="linenos">1324</span></a>            <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Not a valid content type&#39;</span><span class="p">,</span><span class="n">content_type_string</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</span><span id="content_type-1325"><a href="#content_type-1325"><span class="linenos">1325</span></a>        <span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">pdict</span> <span class="o">=</span> <span class="n">mt</span>
</span><span id="content_type-1326"><a href="#content_type-1326"><span class="linenos">1326</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_major</span><span class="p">(</span> <span class="n">major</span> <span class="p">)</span>
</span><span id="content_type-1327"><a href="#content_type-1327"><span class="linenos">1327</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_minor</span><span class="p">(</span> <span class="n">minor</span> <span class="p">)</span>
</span><span id="content_type-1328"><a href="#content_type-1328"><span class="linenos">1328</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parmdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pdict</span><span class="p">)</span>
</span><span id="content_type-1329"><a href="#content_type-1329"><span class="linenos">1329</span></a>        
</span><span id="content_type-1330"><a href="#content_type-1330"><span class="linenos">1330</span></a>    <span class="k">def</span> <span class="nf">_get_major</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="content_type-1331"><a href="#content_type-1331"><span class="linenos">1331</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_major</span>
</span><span id="content_type-1332"><a href="#content_type-1332"><span class="linenos">1332</span></a>    <span class="k">def</span> <span class="nf">_set_major</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
</span><span id="content_type-1333"><a href="#content_type-1333"><span class="linenos">1333</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="c1"># case-insentive</span>
</span><span id="content_type-1334"><a href="#content_type-1334"><span class="linenos">1334</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_token</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="content_type-1335"><a href="#content_type-1335"><span class="linenos">1335</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Major media type contains an invalid character&#39;</span><span class="p">)</span>
</span><span id="content_type-1336"><a href="#content_type-1336"><span class="linenos">1336</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_major</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="content_type-1337"><a href="#content_type-1337"><span class="linenos">1337</span></a>
</span><span id="content_type-1338"><a href="#content_type-1338"><span class="linenos">1338</span></a>    <span class="k">def</span> <span class="nf">_get_minor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="content_type-1339"><a href="#content_type-1339"><span class="linenos">1339</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minor</span>
</span><span id="content_type-1340"><a href="#content_type-1340"><span class="linenos">1340</span></a>    <span class="k">def</span> <span class="nf">_set_minor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
</span><span id="content_type-1341"><a href="#content_type-1341"><span class="linenos">1341</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="c1"># case-insentive</span>
</span><span id="content_type-1342"><a href="#content_type-1342"><span class="linenos">1342</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_token</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="content_type-1343"><a href="#content_type-1343"><span class="linenos">1343</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Minor media type contains an invalid character&#39;</span><span class="p">)</span>
</span><span id="content_type-1344"><a href="#content_type-1344"><span class="linenos">1344</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_minor</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="content_type-1345"><a href="#content_type-1345"><span class="linenos">1345</span></a>
</span><span id="content_type-1346"><a href="#content_type-1346"><span class="linenos">1346</span></a>    <span class="n">major</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_major</span><span class="p">,</span><span class="n">_set_major</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Major media classification&quot;</span><span class="p">)</span>
</span><span id="content_type-1347"><a href="#content_type-1347"><span class="linenos">1347</span></a>    <span class="n">minor</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_minor</span><span class="p">,</span><span class="n">_set_minor</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Minor media sub-classification&quot;</span><span class="p">)</span>
</span><span id="content_type-1348"><a href="#content_type-1348"><span class="linenos">1348</span></a>
</span><span id="content_type-1349"><a href="#content_type-1349"><span class="linenos">1349</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="content_type-1350"><a href="#content_type-1350"><span class="linenos">1350</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;String value.&quot;&quot;&quot;</span>
</span><span id="content_type-1351"><a href="#content_type-1351"><span class="linenos">1351</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">major</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span><span class="p">)</span>
</span><span id="content_type-1352"><a href="#content_type-1352"><span class="linenos">1352</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmdict</span><span class="p">:</span>
</span><span id="content_type-1353"><a href="#content_type-1353"><span class="linenos">1353</span></a>            <span class="n">extra</span> <span class="o">=</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">quote_string</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="kc">False</span><span class="p">))</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmdict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</span><span id="content_type-1354"><a href="#content_type-1354"><span class="linenos">1354</span></a>            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;; &#39;</span> <span class="o">+</span> <span class="n">extra</span>
</span><span id="content_type-1355"><a href="#content_type-1355"><span class="linenos">1355</span></a>        <span class="k">return</span> <span class="n">s</span>
</span><span id="content_type-1356"><a href="#content_type-1356"><span class="linenos">1356</span></a>
</span><span id="content_type-1357"><a href="#content_type-1357"><span class="linenos">1357</span></a>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="content_type-1358"><a href="#content_type-1358"><span class="linenos">1358</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unicode string value.&quot;&quot;&quot;</span>
</span><span id="content_type-1359"><a href="#content_type-1359"><span class="linenos">1359</span></a>        <span class="c1"># In Python 3 this is probably unnecessary in general, this is just to avoid possible syntax issues. I.H.</span>
</span><span id="content_type-1360"><a href="#content_type-1360"><span class="linenos">1360</span></a>        <span class="k">if</span> <span class="n">PY3</span> <span class="p">:</span>
</span><span id="content_type-1361"><a href="#content_type-1361"><span class="linenos">1361</span></a>            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span><span id="content_type-1362"><a href="#content_type-1362"><span class="linenos">1362</span></a>        <span class="k">else</span> <span class="p">:</span>
</span><span id="content_type-1363"><a href="#content_type-1363"><span class="linenos">1363</span></a>            <span class="k">return</span> <span class="n">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span><span id="content_type-1364"><a href="#content_type-1364"><span class="linenos">1364</span></a>
</span><span id="content_type-1365"><a href="#content_type-1365"><span class="linenos">1365</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="content_type-1366"><a href="#content_type-1366"><span class="linenos">1366</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Python representation of this object.&quot;&quot;&quot;</span>
</span><span id="content_type-1367"><a href="#content_type-1367"><span class="linenos">1367</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()))</span>
</span><span id="content_type-1368"><a href="#content_type-1368"><span class="linenos">1368</span></a>        <span class="k">return</span> <span class="n">s</span>
</span><span id="content_type-1369"><a href="#content_type-1369"><span class="linenos">1369</span></a>
</span><span id="content_type-1370"><a href="#content_type-1370"><span class="linenos">1370</span></a>
</span><span id="content_type-1371"><a href="#content_type-1371"><span class="linenos">1371</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="content_type-1372"><a href="#content_type-1372"><span class="linenos">1372</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Hash this object; the hash is dependent only upon the value.&quot;&quot;&quot;</span>
</span><span id="content_type-1373"><a href="#content_type-1373"><span class="linenos">1373</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span><span id="content_type-1374"><a href="#content_type-1374"><span class="linenos">1374</span></a>
</span><span id="content_type-1375"><a href="#content_type-1375"><span class="linenos">1375</span></a>    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="content_type-1376"><a href="#content_type-1376"><span class="linenos">1376</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pickler&quot;&quot;&quot;</span>
</span><span id="content_type-1377"><a href="#content_type-1377"><span class="linenos">1377</span></a>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="content_type-1378"><a href="#content_type-1378"><span class="linenos">1378</span></a>
</span><span id="content_type-1379"><a href="#content_type-1379"><span class="linenos">1379</span></a>    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
</span><span id="content_type-1380"><a href="#content_type-1380"><span class="linenos">1380</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpickler&quot;&quot;&quot;</span>
</span><span id="content_type-1381"><a href="#content_type-1381"><span class="linenos">1381</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span><span id="content_type-1382"><a href="#content_type-1382"><span class="linenos">1382</span></a>
</span><span id="content_type-1383"><a href="#content_type-1383"><span class="linenos">1383</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="content_type-1384"><a href="#content_type-1384"><span class="linenos">1384</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Logical length of this media type.</span>
</span><span id="content_type-1385"><a href="#content_type-1385"><span class="linenos">1385</span></a><span class="sd">        For example:</span>
</span><span id="content_type-1386"><a href="#content_type-1386"><span class="linenos">1386</span></a><span class="sd">           len(&#39;*/*&#39;)  -&gt; 0</span>
</span><span id="content_type-1387"><a href="#content_type-1387"><span class="linenos">1387</span></a><span class="sd">           len(&#39;image/*&#39;) -&gt; 1</span>
</span><span id="content_type-1388"><a href="#content_type-1388"><span class="linenos">1388</span></a><span class="sd">           len(&#39;image/png&#39;) -&gt; 2</span>
</span><span id="content_type-1389"><a href="#content_type-1389"><span class="linenos">1389</span></a><span class="sd">           len(&#39;text/plain; charset=utf-8&#39;)  -&gt; 3</span>
</span><span id="content_type-1390"><a href="#content_type-1390"><span class="linenos">1390</span></a><span class="sd">           len(&#39;text/plain; charset=utf-8; filename=xyz.txt&#39;) -&gt; 4</span>
</span><span id="content_type-1391"><a href="#content_type-1391"><span class="linenos">1391</span></a>
</span><span id="content_type-1392"><a href="#content_type-1392"><span class="linenos">1392</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="content_type-1393"><a href="#content_type-1393"><span class="linenos">1393</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
</span><span id="content_type-1394"><a href="#content_type-1394"><span class="linenos">1394</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="content_type-1395"><a href="#content_type-1395"><span class="linenos">1395</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
</span><span id="content_type-1396"><a href="#content_type-1396"><span class="linenos">1396</span></a>            <span class="k">return</span> <span class="mi">1</span>
</span><span id="content_type-1397"><a href="#content_type-1397"><span class="linenos">1397</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="content_type-1398"><a href="#content_type-1398"><span class="linenos">1398</span></a>            <span class="k">return</span> <span class="mi">2</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parmdict</span><span class="p">)</span>
</span><span id="content_type-1399"><a href="#content_type-1399"><span class="linenos">1399</span></a>
</span><span id="content_type-1400"><a href="#content_type-1400"><span class="linenos">1400</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="content_type-1401"><a href="#content_type-1401"><span class="linenos">1401</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Equality test.</span>
</span><span id="content_type-1402"><a href="#content_type-1402"><span class="linenos">1402</span></a>
</span><span id="content_type-1403"><a href="#content_type-1403"><span class="linenos">1403</span></a><span class="sd">        Note that this is an exact match, including any parameters if any.</span>
</span><span id="content_type-1404"><a href="#content_type-1404"><span class="linenos">1404</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="content_type-1405"><a href="#content_type-1405"><span class="linenos">1405</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">major</span> <span class="ow">and</span> \
</span><span id="content_type-1406"><a href="#content_type-1406"><span class="linenos">1406</span></a>                   <span class="bp">self</span><span class="o">.</span><span class="n">minor</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">minor</span> <span class="ow">and</span> \
</span><span id="content_type-1407"><a href="#content_type-1407"><span class="linenos">1407</span></a>                   <span class="bp">self</span><span class="o">.</span><span class="n">parmdict</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">parmdict</span>
</span><span id="content_type-1408"><a href="#content_type-1408"><span class="linenos">1408</span></a>
</span><span id="content_type-1409"><a href="#content_type-1409"><span class="linenos">1409</span></a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="content_type-1410"><a href="#content_type-1410"><span class="linenos">1410</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Inequality test.&quot;&quot;&quot;</span>
</span><span id="content_type-1411"><a href="#content_type-1411"><span class="linenos">1411</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="content_type-1412"><a href="#content_type-1412"><span class="linenos">1412</span></a>            
</span><span id="content_type-1413"><a href="#content_type-1413"><span class="linenos">1413</span></a>    <span class="k">def</span> <span class="nf">_get_media_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="content_type-1414"><a href="#content_type-1414"><span class="linenos">1414</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the media &#39;type/subtype&#39; string, without parameters.&quot;&quot;&quot;</span>
</span><span id="content_type-1415"><a href="#content_type-1415"><span class="linenos">1415</span></a>        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">major</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span><span class="p">)</span>
</span><span id="content_type-1416"><a href="#content_type-1416"><span class="linenos">1416</span></a>
</span><span id="content_type-1417"><a href="#content_type-1417"><span class="linenos">1417</span></a>    <span class="n">media_type</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_media_type</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Returns the just the media type &#39;type/subtype&#39; without any paramters (read-only).&quot;</span><span class="p">)</span>
</span><span id="content_type-1418"><a href="#content_type-1418"><span class="linenos">1418</span></a>
</span><span id="content_type-1419"><a href="#content_type-1419"><span class="linenos">1419</span></a>    <span class="k">def</span> <span class="nf">is_wildcard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="content_type-1420"><a href="#content_type-1420"><span class="linenos">1420</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if this is a &#39;something/*&#39; media type.</span>
</span><span id="content_type-1421"><a href="#content_type-1421"><span class="linenos">1421</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="content_type-1422"><a href="#content_type-1422"><span class="linenos">1422</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span>
</span><span id="content_type-1423"><a href="#content_type-1423"><span class="linenos">1423</span></a>
</span><span id="content_type-1424"><a href="#content_type-1424"><span class="linenos">1424</span></a>    <span class="k">def</span> <span class="nf">is_universal_wildcard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="content_type-1425"><a href="#content_type-1425"><span class="linenos">1425</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if this is the unspecified &#39;*/*&#39; media type.</span>
</span><span id="content_type-1426"><a href="#content_type-1426"><span class="linenos">1426</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="content_type-1427"><a href="#content_type-1427"><span class="linenos">1427</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span>
</span><span id="content_type-1428"><a href="#content_type-1428"><span class="linenos">1428</span></a>
</span><span id="content_type-1429"><a href="#content_type-1429"><span class="linenos">1429</span></a>    <span class="k">def</span> <span class="nf">is_composite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="content_type-1430"><a href="#content_type-1430"><span class="linenos">1430</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Is this media type composed of multiple parts.</span>
</span><span id="content_type-1431"><a href="#content_type-1431"><span class="linenos">1431</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="content_type-1432"><a href="#content_type-1432"><span class="linenos">1432</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="o">==</span> <span class="s1">&#39;multipart&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="o">==</span> <span class="s1">&#39;message&#39;</span>
</span><span id="content_type-1433"><a href="#content_type-1433"><span class="linenos">1433</span></a>
</span><span id="content_type-1434"><a href="#content_type-1434"><span class="linenos">1434</span></a>    <span class="k">def</span> <span class="nf">is_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="content_type-1435"><a href="#content_type-1435"><span class="linenos">1435</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if this media type is XML-based.</span>
</span><span id="content_type-1436"><a href="#content_type-1436"><span class="linenos">1436</span></a>
</span><span id="content_type-1437"><a href="#content_type-1437"><span class="linenos">1437</span></a><span class="sd">        Note this does not consider text/html to be XML, but</span>
</span><span id="content_type-1438"><a href="#content_type-1438"><span class="linenos">1438</span></a><span class="sd">        application/xhtml+xml is.</span>
</span><span id="content_type-1439"><a href="#content_type-1439"><span class="linenos">1439</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="content_type-1440"><a href="#content_type-1440"><span class="linenos">1440</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span> <span class="o">==</span> <span class="s1">&#39;xml&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;+xml&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This class represents a media type (aka a MIME content type), including parameters.</p>

<p>You initialize these by passing in a content-type declaration
string, such as "text/plain; charset=ascii", to the constructor or
to the set() method.  If you provide no string value, the object
returned will represent the wildcard <em>/</em> content type.</p>

<p>Normally you will get the value back by using str(), or optionally
you can access the components via the 'major', 'minor', 'media_type',
or 'parmdict' members.</p>
</div>


                            <div id="content_type.__init__" class="classattr">
                                        <input id="content_type.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">content_type</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">content_type_string</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">with_parameters</span><span class="o">=</span><span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="content_type.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#content_type.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="content_type.__init__-1289"><a href="#content_type.__init__-1289"><span class="linenos">1289</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content_type_string</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">with_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="content_type.__init__-1290"><a href="#content_type.__init__-1290"><span class="linenos">1290</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new content_type object.</span>
</span><span id="content_type.__init__-1291"><a href="#content_type.__init__-1291"><span class="linenos">1291</span></a>
</span><span id="content_type.__init__-1292"><a href="#content_type.__init__-1292"><span class="linenos">1292</span></a><span class="sd">        See the set() method for a description of the arguments.</span>
</span><span id="content_type.__init__-1293"><a href="#content_type.__init__-1293"><span class="linenos">1293</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="content_type.__init__-1294"><a href="#content_type.__init__-1294"><span class="linenos">1294</span></a>        <span class="k">if</span> <span class="n">content_type_string</span><span class="p">:</span>
</span><span id="content_type.__init__-1295"><a href="#content_type.__init__-1295"><span class="linenos">1295</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span> <span class="n">content_type_string</span><span class="p">,</span> <span class="n">with_parameters</span><span class="o">=</span><span class="n">with_parameters</span> <span class="p">)</span>
</span><span id="content_type.__init__-1296"><a href="#content_type.__init__-1296"><span class="linenos">1296</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="content_type.__init__-1297"><a href="#content_type.__init__-1297"><span class="linenos">1297</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span> <span class="s1">&#39;*/*&#39;</span> <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a new content_type object.</p>

<p>See the set() method for a description of the arguments.</p>
</div>


                            </div>
                            <div id="content_type.set_parameters" class="classattr">
                                        <input id="content_type.set_parameters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_parameters</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">parameter_list_or_dict</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="content_type.set_parameters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#content_type.set_parameters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="content_type.set_parameters-1299"><a href="#content_type.set_parameters-1299"><span class="linenos">1299</span></a>    <span class="k">def</span> <span class="nf">set_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter_list_or_dict</span><span class="p">):</span>
</span><span id="content_type.set_parameters-1300"><a href="#content_type.set_parameters-1300"><span class="linenos">1300</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the optional paramters based upon the parameter list.</span>
</span><span id="content_type.set_parameters-1301"><a href="#content_type.set_parameters-1301"><span class="linenos">1301</span></a>
</span><span id="content_type.set_parameters-1302"><a href="#content_type.set_parameters-1302"><span class="linenos">1302</span></a><span class="sd">        The paramter list should be a semicolon-separated name=value string.</span>
</span><span id="content_type.set_parameters-1303"><a href="#content_type.set_parameters-1303"><span class="linenos">1303</span></a><span class="sd">        Any paramters which already exist on this object will be deleted,</span>
</span><span id="content_type.set_parameters-1304"><a href="#content_type.set_parameters-1304"><span class="linenos">1304</span></a><span class="sd">        unless they appear in the given paramter_list.</span>
</span><span id="content_type.set_parameters-1305"><a href="#content_type.set_parameters-1305"><span class="linenos">1305</span></a>
</span><span id="content_type.set_parameters-1306"><a href="#content_type.set_parameters-1306"><span class="linenos">1306</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="content_type.set_parameters-1307"><a href="#content_type.set_parameters-1307"><span class="linenos">1307</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">parameter_list_or_dict</span><span class="p">,</span> <span class="s1">&#39;has_key&#39;</span><span class="p">):</span>
</span><span id="content_type.set_parameters-1308"><a href="#content_type.set_parameters-1308"><span class="linenos">1308</span></a>            <span class="c1"># already a dictionary</span>
</span><span id="content_type.set_parameters-1309"><a href="#content_type.set_parameters-1309"><span class="linenos">1309</span></a>            <span class="n">pl</span> <span class="o">=</span> <span class="n">parameter_list_or_dict</span>
</span><span id="content_type.set_parameters-1310"><a href="#content_type.set_parameters-1310"><span class="linenos">1310</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="content_type.set_parameters-1311"><a href="#content_type.set_parameters-1311"><span class="linenos">1311</span></a>            <span class="n">pl</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_parameter_list</span><span class="p">(</span><span class="n">parameter_list</span><span class="p">)</span>
</span><span id="content_type.set_parameters-1312"><a href="#content_type.set_parameters-1312"><span class="linenos">1312</span></a>            <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameter_list</span><span class="p">):</span>
</span><span id="content_type.set_parameters-1313"><a href="#content_type.set_parameters-1313"><span class="linenos">1313</span></a>                <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Invalid parameter list&#39;</span><span class="p">,</span><span class="n">paramter_list</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
</span><span id="content_type.set_parameters-1314"><a href="#content_type.set_parameters-1314"><span class="linenos">1314</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parmdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sets the optional paramters based upon the parameter list.</p>

<p>The paramter list should be a semicolon-separated name=value string.
Any paramters which already exist on this object will be deleted,
unless they appear in the given paramter_list.</p>
</div>


                            </div>
                            <div id="content_type.set" class="classattr">
                                        <input id="content_type.set-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">content_type_string</span>, </span><span class="param"><span class="n">with_parameters</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="content_type.set-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#content_type.set"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="content_type.set-1316"><a href="#content_type.set-1316"><span class="linenos">1316</span></a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content_type_string</span><span class="p">,</span> <span class="n">with_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="content_type.set-1317"><a href="#content_type.set-1317"><span class="linenos">1317</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Parses the content type string and sets this object to it&#39;s value.</span>
</span><span id="content_type.set-1318"><a href="#content_type.set-1318"><span class="linenos">1318</span></a>
</span><span id="content_type.set-1319"><a href="#content_type.set-1319"><span class="linenos">1319</span></a><span class="sd">        For a more complete description of the arguments, see the</span>
</span><span id="content_type.set-1320"><a href="#content_type.set-1320"><span class="linenos">1320</span></a><span class="sd">        documentation for the parse_media_type() function in this module.</span>
</span><span id="content_type.set-1321"><a href="#content_type.set-1321"><span class="linenos">1321</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="content_type.set-1322"><a href="#content_type.set-1322"><span class="linenos">1322</span></a>        <span class="n">mt</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_media_type</span><span class="p">(</span> <span class="n">content_type_string</span><span class="p">,</span> <span class="n">with_parameters</span><span class="o">=</span><span class="n">with_parameters</span> <span class="p">)</span>
</span><span id="content_type.set-1323"><a href="#content_type.set-1323"><span class="linenos">1323</span></a>        <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">content_type_string</span><span class="p">):</span>
</span><span id="content_type.set-1324"><a href="#content_type.set-1324"><span class="linenos">1324</span></a>            <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Not a valid content type&#39;</span><span class="p">,</span><span class="n">content_type_string</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</span><span id="content_type.set-1325"><a href="#content_type.set-1325"><span class="linenos">1325</span></a>        <span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">pdict</span> <span class="o">=</span> <span class="n">mt</span>
</span><span id="content_type.set-1326"><a href="#content_type.set-1326"><span class="linenos">1326</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_major</span><span class="p">(</span> <span class="n">major</span> <span class="p">)</span>
</span><span id="content_type.set-1327"><a href="#content_type.set-1327"><span class="linenos">1327</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_minor</span><span class="p">(</span> <span class="n">minor</span> <span class="p">)</span>
</span><span id="content_type.set-1328"><a href="#content_type.set-1328"><span class="linenos">1328</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parmdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pdict</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Parses the content type string and sets this object to it's value.</p>

<p>For a more complete description of the arguments, see the
documentation for the parse_media_type() function in this module.</p>
</div>


                            </div>
                            <div id="content_type.major" class="classattr">
                                        <input id="content_type.major-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">major</span>

                <label class="view-source-button" for="content_type.major-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#content_type.major"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="content_type.major-1330"><a href="#content_type.major-1330"><span class="linenos">1330</span></a>    <span class="k">def</span> <span class="nf">_get_major</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="content_type.major-1331"><a href="#content_type.major-1331"><span class="linenos">1331</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_major</span>
</span></pre></div>


            <div class="docstring"><p>Major media classification</p>
</div>


                            </div>
                            <div id="content_type.minor" class="classattr">
                                        <input id="content_type.minor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">minor</span>

                <label class="view-source-button" for="content_type.minor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#content_type.minor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="content_type.minor-1338"><a href="#content_type.minor-1338"><span class="linenos">1338</span></a>    <span class="k">def</span> <span class="nf">_get_minor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="content_type.minor-1339"><a href="#content_type.minor-1339"><span class="linenos">1339</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minor</span>
</span></pre></div>


            <div class="docstring"><p>Minor media sub-classification</p>
</div>


                            </div>
                            <div id="content_type.media_type" class="classattr">
                                        <input id="content_type.media_type-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">media_type</span>

                <label class="view-source-button" for="content_type.media_type-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#content_type.media_type"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="content_type.media_type-1413"><a href="#content_type.media_type-1413"><span class="linenos">1413</span></a>    <span class="k">def</span> <span class="nf">_get_media_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="content_type.media_type-1414"><a href="#content_type.media_type-1414"><span class="linenos">1414</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the media &#39;type/subtype&#39; string, without parameters.&quot;&quot;&quot;</span>
</span><span id="content_type.media_type-1415"><a href="#content_type.media_type-1415"><span class="linenos">1415</span></a>        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">major</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns the media 'type/subtype' string, without parameters.</p>
</div>


                            </div>
                            <div id="content_type.is_wildcard" class="classattr">
                                        <input id="content_type.is_wildcard-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_wildcard</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="content_type.is_wildcard-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#content_type.is_wildcard"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="content_type.is_wildcard-1419"><a href="#content_type.is_wildcard-1419"><span class="linenos">1419</span></a>    <span class="k">def</span> <span class="nf">is_wildcard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="content_type.is_wildcard-1420"><a href="#content_type.is_wildcard-1420"><span class="linenos">1420</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if this is a &#39;something/*&#39; media type.</span>
</span><span id="content_type.is_wildcard-1421"><a href="#content_type.is_wildcard-1421"><span class="linenos">1421</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="content_type.is_wildcard-1422"><a href="#content_type.is_wildcard-1422"><span class="linenos">1422</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span>
</span></pre></div>


            <div class="docstring"><p>Returns True if this is a 'something/*' media type.</p>
</div>


                            </div>
                            <div id="content_type.is_universal_wildcard" class="classattr">
                                        <input id="content_type.is_universal_wildcard-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_universal_wildcard</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="content_type.is_universal_wildcard-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#content_type.is_universal_wildcard"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="content_type.is_universal_wildcard-1424"><a href="#content_type.is_universal_wildcard-1424"><span class="linenos">1424</span></a>    <span class="k">def</span> <span class="nf">is_universal_wildcard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="content_type.is_universal_wildcard-1425"><a href="#content_type.is_universal_wildcard-1425"><span class="linenos">1425</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if this is the unspecified &#39;*/*&#39; media type.</span>
</span><span id="content_type.is_universal_wildcard-1426"><a href="#content_type.is_universal_wildcard-1426"><span class="linenos">1426</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="content_type.is_universal_wildcard-1427"><a href="#content_type.is_universal_wildcard-1427"><span class="linenos">1427</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span>
</span></pre></div>


            <div class="docstring"><p>Returns True if this is the unspecified '<em>/</em>' media type.</p>
</div>


                            </div>
                            <div id="content_type.is_composite" class="classattr">
                                        <input id="content_type.is_composite-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_composite</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="content_type.is_composite-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#content_type.is_composite"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="content_type.is_composite-1429"><a href="#content_type.is_composite-1429"><span class="linenos">1429</span></a>    <span class="k">def</span> <span class="nf">is_composite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="content_type.is_composite-1430"><a href="#content_type.is_composite-1430"><span class="linenos">1430</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Is this media type composed of multiple parts.</span>
</span><span id="content_type.is_composite-1431"><a href="#content_type.is_composite-1431"><span class="linenos">1431</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="content_type.is_composite-1432"><a href="#content_type.is_composite-1432"><span class="linenos">1432</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="o">==</span> <span class="s1">&#39;multipart&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="o">==</span> <span class="s1">&#39;message&#39;</span>
</span></pre></div>


            <div class="docstring"><p>Is this media type composed of multiple parts.</p>
</div>


                            </div>
                            <div id="content_type.is_xml" class="classattr">
                                        <input id="content_type.is_xml-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_xml</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="content_type.is_xml-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#content_type.is_xml"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="content_type.is_xml-1434"><a href="#content_type.is_xml-1434"><span class="linenos">1434</span></a>    <span class="k">def</span> <span class="nf">is_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="content_type.is_xml-1435"><a href="#content_type.is_xml-1435"><span class="linenos">1435</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if this media type is XML-based.</span>
</span><span id="content_type.is_xml-1436"><a href="#content_type.is_xml-1436"><span class="linenos">1436</span></a>
</span><span id="content_type.is_xml-1437"><a href="#content_type.is_xml-1437"><span class="linenos">1437</span></a><span class="sd">        Note this does not consider text/html to be XML, but</span>
</span><span id="content_type.is_xml-1438"><a href="#content_type.is_xml-1438"><span class="linenos">1438</span></a><span class="sd">        application/xhtml+xml is.</span>
</span><span id="content_type.is_xml-1439"><a href="#content_type.is_xml-1439"><span class="linenos">1439</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="content_type.is_xml-1440"><a href="#content_type.is_xml-1440"><span class="linenos">1440</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span> <span class="o">==</span> <span class="s1">&#39;xml&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;+xml&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns True if this media type is XML-based.</p>

<p>Note this does not consider text/html to be XML, but
application/xhtml+xml is.</p>
</div>


                            </div>
                </section>
                <section id="content_formdata">
                    <div class="attr variable">
            <span class="name">content_formdata</span>        =
<span class="default_value">content_type(&#39;multipart/form-data&#39;)</span>

        
    </div>
    <a class="headerlink" href="#content_formdata"></a>
    
    

                </section>
                <section id="content_urlencoded">
                    <div class="attr variable">
            <span class="name">content_urlencoded</span>        =
<span class="default_value">content_type(&#39;application/x-www-form-urlencoded&#39;)</span>

        
    </div>
    <a class="headerlink" href="#content_urlencoded"></a>
    
    

                </section>
                <section id="content_byteranges">
                    <div class="attr variable">
            <span class="name">content_byteranges</span>        =
<span class="default_value">content_type(&#39;multipart/byteranges&#39;)</span>

        
    </div>
    <a class="headerlink" href="#content_byteranges"></a>
    
    

                </section>
                <section id="content_opaque">
                    <div class="attr variable">
            <span class="name">content_opaque</span>        =
<span class="default_value">content_type(&#39;application/octet-stream&#39;)</span>

        
    </div>
    <a class="headerlink" href="#content_opaque"></a>
    
    

                </section>
                <section id="content_html">
                    <div class="attr variable">
            <span class="name">content_html</span>        =
<span class="default_value">content_type(&#39;text/html&#39;)</span>

        
    </div>
    <a class="headerlink" href="#content_html"></a>
    
    

                </section>
                <section id="content_xhtml">
                    <div class="attr variable">
            <span class="name">content_xhtml</span>        =
<span class="default_value">content_type(&#39;application/xhtml+xml&#39;)</span>

        
    </div>
    <a class="headerlink" href="#content_xhtml"></a>
    
    

                </section>
                <section id="acceptable_content_type">
                            <input id="acceptable_content_type-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">acceptable_content_type</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">accept_header</span>, </span><span class="param"><span class="n">content_types</span>, </span><span class="param"><span class="n">ignore_wildcard</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="acceptable_content_type-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#acceptable_content_type"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="acceptable_content_type-1451"><a href="#acceptable_content_type-1451"><span class="linenos">1451</span></a><span class="k">def</span> <span class="nf">acceptable_content_type</span><span class="p">(</span> <span class="n">accept_header</span><span class="p">,</span> <span class="n">content_types</span><span class="p">,</span> <span class="n">ignore_wildcard</span><span class="o">=</span><span class="kc">True</span> <span class="p">):</span>
</span><span id="acceptable_content_type-1452"><a href="#acceptable_content_type-1452"><span class="linenos">1452</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Determines if the given content type is acceptable to the user agent.</span>
</span><span id="acceptable_content_type-1453"><a href="#acceptable_content_type-1453"><span class="linenos">1453</span></a>
</span><span id="acceptable_content_type-1454"><a href="#acceptable_content_type-1454"><span class="linenos">1454</span></a><span class="sd">    The accept_header should be the value present in the HTTP</span>
</span><span id="acceptable_content_type-1455"><a href="#acceptable_content_type-1455"><span class="linenos">1455</span></a><span class="sd">    &quot;Accept:&quot; header.  In mod_python this is typically obtained from</span>
</span><span id="acceptable_content_type-1456"><a href="#acceptable_content_type-1456"><span class="linenos">1456</span></a><span class="sd">    the req.http_headers_in table; in WSGI it is environ[&quot;Accept&quot;];</span>
</span><span id="acceptable_content_type-1457"><a href="#acceptable_content_type-1457"><span class="linenos">1457</span></a><span class="sd">    other web frameworks may provide other methods of obtaining it.</span>
</span><span id="acceptable_content_type-1458"><a href="#acceptable_content_type-1458"><span class="linenos">1458</span></a>
</span><span id="acceptable_content_type-1459"><a href="#acceptable_content_type-1459"><span class="linenos">1459</span></a><span class="sd">    Optionally the accept_header parameter can be pre-parsed, as</span>
</span><span id="acceptable_content_type-1460"><a href="#acceptable_content_type-1460"><span class="linenos">1460</span></a><span class="sd">    returned from the parse_accept_header() function in this module.</span>
</span><span id="acceptable_content_type-1461"><a href="#acceptable_content_type-1461"><span class="linenos">1461</span></a>
</span><span id="acceptable_content_type-1462"><a href="#acceptable_content_type-1462"><span class="linenos">1462</span></a><span class="sd">    The content_types argument should either be a single MIME media</span>
</span><span id="acceptable_content_type-1463"><a href="#acceptable_content_type-1463"><span class="linenos">1463</span></a><span class="sd">    type string, or a sequence of them.  It represents the set of</span>
</span><span id="acceptable_content_type-1464"><a href="#acceptable_content_type-1464"><span class="linenos">1464</span></a><span class="sd">    content types that the caller (server) is willing to send.</span>
</span><span id="acceptable_content_type-1465"><a href="#acceptable_content_type-1465"><span class="linenos">1465</span></a><span class="sd">    Generally, the server content_types should not contain any</span>
</span><span id="acceptable_content_type-1466"><a href="#acceptable_content_type-1466"><span class="linenos">1466</span></a><span class="sd">    wildcarded values.</span>
</span><span id="acceptable_content_type-1467"><a href="#acceptable_content_type-1467"><span class="linenos">1467</span></a>
</span><span id="acceptable_content_type-1468"><a href="#acceptable_content_type-1468"><span class="linenos">1468</span></a><span class="sd">    This function determines which content type which is the most</span>
</span><span id="acceptable_content_type-1469"><a href="#acceptable_content_type-1469"><span class="linenos">1469</span></a><span class="sd">    preferred and is acceptable to both the user agent and the server.</span>
</span><span id="acceptable_content_type-1470"><a href="#acceptable_content_type-1470"><span class="linenos">1470</span></a><span class="sd">    If one is negotiated it will return a four-valued tuple like:</span>
</span><span id="acceptable_content_type-1471"><a href="#acceptable_content_type-1471"><span class="linenos">1471</span></a>
</span><span id="acceptable_content_type-1472"><a href="#acceptable_content_type-1472"><span class="linenos">1472</span></a><span class="sd">        (server_content_type, ua_content_range, qvalue, accept_parms)</span>
</span><span id="acceptable_content_type-1473"><a href="#acceptable_content_type-1473"><span class="linenos">1473</span></a>
</span><span id="acceptable_content_type-1474"><a href="#acceptable_content_type-1474"><span class="linenos">1474</span></a><span class="sd">    The first tuple value is one of the server&#39;s content_types, while</span>
</span><span id="acceptable_content_type-1475"><a href="#acceptable_content_type-1475"><span class="linenos">1475</span></a><span class="sd">    the remaining tuple values descript which of the client&#39;s</span>
</span><span id="acceptable_content_type-1476"><a href="#acceptable_content_type-1476"><span class="linenos">1476</span></a><span class="sd">    acceptable content_types was matched.  In most cases accept_parms</span>
</span><span id="acceptable_content_type-1477"><a href="#acceptable_content_type-1477"><span class="linenos">1477</span></a><span class="sd">    will be an empty list (see description of parse_accept_header()</span>
</span><span id="acceptable_content_type-1478"><a href="#acceptable_content_type-1478"><span class="linenos">1478</span></a><span class="sd">    for more details).</span>
</span><span id="acceptable_content_type-1479"><a href="#acceptable_content_type-1479"><span class="linenos">1479</span></a>
</span><span id="acceptable_content_type-1480"><a href="#acceptable_content_type-1480"><span class="linenos">1480</span></a><span class="sd">    If no content type could be negotiated, then this function will</span>
</span><span id="acceptable_content_type-1481"><a href="#acceptable_content_type-1481"><span class="linenos">1481</span></a><span class="sd">    return None (and the caller should typically cause an HTTP 406 Not</span>
</span><span id="acceptable_content_type-1482"><a href="#acceptable_content_type-1482"><span class="linenos">1482</span></a><span class="sd">    Acceptable as a response).</span>
</span><span id="acceptable_content_type-1483"><a href="#acceptable_content_type-1483"><span class="linenos">1483</span></a>
</span><span id="acceptable_content_type-1484"><a href="#acceptable_content_type-1484"><span class="linenos">1484</span></a><span class="sd">    Note that the wildcarded content type &quot;*/*&quot; sent by the client</span>
</span><span id="acceptable_content_type-1485"><a href="#acceptable_content_type-1485"><span class="linenos">1485</span></a><span class="sd">    will be ignored, since it is often incorrectly sent by web</span>
</span><span id="acceptable_content_type-1486"><a href="#acceptable_content_type-1486"><span class="linenos">1486</span></a><span class="sd">    browsers that don&#39;t really mean it.  To override this, call with</span>
</span><span id="acceptable_content_type-1487"><a href="#acceptable_content_type-1487"><span class="linenos">1487</span></a><span class="sd">    ignore_wildcard=False.  Partial wildcards such as &quot;image/*&quot; will</span>
</span><span id="acceptable_content_type-1488"><a href="#acceptable_content_type-1488"><span class="linenos">1488</span></a><span class="sd">    always be processed, but be at a lower priority than a complete</span>
</span><span id="acceptable_content_type-1489"><a href="#acceptable_content_type-1489"><span class="linenos">1489</span></a><span class="sd">    matching type.</span>
</span><span id="acceptable_content_type-1490"><a href="#acceptable_content_type-1490"><span class="linenos">1490</span></a>
</span><span id="acceptable_content_type-1491"><a href="#acceptable_content_type-1491"><span class="linenos">1491</span></a><span class="sd">    See also: RFC 2616 section 14.1, and</span>
</span><span id="acceptable_content_type-1492"><a href="#acceptable_content_type-1492"><span class="linenos">1492</span></a><span class="sd">    &lt;http://www.iana.org/assignments/media-types/&gt;</span>
</span><span id="acceptable_content_type-1493"><a href="#acceptable_content_type-1493"><span class="linenos">1493</span></a>
</span><span id="acceptable_content_type-1494"><a href="#acceptable_content_type-1494"><span class="linenos">1494</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="acceptable_content_type-1495"><a href="#acceptable_content_type-1495"><span class="linenos">1495</span></a>    <span class="k">if</span> <span class="n">_is_string</span><span class="p">(</span><span class="n">accept_header</span><span class="p">):</span>
</span><span id="acceptable_content_type-1496"><a href="#acceptable_content_type-1496"><span class="linenos">1496</span></a>        <span class="n">accept_list</span> <span class="o">=</span> <span class="n">parse_accept_header</span><span class="p">(</span><span class="n">accept_header</span><span class="p">)</span>
</span><span id="acceptable_content_type-1497"><a href="#acceptable_content_type-1497"><span class="linenos">1497</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="acceptable_content_type-1498"><a href="#acceptable_content_type-1498"><span class="linenos">1498</span></a>        <span class="n">accept_list</span> <span class="o">=</span> <span class="n">accept_header</span>
</span><span id="acceptable_content_type-1499"><a href="#acceptable_content_type-1499"><span class="linenos">1499</span></a>
</span><span id="acceptable_content_type-1500"><a href="#acceptable_content_type-1500"><span class="linenos">1500</span></a>    <span class="k">if</span> <span class="n">_is_string</span><span class="p">(</span><span class="n">content_types</span><span class="p">):</span>
</span><span id="acceptable_content_type-1501"><a href="#acceptable_content_type-1501"><span class="linenos">1501</span></a>        <span class="n">content_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">content_types</span><span class="p">]</span>
</span><span id="acceptable_content_type-1502"><a href="#acceptable_content_type-1502"><span class="linenos">1502</span></a>
</span><span id="acceptable_content_type-1503"><a href="#acceptable_content_type-1503"><span class="linenos">1503</span></a>    <span class="n">server_ctlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">content_type</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span> <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">content_types</span><span class="p">]</span>
</span><span id="acceptable_content_type-1504"><a href="#acceptable_content_type-1504"><span class="linenos">1504</span></a>    <span class="k">del</span> <span class="n">ct</span>
</span><span id="acceptable_content_type-1505"><a href="#acceptable_content_type-1505"><span class="linenos">1505</span></a>
</span><span id="acceptable_content_type-1506"><a href="#acceptable_content_type-1506"><span class="linenos">1506</span></a>    <span class="c1">#print &#39;AC&#39;, repr(accept_list)</span>
</span><span id="acceptable_content_type-1507"><a href="#acceptable_content_type-1507"><span class="linenos">1507</span></a>    <span class="c1">#print &#39;SV&#39;, repr(server_ctlist)</span>
</span><span id="acceptable_content_type-1508"><a href="#acceptable_content_type-1508"><span class="linenos">1508</span></a>
</span><span id="acceptable_content_type-1509"><a href="#acceptable_content_type-1509"><span class="linenos">1509</span></a>    <span class="n">best</span> <span class="o">=</span> <span class="kc">None</span>   <span class="c1"># (content_type, qvalue, accept_parms, matchlen)</span>
</span><span id="acceptable_content_type-1510"><a href="#acceptable_content_type-1510"><span class="linenos">1510</span></a>
</span><span id="acceptable_content_type-1511"><a href="#acceptable_content_type-1511"><span class="linenos">1511</span></a>    <span class="k">for</span> <span class="n">server_ct</span> <span class="ow">in</span> <span class="n">server_ctlist</span><span class="p">:</span>
</span><span id="acceptable_content_type-1512"><a href="#acceptable_content_type-1512"><span class="linenos">1512</span></a>        <span class="n">best_for_this</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="acceptable_content_type-1513"><a href="#acceptable_content_type-1513"><span class="linenos">1513</span></a>        <span class="k">for</span> <span class="n">client_ct</span><span class="p">,</span> <span class="n">qvalue</span><span class="p">,</span> <span class="n">aargs</span> <span class="ow">in</span> <span class="n">accept_list</span><span class="p">:</span>
</span><span id="acceptable_content_type-1514"><a href="#acceptable_content_type-1514"><span class="linenos">1514</span></a>            <span class="k">if</span> <span class="n">ignore_wildcard</span> <span class="ow">and</span> <span class="n">client_ct</span><span class="o">.</span><span class="n">is_universal_wildcard</span><span class="p">():</span>
</span><span id="acceptable_content_type-1515"><a href="#acceptable_content_type-1515"><span class="linenos">1515</span></a>                <span class="k">continue</span>  <span class="c1"># */* being ignored</span>
</span><span id="acceptable_content_type-1516"><a href="#acceptable_content_type-1516"><span class="linenos">1516</span></a>
</span><span id="acceptable_content_type-1517"><a href="#acceptable_content_type-1517"><span class="linenos">1517</span></a>            <span class="n">matchlen</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># how specifically this one matches (0 is a non-match)</span>
</span><span id="acceptable_content_type-1518"><a href="#acceptable_content_type-1518"><span class="linenos">1518</span></a>            <span class="k">if</span> <span class="n">client_ct</span><span class="o">.</span><span class="n">is_universal_wildcard</span><span class="p">():</span>
</span><span id="acceptable_content_type-1519"><a href="#acceptable_content_type-1519"><span class="linenos">1519</span></a>                <span class="n">matchlen</span> <span class="o">=</span> <span class="mi">1</span>   <span class="c1"># */* is a 1</span>
</span><span id="acceptable_content_type-1520"><a href="#acceptable_content_type-1520"><span class="linenos">1520</span></a>            <span class="k">elif</span> <span class="n">client_ct</span><span class="o">.</span><span class="n">major</span> <span class="o">==</span> <span class="n">server_ct</span><span class="o">.</span><span class="n">major</span><span class="p">:</span>
</span><span id="acceptable_content_type-1521"><a href="#acceptable_content_type-1521"><span class="linenos">1521</span></a>                <span class="k">if</span> <span class="n">client_ct</span><span class="o">.</span><span class="n">minor</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>  <span class="c1"># something/* is a 2</span>
</span><span id="acceptable_content_type-1522"><a href="#acceptable_content_type-1522"><span class="linenos">1522</span></a>                    <span class="n">matchlen</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="acceptable_content_type-1523"><a href="#acceptable_content_type-1523"><span class="linenos">1523</span></a>                <span class="k">elif</span> <span class="n">client_ct</span><span class="o">.</span><span class="n">minor</span> <span class="o">==</span> <span class="n">server_ct</span><span class="o">.</span><span class="n">minor</span><span class="p">:</span> <span class="c1"># something/something is a 3</span>
</span><span id="acceptable_content_type-1524"><a href="#acceptable_content_type-1524"><span class="linenos">1524</span></a>                    <span class="n">matchlen</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="acceptable_content_type-1525"><a href="#acceptable_content_type-1525"><span class="linenos">1525</span></a>                    <span class="c1"># must make sure all the parms match too</span>
</span><span id="acceptable_content_type-1526"><a href="#acceptable_content_type-1526"><span class="linenos">1526</span></a>                    <span class="k">for</span> <span class="n">pname</span><span class="p">,</span> <span class="n">pval</span> <span class="ow">in</span> <span class="n">client_ct</span><span class="o">.</span><span class="n">parmdict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="acceptable_content_type-1527"><a href="#acceptable_content_type-1527"><span class="linenos">1527</span></a>                        <span class="n">sval</span> <span class="o">=</span> <span class="n">server_ct</span><span class="o">.</span><span class="n">parmdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pname</span><span class="p">)</span>
</span><span id="acceptable_content_type-1528"><a href="#acceptable_content_type-1528"><span class="linenos">1528</span></a>                        <span class="k">if</span> <span class="n">pname</span> <span class="o">==</span> <span class="s1">&#39;charset&#39;</span><span class="p">:</span>
</span><span id="acceptable_content_type-1529"><a href="#acceptable_content_type-1529"><span class="linenos">1529</span></a>                            <span class="c1"># special case for charset to match aliases</span>
</span><span id="acceptable_content_type-1530"><a href="#acceptable_content_type-1530"><span class="linenos">1530</span></a>                            <span class="n">pval</span> <span class="o">=</span> <span class="n">canonical_charset</span><span class="p">(</span><span class="n">pval</span><span class="p">)</span>
</span><span id="acceptable_content_type-1531"><a href="#acceptable_content_type-1531"><span class="linenos">1531</span></a>                            <span class="n">sval</span> <span class="o">=</span> <span class="n">canonical_charset</span><span class="p">(</span><span class="n">sval</span><span class="p">)</span>
</span><span id="acceptable_content_type-1532"><a href="#acceptable_content_type-1532"><span class="linenos">1532</span></a>                        <span class="k">if</span> <span class="n">sval</span> <span class="o">==</span> <span class="n">pval</span><span class="p">:</span>
</span><span id="acceptable_content_type-1533"><a href="#acceptable_content_type-1533"><span class="linenos">1533</span></a>                            <span class="n">matchlen</span> <span class="o">=</span> <span class="n">matchlen</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="acceptable_content_type-1534"><a href="#acceptable_content_type-1534"><span class="linenos">1534</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="acceptable_content_type-1535"><a href="#acceptable_content_type-1535"><span class="linenos">1535</span></a>                            <span class="n">matchlen</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="acceptable_content_type-1536"><a href="#acceptable_content_type-1536"><span class="linenos">1536</span></a>                            <span class="k">break</span>
</span><span id="acceptable_content_type-1537"><a href="#acceptable_content_type-1537"><span class="linenos">1537</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="acceptable_content_type-1538"><a href="#acceptable_content_type-1538"><span class="linenos">1538</span></a>                    <span class="n">matchlen</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="acceptable_content_type-1539"><a href="#acceptable_content_type-1539"><span class="linenos">1539</span></a>
</span><span id="acceptable_content_type-1540"><a href="#acceptable_content_type-1540"><span class="linenos">1540</span></a>            <span class="c1">#print &#39;S&#39;,server_ct,&#39;  C&#39;,client_ct,&#39;  M&#39;,matchlen,&#39;Q&#39;,qvalue</span>
</span><span id="acceptable_content_type-1541"><a href="#acceptable_content_type-1541"><span class="linenos">1541</span></a>            <span class="k">if</span> <span class="n">matchlen</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="acceptable_content_type-1542"><a href="#acceptable_content_type-1542"><span class="linenos">1542</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">best_for_this</span> \
</span><span id="acceptable_content_type-1543"><a href="#acceptable_content_type-1543"><span class="linenos">1543</span></a>                       <span class="ow">or</span> <span class="n">matchlen</span> <span class="o">&gt;</span> <span class="n">best_for_this</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> \
</span><span id="acceptable_content_type-1544"><a href="#acceptable_content_type-1544"><span class="linenos">1544</span></a>                       <span class="ow">or</span> <span class="p">(</span><span class="n">matchlen</span> <span class="o">==</span> <span class="n">best_for_this</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">qvalue</span> <span class="o">&gt;</span> <span class="n">best_for_this</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
</span><span id="acceptable_content_type-1545"><a href="#acceptable_content_type-1545"><span class="linenos">1545</span></a>                    <span class="c1"># This match is better</span>
</span><span id="acceptable_content_type-1546"><a href="#acceptable_content_type-1546"><span class="linenos">1546</span></a>                    <span class="n">best_for_this</span> <span class="o">=</span> <span class="p">(</span><span class="n">server_ct</span><span class="p">,</span> <span class="n">client_ct</span><span class="p">,</span> <span class="n">qvalue</span><span class="p">,</span> <span class="n">aargs</span><span class="p">,</span> <span class="n">matchlen</span><span class="p">)</span>
</span><span id="acceptable_content_type-1547"><a href="#acceptable_content_type-1547"><span class="linenos">1547</span></a>                    <span class="c1">#print &#39;BEST2 NOW&#39;, repr(best_for_this)</span>
</span><span id="acceptable_content_type-1548"><a href="#acceptable_content_type-1548"><span class="linenos">1548</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">best</span> <span class="ow">or</span> \
</span><span id="acceptable_content_type-1549"><a href="#acceptable_content_type-1549"><span class="linenos">1549</span></a>               <span class="p">(</span><span class="n">best_for_this</span> <span class="ow">and</span> <span class="n">best_for_this</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">best</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
</span><span id="acceptable_content_type-1550"><a href="#acceptable_content_type-1550"><span class="linenos">1550</span></a>            <span class="n">best</span> <span class="o">=</span> <span class="n">best_for_this</span>
</span><span id="acceptable_content_type-1551"><a href="#acceptable_content_type-1551"><span class="linenos">1551</span></a>            <span class="c1">#print &#39;BEST NOW&#39;, repr(best)</span>
</span><span id="acceptable_content_type-1552"><a href="#acceptable_content_type-1552"><span class="linenos">1552</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">best</span> <span class="ow">or</span> <span class="n">best</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="acceptable_content_type-1553"><a href="#acceptable_content_type-1553"><span class="linenos">1553</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="acceptable_content_type-1554"><a href="#acceptable_content_type-1554"><span class="linenos">1554</span></a>    <span class="k">return</span> <span class="n">best</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Determines if the given content type is acceptable to the user agent.</p>

<p>The accept_header should be the value present in the HTTP
"Accept:" header.  In mod_python this is typically obtained from
the req.http_headers_in table; in WSGI it is environ["Accept"];
other web frameworks may provide other methods of obtaining it.</p>

<p>Optionally the accept_header parameter can be pre-parsed, as
returned from the parse_accept_header() function in this module.</p>

<p>The content_types argument should either be a single MIME media
type string, or a sequence of them.  It represents the set of
content types that the caller (server) is willing to send.
Generally, the server content_types should not contain any
wildcarded values.</p>

<p>This function determines which content type which is the most
preferred and is acceptable to both the user agent and the server.
If one is negotiated it will return a four-valued tuple like:</p>

<pre><code>(server_content_type, ua_content_range, qvalue, accept_parms)
</code></pre>

<p>The first tuple value is one of the server's content_types, while
the remaining tuple values descript which of the client's
acceptable content_types was matched.  In most cases accept_parms
will be an empty list (see description of parse_accept_header()
for more details).</p>

<p>If no content type could be negotiated, then this function will
return None (and the caller should typically cause an HTTP 406 Not
Acceptable as a response).</p>

<p>Note that the wildcarded content type "<em>/</em>" sent by the client
will be ignored, since it is often incorrectly sent by web
browsers that don't really mean it.  To override this, call with
ignore_wildcard=False.  Partial wildcards such as "image/*" will
always be processed, but be at a lower priority than a complete
matching type.</p>

<p>See also: RFC 2616 section 14.1, and
<a href="http://www.iana.org/assignments/media-types/">http://www.iana.org/assignments/media-types/</a></p>
</div>


                </section>
                <section id="character_set_aliases">
                    <div class="attr variable">
            <span class="name">character_set_aliases</span>        =
<input id="character_set_aliases-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="character_set_aliases-view-value"></label><span class="default_value">{&#39;ASCII&#39;: &#39;US-ASCII&#39;, &#39;ISO646-US&#39;: &#39;US-ASCII&#39;, &#39;IBM367&#39;: &#39;US-ASCII&#39;, &#39;CP367&#39;: &#39;US-ASCII&#39;, &#39;CSASCII&#39;: &#39;US-ASCII&#39;, &#39;ANSI_X3.4-1968&#39;: &#39;US-ASCII&#39;, &#39;ISO_646.IRV:1991&#39;: &#39;US-ASCII&#39;, &#39;UTF7&#39;: &#39;UTF-7&#39;, &#39;UTF8&#39;: &#39;UTF-8&#39;, &#39;UTF16&#39;: &#39;UTF-16&#39;, &#39;UTF16LE&#39;: &#39;UTF-16LE&#39;, &#39;UTF16BE&#39;: &#39;UTF-16BE&#39;, &#39;UTF32&#39;: &#39;UTF-32&#39;, &#39;UTF32LE&#39;: &#39;UTF-32LE&#39;, &#39;UTF32BE&#39;: &#39;UTF-32BE&#39;, &#39;UCS2&#39;: &#39;ISO-10646-UCS-2&#39;, &#39;UCS_2&#39;: &#39;ISO-10646-UCS-2&#39;, &#39;UCS-2&#39;: &#39;ISO-10646-UCS-2&#39;, &#39;CSUNICODE&#39;: &#39;ISO-10646-UCS-2&#39;, &#39;UCS4&#39;: &#39;ISO-10646-UCS-4&#39;, &#39;UCS_4&#39;: &#39;ISO-10646-UCS-4&#39;, &#39;UCS-4&#39;: &#39;ISO-10646-UCS-4&#39;, &#39;CSUCS4&#39;: &#39;ISO-10646-UCS-4&#39;, &#39;ISO_8859-1&#39;: &#39;ISO-8859-1&#39;, &#39;LATIN1&#39;: &#39;ISO-8859-1&#39;, &#39;CP819&#39;: &#39;ISO-8859-1&#39;, &#39;IBM819&#39;: &#39;ISO-8859-1&#39;, &#39;ISO_8859-2&#39;: &#39;ISO-8859-2&#39;, &#39;LATIN2&#39;: &#39;ISO-8859-2&#39;, &#39;ISO_8859-3&#39;: &#39;ISO-8859-3&#39;, &#39;LATIN3&#39;: &#39;ISO-8859-3&#39;, &#39;ISO_8859-4&#39;: &#39;ISO-8859-4&#39;, &#39;LATIN4&#39;: &#39;ISO-8859-4&#39;, &#39;ISO_8859-5&#39;: &#39;ISO-8859-5&#39;, &#39;CYRILLIC&#39;: &#39;ISO-8859-5&#39;, &#39;ISO_8859-6&#39;: &#39;ISO-8859-6&#39;, &#39;ARABIC&#39;: &#39;ISO-8859-6&#39;, &#39;ECMA-114&#39;: &#39;ISO-8859-6&#39;, &#39;ISO_8859-6-E&#39;: &#39;ISO-8859-6-E&#39;, &#39;ISO_8859-6-I&#39;: &#39;ISO-8859-6-I&#39;, &#39;ISO_8859-7&#39;: &#39;ISO-8859-7&#39;, &#39;GREEK&#39;: &#39;ISO-8859-7&#39;, &#39;GREEK8&#39;: &#39;ISO-8859-7&#39;, &#39;ECMA-118&#39;: &#39;ISO-8859-7&#39;, &#39;ISO_8859-8&#39;: &#39;ISO-8859-8&#39;, &#39;HEBREW&#39;: &#39;ISO-8859-8&#39;, &#39;ISO_8859-8-E&#39;: &#39;ISO-8859-8-E&#39;, &#39;ISO_8859-8-I&#39;: &#39;ISO-8859-8-I&#39;, &#39;ISO_8859-9&#39;: &#39;ISO-8859-9&#39;, &#39;LATIN5&#39;: &#39;ISO-8859-9&#39;, &#39;ISO_8859-10&#39;: &#39;ISO-8859-10&#39;, &#39;LATIN6&#39;: &#39;ISO-8859-10&#39;, &#39;ISO_8859-13&#39;: &#39;ISO-8859-13&#39;, &#39;ISO_8859-14&#39;: &#39;ISO-8859-14&#39;, &#39;LATIN8&#39;: &#39;ISO-8859-14&#39;, &#39;ISO_8859-15&#39;: &#39;ISO-8859-15&#39;, &#39;LATIN9&#39;: &#39;ISO-8859-15&#39;, &#39;ISO_8859-16&#39;: &#39;ISO-8859-16&#39;, &#39;LATIN10&#39;: &#39;ISO-8859-16&#39;}</span>

        
    </div>
    <a class="headerlink" href="#character_set_aliases"></a>
    
    

                </section>
                <section id="canonical_charset">
                            <input id="canonical_charset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">canonical_charset</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">charset</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="canonical_charset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#canonical_charset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="canonical_charset-1642"><a href="#canonical_charset-1642"><span class="linenos">1642</span></a><span class="k">def</span> <span class="nf">canonical_charset</span><span class="p">(</span> <span class="n">charset</span> <span class="p">):</span>
</span><span id="canonical_charset-1643"><a href="#canonical_charset-1643"><span class="linenos">1643</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the canonical or preferred name of a charset.</span>
</span><span id="canonical_charset-1644"><a href="#canonical_charset-1644"><span class="linenos">1644</span></a>
</span><span id="canonical_charset-1645"><a href="#canonical_charset-1645"><span class="linenos">1645</span></a><span class="sd">    Additional character sets can be recognized by this function by</span>
</span><span id="canonical_charset-1646"><a href="#canonical_charset-1646"><span class="linenos">1646</span></a><span class="sd">    altering the character_set_aliases dictionary in this module.</span>
</span><span id="canonical_charset-1647"><a href="#canonical_charset-1647"><span class="linenos">1647</span></a><span class="sd">    Charsets which are not recognized are simply converted to</span>
</span><span id="canonical_charset-1648"><a href="#canonical_charset-1648"><span class="linenos">1648</span></a><span class="sd">    upper-case (as charset names are always case-insensitive).</span>
</span><span id="canonical_charset-1649"><a href="#canonical_charset-1649"><span class="linenos">1649</span></a><span class="sd">    </span>
</span><span id="canonical_charset-1650"><a href="#canonical_charset-1650"><span class="linenos">1650</span></a><span class="sd">    See &lt;http://www.iana.org/assignments/character-sets&gt;.</span>
</span><span id="canonical_charset-1651"><a href="#canonical_charset-1651"><span class="linenos">1651</span></a>
</span><span id="canonical_charset-1652"><a href="#canonical_charset-1652"><span class="linenos">1652</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="canonical_charset-1653"><a href="#canonical_charset-1653"><span class="linenos">1653</span></a>    <span class="c1"># It would be nice to use Python&#39;s codecs modules for this, but</span>
</span><span id="canonical_charset-1654"><a href="#canonical_charset-1654"><span class="linenos">1654</span></a>    <span class="c1"># there is no fixed public interface to it&#39;s alias mappings.</span>
</span><span id="canonical_charset-1655"><a href="#canonical_charset-1655"><span class="linenos">1655</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">charset</span><span class="p">:</span>
</span><span id="canonical_charset-1656"><a href="#canonical_charset-1656"><span class="linenos">1656</span></a>        <span class="k">return</span> <span class="n">charset</span>
</span><span id="canonical_charset-1657"><a href="#canonical_charset-1657"><span class="linenos">1657</span></a>    <span class="n">uc</span> <span class="o">=</span> <span class="n">charset</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="canonical_charset-1658"><a href="#canonical_charset-1658"><span class="linenos">1658</span></a>    <span class="n">uccon</span> <span class="o">=</span> <span class="n">character_set_aliases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">uc</span><span class="p">,</span> <span class="n">uc</span> <span class="p">)</span>
</span><span id="canonical_charset-1659"><a href="#canonical_charset-1659"><span class="linenos">1659</span></a>    <span class="k">return</span> <span class="n">uccon</span>
</span></pre></div>


            <div class="docstring"><p>Returns the canonical or preferred name of a charset.</p>

<p>Additional character sets can be recognized by this function by
altering the character_set_aliases dictionary in this module.
Charsets which are not recognized are simply converted to
upper-case (as charset names are always case-insensitive).</p>

<p>See <a href="http://www.iana.org/assignments/character-sets">http://www.iana.org/assignments/character-sets</a>.</p>
</div>


                </section>
                <section id="acceptable_charset">
                            <input id="acceptable_charset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">acceptable_charset</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">accept_charset_header</span>,</span><span class="param">	<span class="n">charsets</span>,</span><span class="param">	<span class="n">ignore_wildcard</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">default</span><span class="o">=</span><span class="s1">&#39;ISO-8859-1&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="acceptable_charset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#acceptable_charset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="acceptable_charset-1662"><a href="#acceptable_charset-1662"><span class="linenos">1662</span></a><span class="k">def</span> <span class="nf">acceptable_charset</span><span class="p">(</span> <span class="n">accept_charset_header</span><span class="p">,</span> <span class="n">charsets</span><span class="p">,</span> <span class="n">ignore_wildcard</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;ISO-8859-1&#39;</span> <span class="p">):</span>
</span><span id="acceptable_charset-1663"><a href="#acceptable_charset-1663"><span class="linenos">1663</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="acceptable_charset-1664"><a href="#acceptable_charset-1664"><span class="linenos">1664</span></a><span class="sd">    Determines if the given charset is acceptable to the user agent.</span>
</span><span id="acceptable_charset-1665"><a href="#acceptable_charset-1665"><span class="linenos">1665</span></a>
</span><span id="acceptable_charset-1666"><a href="#acceptable_charset-1666"><span class="linenos">1666</span></a><span class="sd">    The accept_charset_header should be the value present in the HTTP</span>
</span><span id="acceptable_charset-1667"><a href="#acceptable_charset-1667"><span class="linenos">1667</span></a><span class="sd">    &quot;Accept-Charset:&quot; header.  In mod_python this is typically</span>
</span><span id="acceptable_charset-1668"><a href="#acceptable_charset-1668"><span class="linenos">1668</span></a><span class="sd">    obtained from the req.http_headers table; in WSGI it is</span>
</span><span id="acceptable_charset-1669"><a href="#acceptable_charset-1669"><span class="linenos">1669</span></a><span class="sd">    environ[&quot;Accept-Charset&quot;]; other web frameworks may provide other</span>
</span><span id="acceptable_charset-1670"><a href="#acceptable_charset-1670"><span class="linenos">1670</span></a><span class="sd">    methods of obtaining it.</span>
</span><span id="acceptable_charset-1671"><a href="#acceptable_charset-1671"><span class="linenos">1671</span></a>
</span><span id="acceptable_charset-1672"><a href="#acceptable_charset-1672"><span class="linenos">1672</span></a><span class="sd">    Optionally the accept_charset_header parameter can instead be the</span>
</span><span id="acceptable_charset-1673"><a href="#acceptable_charset-1673"><span class="linenos">1673</span></a><span class="sd">    list returned from the parse_accept_header() function in this</span>
</span><span id="acceptable_charset-1674"><a href="#acceptable_charset-1674"><span class="linenos">1674</span></a><span class="sd">    module.</span>
</span><span id="acceptable_charset-1675"><a href="#acceptable_charset-1675"><span class="linenos">1675</span></a>
</span><span id="acceptable_charset-1676"><a href="#acceptable_charset-1676"><span class="linenos">1676</span></a><span class="sd">    The charsets argument should either be a charset identifier string,</span>
</span><span id="acceptable_charset-1677"><a href="#acceptable_charset-1677"><span class="linenos">1677</span></a><span class="sd">    or a sequence of them.</span>
</span><span id="acceptable_charset-1678"><a href="#acceptable_charset-1678"><span class="linenos">1678</span></a>
</span><span id="acceptable_charset-1679"><a href="#acceptable_charset-1679"><span class="linenos">1679</span></a><span class="sd">    This function returns the charset identifier string which is the</span>
</span><span id="acceptable_charset-1680"><a href="#acceptable_charset-1680"><span class="linenos">1680</span></a><span class="sd">    most prefered and is acceptable to both the user agent and the</span>
</span><span id="acceptable_charset-1681"><a href="#acceptable_charset-1681"><span class="linenos">1681</span></a><span class="sd">    caller.  It will return the default value if no charset is negotiable.</span>
</span><span id="acceptable_charset-1682"><a href="#acceptable_charset-1682"><span class="linenos">1682</span></a><span class="sd">    </span>
</span><span id="acceptable_charset-1683"><a href="#acceptable_charset-1683"><span class="linenos">1683</span></a><span class="sd">    Note that the wildcarded charset &quot;*&quot; will be ignored.  To override</span>
</span><span id="acceptable_charset-1684"><a href="#acceptable_charset-1684"><span class="linenos">1684</span></a><span class="sd">    this, call with ignore_wildcard=False.</span>
</span><span id="acceptable_charset-1685"><a href="#acceptable_charset-1685"><span class="linenos">1685</span></a>
</span><span id="acceptable_charset-1686"><a href="#acceptable_charset-1686"><span class="linenos">1686</span></a><span class="sd">    See also: RFC 2616 section 14.2, and</span>
</span><span id="acceptable_charset-1687"><a href="#acceptable_charset-1687"><span class="linenos">1687</span></a><span class="sd">    &lt;http://www.iana.org/assignments/character-sets&gt;</span>
</span><span id="acceptable_charset-1688"><a href="#acceptable_charset-1688"><span class="linenos">1688</span></a>
</span><span id="acceptable_charset-1689"><a href="#acceptable_charset-1689"><span class="linenos">1689</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="acceptable_charset-1690"><a href="#acceptable_charset-1690"><span class="linenos">1690</span></a>    <span class="k">if</span> <span class="n">default</span><span class="p">:</span>
</span><span id="acceptable_charset-1691"><a href="#acceptable_charset-1691"><span class="linenos">1691</span></a>        <span class="n">default</span> <span class="o">=</span> <span class="n">_canonical_charset</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
</span><span id="acceptable_charset-1692"><a href="#acceptable_charset-1692"><span class="linenos">1692</span></a>
</span><span id="acceptable_charset-1693"><a href="#acceptable_charset-1693"><span class="linenos">1693</span></a>    <span class="k">if</span> <span class="n">_is_string</span><span class="p">(</span><span class="n">accept_charset_header</span><span class="p">):</span>
</span><span id="acceptable_charset-1694"><a href="#acceptable_charset-1694"><span class="linenos">1694</span></a>        <span class="n">accept_list</span> <span class="o">=</span> <span class="n">parse_accept_header</span><span class="p">(</span><span class="n">accept_charset_header</span><span class="p">)</span>
</span><span id="acceptable_charset-1695"><a href="#acceptable_charset-1695"><span class="linenos">1695</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="acceptable_charset-1696"><a href="#acceptable_charset-1696"><span class="linenos">1696</span></a>        <span class="n">accept_list</span> <span class="o">=</span> <span class="n">accept_charset_header</span>
</span><span id="acceptable_charset-1697"><a href="#acceptable_charset-1697"><span class="linenos">1697</span></a>
</span><span id="acceptable_charset-1698"><a href="#acceptable_charset-1698"><span class="linenos">1698</span></a>    <span class="k">if</span> <span class="n">_is_string</span><span class="p">(</span><span class="n">charsets</span><span class="p">):</span>
</span><span id="acceptable_charset-1699"><a href="#acceptable_charset-1699"><span class="linenos">1699</span></a>        <span class="n">charsets</span> <span class="o">=</span> <span class="p">[</span><span class="n">_canonical_charset</span><span class="p">(</span><span class="n">charsets</span><span class="p">)]</span>
</span><span id="acceptable_charset-1700"><a href="#acceptable_charset-1700"><span class="linenos">1700</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="acceptable_charset-1701"><a href="#acceptable_charset-1701"><span class="linenos">1701</span></a>        <span class="n">charsets</span> <span class="o">=</span> <span class="p">[</span><span class="n">_canonical_charset</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">charsets</span><span class="p">]</span>
</span><span id="acceptable_charset-1702"><a href="#acceptable_charset-1702"><span class="linenos">1702</span></a>
</span><span id="acceptable_charset-1703"><a href="#acceptable_charset-1703"><span class="linenos">1703</span></a>    <span class="c1"># Note per RFC that &#39;ISO-8859-1&#39; is special, and is implictly in the</span>
</span><span id="acceptable_charset-1704"><a href="#acceptable_charset-1704"><span class="linenos">1704</span></a>    <span class="c1"># accept list with q=1; unless it is already in the list, or &#39;*&#39; is in the list.</span>
</span><span id="acceptable_charset-1705"><a href="#acceptable_charset-1705"><span class="linenos">1705</span></a>
</span><span id="acceptable_charset-1706"><a href="#acceptable_charset-1706"><span class="linenos">1706</span></a>    <span class="n">best</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="acceptable_charset-1707"><a href="#acceptable_charset-1707"><span class="linenos">1707</span></a>    <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">qvalue</span><span class="p">,</span> <span class="n">junk</span> <span class="ow">in</span> <span class="n">accept_list</span><span class="p">:</span>
</span><span id="acceptable_charset-1708"><a href="#acceptable_charset-1708"><span class="linenos">1708</span></a>        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
</span><span id="acceptable_charset-1709"><a href="#acceptable_charset-1709"><span class="linenos">1709</span></a>            <span class="n">default</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="acceptable_charset-1710"><a href="#acceptable_charset-1710"><span class="linenos">1710</span></a>            <span class="k">if</span> <span class="n">ignore_wildcard</span><span class="p">:</span>
</span><span id="acceptable_charset-1711"><a href="#acceptable_charset-1711"><span class="linenos">1711</span></a>                <span class="k">continue</span>
</span><span id="acceptable_charset-1712"><a href="#acceptable_charset-1712"><span class="linenos">1712</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">best</span> <span class="ow">or</span> <span class="n">qvalue</span> <span class="o">&gt;</span> <span class="n">best</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="acceptable_charset-1713"><a href="#acceptable_charset-1713"><span class="linenos">1713</span></a>                <span class="n">best</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">qvalue</span><span class="p">)</span>
</span><span id="acceptable_charset-1714"><a href="#acceptable_charset-1714"><span class="linenos">1714</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="acceptable_charset-1715"><a href="#acceptable_charset-1715"><span class="linenos">1715</span></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">_canonical_charset</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="acceptable_charset-1716"><a href="#acceptable_charset-1716"><span class="linenos">1716</span></a>            <span class="k">for</span> <span class="n">test_c</span> <span class="ow">in</span> <span class="n">charsets</span><span class="p">:</span>
</span><span id="acceptable_charset-1717"><a href="#acceptable_charset-1717"><span class="linenos">1717</span></a>                <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">default</span><span class="p">:</span>
</span><span id="acceptable_charset-1718"><a href="#acceptable_charset-1718"><span class="linenos">1718</span></a>                    <span class="n">default</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="acceptable_charset-1719"><a href="#acceptable_charset-1719"><span class="linenos">1719</span></a>                <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">test_c</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">best</span> <span class="ow">or</span> <span class="n">best</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;*&#39;</span> <span class="ow">or</span> <span class="n">qvalue</span> <span class="o">&gt;</span> <span class="n">best</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="acceptable_charset-1720"><a href="#acceptable_charset-1720"><span class="linenos">1720</span></a>                    <span class="n">best</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">qvalue</span><span class="p">)</span>
</span><span id="acceptable_charset-1721"><a href="#acceptable_charset-1721"><span class="linenos">1721</span></a>    <span class="k">if</span> <span class="n">default</span> <span class="ow">and</span> <span class="n">default</span> <span class="ow">in</span> <span class="p">[</span><span class="n">test_c</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">test_c</span> <span class="ow">in</span> <span class="n">charsets</span><span class="p">]:</span>
</span><span id="acceptable_charset-1722"><a href="#acceptable_charset-1722"><span class="linenos">1722</span></a>        <span class="n">best</span> <span class="o">=</span> <span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="acceptable_charset-1723"><a href="#acceptable_charset-1723"><span class="linenos">1723</span></a>    <span class="k">if</span> <span class="n">best</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
</span><span id="acceptable_charset-1724"><a href="#acceptable_charset-1724"><span class="linenos">1724</span></a>        <span class="n">best</span> <span class="o">=</span> <span class="p">(</span><span class="n">charsets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">best</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="acceptable_charset-1725"><a href="#acceptable_charset-1725"><span class="linenos">1725</span></a>    <span class="k">return</span> <span class="n">best</span>
</span></pre></div>


            <div class="docstring"><p>Determines if the given charset is acceptable to the user agent.</p>

<p>The accept_charset_header should be the value present in the HTTP
"Accept-Charset:" header.  In mod_python this is typically
obtained from the req.http_headers table; in WSGI it is
environ["Accept-Charset"]; other web frameworks may provide other
methods of obtaining it.</p>

<p>Optionally the accept_charset_header parameter can instead be the
list returned from the parse_accept_header() function in this
module.</p>

<p>The charsets argument should either be a charset identifier string,
or a sequence of them.</p>

<p>This function returns the charset identifier string which is the
most prefered and is acceptable to both the user agent and the
caller.  It will return the default value if no charset is negotiable.</p>

<p>Note that the wildcarded charset "*" will be ignored.  To override
this, call with ignore_wildcard=False.</p>

<p>See also: RFC 2616 section 14.2, and
<a href="http://www.iana.org/assignments/character-sets">http://www.iana.org/assignments/character-sets</a></p>
</div>


                </section>
                <section id="language_tag">
                            <input id="language_tag-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">language_tag</span>:

                <label class="view-source-button" for="language_tag-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#language_tag"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="language_tag-1729"><a href="#language_tag-1729"><span class="linenos">1729</span></a><span class="k">class</span> <span class="nc">language_tag</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="language_tag-1730"><a href="#language_tag-1730"><span class="linenos">1730</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class represents an RFC 3066 language tag.</span>
</span><span id="language_tag-1731"><a href="#language_tag-1731"><span class="linenos">1731</span></a>
</span><span id="language_tag-1732"><a href="#language_tag-1732"><span class="linenos">1732</span></a><span class="sd">    Initialize objects of this class with a single string representing</span>
</span><span id="language_tag-1733"><a href="#language_tag-1733"><span class="linenos">1733</span></a><span class="sd">    the language tag, such as &quot;en-US&quot;.</span>
</span><span id="language_tag-1734"><a href="#language_tag-1734"><span class="linenos">1734</span></a><span class="sd">        </span>
</span><span id="language_tag-1735"><a href="#language_tag-1735"><span class="linenos">1735</span></a><span class="sd">    Case is insensitive. Wildcarded subtags are ignored or stripped as</span>
</span><span id="language_tag-1736"><a href="#language_tag-1736"><span class="linenos">1736</span></a><span class="sd">    they have no significance, so that &quot;en-*&quot; is the same as &quot;en&quot;.</span>
</span><span id="language_tag-1737"><a href="#language_tag-1737"><span class="linenos">1737</span></a><span class="sd">    However the universal wildcard &quot;*&quot; language tag is kept as-is.</span>
</span><span id="language_tag-1738"><a href="#language_tag-1738"><span class="linenos">1738</span></a>
</span><span id="language_tag-1739"><a href="#language_tag-1739"><span class="linenos">1739</span></a><span class="sd">    Note that although relational operators such as &lt; are defined,</span>
</span><span id="language_tag-1740"><a href="#language_tag-1740"><span class="linenos">1740</span></a><span class="sd">    they only form a partial order based upon specialization.</span>
</span><span id="language_tag-1741"><a href="#language_tag-1741"><span class="linenos">1741</span></a>
</span><span id="language_tag-1742"><a href="#language_tag-1742"><span class="linenos">1742</span></a><span class="sd">    Thus for example,</span>
</span><span id="language_tag-1743"><a href="#language_tag-1743"><span class="linenos">1743</span></a><span class="sd">         &quot;en&quot; &lt;= &quot;en-US&quot;</span>
</span><span id="language_tag-1744"><a href="#language_tag-1744"><span class="linenos">1744</span></a><span class="sd">    but,</span>
</span><span id="language_tag-1745"><a href="#language_tag-1745"><span class="linenos">1745</span></a><span class="sd">         not &quot;en&quot; &lt;= &quot;de&quot;, and</span>
</span><span id="language_tag-1746"><a href="#language_tag-1746"><span class="linenos">1746</span></a><span class="sd">         not &quot;de&quot; &lt;= &quot;en&quot;.</span>
</span><span id="language_tag-1747"><a href="#language_tag-1747"><span class="linenos">1747</span></a>
</span><span id="language_tag-1748"><a href="#language_tag-1748"><span class="linenos">1748</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="language_tag-1749"><a href="#language_tag-1749"><span class="linenos">1749</span></a>
</span><span id="language_tag-1750"><a href="#language_tag-1750"><span class="linenos">1750</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagname</span><span class="p">):</span>
</span><span id="language_tag-1751"><a href="#language_tag-1751"><span class="linenos">1751</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize objects of this class with a single string representing</span>
</span><span id="language_tag-1752"><a href="#language_tag-1752"><span class="linenos">1752</span></a><span class="sd">        the language tag, such as &quot;en-US&quot;.  Case is insensitive.</span>
</span><span id="language_tag-1753"><a href="#language_tag-1753"><span class="linenos">1753</span></a>
</span><span id="language_tag-1754"><a href="#language_tag-1754"><span class="linenos">1754</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="language_tag-1755"><a href="#language_tag-1755"><span class="linenos">1755</span></a>
</span><span id="language_tag-1756"><a href="#language_tag-1756"><span class="linenos">1756</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parts</span> <span class="o">=</span> <span class="n">tagname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
</span><span id="language_tag-1757"><a href="#language_tag-1757"><span class="linenos">1757</span></a>        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
</span><span id="language_tag-1758"><a href="#language_tag-1758"><span class="linenos">1758</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="language_tag-1759"><a href="#language_tag-1759"><span class="linenos">1759</span></a>
</span><span id="language_tag-1760"><a href="#language_tag-1760"><span class="linenos">1760</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="language_tag-1761"><a href="#language_tag-1761"><span class="linenos">1761</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of subtags in this tag.&quot;&quot;&quot;</span>
</span><span id="language_tag-1762"><a href="#language_tag-1762"><span class="linenos">1762</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
</span><span id="language_tag-1763"><a href="#language_tag-1763"><span class="linenos">1763</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="language_tag-1764"><a href="#language_tag-1764"><span class="linenos">1764</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span>
</span><span id="language_tag-1765"><a href="#language_tag-1765"><span class="linenos">1765</span></a>
</span><span id="language_tag-1766"><a href="#language_tag-1766"><span class="linenos">1766</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="language_tag-1767"><a href="#language_tag-1767"><span class="linenos">1767</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The standard string form of this language tag.&quot;&quot;&quot;</span>
</span><span id="language_tag-1768"><a href="#language_tag-1768"><span class="linenos">1768</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="language_tag-1769"><a href="#language_tag-1769"><span class="linenos">1769</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="language_tag-1770"><a href="#language_tag-1770"><span class="linenos">1770</span></a>            <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="language_tag-1771"><a href="#language_tag-1771"><span class="linenos">1771</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="language_tag-1772"><a href="#language_tag-1772"><span class="linenos">1772</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="language_tag-1773"><a href="#language_tag-1773"><span class="linenos">1773</span></a>                <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="p">)</span>
</span><span id="language_tag-1774"><a href="#language_tag-1774"><span class="linenos">1774</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="language_tag-1775"><a href="#language_tag-1775"><span class="linenos">1775</span></a>                <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
</span><span id="language_tag-1776"><a href="#language_tag-1776"><span class="linenos">1776</span></a>        <span class="n">a</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="p">)</span>
</span><span id="language_tag-1777"><a href="#language_tag-1777"><span class="linenos">1777</span></a>        <span class="k">return</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="language_tag-1778"><a href="#language_tag-1778"><span class="linenos">1778</span></a>
</span><span id="language_tag-1779"><a href="#language_tag-1779"><span class="linenos">1779</span></a>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="language_tag-1780"><a href="#language_tag-1780"><span class="linenos">1780</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The unicode string form of this language tag.&quot;&quot;&quot;</span>
</span><span id="language_tag-1781"><a href="#language_tag-1781"><span class="linenos">1781</span></a>        <span class="c1"># Probably unnecessary in Python 3</span>
</span><span id="language_tag-1782"><a href="#language_tag-1782"><span class="linenos">1782</span></a>        <span class="k">if</span> <span class="n">PY3</span> <span class="p">:</span>
</span><span id="language_tag-1783"><a href="#language_tag-1783"><span class="linenos">1783</span></a>            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span><span id="language_tag-1784"><a href="#language_tag-1784"><span class="linenos">1784</span></a>        <span class="k">else</span> <span class="p">:</span>
</span><span id="language_tag-1785"><a href="#language_tag-1785"><span class="linenos">1785</span></a>            <span class="k">return</span> <span class="n">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span><span id="language_tag-1786"><a href="#language_tag-1786"><span class="linenos">1786</span></a>
</span><span id="language_tag-1787"><a href="#language_tag-1787"><span class="linenos">1787</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="language_tag-1788"><a href="#language_tag-1788"><span class="linenos">1788</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The python representation of this language tag.&quot;&quot;&quot;</span>
</span><span id="language_tag-1789"><a href="#language_tag-1789"><span class="linenos">1789</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(&quot;</span><span class="si">%s</span><span class="s1">&quot;)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span><span id="language_tag-1790"><a href="#language_tag-1790"><span class="linenos">1790</span></a>        <span class="k">return</span> <span class="n">s</span>
</span><span id="language_tag-1791"><a href="#language_tag-1791"><span class="linenos">1791</span></a>
</span><span id="language_tag-1792"><a href="#language_tag-1792"><span class="linenos">1792</span></a>    <span class="k">def</span> <span class="nf">superior</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="language_tag-1793"><a href="#language_tag-1793"><span class="linenos">1793</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns another instance of language_tag which is the superior.</span>
</span><span id="language_tag-1794"><a href="#language_tag-1794"><span class="linenos">1794</span></a>
</span><span id="language_tag-1795"><a href="#language_tag-1795"><span class="linenos">1795</span></a><span class="sd">        Thus en-US gives en, and en gives *.</span>
</span><span id="language_tag-1796"><a href="#language_tag-1796"><span class="linenos">1796</span></a>
</span><span id="language_tag-1797"><a href="#language_tag-1797"><span class="linenos">1797</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="language_tag-1798"><a href="#language_tag-1798"><span class="linenos">1798</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="language_tag-1799"><a href="#language_tag-1799"><span class="linenos">1799</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span id="language_tag-1800"><a href="#language_tag-1800"><span class="linenos">1800</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
</span><span id="language_tag-1801"><a href="#language_tag-1801"><span class="linenos">1801</span></a>
</span><span id="language_tag-1802"><a href="#language_tag-1802"><span class="linenos">1802</span></a>    <span class="k">def</span> <span class="nf">all_superiors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_wildcard</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="language_tag-1803"><a href="#language_tag-1803"><span class="linenos">1803</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of this language and all it&#39;s superiors.</span>
</span><span id="language_tag-1804"><a href="#language_tag-1804"><span class="linenos">1804</span></a>
</span><span id="language_tag-1805"><a href="#language_tag-1805"><span class="linenos">1805</span></a><span class="sd">        If include_wildcard is False, then &quot;*&quot; will not be among the</span>
</span><span id="language_tag-1806"><a href="#language_tag-1806"><span class="linenos">1806</span></a><span class="sd">        output list, unless this language is itself &quot;*&quot;.</span>
</span><span id="language_tag-1807"><a href="#language_tag-1807"><span class="linenos">1807</span></a>
</span><span id="language_tag-1808"><a href="#language_tag-1808"><span class="linenos">1808</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="language_tag-1809"><a href="#language_tag-1809"><span class="linenos">1809</span></a>        <span class="n">langlist</span> <span class="o">=</span> <span class="p">[</span> <span class="bp">self</span> <span class="p">]</span>
</span><span id="language_tag-1810"><a href="#language_tag-1810"><span class="linenos">1810</span></a>        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="language_tag-1811"><a href="#language_tag-1811"><span class="linenos">1811</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">l</span><span class="o">.</span><span class="n">is_universal_wildcard</span><span class="p">():</span>
</span><span id="language_tag-1812"><a href="#language_tag-1812"><span class="linenos">1812</span></a>            <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">superior</span><span class="p">()</span>
</span><span id="language_tag-1813"><a href="#language_tag-1813"><span class="linenos">1813</span></a>            <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">is_universal_wildcard</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">include_wildcard</span><span class="p">:</span>
</span><span id="language_tag-1814"><a href="#language_tag-1814"><span class="linenos">1814</span></a>                <span class="k">continue</span>
</span><span id="language_tag-1815"><a href="#language_tag-1815"><span class="linenos">1815</span></a>            <span class="n">langlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</span><span id="language_tag-1816"><a href="#language_tag-1816"><span class="linenos">1816</span></a>        <span class="k">return</span> <span class="n">langlist</span>
</span><span id="language_tag-1817"><a href="#language_tag-1817"><span class="linenos">1817</span></a>                
</span><span id="language_tag-1818"><a href="#language_tag-1818"><span class="linenos">1818</span></a>    <span class="k">def</span> <span class="nf">is_universal_wildcard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="language_tag-1819"><a href="#language_tag-1819"><span class="linenos">1819</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if this language tag represents all possible</span>
</span><span id="language_tag-1820"><a href="#language_tag-1820"><span class="linenos">1820</span></a><span class="sd">        languages, by using the reserved tag of &quot;*&quot;.</span>
</span><span id="language_tag-1821"><a href="#language_tag-1821"><span class="linenos">1821</span></a>
</span><span id="language_tag-1822"><a href="#language_tag-1822"><span class="linenos">1822</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="language_tag-1823"><a href="#language_tag-1823"><span class="linenos">1823</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span>
</span><span id="language_tag-1824"><a href="#language_tag-1824"><span class="linenos">1824</span></a>
</span><span id="language_tag-1825"><a href="#language_tag-1825"><span class="linenos">1825</span></a>    <span class="k">def</span> <span class="nf">dialect_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">ignore_wildcard</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="language_tag-1826"><a href="#language_tag-1826"><span class="linenos">1826</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Is this language a dialect (or subset/specialization) of another.</span>
</span><span id="language_tag-1827"><a href="#language_tag-1827"><span class="linenos">1827</span></a>
</span><span id="language_tag-1828"><a href="#language_tag-1828"><span class="linenos">1828</span></a><span class="sd">        This method returns True if this language is the same as or a</span>
</span><span id="language_tag-1829"><a href="#language_tag-1829"><span class="linenos">1829</span></a><span class="sd">        specialization (dialect) of the other language_tag.</span>
</span><span id="language_tag-1830"><a href="#language_tag-1830"><span class="linenos">1830</span></a>
</span><span id="language_tag-1831"><a href="#language_tag-1831"><span class="linenos">1831</span></a><span class="sd">        If ignore_wildcard is False, then all languages will be</span>
</span><span id="language_tag-1832"><a href="#language_tag-1832"><span class="linenos">1832</span></a><span class="sd">        considered to be a dialect of the special language tag of &quot;*&quot;.</span>
</span><span id="language_tag-1833"><a href="#language_tag-1833"><span class="linenos">1833</span></a>
</span><span id="language_tag-1834"><a href="#language_tag-1834"><span class="linenos">1834</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="language_tag-1835"><a href="#language_tag-1835"><span class="linenos">1835</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_wildcard</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_universal_wildcard</span><span class="p">():</span>
</span><span id="language_tag-1836"><a href="#language_tag-1836"><span class="linenos">1836</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="language_tag-1837"><a href="#language_tag-1837"><span class="linenos">1837</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">))</span> <span class="p">):</span>
</span><span id="language_tag-1838"><a href="#language_tag-1838"><span class="linenos">1838</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="language_tag-1839"><a href="#language_tag-1839"><span class="linenos">1839</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="language_tag-1840"><a href="#language_tag-1840"><span class="linenos">1840</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
</span><span id="language_tag-1841"><a href="#language_tag-1841"><span class="linenos">1841</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="language_tag-1842"><a href="#language_tag-1842"><span class="linenos">1842</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="language_tag-1843"><a href="#language_tag-1843"><span class="linenos">1843</span></a>
</span><span id="language_tag-1844"><a href="#language_tag-1844"><span class="linenos">1844</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="language_tag-1845"><a href="#language_tag-1845"><span class="linenos">1845</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;== operator. Are the two languages the same?&quot;&quot;&quot;</span>
</span><span id="language_tag-1846"><a href="#language_tag-1846"><span class="linenos">1846</span></a>
</span><span id="language_tag-1847"><a href="#language_tag-1847"><span class="linenos">1847</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">parts</span>
</span><span id="language_tag-1848"><a href="#language_tag-1848"><span class="linenos">1848</span></a>
</span><span id="language_tag-1849"><a href="#language_tag-1849"><span class="linenos">1849</span></a>    <span class="k">def</span> <span class="nf">__neq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="language_tag-1850"><a href="#language_tag-1850"><span class="linenos">1850</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;!= operator. Are the two languages different?&quot;&quot;&quot;</span>
</span><span id="language_tag-1851"><a href="#language_tag-1851"><span class="linenos">1851</span></a>
</span><span id="language_tag-1852"><a href="#language_tag-1852"><span class="linenos">1852</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="language_tag-1853"><a href="#language_tag-1853"><span class="linenos">1853</span></a>
</span><span id="language_tag-1854"><a href="#language_tag-1854"><span class="linenos">1854</span></a>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="language_tag-1855"><a href="#language_tag-1855"><span class="linenos">1855</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&lt; operator. Returns True if the other language is a more</span>
</span><span id="language_tag-1856"><a href="#language_tag-1856"><span class="linenos">1856</span></a><span class="sd">        specialized dialect of this one.&quot;&quot;&quot;</span>
</span><span id="language_tag-1857"><a href="#language_tag-1857"><span class="linenos">1857</span></a>
</span><span id="language_tag-1858"><a href="#language_tag-1858"><span class="linenos">1858</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">dialect_of</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span> <span class="o">!=</span> <span class="n">other</span>
</span><span id="language_tag-1859"><a href="#language_tag-1859"><span class="linenos">1859</span></a>
</span><span id="language_tag-1860"><a href="#language_tag-1860"><span class="linenos">1860</span></a>    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="language_tag-1861"><a href="#language_tag-1861"><span class="linenos">1861</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&lt;= operator. Returns True if the other language is the same</span>
</span><span id="language_tag-1862"><a href="#language_tag-1862"><span class="linenos">1862</span></a><span class="sd">        as or a more specialized dialect of this one.&quot;&quot;&quot;</span>
</span><span id="language_tag-1863"><a href="#language_tag-1863"><span class="linenos">1863</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">dialect_of</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="language_tag-1864"><a href="#language_tag-1864"><span class="linenos">1864</span></a>
</span><span id="language_tag-1865"><a href="#language_tag-1865"><span class="linenos">1865</span></a>    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="language_tag-1866"><a href="#language_tag-1866"><span class="linenos">1866</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&gt; operator.  Returns True if this language is a more</span>
</span><span id="language_tag-1867"><a href="#language_tag-1867"><span class="linenos">1867</span></a><span class="sd">        specialized dialect of the other one.&quot;&quot;&quot;</span>
</span><span id="language_tag-1868"><a href="#language_tag-1868"><span class="linenos">1868</span></a>
</span><span id="language_tag-1869"><a href="#language_tag-1869"><span class="linenos">1869</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialect_of</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span> <span class="o">!=</span> <span class="n">other</span>
</span><span id="language_tag-1870"><a href="#language_tag-1870"><span class="linenos">1870</span></a>
</span><span id="language_tag-1871"><a href="#language_tag-1871"><span class="linenos">1871</span></a>    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="language_tag-1872"><a href="#language_tag-1872"><span class="linenos">1872</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&gt;= operator.  Returns True if this language is the same as</span>
</span><span id="language_tag-1873"><a href="#language_tag-1873"><span class="linenos">1873</span></a><span class="sd">        or a more specialized dialect of the other one.&quot;&quot;&quot;</span>
</span><span id="language_tag-1874"><a href="#language_tag-1874"><span class="linenos">1874</span></a>
</span><span id="language_tag-1875"><a href="#language_tag-1875"><span class="linenos">1875</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialect_of</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This class represents an RFC 3066 language tag.</p>

<p>Initialize objects of this class with a single string representing
the language tag, such as "en-US".</p>

<p>Case is insensitive. Wildcarded subtags are ignored or stripped as
they have no significance, so that "en-<em>" is the same as "en".
However the universal wildcard "</em>" language tag is kept as-is.</p>

<p>Note that although relational operators such as &lt; are defined,
they only form a partial order based upon specialization.</p>

<p>Thus for example,
     "en" &lt;= "en-US"
but,
     not "en" &lt;= "de", and
     not "de" &lt;= "en".</p>
</div>


                            <div id="language_tag.__init__" class="classattr">
                                        <input id="language_tag.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">language_tag</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">tagname</span></span>)</span>

                <label class="view-source-button" for="language_tag.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#language_tag.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="language_tag.__init__-1750"><a href="#language_tag.__init__-1750"><span class="linenos">1750</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagname</span><span class="p">):</span>
</span><span id="language_tag.__init__-1751"><a href="#language_tag.__init__-1751"><span class="linenos">1751</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize objects of this class with a single string representing</span>
</span><span id="language_tag.__init__-1752"><a href="#language_tag.__init__-1752"><span class="linenos">1752</span></a><span class="sd">        the language tag, such as &quot;en-US&quot;.  Case is insensitive.</span>
</span><span id="language_tag.__init__-1753"><a href="#language_tag.__init__-1753"><span class="linenos">1753</span></a>
</span><span id="language_tag.__init__-1754"><a href="#language_tag.__init__-1754"><span class="linenos">1754</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="language_tag.__init__-1755"><a href="#language_tag.__init__-1755"><span class="linenos">1755</span></a>
</span><span id="language_tag.__init__-1756"><a href="#language_tag.__init__-1756"><span class="linenos">1756</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parts</span> <span class="o">=</span> <span class="n">tagname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
</span><span id="language_tag.__init__-1757"><a href="#language_tag.__init__-1757"><span class="linenos">1757</span></a>        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
</span><span id="language_tag.__init__-1758"><a href="#language_tag.__init__-1758"><span class="linenos">1758</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Initialize objects of this class with a single string representing
the language tag, such as "en-US".  Case is insensitive.</p>
</div>


                            </div>
                            <div id="language_tag.parts" class="classattr">
                                <div class="attr variable">
            <span class="name">parts</span>

        
    </div>
    <a class="headerlink" href="#language_tag.parts"></a>
    
    

                            </div>
                            <div id="language_tag.superior" class="classattr">
                                        <input id="language_tag.superior-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">superior</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="language_tag.superior-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#language_tag.superior"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="language_tag.superior-1792"><a href="#language_tag.superior-1792"><span class="linenos">1792</span></a>    <span class="k">def</span> <span class="nf">superior</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="language_tag.superior-1793"><a href="#language_tag.superior-1793"><span class="linenos">1793</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns another instance of language_tag which is the superior.</span>
</span><span id="language_tag.superior-1794"><a href="#language_tag.superior-1794"><span class="linenos">1794</span></a>
</span><span id="language_tag.superior-1795"><a href="#language_tag.superior-1795"><span class="linenos">1795</span></a><span class="sd">        Thus en-US gives en, and en gives *.</span>
</span><span id="language_tag.superior-1796"><a href="#language_tag.superior-1796"><span class="linenos">1796</span></a>
</span><span id="language_tag.superior-1797"><a href="#language_tag.superior-1797"><span class="linenos">1797</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="language_tag.superior-1798"><a href="#language_tag.superior-1798"><span class="linenos">1798</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="language_tag.superior-1799"><a href="#language_tag.superior-1799"><span class="linenos">1799</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span id="language_tag.superior-1800"><a href="#language_tag.superior-1800"><span class="linenos">1800</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns another instance of language_tag which is the superior.</p>

<p>Thus en-US gives en, and en gives *.</p>
</div>


                            </div>
                            <div id="language_tag.all_superiors" class="classattr">
                                        <input id="language_tag.all_superiors-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">all_superiors</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">include_wildcard</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="language_tag.all_superiors-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#language_tag.all_superiors"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="language_tag.all_superiors-1802"><a href="#language_tag.all_superiors-1802"><span class="linenos">1802</span></a>    <span class="k">def</span> <span class="nf">all_superiors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_wildcard</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="language_tag.all_superiors-1803"><a href="#language_tag.all_superiors-1803"><span class="linenos">1803</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of this language and all it&#39;s superiors.</span>
</span><span id="language_tag.all_superiors-1804"><a href="#language_tag.all_superiors-1804"><span class="linenos">1804</span></a>
</span><span id="language_tag.all_superiors-1805"><a href="#language_tag.all_superiors-1805"><span class="linenos">1805</span></a><span class="sd">        If include_wildcard is False, then &quot;*&quot; will not be among the</span>
</span><span id="language_tag.all_superiors-1806"><a href="#language_tag.all_superiors-1806"><span class="linenos">1806</span></a><span class="sd">        output list, unless this language is itself &quot;*&quot;.</span>
</span><span id="language_tag.all_superiors-1807"><a href="#language_tag.all_superiors-1807"><span class="linenos">1807</span></a>
</span><span id="language_tag.all_superiors-1808"><a href="#language_tag.all_superiors-1808"><span class="linenos">1808</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="language_tag.all_superiors-1809"><a href="#language_tag.all_superiors-1809"><span class="linenos">1809</span></a>        <span class="n">langlist</span> <span class="o">=</span> <span class="p">[</span> <span class="bp">self</span> <span class="p">]</span>
</span><span id="language_tag.all_superiors-1810"><a href="#language_tag.all_superiors-1810"><span class="linenos">1810</span></a>        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="language_tag.all_superiors-1811"><a href="#language_tag.all_superiors-1811"><span class="linenos">1811</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">l</span><span class="o">.</span><span class="n">is_universal_wildcard</span><span class="p">():</span>
</span><span id="language_tag.all_superiors-1812"><a href="#language_tag.all_superiors-1812"><span class="linenos">1812</span></a>            <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">superior</span><span class="p">()</span>
</span><span id="language_tag.all_superiors-1813"><a href="#language_tag.all_superiors-1813"><span class="linenos">1813</span></a>            <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">is_universal_wildcard</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">include_wildcard</span><span class="p">:</span>
</span><span id="language_tag.all_superiors-1814"><a href="#language_tag.all_superiors-1814"><span class="linenos">1814</span></a>                <span class="k">continue</span>
</span><span id="language_tag.all_superiors-1815"><a href="#language_tag.all_superiors-1815"><span class="linenos">1815</span></a>            <span class="n">langlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</span><span id="language_tag.all_superiors-1816"><a href="#language_tag.all_superiors-1816"><span class="linenos">1816</span></a>        <span class="k">return</span> <span class="n">langlist</span>
</span></pre></div>


            <div class="docstring"><p>Returns a list of this language and all it's superiors.</p>

<p>If include_wildcard is False, then "<em>" will not be among the
output list, unless this language is itself "</em>".</p>
</div>


                            </div>
                            <div id="language_tag.is_universal_wildcard" class="classattr">
                                        <input id="language_tag.is_universal_wildcard-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_universal_wildcard</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="language_tag.is_universal_wildcard-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#language_tag.is_universal_wildcard"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="language_tag.is_universal_wildcard-1818"><a href="#language_tag.is_universal_wildcard-1818"><span class="linenos">1818</span></a>    <span class="k">def</span> <span class="nf">is_universal_wildcard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="language_tag.is_universal_wildcard-1819"><a href="#language_tag.is_universal_wildcard-1819"><span class="linenos">1819</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if this language tag represents all possible</span>
</span><span id="language_tag.is_universal_wildcard-1820"><a href="#language_tag.is_universal_wildcard-1820"><span class="linenos">1820</span></a><span class="sd">        languages, by using the reserved tag of &quot;*&quot;.</span>
</span><span id="language_tag.is_universal_wildcard-1821"><a href="#language_tag.is_universal_wildcard-1821"><span class="linenos">1821</span></a>
</span><span id="language_tag.is_universal_wildcard-1822"><a href="#language_tag.is_universal_wildcard-1822"><span class="linenos">1822</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="language_tag.is_universal_wildcard-1823"><a href="#language_tag.is_universal_wildcard-1823"><span class="linenos">1823</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span>
</span></pre></div>


            <div class="docstring"><p>Returns True if this language tag represents all possible
languages, by using the reserved tag of "*".</p>
</div>


                            </div>
                            <div id="language_tag.dialect_of" class="classattr">
                                        <input id="language_tag.dialect_of-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">dialect_of</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span>, </span><span class="param"><span class="n">ignore_wildcard</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="language_tag.dialect_of-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#language_tag.dialect_of"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="language_tag.dialect_of-1825"><a href="#language_tag.dialect_of-1825"><span class="linenos">1825</span></a>    <span class="k">def</span> <span class="nf">dialect_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">ignore_wildcard</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="language_tag.dialect_of-1826"><a href="#language_tag.dialect_of-1826"><span class="linenos">1826</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Is this language a dialect (or subset/specialization) of another.</span>
</span><span id="language_tag.dialect_of-1827"><a href="#language_tag.dialect_of-1827"><span class="linenos">1827</span></a>
</span><span id="language_tag.dialect_of-1828"><a href="#language_tag.dialect_of-1828"><span class="linenos">1828</span></a><span class="sd">        This method returns True if this language is the same as or a</span>
</span><span id="language_tag.dialect_of-1829"><a href="#language_tag.dialect_of-1829"><span class="linenos">1829</span></a><span class="sd">        specialization (dialect) of the other language_tag.</span>
</span><span id="language_tag.dialect_of-1830"><a href="#language_tag.dialect_of-1830"><span class="linenos">1830</span></a>
</span><span id="language_tag.dialect_of-1831"><a href="#language_tag.dialect_of-1831"><span class="linenos">1831</span></a><span class="sd">        If ignore_wildcard is False, then all languages will be</span>
</span><span id="language_tag.dialect_of-1832"><a href="#language_tag.dialect_of-1832"><span class="linenos">1832</span></a><span class="sd">        considered to be a dialect of the special language tag of &quot;*&quot;.</span>
</span><span id="language_tag.dialect_of-1833"><a href="#language_tag.dialect_of-1833"><span class="linenos">1833</span></a>
</span><span id="language_tag.dialect_of-1834"><a href="#language_tag.dialect_of-1834"><span class="linenos">1834</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="language_tag.dialect_of-1835"><a href="#language_tag.dialect_of-1835"><span class="linenos">1835</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_wildcard</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_universal_wildcard</span><span class="p">():</span>
</span><span id="language_tag.dialect_of-1836"><a href="#language_tag.dialect_of-1836"><span class="linenos">1836</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="language_tag.dialect_of-1837"><a href="#language_tag.dialect_of-1837"><span class="linenos">1837</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">))</span> <span class="p">):</span>
</span><span id="language_tag.dialect_of-1838"><a href="#language_tag.dialect_of-1838"><span class="linenos">1838</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="language_tag.dialect_of-1839"><a href="#language_tag.dialect_of-1839"><span class="linenos">1839</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="language_tag.dialect_of-1840"><a href="#language_tag.dialect_of-1840"><span class="linenos">1840</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
</span><span id="language_tag.dialect_of-1841"><a href="#language_tag.dialect_of-1841"><span class="linenos">1841</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="language_tag.dialect_of-1842"><a href="#language_tag.dialect_of-1842"><span class="linenos">1842</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Is this language a dialect (or subset/specialization) of another.</p>

<p>This method returns True if this language is the same as or a
specialization (dialect) of the other language_tag.</p>

<p>If ignore_wildcard is False, then all languages will be
considered to be a dialect of the special language tag of "*".</p>
</div>


                            </div>
                </section>
                <section id="parse_accept_language_header">
                            <input id="parse_accept_language_header-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse_accept_language_header</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">header_value</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="parse_accept_language_header-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parse_accept_language_header"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parse_accept_language_header-1878"><a href="#parse_accept_language_header-1878"><span class="linenos">1878</span></a><span class="k">def</span> <span class="nf">parse_accept_language_header</span><span class="p">(</span> <span class="n">header_value</span> <span class="p">):</span>
</span><span id="parse_accept_language_header-1879"><a href="#parse_accept_language_header-1879"><span class="linenos">1879</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses the Accept-Language header.</span>
</span><span id="parse_accept_language_header-1880"><a href="#parse_accept_language_header-1880"><span class="linenos">1880</span></a>
</span><span id="parse_accept_language_header-1881"><a href="#parse_accept_language_header-1881"><span class="linenos">1881</span></a><span class="sd">    Returns a list of tuples, each like:</span>
</span><span id="parse_accept_language_header-1882"><a href="#parse_accept_language_header-1882"><span class="linenos">1882</span></a>
</span><span id="parse_accept_language_header-1883"><a href="#parse_accept_language_header-1883"><span class="linenos">1883</span></a><span class="sd">        (language_tag, qvalue, accept_parameters)</span>
</span><span id="parse_accept_language_header-1884"><a href="#parse_accept_language_header-1884"><span class="linenos">1884</span></a>
</span><span id="parse_accept_language_header-1885"><a href="#parse_accept_language_header-1885"><span class="linenos">1885</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="parse_accept_language_header-1886"><a href="#parse_accept_language_header-1886"><span class="linenos">1886</span></a>    <span class="n">alist</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">parse_qvalue_accept_list</span><span class="p">(</span> <span class="n">header_value</span><span class="p">)</span>
</span><span id="parse_accept_language_header-1887"><a href="#parse_accept_language_header-1887"><span class="linenos">1887</span></a>    <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_value</span><span class="p">):</span>
</span><span id="parse_accept_language_header-1888"><a href="#parse_accept_language_header-1888"><span class="linenos">1888</span></a>        <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Accept-Language header is invalid&#39;</span><span class="p">,</span><span class="n">header_value</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
</span><span id="parse_accept_language_header-1889"><a href="#parse_accept_language_header-1889"><span class="linenos">1889</span></a>
</span><span id="parse_accept_language_header-1890"><a href="#parse_accept_language_header-1890"><span class="linenos">1890</span></a>    <span class="n">langlist</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="parse_accept_language_header-1891"><a href="#parse_accept_language_header-1891"><span class="linenos">1891</span></a>    <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">langparms</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">acptparms</span> <span class="ow">in</span> <span class="n">alist</span><span class="p">:</span>
</span><span id="parse_accept_language_header-1892"><a href="#parse_accept_language_header-1892"><span class="linenos">1892</span></a>        <span class="k">if</span> <span class="n">langparms</span><span class="p">:</span>
</span><span id="parse_accept_language_header-1893"><a href="#parse_accept_language_header-1893"><span class="linenos">1893</span></a>            <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;Language tag may not have any parameters&#39;</span><span class="p">,</span><span class="n">header_value</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</span><span id="parse_accept_language_header-1894"><a href="#parse_accept_language_header-1894"><span class="linenos">1894</span></a>        <span class="n">lang</span> <span class="o">=</span> <span class="n">language_tag</span><span class="p">(</span> <span class="n">token</span> <span class="p">)</span>
</span><span id="parse_accept_language_header-1895"><a href="#parse_accept_language_header-1895"><span class="linenos">1895</span></a>        <span class="n">langlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">lang</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">acptparms</span><span class="p">)</span> <span class="p">)</span>
</span><span id="parse_accept_language_header-1896"><a href="#parse_accept_language_header-1896"><span class="linenos">1896</span></a>
</span><span id="parse_accept_language_header-1897"><a href="#parse_accept_language_header-1897"><span class="linenos">1897</span></a>    <span class="k">return</span> <span class="n">langlist</span>
</span></pre></div>


            <div class="docstring"><p>Parses the Accept-Language header.</p>

<p>Returns a list of tuples, each like:</p>

<pre><code>(language_tag, qvalue, accept_parameters)
</code></pre>
</div>


                </section>
                <section id="acceptable_language">
                            <input id="acceptable_language-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">acceptable_language</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">accept_header</span>,</span><span class="param">	<span class="n">server_languages</span>,</span><span class="param">	<span class="n">ignore_wildcard</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">assume_superiors</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="acceptable_language-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#acceptable_language"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="acceptable_language-1900"><a href="#acceptable_language-1900"><span class="linenos">1900</span></a><span class="k">def</span> <span class="nf">acceptable_language</span><span class="p">(</span> <span class="n">accept_header</span><span class="p">,</span> <span class="n">server_languages</span><span class="p">,</span> <span class="n">ignore_wildcard</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">assume_superiors</span><span class="o">=</span><span class="kc">True</span> <span class="p">):</span>
</span><span id="acceptable_language-1901"><a href="#acceptable_language-1901"><span class="linenos">1901</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Determines if the given language is acceptable to the user agent.</span>
</span><span id="acceptable_language-1902"><a href="#acceptable_language-1902"><span class="linenos">1902</span></a>
</span><span id="acceptable_language-1903"><a href="#acceptable_language-1903"><span class="linenos">1903</span></a><span class="sd">    The accept_header should be the value present in the HTTP</span>
</span><span id="acceptable_language-1904"><a href="#acceptable_language-1904"><span class="linenos">1904</span></a><span class="sd">    &quot;Accept-Language:&quot; header.  In mod_python this is typically</span>
</span><span id="acceptable_language-1905"><a href="#acceptable_language-1905"><span class="linenos">1905</span></a><span class="sd">    obtained from the req.http_headers_in table; in WSGI it is</span>
</span><span id="acceptable_language-1906"><a href="#acceptable_language-1906"><span class="linenos">1906</span></a><span class="sd">    environ[&quot;Accept-Language&quot;]; other web frameworks may provide other</span>
</span><span id="acceptable_language-1907"><a href="#acceptable_language-1907"><span class="linenos">1907</span></a><span class="sd">    methods of obtaining it.</span>
</span><span id="acceptable_language-1908"><a href="#acceptable_language-1908"><span class="linenos">1908</span></a>
</span><span id="acceptable_language-1909"><a href="#acceptable_language-1909"><span class="linenos">1909</span></a><span class="sd">    Optionally the accept_header parameter can be pre-parsed, as</span>
</span><span id="acceptable_language-1910"><a href="#acceptable_language-1910"><span class="linenos">1910</span></a><span class="sd">    returned by the parse_accept_language_header() function defined in</span>
</span><span id="acceptable_language-1911"><a href="#acceptable_language-1911"><span class="linenos">1911</span></a><span class="sd">    this module.</span>
</span><span id="acceptable_language-1912"><a href="#acceptable_language-1912"><span class="linenos">1912</span></a>
</span><span id="acceptable_language-1913"><a href="#acceptable_language-1913"><span class="linenos">1913</span></a><span class="sd">    The server_languages argument should either be a single language</span>
</span><span id="acceptable_language-1914"><a href="#acceptable_language-1914"><span class="linenos">1914</span></a><span class="sd">    string, a language_tag object, or a sequence of them.  It</span>
</span><span id="acceptable_language-1915"><a href="#acceptable_language-1915"><span class="linenos">1915</span></a><span class="sd">    represents the set of languages that the server is willing to</span>
</span><span id="acceptable_language-1916"><a href="#acceptable_language-1916"><span class="linenos">1916</span></a><span class="sd">    send to the user agent.</span>
</span><span id="acceptable_language-1917"><a href="#acceptable_language-1917"><span class="linenos">1917</span></a>
</span><span id="acceptable_language-1918"><a href="#acceptable_language-1918"><span class="linenos">1918</span></a><span class="sd">    Note that the wildcarded language tag &quot;*&quot; will be ignored.  To</span>
</span><span id="acceptable_language-1919"><a href="#acceptable_language-1919"><span class="linenos">1919</span></a><span class="sd">    override this, call with ignore_wildcard=False, and even then</span>
</span><span id="acceptable_language-1920"><a href="#acceptable_language-1920"><span class="linenos">1920</span></a><span class="sd">    it will be the lowest-priority choice regardless of it&#39;s</span>
</span><span id="acceptable_language-1921"><a href="#acceptable_language-1921"><span class="linenos">1921</span></a><span class="sd">    quality factor (as per HTTP spec).</span>
</span><span id="acceptable_language-1922"><a href="#acceptable_language-1922"><span class="linenos">1922</span></a>
</span><span id="acceptable_language-1923"><a href="#acceptable_language-1923"><span class="linenos">1923</span></a><span class="sd">    If the assume_superiors is True then it the languages that the</span>
</span><span id="acceptable_language-1924"><a href="#acceptable_language-1924"><span class="linenos">1924</span></a><span class="sd">    browser accepts will automatically include all superior languages.</span>
</span><span id="acceptable_language-1925"><a href="#acceptable_language-1925"><span class="linenos">1925</span></a><span class="sd">    Any superior languages which must be added are done so with one</span>
</span><span id="acceptable_language-1926"><a href="#acceptable_language-1926"><span class="linenos">1926</span></a><span class="sd">    half the qvalue of the language which is present.  For example, if</span>
</span><span id="acceptable_language-1927"><a href="#acceptable_language-1927"><span class="linenos">1927</span></a><span class="sd">    the accept string is &quot;en-US&quot;, then it will be treated as if it</span>
</span><span id="acceptable_language-1928"><a href="#acceptable_language-1928"><span class="linenos">1928</span></a><span class="sd">    were &quot;en-US, en;q=0.5&quot;.  Note that although the HTTP 1.1 spec says</span>
</span><span id="acceptable_language-1929"><a href="#acceptable_language-1929"><span class="linenos">1929</span></a><span class="sd">    that browsers are supposed to encourage users to configure all</span>
</span><span id="acceptable_language-1930"><a href="#acceptable_language-1930"><span class="linenos">1930</span></a><span class="sd">    acceptable languages, sometimes they don&#39;t, thus the ability</span>
</span><span id="acceptable_language-1931"><a href="#acceptable_language-1931"><span class="linenos">1931</span></a><span class="sd">    for this function to assume this.  But setting assume_superiors</span>
</span><span id="acceptable_language-1932"><a href="#acceptable_language-1932"><span class="linenos">1932</span></a><span class="sd">    to False will insure strict adherence to the HTTP 1.1 spec; which</span>
</span><span id="acceptable_language-1933"><a href="#acceptable_language-1933"><span class="linenos">1933</span></a><span class="sd">    means that if the browser accepts &quot;en-US&quot;, then it will not</span>
</span><span id="acceptable_language-1934"><a href="#acceptable_language-1934"><span class="linenos">1934</span></a><span class="sd">    be acceptable to send just &quot;en&quot; to it.</span>
</span><span id="acceptable_language-1935"><a href="#acceptable_language-1935"><span class="linenos">1935</span></a>
</span><span id="acceptable_language-1936"><a href="#acceptable_language-1936"><span class="linenos">1936</span></a><span class="sd">    This function returns the language which is the most prefered and</span>
</span><span id="acceptable_language-1937"><a href="#acceptable_language-1937"><span class="linenos">1937</span></a><span class="sd">    is acceptable to both the user agent and the caller.  It will</span>
</span><span id="acceptable_language-1938"><a href="#acceptable_language-1938"><span class="linenos">1938</span></a><span class="sd">    return None if no language is negotiable, otherwise the return</span>
</span><span id="acceptable_language-1939"><a href="#acceptable_language-1939"><span class="linenos">1939</span></a><span class="sd">    value is always an instance of language_tag.</span>
</span><span id="acceptable_language-1940"><a href="#acceptable_language-1940"><span class="linenos">1940</span></a>
</span><span id="acceptable_language-1941"><a href="#acceptable_language-1941"><span class="linenos">1941</span></a><span class="sd">    See also: RFC 3066 &lt;http://www.ietf.org/rfc/rfc3066.txt&gt;, and</span>
</span><span id="acceptable_language-1942"><a href="#acceptable_language-1942"><span class="linenos">1942</span></a><span class="sd">    ISO 639, links at &lt;http://en.wikipedia.org/wiki/ISO_639&gt;, and</span>
</span><span id="acceptable_language-1943"><a href="#acceptable_language-1943"><span class="linenos">1943</span></a><span class="sd">    &lt;http://www.iana.org/assignments/language-tags&gt;.</span>
</span><span id="acceptable_language-1944"><a href="#acceptable_language-1944"><span class="linenos">1944</span></a><span class="sd">    </span>
</span><span id="acceptable_language-1945"><a href="#acceptable_language-1945"><span class="linenos">1945</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="acceptable_language-1946"><a href="#acceptable_language-1946"><span class="linenos">1946</span></a>    <span class="c1"># Note special instructions from RFC 2616 sect. 14.1:</span>
</span><span id="acceptable_language-1947"><a href="#acceptable_language-1947"><span class="linenos">1947</span></a>    <span class="c1">#   &quot;The language quality factor assigned to a language-tag by the</span>
</span><span id="acceptable_language-1948"><a href="#acceptable_language-1948"><span class="linenos">1948</span></a>    <span class="c1">#   Accept-Language field is the quality value of the longest</span>
</span><span id="acceptable_language-1949"><a href="#acceptable_language-1949"><span class="linenos">1949</span></a>    <span class="c1">#   language- range in the field that matches the language-tag.&quot;</span>
</span><span id="acceptable_language-1950"><a href="#acceptable_language-1950"><span class="linenos">1950</span></a>
</span><span id="acceptable_language-1951"><a href="#acceptable_language-1951"><span class="linenos">1951</span></a>    <span class="k">if</span> <span class="n">_is_string</span><span class="p">(</span><span class="n">accept_header</span><span class="p">):</span>
</span><span id="acceptable_language-1952"><a href="#acceptable_language-1952"><span class="linenos">1952</span></a>        <span class="n">accept_list</span> <span class="o">=</span> <span class="n">parse_accept_language_header</span><span class="p">(</span><span class="n">accept_header</span><span class="p">)</span>
</span><span id="acceptable_language-1953"><a href="#acceptable_language-1953"><span class="linenos">1953</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="acceptable_language-1954"><a href="#acceptable_language-1954"><span class="linenos">1954</span></a>        <span class="n">accept_list</span> <span class="o">=</span> <span class="n">accept_header</span>
</span><span id="acceptable_language-1955"><a href="#acceptable_language-1955"><span class="linenos">1955</span></a>
</span><span id="acceptable_language-1956"><a href="#acceptable_language-1956"><span class="linenos">1956</span></a>    <span class="c1"># Possibly add in any &quot;missing&quot; languages that the browser may</span>
</span><span id="acceptable_language-1957"><a href="#acceptable_language-1957"><span class="linenos">1957</span></a>    <span class="c1"># have forgotten to include in the list. Insure list is sorted so</span>
</span><span id="acceptable_language-1958"><a href="#acceptable_language-1958"><span class="linenos">1958</span></a>    <span class="c1"># more general languages come before more specific ones.</span>
</span><span id="acceptable_language-1959"><a href="#acceptable_language-1959"><span class="linenos">1959</span></a>
</span><span id="acceptable_language-1960"><a href="#acceptable_language-1960"><span class="linenos">1960</span></a>    <span class="n">accept_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="acceptable_language-1961"><a href="#acceptable_language-1961"><span class="linenos">1961</span></a>    <span class="n">all_tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">accept_list</span><span class="p">]</span>
</span><span id="acceptable_language-1962"><a href="#acceptable_language-1962"><span class="linenos">1962</span></a>    <span class="k">if</span> <span class="n">assume_superiors</span><span class="p">:</span>
</span><span id="acceptable_language-1963"><a href="#acceptable_language-1963"><span class="linenos">1963</span></a>        <span class="n">to_add</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="acceptable_language-1964"><a href="#acceptable_language-1964"><span class="linenos">1964</span></a>        <span class="k">for</span> <span class="n">langtag</span><span class="p">,</span> <span class="n">qvalue</span><span class="p">,</span> <span class="n">aargs</span> <span class="ow">in</span> <span class="n">accept_list</span><span class="p">:</span>
</span><span id="acceptable_language-1965"><a href="#acceptable_language-1965"><span class="linenos">1965</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">langtag</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="acceptable_language-1966"><a href="#acceptable_language-1966"><span class="linenos">1966</span></a>                <span class="k">for</span> <span class="n">suptag</span> <span class="ow">in</span> <span class="n">langtag</span><span class="o">.</span><span class="n">all_superiors</span><span class="p">(</span> <span class="n">include_wildcard</span><span class="o">=</span><span class="kc">False</span> <span class="p">):</span>
</span><span id="acceptable_language-1967"><a href="#acceptable_language-1967"><span class="linenos">1967</span></a>                    <span class="k">if</span> <span class="n">suptag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_tags</span><span class="p">:</span>
</span><span id="acceptable_language-1968"><a href="#acceptable_language-1968"><span class="linenos">1968</span></a>                        <span class="c1"># Add in superior at half the qvalue</span>
</span><span id="acceptable_language-1969"><a href="#acceptable_language-1969"><span class="linenos">1969</span></a>                        <span class="n">to_add</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">suptag</span><span class="p">,</span> <span class="n">qvalue</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">)</span>
</span><span id="acceptable_language-1970"><a href="#acceptable_language-1970"><span class="linenos">1970</span></a>                        <span class="n">all_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">suptag</span> <span class="p">)</span>
</span><span id="acceptable_language-1971"><a href="#acceptable_language-1971"><span class="linenos">1971</span></a>        <span class="n">accept_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="n">to_add</span> <span class="p">)</span>
</span><span id="acceptable_language-1972"><a href="#acceptable_language-1972"><span class="linenos">1972</span></a>
</span><span id="acceptable_language-1973"><a href="#acceptable_language-1973"><span class="linenos">1973</span></a>    <span class="c1"># Convert server_languages to a list of language_tags</span>
</span><span id="acceptable_language-1974"><a href="#acceptable_language-1974"><span class="linenos">1974</span></a>    <span class="k">if</span> <span class="n">_is_string</span><span class="p">(</span><span class="n">server_languages</span><span class="p">):</span>
</span><span id="acceptable_language-1975"><a href="#acceptable_language-1975"><span class="linenos">1975</span></a>        <span class="n">server_languages</span> <span class="o">=</span> <span class="p">[</span><span class="n">language_tag</span><span class="p">(</span><span class="n">server_languages</span><span class="p">)]</span>
</span><span id="acceptable_language-1976"><a href="#acceptable_language-1976"><span class="linenos">1976</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_languages</span><span class="p">,</span> <span class="n">language_tag</span><span class="p">):</span>
</span><span id="acceptable_language-1977"><a href="#acceptable_language-1977"><span class="linenos">1977</span></a>        <span class="n">server_languages</span> <span class="o">=</span> <span class="p">[</span><span class="n">server_languages</span><span class="p">]</span>
</span><span id="acceptable_language-1978"><a href="#acceptable_language-1978"><span class="linenos">1978</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="acceptable_language-1979"><a href="#acceptable_language-1979"><span class="linenos">1979</span></a>        <span class="n">server_languages</span> <span class="o">=</span> <span class="p">[</span><span class="n">language_tag</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span> <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">server_languages</span><span class="p">]</span>
</span><span id="acceptable_language-1980"><a href="#acceptable_language-1980"><span class="linenos">1980</span></a>
</span><span id="acceptable_language-1981"><a href="#acceptable_language-1981"><span class="linenos">1981</span></a>    <span class="c1"># Select the best one</span>
</span><span id="acceptable_language-1982"><a href="#acceptable_language-1982"><span class="linenos">1982</span></a>    <span class="n">best</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># tuple (langtag, qvalue, matchlen)</span>
</span><span id="acceptable_language-1983"><a href="#acceptable_language-1983"><span class="linenos">1983</span></a>    
</span><span id="acceptable_language-1984"><a href="#acceptable_language-1984"><span class="linenos">1984</span></a>    <span class="k">for</span> <span class="n">langtag</span><span class="p">,</span> <span class="n">qvalue</span><span class="p">,</span> <span class="n">aargs</span> <span class="ow">in</span> <span class="n">accept_list</span><span class="p">:</span>
</span><span id="acceptable_language-1985"><a href="#acceptable_language-1985"><span class="linenos">1985</span></a>        <span class="c1"># aargs is ignored for Accept-Language</span>
</span><span id="acceptable_language-1986"><a href="#acceptable_language-1986"><span class="linenos">1986</span></a>        <span class="k">if</span> <span class="n">qvalue</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="acceptable_language-1987"><a href="#acceptable_language-1987"><span class="linenos">1987</span></a>            <span class="k">continue</span> <span class="c1"># UA doesn&#39;t accept this language</span>
</span><span id="acceptable_language-1988"><a href="#acceptable_language-1988"><span class="linenos">1988</span></a>
</span><span id="acceptable_language-1989"><a href="#acceptable_language-1989"><span class="linenos">1989</span></a>        <span class="k">if</span> <span class="n">ignore_wildcard</span> <span class="ow">and</span> <span class="n">langtag</span><span class="o">.</span><span class="n">is_universal_wildcard</span><span class="p">():</span>
</span><span id="acceptable_language-1990"><a href="#acceptable_language-1990"><span class="linenos">1990</span></a>            <span class="k">continue</span>  <span class="c1"># &quot;*&quot; being ignored</span>
</span><span id="acceptable_language-1991"><a href="#acceptable_language-1991"><span class="linenos">1991</span></a>
</span><span id="acceptable_language-1992"><a href="#acceptable_language-1992"><span class="linenos">1992</span></a>        <span class="k">for</span> <span class="n">svrlang</span> <span class="ow">in</span> <span class="n">server_languages</span><span class="p">:</span>
</span><span id="acceptable_language-1993"><a href="#acceptable_language-1993"><span class="linenos">1993</span></a>            <span class="c1"># The best match is determined first by the quality factor,</span>
</span><span id="acceptable_language-1994"><a href="#acceptable_language-1994"><span class="linenos">1994</span></a>            <span class="c1"># and then by the most specific match.</span>
</span><span id="acceptable_language-1995"><a href="#acceptable_language-1995"><span class="linenos">1995</span></a>
</span><span id="acceptable_language-1996"><a href="#acceptable_language-1996"><span class="linenos">1996</span></a>            <span class="n">matchlen</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1"># how specifically this one matches (0 is a non-match)</span>
</span><span id="acceptable_language-1997"><a href="#acceptable_language-1997"><span class="linenos">1997</span></a>            <span class="k">if</span> <span class="n">svrlang</span><span class="o">.</span><span class="n">dialect_of</span><span class="p">(</span> <span class="n">langtag</span><span class="p">,</span> <span class="n">ignore_wildcard</span><span class="o">=</span><span class="n">ignore_wildcard</span> <span class="p">):</span>
</span><span id="acceptable_language-1998"><a href="#acceptable_language-1998"><span class="linenos">1998</span></a>                <span class="n">matchlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">langtag</span><span class="p">)</span>
</span><span id="acceptable_language-1999"><a href="#acceptable_language-1999"><span class="linenos">1999</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">best</span> \
</span><span id="acceptable_language-2000"><a href="#acceptable_language-2000"><span class="linenos">2000</span></a>                       <span class="ow">or</span> <span class="n">matchlen</span> <span class="o">&gt;</span> <span class="n">best</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> \
</span><span id="acceptable_language-2001"><a href="#acceptable_language-2001"><span class="linenos">2001</span></a>                       <span class="ow">or</span> <span class="p">(</span><span class="n">matchlen</span> <span class="o">==</span> <span class="n">best</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="n">qvalue</span> <span class="o">&gt;</span> <span class="n">best</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="acceptable_language-2002"><a href="#acceptable_language-2002"><span class="linenos">2002</span></a>                    <span class="c1"># This match is better</span>
</span><span id="acceptable_language-2003"><a href="#acceptable_language-2003"><span class="linenos">2003</span></a>                    <span class="n">best</span> <span class="o">=</span> <span class="p">(</span><span class="n">langtag</span><span class="p">,</span> <span class="n">qvalue</span><span class="p">,</span> <span class="n">matchlen</span><span class="p">)</span>
</span><span id="acceptable_language-2004"><a href="#acceptable_language-2004"><span class="linenos">2004</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">best</span><span class="p">:</span>
</span><span id="acceptable_language-2005"><a href="#acceptable_language-2005"><span class="linenos">2005</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="acceptable_language-2006"><a href="#acceptable_language-2006"><span class="linenos">2006</span></a>    <span class="k">return</span> <span class="n">best</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Determines if the given language is acceptable to the user agent.</p>

<p>The accept_header should be the value present in the HTTP
"Accept-Language:" header.  In mod_python this is typically
obtained from the req.http_headers_in table; in WSGI it is
environ["Accept-Language"]; other web frameworks may provide other
methods of obtaining it.</p>

<p>Optionally the accept_header parameter can be pre-parsed, as
returned by the parse_accept_language_header() function defined in
this module.</p>

<p>The server_languages argument should either be a single language
string, a language_tag object, or a sequence of them.  It
represents the set of languages that the server is willing to
send to the user agent.</p>

<p>Note that the wildcarded language tag "*" will be ignored.  To
override this, call with ignore_wildcard=False, and even then
it will be the lowest-priority choice regardless of it's
quality factor (as per HTTP spec).</p>

<p>If the assume_superiors is True then it the languages that the
browser accepts will automatically include all superior languages.
Any superior languages which must be added are done so with one
half the qvalue of the language which is present.  For example, if
the accept string is "en-US", then it will be treated as if it
were "en-US, en;q=0.5".  Note that although the HTTP 1.1 spec says
that browsers are supposed to encourage users to configure all
acceptable languages, sometimes they don't, thus the ability
for this function to assume this.  But setting assume_superiors
to False will insure strict adherence to the HTTP 1.1 spec; which
means that if the browser accepts "en-US", then it will not
be acceptable to send just "en" to it.</p>

<p>This function returns the language which is the most prefered and
is acceptable to both the user agent and the caller.  It will
return None if no language is negotiable, otherwise the return
value is always an instance of language_tag.</p>

<p>See also: RFC 3066 <a href="http://www.ietf.org/rfc/rfc3066.txt">http://www.ietf.org/rfc/rfc3066.txt</a>, and
ISO 639, links at <a href="http://en.wikipedia.org/wiki/ISO_639">http://en.wikipedia.org/wiki/ISO_639</a>, and
<a href="http://www.iana.org/assignments/language-tags">http://www.iana.org/assignments/language-tags</a>.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>